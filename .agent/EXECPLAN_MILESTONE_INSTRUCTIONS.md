# Implement Jan 26 Milestones 1–6 (Schema, Storage, Routes, API Client, Prompts, Ingestion UI)

This ExecPlan is a living document. The sections Progress, Surprises & Discoveries, Decision Log, and Outcomes & Retrospective must be kept up to date as work proceeds.

This document must be maintained in accordance with `C:/pt-study-sop/.agent/PLANS.md`.

## Purpose / Big Picture

After this change, the dashboard can ingest course schedules, modules, and learning objectives through API endpoints and a new Brain “Ingestion” tab. A user can paste JSON generated by ChatGPT into the UI to create schedule events and learning objectives tied to a course/module, then verify the new data through the API or UI. This enables a full material-ingestion workflow without breaking existing sessions/courses behavior.

## Progress

- [x] (2026-01-24 00:00) Added new schema tables (`schedule_events`, `modules`, `learning_objectives`, `lo_sessions`) and `sessions.source_lock` column; created `shared/schema.ts` re-export.
- [x] (2026-01-24 00:00) Implemented storage CRUD for schedule events, modules, learning objectives, LO sessions, and last-session context.
- [x] (2026-01-24 00:00) Implemented REST routes for schedule events, modules, learning objectives, LO sessions, and session context.
- [x] (2026-01-24 00:00) Updated API client to include schedule events, modules, learning objectives, LO sessions, and session context.
- [x] (2026-01-24 00:00) Added ChatGPT prompt files under `JANUARY_26_PLAN/PROMPTS/`.
- [x] (2026-01-24 00:00) Added Brain Ingestion UI component and tab.
- [x] (2026-01-24 00:00) Added README files in touched folders per AGENTS rule.
- [x] (2026-01-24 00:00) Ran `npm run db:push`; attempted `npm run check` (see Surprises).

## Surprises & Discoveries

- `npm run check` currently fails due to pre-existing TypeScript issues unrelated to the milestones (missing `AcademicDeadline` type, missing `@/hooks/use-mobile`, and various typing errors in existing pages). These failures predate the milestone work and should be addressed separately before expecting a clean typecheck.

## Decision Log

- Decision: Use `JANUARY_26_PLAN/MILESTONE_INSTRUCTIONS.md` as the execution guide and treat other plan docs as non-authoritative for this implementation.
  Rationale: User explicitly selected this as the source of truth; it is the most complete step-by-step guide.
  Date/Author: 2026-01-24 / Codex

- Decision: Keep field naming aligned to `MILESTONE_INSTRUCTIONS.md` (`dueDate`, `loCode`, `sourceLock`) and store dates as strings where specified.
  Rationale: Preserve backward compatibility and consistency with the chosen source of truth.
  Date/Author: 2026-01-24 / Codex

## Outcomes & Retrospective

All six milestones are implemented. The system now supports schedule event, module, and learning-objective ingestion via API and UI, with prompts included for ChatGPT extraction. The only blocking issue for typecheck is pre-existing TypeScript errors in unrelated files.

## Context and Orientation

This repository’s dashboard rebuild lives at `dashboard_rebuild/`. The server is an Express API under `dashboard_rebuild/server`, and the React client is under `dashboard_rebuild/client`. The schema is managed by Drizzle in `dashboard_rebuild/schema.ts`. The client imports shared types from `@shared/schema`, which maps to `dashboard_rebuild/shared/schema.ts`. This change adds tables and endpoints to store course schedule events, modules, and learning objectives, along with a Brain “Ingestion” UI for importing those via JSON.

Key paths:
- `dashboard_rebuild/schema.ts` — database schema.
- `dashboard_rebuild/shared/schema.ts` — re-export for `@shared/schema`.
- `dashboard_rebuild/server/storage.ts` — storage layer for CRUD.
- `dashboard_rebuild/server/routes.ts` — API routes.
- `dashboard_rebuild/client/src/api.ts` — client API bindings.
- `dashboard_rebuild/client/src/components/IngestionTab.tsx` — new UI component.
- `dashboard_rebuild/client/src/pages/brain.tsx` — adds Ingestion tab.
- `JANUARY_26_PLAN/PROMPTS/*.md` — ChatGPT prompts.

## Plan of Work

Update the schema to add `schedule_events`, `modules`, `learning_objectives`, and `lo_sessions`, and add a `source_lock` column to `sessions`. Create `dashboard_rebuild/shared/schema.ts` to re-export the schema for client imports. Extend `IStorage` and `DatabaseStorage` in `dashboard_rebuild/server/storage.ts` with CRUD for the new tables and a `getLastSessionContext` method. Add REST endpoints in `dashboard_rebuild/server/routes.ts` for schedule events, modules, learning objectives, LO sessions, and last-session context. Expand the client API in `dashboard_rebuild/client/src/api.ts` to match those routes. Add prompt files under `JANUARY_26_PLAN/PROMPTS/`. Create `IngestionTab.tsx` to allow course selection and JSON import in the Brain page, and add an `INGESTION` tab in `dashboard_rebuild/client/src/pages/brain.tsx`.

## Concrete Steps

From `C:/pt-study-sop/dashboard_rebuild`:

1) Schema changes:
   - Add the new tables and `sessions.source_lock` in `schema.ts`.
   - Create `shared/schema.ts` to re-export from `../schema.ts`.

2) Apply DB changes:
   - Run `npm run db:push`.

3) Storage layer:
   - Update imports in `server/storage.ts` to include new tables/types.
   - Add CRUD methods for schedule events, modules, learning objectives, lo sessions, and `getLastSessionContext`.

4) Routes:
   - Add REST endpoints in `server/routes.ts`:
     - `GET /api/schedule-events?courseId=1`
     - `POST /api/schedule-events`
     - `POST /api/schedule-events/bulk`
     - `PATCH /api/schedule-events/:id`
     - `DELETE /api/schedule-events/:id`
     - `GET /api/modules?courseId=1`
     - `GET /api/modules/:id`
     - `POST /api/modules`
     - `POST /api/modules/bulk`
     - `PATCH /api/modules/:id`
     - `DELETE /api/modules/:id`
     - `GET /api/learning-objectives?courseId=1|moduleId=1`
     - `GET /api/learning-objectives/:id`
     - `POST /api/learning-objectives`
     - `POST /api/learning-objectives/bulk`
     - `PATCH /api/learning-objectives/:id`
     - `DELETE /api/learning-objectives/:id`
     - `POST /api/lo-sessions`
     - `GET /api/sessions/last-context?courseId=1`

5) Client API:
   - Add `scheduleEvents`, `modules`, `learningObjectives`, `loSessions`, and `sessionContext` to `client/src/api.ts`.

6) Prompts:
   - Create prompt files under `JANUARY_26_PLAN/PROMPTS/`.

7) UI:
   - Add `client/src/components/IngestionTab.tsx`.
   - Add `INGESTION` tab in `client/src/pages/brain.tsx` and render `IngestionTab`.

## Validation and Acceptance

- Run `npm run db:push` and verify the new tables exist in the DB.
- Run `npm run check`; note it currently fails due to pre-existing TypeScript errors (see Surprises).
- Run `npm run dev`, open `http://localhost:5000/brain`, and confirm:
  - The `INGESTION` tab appears.
  - Course selection works.
  - Copy prompt buttons work.
  - JSON import buttons call the API without client errors.
- API checks (while server running):
  - `GET /api/schedule-events?courseId=1` returns an array (empty if none).
  - `GET /api/modules?courseId=1` returns an array (empty if none).
  - `GET /api/learning-objectives?courseId=1` returns an array (empty if none).
  - `GET /api/sessions/last-context` returns an object with `lastSession`, `course`, `recentLos`.

## Idempotence and Recovery

- Schema changes are additive; re-running `npm run db:push` is safe.
- If `data.db` becomes inconsistent, restore from `data.db.backup` and re-run the migration.

## Artifacts and Notes

- `dashboard_rebuild/shared/schema.ts` re-exports schema for `@shared/schema` imports.
- Prompts live under `JANUARY_26_PLAN/PROMPTS/` for manual ingestion workflows.

## Interfaces and Dependencies

- Storage interface: `IStorage` in `dashboard_rebuild/server/storage.ts` includes new CRUD methods for schedule events, modules, learning objectives, LO sessions, and `getLastSessionContext`.
- Routes: new endpoints in `dashboard_rebuild/server/routes.ts` mirror those methods.
- Client API: `dashboard_rebuild/client/src/api.ts` exposes matching functions for UI use.

Note: This ExecPlan was created after implementation to document the completed work; it must still be maintained per PLANS.md for future changes.
