import{r as n,j as t}from"./index-DQdAKonc.js";import{F as V}from"./react-force-graph-2d-DjHp7Sm5.js";import{p as H,S as Z}from"./layout-veyEtZar.js";import{C as R}from"./checkbox-DG1NANI0.js";import"./zoom-DwwqPMg_.js";import"./index-Ch5KUB_m.js";const F={"":"#6366f1",School:"#22d3ee",Clinical:"#f472b6",Research:"#a78bfa",Personal:"#34d399"};function z(f){const p=f.split("/")[0];return F[p]||"#6366f1"}function J({onNodeClick:f}){const p=n.useRef(null),u=n.useRef(),[l,E]=n.useState({nodes:[],links:[]}),[k,g]=n.useState(!0),[b,S]=n.useState(null),[y,O]=n.useState(null),[w,D]=n.useState(null),[x,N]=n.useState(1),[c,j]=n.useState(new Set),[C,L]=n.useState(!1);n.useEffect(()=>{const e=p.current;if(!e)return;const s=()=>{const a=e.getBoundingClientRect();O({width:Math.max(1,Math.floor(a.width)-2),height:Math.max(1,Math.floor(a.height)-2)})};s();const r=new ResizeObserver(s);return r.observe(e),()=>r.disconnect()},[]),n.useEffect(()=>{let e=!1;return g(!0),H.obsidian.getGraph().then(s=>{e||(s.success?E({nodes:s.nodes,links:s.links}):S("Failed to load graph data"),g(!1))}).catch(()=>{e||(S("Network error loading graph"),g(!1))}),()=>{e=!0}},[]);const o=n.useMemo(()=>{const e=new Set;for(const s of l.nodes){const r=s.folder?.split("/")[0]||"(root)";e.add(r)}return Array.from(e).sort()},[l.nodes]);n.useEffect(()=>{o.length>0&&!C&&(L(!0),j(new Set(o)))},[o,C]);const m=n.useMemo(()=>{if(c.size===0||c.size===o.length)return l;const e=new Set,s=l.nodes.filter(a=>{const h=a.folder?.split("/")[0]||"(root)",i=c.has(h);return i&&e.add(a.id),i}),r=l.links.filter(a=>{const h=typeof a.source=="string"?a.source:a.source.id,i=typeof a.target=="string"?a.target:a.target.id;return e.has(h)&&e.has(i)});return{nodes:s,links:r}},[l,c,o.length]),I=e=>{j(s=>{const r=new Set(s);return r.has(e)?r.delete(e):r.add(e),r})},A=n.useCallback(e=>{f?.(e.name)},[f]),v=n.useCallback(e=>{const s=Math.max(.1,Math.min(10,e));N(s);const r=u.current;r?.zoom&&r.zoom(s,200)},[]),P=n.useCallback((e,s,r)=>{const a=e.name,h=Math.max(10/r,2),i=Math.max(4,3+m.links.filter(d=>(typeof d.source=="string"?d.source:d.source.id)===e.id||(typeof d.target=="string"?d.target:d.target.id)===e.id).length*.5),G=z(e.folder),M=w?.id===e.id;s.beginPath(),s.arc(e.x||0,e.y||0,i,0,2*Math.PI),s.fillStyle=M?"#ffffff":G,s.fill(),(M||r>1.5)&&(s.font=`${h}px monospace`,s.textAlign="center",s.textBaseline="top",s.fillStyle="rgba(255,255,255,0.9)",s.fillText(a,e.x||0,(e.y||0)+i+2))},[m.links,w]),T=!k&&!b&&y;return t.jsxs("div",{className:"flex h-full",children:[t.jsx("div",{className:"w-[180px] shrink-0 border-r border-secondary/30 bg-black/60",children:t.jsx(Z,{className:"h-full",children:t.jsxs("div",{className:"p-3 space-y-3",children:[t.jsx("div",{className:"font-arcade text-[10px] text-primary mb-2",children:"FOLDERS"}),t.jsxs("label",{className:"flex items-center gap-2 py-1 cursor-pointer",children:[t.jsx(R,{checked:c.size===o.length,onCheckedChange:e=>{j(e?new Set(o):new Set)},className:"border-primary data-[state=checked]:bg-primary"}),t.jsx("span",{className:"font-terminal text-xs text-primary",children:"All Folders"})]}),o.map(e=>t.jsxs("label",{className:"flex items-center gap-2 py-0.5 cursor-pointer",children:[t.jsx(R,{checked:c.has(e),onCheckedChange:()=>I(e),className:"border-primary data-[state=checked]:bg-primary"}),t.jsx("span",{className:"font-terminal text-xs truncate",style:{color:z(e==="(root)"?"":e)},children:e})]},e)),t.jsxs("div",{className:"pt-2 border-t border-secondary/30 space-y-1",children:[t.jsx("div",{className:"font-arcade text-[10px] text-muted-foreground mb-1",children:"COLORS"}),Object.entries(F).filter(([e])=>e).map(([e,s])=>t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-2.5 h-2.5 rounded-full",style:{backgroundColor:s}}),t.jsx("span",{className:"font-terminal text-[10px]",style:{color:s},children:e})]},e))]}),t.jsxs("div",{className:"pt-2 border-t border-secondary/30 font-terminal text-[10px] text-muted-foreground",children:[t.jsxs("div",{children:["Notes: ",m.nodes.length]}),t.jsxs("div",{children:["Links: ",m.links.length]})]})]})})}),t.jsxs("div",{ref:p,className:"flex-1 relative bg-black/80 rounded border border-primary/30 overflow-hidden",children:[k&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-primary font-terminal z-10",children:t.jsx("div",{className:"animate-pulse",children:"SCANNING VAULT CONNECTIONS..."})}),b&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-red-400 font-terminal z-10",children:b}),T&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"absolute top-2 left-2 right-2 z-10 flex items-center justify-between pointer-events-none",children:[t.jsx("div",{className:"flex items-center gap-2 pointer-events-auto",children:t.jsx("button",{onClick:()=>{u.current?.zoomToFit?.(400,40),setTimeout(()=>{const e=u.current;e?.zoom&&N(e.zoom())},450)},className:"px-2 py-0.5 text-xs font-terminal bg-primary/20 border border-primary/40 text-primary hover:bg-primary/30 rounded-none",children:"CENTER"})}),t.jsxs("div",{className:"flex items-center gap-1.5 pointer-events-auto bg-black/70 border border-primary/30 rounded-none px-2 py-1",children:[t.jsx("button",{onClick:()=>v(x/1.3),className:"text-primary hover:text-white font-mono text-sm w-5 h-5 flex items-center justify-center",children:"-"}),t.jsx("input",{type:"range",min:-2.3,max:2.3,step:.01,value:Math.log(x),onChange:e=>v(Math.exp(parseFloat(e.target.value))),className:"w-24 h-1 accent-primary cursor-pointer"}),t.jsx("button",{onClick:()=>v(x*1.3),className:"text-primary hover:text-white font-mono text-sm w-5 h-5 flex items-center justify-center",children:"+"}),t.jsxs("span",{className:"text-[10px] font-terminal text-primary/50 w-8 text-right",children:[Math.round(x*100),"%"]})]})]}),t.jsx(V,{ref:u,graphData:m,width:y.width,height:y.height,nodeCanvasObject:P,nodePointerAreaPaint:(e,s,r)=>{r.beginPath(),r.arc(e.x||0,e.y||0,6,0,2*Math.PI),r.fillStyle=s,r.fill()},onNodeClick:A,onNodeHover:e=>D(e),onZoom:({k:e})=>N(e),linkColor:()=>"rgba(99, 102, 241, 0.15)",linkWidth:.5,backgroundColor:"transparent",cooldownTicks:100,d3AlphaDecay:.02,d3VelocityDecay:.3})]})]})]})}export{J as VaultGraphView};
