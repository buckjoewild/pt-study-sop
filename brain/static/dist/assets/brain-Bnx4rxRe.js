const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ConceptMapEditor-tQxxK8-j.js","assets/index-BVqBUaUZ.js","assets/index-DzbGgZmI.css","assets/zoom-DwwqPMg_.js","assets/layout-BKsO2JfQ.js","assets/plus-BN5qIo2G.js","assets/file-text-BTC0_hpX.js","assets/badge-BkuFmKJb.js","assets/circle-check-DssJqdq7.js","assets/circle-DgqYU0W9.js","assets/star-Bu8SsvsT.js","assets/index-B-5vpBbe.js","assets/search-Bh6kJEel.js","assets/select-YdSdKwW-.js","assets/index-DpsEiTZH.js","assets/checkbox-Dm_ePY6N.js","assets/tabs-DoA7ZF7r.js","assets/message-square-Br1IbiIu.js","assets/loader-circle-oc_4DvbM.js","assets/send-BRgcVuPD.js","assets/external-link-qmGTJy6j.js","assets/ConceptMapEditor-BZV40eAE.css","assets/VaultGraphView-BEFA5tOK.js","assets/react-force-graph-2d-bHDLLv5H.js","assets/MindMapView-DeV1tAK9.js"])))=>i.map(i=>d[i]);
import{c as se,r as c,R as kn,j as n,b as ye,f as Pr,a as En,P as at,u as Mt,g as Rr,h as Ir,d as ot,X as Et,_ as At,e as Tt}from"./index-BVqBUaUZ.js";import{q as zr,u as ee,p as q,B as K,I as De,S as Ge,r as Mr,f as Dt,h as $t,i as Ot,j as Lt,k as _t,o as Pt,s as Ft,m as Xe,e as ve,n as pt,l as Ze,t as en,v as Ar,L as Tr}from"./layout-BKsO2JfQ.js";import{B as et,C as $e,a as Oe,b as Le,c as _e}from"./badge-BkuFmKJb.js";import{C as Dr}from"./circle-check-DssJqdq7.js";import{C as Pn}from"./circle-DgqYU0W9.js";import{A as $r,S as Or}from"./star-Bu8SsvsT.js";import{F as Rn,M as Lr,r as _r,D as Fr}from"./index-B-5vpBbe.js";import{S as Hr,R as ht}from"./search-Bh6kJEel.js";import{F as Ht}from"./file-text-BTC0_hpX.js";import{C as qr,S as Vr,a as Gr,b as Br,c as Kr,d as Ce}from"./select-YdSdKwW-.js";import{C as Ur,u as Wr}from"./index-DpsEiTZH.js";import{C as In}from"./checkbox-Dm_ePY6N.js";import{c as zn,R as Jr,I as Yr,T as Qr,a as Xr,b as xt,d as gt,C as Zr,L as Be}from"./tabs-DoA7ZF7r.js";import{M as Mn}from"./message-square-Br1IbiIu.js";import{L as qt}from"./loader-circle-oc_4DvbM.js";import{S as es}from"./send-BRgcVuPD.js";import{E as ts}from"./external-link-qmGTJy6j.js";import{P as tn}from"./plus-BN5qIo2G.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],rs=se("arrow-left",ns);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M9 13a4.5 4.5 0 0 0 3-4",key:"10igwf"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M12 13h4",key:"1ku699"}],["path",{d:"M12 18h6a2 2 0 0 1 2 2v1",key:"105ag5"}],["path",{d:"M12 8h8",key:"1lhi5i"}],["path",{d:"M16 8V5a2 2 0 0 1 2-2",key:"u6izg6"}],["circle",{cx:"16",cy:"13",r:".5",key:"ry7gng"}],["circle",{cx:"18",cy:"3",r:".5",key:"1aiba7"}],["circle",{cx:"20",cy:"21",r:".5",key:"yhc1fs"}],["circle",{cx:"20",cy:"8",r:".5",key:"1e43v0"}]],as=se("brain-circuit",ss);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],nn=se("calendar-days",os);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M12 3v18",key:"108xh3"}]],ls=se("columns-2",is);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],ds=se("copy",cs);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Vt=se("download",us);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ms=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]],fs=se("file",ms);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ps=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],hs=se("folder",ps);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xs=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],gs=se("image",xs);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bs=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],ys=se("maximize-2",bs);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vs=[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]],ws=se("minimize-2",vs);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ns=[["rect",{x:"16",y:"16",width:"6",height:"6",rx:"1",key:"4q2zg0"}],["rect",{x:"2",y:"16",width:"6",height:"6",rx:"1",key:"8cvhb9"}],["rect",{x:"9",y:"2",width:"6",height:"6",rx:"1",key:"1egb70"}],["path",{d:"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3",key:"1jsf9p"}],["path",{d:"M12 12V8",key:"2874zd"}]],js=se("network",Ns);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ss=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 12h18",key:"1i2n21"}]],Cs=se("rows-2",Ss);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ks=[["path",{d:"M9 3H5a2 2 0 0 0-2 2v4m6-6h10a2 2 0 0 1 2 2v4M9 3v18m0 0h10a2 2 0 0 0 2-2V9M9 21H5a2 2 0 0 1-2-2V9m0 0h18",key:"gugj83"}]],Es=se("table-2",ks),it=c.createContext(null);it.displayName="PanelGroupContext";const Q={group:"data-panel-group",groupDirection:"data-panel-group-direction",groupId:"data-panel-group-id",panel:"data-panel",panelCollapsible:"data-panel-collapsible",panelId:"data-panel-id",panelSize:"data-panel-size",resizeHandle:"data-resize-handle",resizeHandleActive:"data-resize-handle-active",resizeHandleEnabled:"data-panel-resize-handle-enabled",resizeHandleId:"data-panel-resize-handle-id",resizeHandleState:"data-resize-handle-state"},Gt=10,Pe=c.useLayoutEffect,rn=kn.useId,Ps=typeof rn=="function"?rn:()=>null;let Rs=0;function Bt(e=null){const t=Ps(),r=c.useRef(e||t||null);return r.current===null&&(r.current=""+Rs++),e??r.current}function An({children:e,className:t="",collapsedSize:r,collapsible:s,defaultSize:a,forwardedRef:o,id:i,maxSize:l,minSize:d,onCollapse:f,onExpand:b,onResize:y,order:p,style:v,tagName:N="div",...x}){const h=c.useContext(it);if(h===null)throw Error("Panel components must be rendered within a PanelGroup container");const{collapsePanel:m,expandPanel:g,getPanelSize:k,getPanelStyle:P,groupId:D,isPanelCollapsed:M,reevaluatePanelConstraints:I,registerPanel:w,resizePanel:L,unregisterPanel:O}=h,T=Bt(i),F=c.useRef({callbacks:{onCollapse:f,onExpand:b,onResize:y},constraints:{collapsedSize:r,collapsible:s,defaultSize:a,maxSize:l,minSize:d},id:T,idIsFromProps:i!==void 0,order:p});c.useRef({didLogMissingDefaultSizeWarning:!1}),Pe(()=>{const{callbacks:V,constraints:G}=F.current,J={...G};F.current.id=T,F.current.idIsFromProps=i!==void 0,F.current.order=p,V.onCollapse=f,V.onExpand=b,V.onResize=y,G.collapsedSize=r,G.collapsible=s,G.defaultSize=a,G.maxSize=l,G.minSize=d,(J.collapsedSize!==G.collapsedSize||J.collapsible!==G.collapsible||J.maxSize!==G.maxSize||J.minSize!==G.minSize)&&I(F.current,J)}),Pe(()=>{const V=F.current;return w(V),()=>{O(V)}},[p,T,w,O]),c.useImperativeHandle(o,()=>({collapse:()=>{m(F.current)},expand:V=>{g(F.current,V)},getId(){return T},getSize(){return k(F.current)},isCollapsed(){return M(F.current)},isExpanded(){return!M(F.current)},resize:V=>{L(F.current,V)}}),[m,g,k,M,T,L]);const Z=P(F.current,a);return c.createElement(N,{...x,children:e,className:t,id:T,style:{...Z,...v},[Q.groupId]:D,[Q.panel]:"",[Q.panelCollapsible]:s||void 0,[Q.panelId]:T,[Q.panelSize]:parseFloat(""+Z.flexGrow).toFixed(1)})}const Tn=c.forwardRef((e,t)=>c.createElement(An,{...e,forwardedRef:t}));An.displayName="Panel";Tn.displayName="forwardRef(Panel)";let Rt=null,Qe=-1,je=null;function Is(e,t){if(t){const r=(t&_n)!==0,s=(t&Fn)!==0,a=(t&Hn)!==0,o=(t&qn)!==0;if(r)return a?"se-resize":o?"ne-resize":"e-resize";if(s)return a?"sw-resize":o?"nw-resize":"w-resize";if(a)return"s-resize";if(o)return"n-resize"}switch(e){case"horizontal":return"ew-resize";case"intersection":return"move";case"vertical":return"ns-resize"}}function zs(){je!==null&&(document.head.removeChild(je),Rt=null,je=null,Qe=-1)}function bt(e,t){var r,s;const a=Is(e,t);if(Rt!==a){if(Rt=a,je===null&&(je=document.createElement("style"),document.head.appendChild(je)),Qe>=0){var o;(o=je.sheet)===null||o===void 0||o.removeRule(Qe)}Qe=(r=(s=je.sheet)===null||s===void 0?void 0:s.insertRule(`*{cursor: ${a} !important;}`))!==null&&r!==void 0?r:-1}}function Dn(e){return e.type==="keydown"}function $n(e){return e.type.startsWith("pointer")}function On(e){return e.type.startsWith("mouse")}function lt(e){if($n(e)){if(e.isPrimary)return{x:e.clientX,y:e.clientY}}else if(On(e))return{x:e.clientX,y:e.clientY};return{x:1/0,y:1/0}}function Ms(){if(typeof matchMedia=="function")return matchMedia("(pointer:coarse)").matches?"coarse":"fine"}function As(e,t,r){return e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.y+e.height>t.y}function Ts(e,t){if(e===t)throw new Error("Cannot compare node with itself");const r={a:on(e),b:on(t)};let s;for(;r.a.at(-1)===r.b.at(-1);)e=r.a.pop(),t=r.b.pop(),s=e;$(s,"Stacking order can only be calculated for elements with a common ancestor");const a={a:an(sn(r.a)),b:an(sn(r.b))};if(a.a===a.b){const o=s.childNodes,i={a:r.a.at(-1),b:r.b.at(-1)};let l=o.length;for(;l--;){const d=o[l];if(d===i.a)return 1;if(d===i.b)return-1}}return Math.sign(a.a-a.b)}const Ds=/\b(?:position|zIndex|opacity|transform|webkitTransform|mixBlendMode|filter|webkitFilter|isolation)\b/;function $s(e){var t;const r=getComputedStyle((t=Ln(e))!==null&&t!==void 0?t:e).display;return r==="flex"||r==="inline-flex"}function Os(e){const t=getComputedStyle(e);return!!(t.position==="fixed"||t.zIndex!=="auto"&&(t.position!=="static"||$s(e))||+t.opacity<1||"transform"in t&&t.transform!=="none"||"webkitTransform"in t&&t.webkitTransform!=="none"||"mixBlendMode"in t&&t.mixBlendMode!=="normal"||"filter"in t&&t.filter!=="none"||"webkitFilter"in t&&t.webkitFilter!=="none"||"isolation"in t&&t.isolation==="isolate"||Ds.test(t.willChange)||t.webkitOverflowScrolling==="touch")}function sn(e){let t=e.length;for(;t--;){const r=e[t];if($(r,"Missing node"),Os(r))return r}return null}function an(e){return e&&Number(getComputedStyle(e).zIndex)||0}function on(e){const t=[];for(;e;)t.push(e),e=Ln(e);return t}function Ln(e){const{parentNode:t}=e;return t&&t instanceof ShadowRoot?t.host:t}const _n=1,Fn=2,Hn=4,qn=8,Ls=Ms()==="coarse";let fe=[],He=!1,Ee=new Map,ct=new Map;const Ke=new Set;function _s(e,t,r,s,a){var o;const{ownerDocument:i}=t,l={direction:r,element:t,hitAreaMargins:s,setResizeHandlerState:a},d=(o=Ee.get(i))!==null&&o!==void 0?o:0;return Ee.set(i,d+1),Ke.add(l),tt(),function(){var b;ct.delete(e),Ke.delete(l);const y=(b=Ee.get(i))!==null&&b!==void 0?b:1;if(Ee.set(i,y-1),tt(),y===1&&Ee.delete(i),fe.includes(l)){const p=fe.indexOf(l);p>=0&&fe.splice(p,1),Ut(),a("up",!0,null)}}}function Fs(e){const{target:t}=e,{x:r,y:s}=lt(e);He=!0,Kt({target:t,x:r,y:s}),tt(),fe.length>0&&(nt("down",e),e.preventDefault(),Vn(t)||e.stopImmediatePropagation())}function yt(e){const{x:t,y:r}=lt(e);if(He&&e.buttons===0&&(He=!1,nt("up",e)),!He){const{target:s}=e;Kt({target:s,x:t,y:r})}nt("move",e),Ut(),fe.length>0&&e.preventDefault()}function vt(e){const{target:t}=e,{x:r,y:s}=lt(e);ct.clear(),He=!1,fe.length>0&&(e.preventDefault(),Vn(t)||e.stopImmediatePropagation()),nt("up",e),Kt({target:t,x:r,y:s}),Ut(),tt()}function Vn(e){let t=e;for(;t;){if(t.hasAttribute(Q.resizeHandle))return!0;t=t.parentElement}return!1}function Kt({target:e,x:t,y:r}){fe.splice(0);let s=null;(e instanceof HTMLElement||e instanceof SVGElement)&&(s=e),Ke.forEach(a=>{const{element:o,hitAreaMargins:i}=a,l=o.getBoundingClientRect(),{bottom:d,left:f,right:b,top:y}=l,p=Ls?i.coarse:i.fine;if(t>=f-p&&t<=b+p&&r>=y-p&&r<=d+p){if(s!==null&&document.contains(s)&&o!==s&&!o.contains(s)&&!s.contains(o)&&Ts(s,o)>0){let N=s,x=!1;for(;N&&!N.contains(o);){if(As(N.getBoundingClientRect(),l)){x=!0;break}N=N.parentElement}if(x)return}fe.push(a)}})}function wt(e,t){ct.set(e,t)}function Ut(){let e=!1,t=!1;fe.forEach(s=>{const{direction:a}=s;a==="horizontal"?e=!0:t=!0});let r=0;ct.forEach(s=>{r|=s}),e&&t?bt("intersection",r):e?bt("horizontal",r):t?bt("vertical",r):zs()}let Nt=new AbortController;function tt(){Nt.abort(),Nt=new AbortController;const e={capture:!0,signal:Nt.signal};Ke.size&&(He?(fe.length>0&&Ee.forEach((t,r)=>{const{body:s}=r;t>0&&(s.addEventListener("contextmenu",vt,e),s.addEventListener("pointerleave",yt,e),s.addEventListener("pointermove",yt,e))}),window.addEventListener("pointerup",vt,e),window.addEventListener("pointercancel",vt,e)):Ee.forEach((t,r)=>{const{body:s}=r;t>0&&(s.addEventListener("pointerdown",Fs,e),s.addEventListener("pointermove",yt,e))}))}function nt(e,t){Ke.forEach(r=>{const{setResizeHandlerState:s}=r,a=fe.includes(r);s(e,a,t)})}function Hs(){const[e,t]=c.useState(0);return c.useCallback(()=>t(r=>r+1),[])}function $(e,t){if(!e)throw console.error(t),Error(t)}function Re(e,t,r=Gt){return e.toFixed(r)===t.toFixed(r)?0:e>t?1:-1}function be(e,t,r=Gt){return Re(e,t,r)===0}function oe(e,t,r){return Re(e,t,r)===0}function qs(e,t,r){if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++){const a=e[s],o=t[s];if(!oe(a,o,r))return!1}return!0}function Fe({panelConstraints:e,panelIndex:t,size:r}){const s=e[t];$(s!=null,`Panel constraints not found for index ${t}`);let{collapsedSize:a=0,collapsible:o,maxSize:i=100,minSize:l=0}=s;if(Re(r,l)<0)if(o){const d=(a+l)/2;Re(r,d)<0?r=a:r=l}else r=l;return r=Math.min(i,r),r=parseFloat(r.toFixed(Gt)),r}function qe({delta:e,initialLayout:t,panelConstraints:r,pivotIndices:s,prevLayout:a,trigger:o}){if(oe(e,0))return t;const i=[...t],[l,d]=s;$(l!=null,"Invalid first pivot index"),$(d!=null,"Invalid second pivot index");let f=0;if(o==="keyboard"){{const y=e<0?d:l,p=r[y];$(p,`Panel constraints not found for index ${y}`);const{collapsedSize:v=0,collapsible:N,minSize:x=0}=p;if(N){const h=t[y];if($(h!=null,`Previous layout not found for panel index ${y}`),oe(h,v)){const m=x-h;Re(m,Math.abs(e))>0&&(e=e<0?0-m:m)}}}{const y=e<0?l:d,p=r[y];$(p,`No panel constraints found for index ${y}`);const{collapsedSize:v=0,collapsible:N,minSize:x=0}=p;if(N){const h=t[y];if($(h!=null,`Previous layout not found for panel index ${y}`),oe(h,x)){const m=h-v;Re(m,Math.abs(e))>0&&(e=e<0?0-m:m)}}}}{const y=e<0?1:-1;let p=e<0?d:l,v=0;for(;;){const x=t[p];$(x!=null,`Previous layout not found for panel index ${p}`);const m=Fe({panelConstraints:r,panelIndex:p,size:100})-x;if(v+=m,p+=y,p<0||p>=r.length)break}const N=Math.min(Math.abs(e),Math.abs(v));e=e<0?0-N:N}{let p=e<0?l:d;for(;p>=0&&p<r.length;){const v=Math.abs(e)-Math.abs(f),N=t[p];$(N!=null,`Previous layout not found for panel index ${p}`);const x=N-v,h=Fe({panelConstraints:r,panelIndex:p,size:x});if(!oe(N,h)&&(f+=N-h,i[p]=h,f.toPrecision(3).localeCompare(Math.abs(e).toPrecision(3),void 0,{numeric:!0})>=0))break;e<0?p--:p++}}if(qs(a,i))return a;{const y=e<0?d:l,p=t[y];$(p!=null,`Previous layout not found for panel index ${y}`);const v=p+f,N=Fe({panelConstraints:r,panelIndex:y,size:v});if(i[y]=N,!oe(N,v)){let x=v-N,m=e<0?d:l;for(;m>=0&&m<r.length;){const g=i[m];$(g!=null,`Previous layout not found for panel index ${m}`);const k=g+x,P=Fe({panelConstraints:r,panelIndex:m,size:k});if(oe(g,P)||(x-=P-g,i[m]=P),oe(x,0))break;e>0?m--:m++}}}const b=i.reduce((y,p)=>p+y,0);return oe(b,100)?i:a}function Vs({layout:e,panelsArray:t,pivotIndices:r}){let s=0,a=100,o=0,i=0;const l=r[0];$(l!=null,"No pivot index found"),t.forEach((y,p)=>{const{constraints:v}=y,{maxSize:N=100,minSize:x=0}=v;p===l?(s=x,a=N):(o+=x,i+=N)});const d=Math.min(a,100-o),f=Math.max(s,100-i),b=e[l];return{valueMax:d,valueMin:f,valueNow:b}}function Ue(e,t=document){return Array.from(t.querySelectorAll(`[${Q.resizeHandleId}][data-panel-group-id="${e}"]`))}function Gn(e,t,r=document){const a=Ue(e,r).findIndex(o=>o.getAttribute(Q.resizeHandleId)===t);return a??null}function Bn(e,t,r){const s=Gn(e,t,r);return s!=null?[s,s+1]:[-1,-1]}function Kn(e,t=document){var r;if(t instanceof HTMLElement&&(t==null||(r=t.dataset)===null||r===void 0?void 0:r.panelGroupId)==e)return t;const s=t.querySelector(`[data-panel-group][data-panel-group-id="${e}"]`);return s||null}function dt(e,t=document){const r=t.querySelector(`[${Q.resizeHandleId}="${e}"]`);return r||null}function Gs(e,t,r,s=document){var a,o,i,l;const d=dt(t,s),f=Ue(e,s),b=d?f.indexOf(d):-1,y=(a=(o=r[b])===null||o===void 0?void 0:o.id)!==null&&a!==void 0?a:null,p=(i=(l=r[b+1])===null||l===void 0?void 0:l.id)!==null&&i!==void 0?i:null;return[y,p]}function Bs({committedValuesRef:e,eagerValuesRef:t,groupId:r,layout:s,panelDataArray:a,panelGroupElement:o,setLayout:i}){c.useRef({didWarnAboutMissingResizeHandle:!1}),Pe(()=>{if(!o)return;const l=Ue(r,o);for(let d=0;d<a.length-1;d++){const{valueMax:f,valueMin:b,valueNow:y}=Vs({layout:s,panelsArray:a,pivotIndices:[d,d+1]}),p=l[d];if(p!=null){const v=a[d];$(v,`No panel data found for index "${d}"`),p.setAttribute("aria-controls",v.id),p.setAttribute("aria-valuemax",""+Math.round(f)),p.setAttribute("aria-valuemin",""+Math.round(b)),p.setAttribute("aria-valuenow",y!=null?""+Math.round(y):"")}}return()=>{l.forEach((d,f)=>{d.removeAttribute("aria-controls"),d.removeAttribute("aria-valuemax"),d.removeAttribute("aria-valuemin"),d.removeAttribute("aria-valuenow")})}},[r,s,a,o]),c.useEffect(()=>{if(!o)return;const l=t.current;$(l,"Eager values not found");const{panelDataArray:d}=l,f=Kn(r,o);$(f!=null,`No group found for id "${r}"`);const b=Ue(r,o);$(b,`No resize handles found for group id "${r}"`);const y=b.map(p=>{const v=p.getAttribute(Q.resizeHandleId);$(v,"Resize handle element has no handle id attribute");const[N,x]=Gs(r,v,d,o);if(N==null||x==null)return()=>{};const h=m=>{if(!m.defaultPrevented)switch(m.key){case"Enter":{m.preventDefault();const g=d.findIndex(k=>k.id===N);if(g>=0){const k=d[g];$(k,`No panel data found for index ${g}`);const P=s[g],{collapsedSize:D=0,collapsible:M,minSize:I=0}=k.constraints;if(P!=null&&M){const w=qe({delta:oe(P,D)?I-D:D-P,initialLayout:s,panelConstraints:d.map(L=>L.constraints),pivotIndices:Bn(r,v,o),prevLayout:s,trigger:"keyboard"});s!==w&&i(w)}}break}}};return p.addEventListener("keydown",h),()=>{p.removeEventListener("keydown",h)}});return()=>{y.forEach(p=>p())}},[o,e,t,r,s,a,i])}function ln(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function Un(e,t){const r=e==="horizontal",{x:s,y:a}=lt(t);return r?s:a}function Ks(e,t,r,s,a){const o=r==="horizontal",i=dt(t,a);$(i,`No resize handle element found for id "${t}"`);const l=i.getAttribute(Q.groupId);$(l,"Resize handle element has no group id attribute");let{initialCursorPosition:d}=s;const f=Un(r,e),b=Kn(l,a);$(b,`No group element found for id "${l}"`);const y=b.getBoundingClientRect(),p=o?y.width:y.height;return(f-d)/p*100}function Us(e,t,r,s,a,o){if(Dn(e)){const i=r==="horizontal";let l=0;e.shiftKey?l=100:a!=null?l=a:l=10;let d=0;switch(e.key){case"ArrowDown":d=i?0:l;break;case"ArrowLeft":d=i?-l:0;break;case"ArrowRight":d=i?l:0;break;case"ArrowUp":d=i?0:-l;break;case"End":d=100;break;case"Home":d=-100;break}return d}else return s==null?0:Ks(e,t,r,s,o)}function Ws({panelDataArray:e}){const t=Array(e.length),r=e.map(o=>o.constraints);let s=0,a=100;for(let o=0;o<e.length;o++){const i=r[o];$(i,`Panel constraints not found for index ${o}`);const{defaultSize:l}=i;l!=null&&(s++,t[o]=l,a-=l)}for(let o=0;o<e.length;o++){const i=r[o];$(i,`Panel constraints not found for index ${o}`);const{defaultSize:l}=i;if(l!=null)continue;const d=e.length-s,f=a/d;s++,t[o]=f,a-=f}return t}function ze(e,t,r){t.forEach((s,a)=>{const o=e[a];$(o,`Panel data not found for index ${a}`);const{callbacks:i,constraints:l,id:d}=o,{collapsedSize:f=0,collapsible:b}=l,y=r[d];if(y==null||s!==y){r[d]=s;const{onCollapse:p,onExpand:v,onResize:N}=i;N&&N(s,y),b&&(p||v)&&(v&&(y==null||be(y,f))&&!be(s,f)&&v(),p&&(y==null||!be(y,f))&&be(s,f)&&p())}})}function Ye(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!=t[r])return!1;return!0}function Js({defaultSize:e,dragState:t,layout:r,panelData:s,panelIndex:a,precision:o=3}){const i=r[a];let l;return i==null?l=e!=null?e.toPrecision(o):"1":s.length===1?l="1":l=i.toPrecision(o),{flexBasis:0,flexGrow:l,flexShrink:1,overflow:"hidden",pointerEvents:t!==null?"none":void 0}}function Ys(e,t=10){let r=null;return(...a)=>{r!==null&&clearTimeout(r),r=setTimeout(()=>{e(...a)},t)}}function cn(e){try{if(typeof localStorage<"u")e.getItem=t=>localStorage.getItem(t),e.setItem=(t,r)=>{localStorage.setItem(t,r)};else throw new Error("localStorage not supported in this environment")}catch(t){console.error(t),e.getItem=()=>null,e.setItem=()=>{}}}function Wn(e){return`react-resizable-panels:${e}`}function Jn(e){return e.map(t=>{const{constraints:r,id:s,idIsFromProps:a,order:o}=t;return a?s:o?`${o}:${JSON.stringify(r)}`:JSON.stringify(r)}).sort((t,r)=>t.localeCompare(r)).join(",")}function Yn(e,t){try{const r=Wn(e),s=t.getItem(r);if(s){const a=JSON.parse(s);if(typeof a=="object"&&a!=null)return a}}catch{}return null}function Qs(e,t,r){var s,a;const o=(s=Yn(e,r))!==null&&s!==void 0?s:{},i=Jn(t);return(a=o[i])!==null&&a!==void 0?a:null}function Xs(e,t,r,s,a){var o;const i=Wn(e),l=Jn(t),d=(o=Yn(e,a))!==null&&o!==void 0?o:{};d[l]={expandToSizes:Object.fromEntries(r.entries()),layout:s};try{a.setItem(i,JSON.stringify(d))}catch(f){console.error(f)}}function dn({layout:e,panelConstraints:t}){const r=[...e],s=r.reduce((o,i)=>o+i,0);if(r.length!==t.length)throw Error(`Invalid ${t.length} panel layout: ${r.map(o=>`${o}%`).join(", ")}`);if(!oe(s,100)&&r.length>0)for(let o=0;o<t.length;o++){const i=r[o];$(i!=null,`No layout data found for index ${o}`);const l=100/s*i;r[o]=l}let a=0;for(let o=0;o<t.length;o++){const i=r[o];$(i!=null,`No layout data found for index ${o}`);const l=Fe({panelConstraints:t,panelIndex:o,size:i});i!=l&&(a+=i-l,r[o]=l)}if(!oe(a,0))for(let o=0;o<t.length;o++){const i=r[o];$(i!=null,`No layout data found for index ${o}`);const l=i+a,d=Fe({panelConstraints:t,panelIndex:o,size:l});if(i!==d&&(a-=d-i,r[o]=d,oe(a,0)))break}return r}const Zs=100,Ve={getItem:e=>(cn(Ve),Ve.getItem(e)),setItem:(e,t)=>{cn(Ve),Ve.setItem(e,t)}},un={};function Qn({autoSaveId:e=null,children:t,className:r="",direction:s,forwardedRef:a,id:o=null,onLayout:i=null,keyboardResizeBy:l=null,storage:d=Ve,style:f,tagName:b="div",...y}){const p=Bt(o),v=c.useRef(null),[N,x]=c.useState(null),[h,m]=c.useState([]),g=Hs(),k=c.useRef({}),P=c.useRef(new Map),D=c.useRef(0),M=c.useRef({autoSaveId:e,direction:s,dragState:N,id:p,keyboardResizeBy:l,onLayout:i,storage:d}),I=c.useRef({layout:h,panelDataArray:[],panelDataArrayChanged:!1});c.useRef({didLogIdAndOrderWarning:!1,didLogPanelConstraintsWarning:!1,prevPanelIds:[]}),c.useImperativeHandle(a,()=>({getId:()=>M.current.id,getLayout:()=>{const{layout:u}=I.current;return u},setLayout:u=>{const{onLayout:S}=M.current,{layout:z,panelDataArray:C}=I.current,E=dn({layout:u,panelConstraints:C.map(A=>A.constraints)});ln(z,E)||(m(E),I.current.layout=E,S&&S(E),ze(C,E,k.current))}}),[]),Pe(()=>{M.current.autoSaveId=e,M.current.direction=s,M.current.dragState=N,M.current.id=p,M.current.onLayout=i,M.current.storage=d}),Bs({committedValuesRef:M,eagerValuesRef:I,groupId:p,layout:h,panelDataArray:I.current.panelDataArray,setLayout:m,panelGroupElement:v.current}),c.useEffect(()=>{const{panelDataArray:u}=I.current;if(e){if(h.length===0||h.length!==u.length)return;let S=un[e];S==null&&(S=Ys(Xs,Zs),un[e]=S);const z=[...u],C=new Map(P.current);S(e,z,C,h,d)}},[e,h,d]),c.useEffect(()=>{});const w=c.useCallback(u=>{const{onLayout:S}=M.current,{layout:z,panelDataArray:C}=I.current;if(u.constraints.collapsible){const E=C.map(le=>le.constraints),{collapsedSize:A=0,panelSize:_,pivotIndices:B}=ke(C,u,z);if($(_!=null,`Panel size not found for panel "${u.id}"`),!be(_,A)){P.current.set(u.id,_);const ce=Te(C,u)===C.length-1?_-A:A-_,U=qe({delta:ce,initialLayout:z,panelConstraints:E,pivotIndices:B,prevLayout:z,trigger:"imperative-api"});Ye(z,U)||(m(U),I.current.layout=U,S&&S(U),ze(C,U,k.current))}}},[]),L=c.useCallback((u,S)=>{const{onLayout:z}=M.current,{layout:C,panelDataArray:E}=I.current;if(u.constraints.collapsible){const A=E.map(ne=>ne.constraints),{collapsedSize:_=0,panelSize:B=0,minSize:le=0,pivotIndices:ce}=ke(E,u,C),U=S??le;if(be(B,_)){const ne=P.current.get(u.id),we=ne!=null&&ne>=U?ne:U,R=Te(E,u)===E.length-1?B-we:we-B,j=qe({delta:R,initialLayout:C,panelConstraints:A,pivotIndices:ce,prevLayout:C,trigger:"imperative-api"});Ye(C,j)||(m(j),I.current.layout=j,z&&z(j),ze(E,j,k.current))}}},[]),O=c.useCallback(u=>{const{layout:S,panelDataArray:z}=I.current,{panelSize:C}=ke(z,u,S);return $(C!=null,`Panel size not found for panel "${u.id}"`),C},[]),T=c.useCallback((u,S)=>{const{panelDataArray:z}=I.current,C=Te(z,u);return Js({defaultSize:S,dragState:N,layout:h,panelData:z,panelIndex:C})},[N,h]),F=c.useCallback(u=>{const{layout:S,panelDataArray:z}=I.current,{collapsedSize:C=0,collapsible:E,panelSize:A}=ke(z,u,S);return $(A!=null,`Panel size not found for panel "${u.id}"`),E===!0&&be(A,C)},[]),Z=c.useCallback(u=>{const{layout:S,panelDataArray:z}=I.current,{collapsedSize:C=0,collapsible:E,panelSize:A}=ke(z,u,S);return $(A!=null,`Panel size not found for panel "${u.id}"`),!E||Re(A,C)>0},[]),V=c.useCallback(u=>{const{panelDataArray:S}=I.current;S.push(u),S.sort((z,C)=>{const E=z.order,A=C.order;return E==null&&A==null?0:E==null?-1:A==null?1:E-A}),I.current.panelDataArrayChanged=!0,g()},[g]);Pe(()=>{if(I.current.panelDataArrayChanged){I.current.panelDataArrayChanged=!1;const{autoSaveId:u,onLayout:S,storage:z}=M.current,{layout:C,panelDataArray:E}=I.current;let A=null;if(u){const B=Qs(u,E,z);B&&(P.current=new Map(Object.entries(B.expandToSizes)),A=B.layout)}A==null&&(A=Ws({panelDataArray:E}));const _=dn({layout:A,panelConstraints:E.map(B=>B.constraints)});ln(C,_)||(m(_),I.current.layout=_,S&&S(_),ze(E,_,k.current))}}),Pe(()=>{const u=I.current;return()=>{u.layout=[]}},[]);const G=c.useCallback(u=>{let S=!1;const z=v.current;return z&&window.getComputedStyle(z,null).getPropertyValue("direction")==="rtl"&&(S=!0),function(E){E.preventDefault();const A=v.current;if(!A)return()=>null;const{direction:_,dragState:B,id:le,keyboardResizeBy:ce,onLayout:U}=M.current,{layout:ne,panelDataArray:we}=I.current,{initialLayout:Ie}=B??{},R=Bn(le,u,A);let j=Us(E,u,_,B,ce,A);const H=_==="horizontal";H&&S&&(j=-j);const W=we.map(xe=>xe.constraints),X=qe({delta:j,initialLayout:Ie??ne,panelConstraints:W,pivotIndices:R,prevLayout:ne,trigger:Dn(E)?"keyboard":"mouse-or-touch"}),Y=!Ye(ne,X);($n(E)||On(E))&&D.current!=j&&(D.current=j,!Y&&j!==0?H?wt(u,j<0?_n:Fn):wt(u,j<0?Hn:qn):wt(u,0)),Y&&(m(X),I.current.layout=X,U&&U(X),ze(we,X,k.current))}},[]),J=c.useCallback((u,S)=>{const{onLayout:z}=M.current,{layout:C,panelDataArray:E}=I.current,A=E.map(ne=>ne.constraints),{panelSize:_,pivotIndices:B}=ke(E,u,C);$(_!=null,`Panel size not found for panel "${u.id}"`);const ce=Te(E,u)===E.length-1?_-S:S-_,U=qe({delta:ce,initialLayout:C,panelConstraints:A,pivotIndices:B,prevLayout:C,trigger:"imperative-api"});Ye(C,U)||(m(U),I.current.layout=U,z&&z(U),ze(E,U,k.current))},[]),ie=c.useCallback((u,S)=>{const{layout:z,panelDataArray:C}=I.current,{collapsedSize:E=0,collapsible:A}=S,{collapsedSize:_=0,collapsible:B,maxSize:le=100,minSize:ce=0}=u.constraints,{panelSize:U}=ke(C,u,z);U!=null&&(A&&B&&be(U,E)?be(E,_)||J(u,_):U<ce?J(u,ce):U>le&&J(u,le))},[J]),te=c.useCallback((u,S)=>{const{direction:z}=M.current,{layout:C}=I.current;if(!v.current)return;const E=dt(u,v.current);$(E,`Drag handle element not found for id "${u}"`);const A=Un(z,S);x({dragHandleId:u,dragHandleRect:E.getBoundingClientRect(),initialCursorPosition:A,initialLayout:C})},[]),pe=c.useCallback(()=>{x(null)},[]),he=c.useCallback(u=>{const{panelDataArray:S}=I.current,z=Te(S,u);z>=0&&(S.splice(z,1),delete k.current[u.id],I.current.panelDataArrayChanged=!0,g())},[g]),de=c.useMemo(()=>({collapsePanel:w,direction:s,dragState:N,expandPanel:L,getPanelSize:O,getPanelStyle:T,groupId:p,isPanelCollapsed:F,isPanelExpanded:Z,reevaluatePanelConstraints:ie,registerPanel:V,registerResizeHandle:G,resizePanel:J,startDragging:te,stopDragging:pe,unregisterPanel:he,panelGroupElement:v.current}),[w,N,s,L,O,T,p,F,Z,ie,V,G,J,te,pe,he]),ue={display:"flex",flexDirection:s==="horizontal"?"row":"column",height:"100%",overflow:"hidden",width:"100%"};return c.createElement(it.Provider,{value:de},c.createElement(b,{...y,children:t,className:r,id:o,ref:v,style:{...ue,...f},[Q.group]:"",[Q.groupDirection]:s,[Q.groupId]:p}))}const Xn=c.forwardRef((e,t)=>c.createElement(Qn,{...e,forwardedRef:t}));Qn.displayName="PanelGroup";Xn.displayName="forwardRef(PanelGroup)";function Te(e,t){return e.findIndex(r=>r===t||r.id===t.id)}function ke(e,t,r){const s=Te(e,t),o=s===e.length-1?[s-1,s]:[s,s+1],i=r[s];return{...t.constraints,panelSize:i,pivotIndices:o}}function ea({disabled:e,handleId:t,resizeHandler:r,panelGroupElement:s}){c.useEffect(()=>{if(e||r==null||s==null)return;const a=dt(t,s);if(a==null)return;const o=i=>{if(!i.defaultPrevented)switch(i.key){case"ArrowDown":case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"End":case"Home":{i.preventDefault(),r(i);break}case"F6":{i.preventDefault();const l=a.getAttribute(Q.groupId);$(l,`No group element found for id "${l}"`);const d=Ue(l,s),f=Gn(l,t,s);$(f!==null,`No resize element found for id "${t}"`);const b=i.shiftKey?f>0?f-1:d.length-1:f+1<d.length?f+1:0;d[b].focus();break}}};return a.addEventListener("keydown",o),()=>{a.removeEventListener("keydown",o)}},[s,e,t,r])}function Zn({children:e=null,className:t="",disabled:r=!1,hitAreaMargins:s,id:a,onBlur:o,onClick:i,onDragging:l,onFocus:d,onPointerDown:f,onPointerUp:b,style:y={},tabIndex:p=0,tagName:v="div",...N}){var x,h;const m=c.useRef(null),g=c.useRef({onClick:i,onDragging:l,onPointerDown:f,onPointerUp:b});c.useEffect(()=>{g.current.onClick=i,g.current.onDragging=l,g.current.onPointerDown=f,g.current.onPointerUp=b});const k=c.useContext(it);if(k===null)throw Error("PanelResizeHandle components must be rendered within a PanelGroup container");const{direction:P,groupId:D,registerResizeHandle:M,startDragging:I,stopDragging:w,panelGroupElement:L}=k,O=Bt(a),[T,F]=c.useState("inactive"),[Z,V]=c.useState(!1),[G,J]=c.useState(null),ie=c.useRef({state:T});Pe(()=>{ie.current.state=T}),c.useEffect(()=>{if(r)J(null);else{const de=M(O);J(()=>de)}},[r,O,M]);const te=(x=s?.coarse)!==null&&x!==void 0?x:15,pe=(h=s?.fine)!==null&&h!==void 0?h:5;c.useEffect(()=>{if(r||G==null)return;const de=m.current;$(de,"Element ref not attached");let ue=!1;return _s(O,de,P,{coarse:te,fine:pe},(S,z,C)=>{if(!z){F("inactive");return}switch(S){case"down":{F("drag"),ue=!1,$(C,'Expected event to be defined for "down" action'),I(O,C);const{onDragging:E,onPointerDown:A}=g.current;E?.(!0),A?.();break}case"move":{const{state:E}=ie.current;ue=!0,E!=="drag"&&F("hover"),$(C,'Expected event to be defined for "move" action'),G(C);break}case"up":{F("hover"),w();const{onClick:E,onDragging:A,onPointerUp:_}=g.current;A?.(!1),_?.(),ue||E?.();break}}})},[te,P,r,pe,M,O,G,I,w]),ea({disabled:r,handleId:O,resizeHandler:G,panelGroupElement:L});const he={touchAction:"none",userSelect:"none"};return c.createElement(v,{...N,children:e,className:t,id:a,onBlur:()=>{V(!1),o?.()},onFocus:()=>{V(!0),d?.()},ref:m,role:"separator",style:{...he,...y},tabIndex:p,[Q.groupDirection]:P,[Q.groupId]:D,[Q.resizeHandle]:"",[Q.resizeHandleActive]:T==="drag"?"pointer":Z?"keyboard":void 0,[Q.resizeHandleEnabled]:!r,[Q.resizeHandleId]:O,[Q.resizeHandleState]:T})}Zn.displayName="PanelResizeHandle";const ta=({className:e,...t})=>n.jsx(Xn,{className:ye("flex h-full w-full data-[panel-group-direction=vertical]:flex-col",e),...t}),mn=Tn,na=({withHandle:e,className:t,...r})=>n.jsx(Zn,{className:ye("relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90",t),...r,children:e&&n.jsx("div",{className:"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border",children:n.jsx(zr,{className:"h-2.5 w-2.5"})})});function ra(e,t){try{const r=localStorage.getItem(e);if(r!==null)return JSON.parse(r)}catch{}return t}function sa(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch{}}function aa(){const[e,t]=c.useState(()=>ra("brain-main-mode","edit")),[r,s]=c.useState(null),[a,o]=c.useState(""),[i,l]=c.useState(!1),[d,f]=c.useState(!1),[b,y]=c.useState(!1),[p,v]=c.useState(!1),N=c.useCallback(T=>{t(T),sa("brain-main-mode",T)},[]),{data:x}=ee({queryKey:["obsidian","status"],queryFn:q.obsidian.getStatus,refetchInterval:3e4}),{data:h}=ee({queryKey:["obsidian","config"],queryFn:q.obsidian.getConfig}),{data:m}=ee({queryKey:["obsidian","vault-index"],queryFn:()=>q.obsidian.getVaultIndex(),enabled:x?.connected===!0}),{data:g}=ee({queryKey:["anki","status"],queryFn:q.anki.getStatus,refetchInterval:3e4}),{data:k}=ee({queryKey:["brain","metrics"],queryFn:q.brain.getMetrics}),{data:P=[]}=ee({queryKey:["anki","drafts"],queryFn:q.anki.getDrafts}),D=P.filter(T=>T.status==="pending"),M=c.useCallback(async T=>{try{const F=await q.obsidian.getFile(T);F.success&&F.content!==void 0&&(s(T),o(F.content),l(!1),f(!1))}catch(F){console.error("Failed to load file:",F)}},[]),I=c.useCallback(async()=>{if(r){y(!0);try{(await q.obsidian.saveFile(r,a)).success&&l(!1)}catch(T){console.error("Failed to save file:",T)}finally{y(!1)}}},[r,a]),w=c.useCallback(T=>{o(T),l(!0)},[]),L=["School/Evidence Based Practice","School/Exercise Physiology","School/Movement Science 1","School/Neuroscience","School/Therapeutic Intervention"],O=c.useCallback(async(T,F)=>{if(F){const V=h?.vaultName||"Treys School";window.open(`obsidian://open?vault=${encodeURIComponent(V)}&file=${encodeURIComponent(T)}`,"_blank");return}const Z=m?.paths?.[T];if(Z){await M(Z),f(!0);return}for(const V of L)try{const G=await q.obsidian.getFile(`${V}/${T}.md`);if(G.success&&G.content!==void 0){s(`${V}/${T}.md`),o(G.content),l(!1),f(!0);return}}catch{}console.warn(`Note not found: ${T}`)},[h,m,M]);return{mainMode:e,setMainMode:N,currentFile:r,setCurrentFile:s,fileContent:a,setFileContent:w,hasChanges:i,setHasChanges:l,previewMode:d,setPreviewMode:f,isSaving:b,openFile:M,saveFile:I,importOpen:p,setImportOpen:v,handleWikilinkClick:O,obsidianStatus:x,obsidianConfig:h,vaultIndex:m,ankiStatus:g,metrics:k,ankiDrafts:P,pendingDrafts:D}}const fn=[{id:"study",label:"Study",tab:null,section:null},{id:"wrap",label:"Wrap",tab:null,section:null},{id:"generate",label:"Generate JSON",tab:null,section:null},{id:"attach",label:"Attach JSON",tab:null,section:null},{id:"planner",label:"Planner",tab:null,section:null},{id:"actions",label:"Actions",tab:null,section:null}];function oa({workspace:e}){const[t,r]=c.useState(!1),{data:s=[]}=ee({queryKey:["sessions"],queryFn:q.sessions.getAll}),{data:a=[]}=ee({queryKey:["planner-queue"],queryFn:q.planner.getQueue}),o=new Date,i=`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}-${String(o.getDate()).padStart(2,"0")}`,l=v=>{const N=typeof v=="string"?new Date(v):v;return`${N.getFullYear()}-${String(N.getMonth()+1).padStart(2,"0")}-${String(N.getDate()).padStart(2,"0")}`===i},d=s.some(v=>l(v.date)),f=a.length>0,b=s.some(v=>l(v.date)&&v.cards>0),y={study:d,wrap:d,generate:b,attach:b,planner:f,actions:f},p=c.useCallback(v=>{v.preventDefault(),r(!1),Array.from(v.dataTransfer.files).length>0&&e.setImportOpen(!0)},[e]);return n.jsxs("div",{className:`flex items-center gap-2 px-3 py-2 border-b-2 border-primary/50 bg-black/60 flex-wrap ${t?"ring-2 ring-primary":""}`,onDragOver:v=>{v.preventDefault(),r(!0)},onDragLeave:()=>r(!1),onDrop:p,children:[n.jsx("div",{className:"flex items-center gap-0.5 mr-2",children:fn.map((v,N)=>{const x=y[v.id]??!1;return n.jsxs("div",{className:"flex items-center gap-0.5",children:[n.jsxs("div",{className:`flex items-center gap-0.5 px-1.5 py-0.5 text-xs font-terminal ${x?"text-green-400":"text-muted-foreground"}`,title:v.label,children:[x?n.jsx(Dr,{className:"w-3 h-3"}):n.jsx(Pn,{className:"w-3 h-3"}),n.jsx("span",{className:"hidden xl:inline",children:v.label})]}),N<fn.length-1&&n.jsx($r,{className:"w-2 h-2 text-muted-foreground/50"})]},v.id)})}),n.jsx("div",{className:"w-px h-5 bg-primary/30"}),n.jsxs(K,{size:"sm",variant:"outline",className:"h-6 px-2 rounded-none font-terminal text-xs border-primary/50",onClick:()=>e.setImportOpen(!0),children:[n.jsx(Vt,{className:"w-3 h-3 mr-1"}),"Import"]}),n.jsxs("div",{className:"flex items-center gap-3 ml-auto font-terminal text-xs",children:[n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${e.obsidianStatus?.connected?"bg-green-500":"bg-red-500"}`}),n.jsx("span",{className:"text-muted-foreground",children:"Obsidian"})]}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${e.ankiStatus?.connected?"bg-green-500":"bg-red-500"}`}),n.jsx("span",{className:"text-muted-foreground",children:"Anki"})]}),e.pendingDrafts.length>0&&n.jsxs(et,{variant:"outline",className:"h-5 px-1.5 text-xs rounded-none border-secondary/50 text-secondary",children:[e.pendingDrafts.length," drafts"]})]})]})}const ia=[{name:"EBP",path:"School/Evidence Based Practice"},{name:"ExPhys",path:"School/Exercise Physiology"},{name:"MS1",path:"School/Movement Science 1"},{name:"Neuro",path:"School/Neuroscience"},{name:"TI",path:"School/Therapeutic Intervention"}];function er({name:e,isFolder:t,isExpanded:r,isActive:s,depth:a,onClick:o}){return n.jsxs("button",{onClick:o,className:`w-full flex items-center gap-1.5 py-1 hover:bg-secondary/20 font-terminal text-sm ${s?"bg-primary/20 text-primary":""}`,style:{paddingLeft:`${a*12+8}px`},children:[t?n.jsxs(n.Fragment,{children:[r?n.jsx(qr,{className:"w-3 h-3 text-muted-foreground shrink-0"}):n.jsx(Ur,{className:"w-3 h-3 text-muted-foreground shrink-0"}),n.jsx(hs,{className:"w-3.5 h-3.5 text-yellow-500 shrink-0"})]}):n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"w-3 shrink-0"}),n.jsx(fs,{className:"w-3.5 h-3.5 text-blue-400 shrink-0"})]}),n.jsx("span",{className:"truncate",children:e})]})}function tr({folderPath:e,depth:t,expandedFolders:r,toggleFolder:s,workspace:a,connected:o}){const{data:i}=ee({queryKey:["obsidian","files",e],queryFn:()=>q.obsidian.getFiles(e),enabled:o}),l=i?.files||[];return n.jsx(n.Fragment,{children:l.map(d=>{const f=typeof d=="string"?d:d.path,b=f.endsWith("/"),y=f.replace(/\/$/,"").split("/").pop()||f,p=`${e}/${y}`,v=r.has(p);return n.jsxs("div",{children:[n.jsx(er,{name:y,isFolder:b,isExpanded:v,isActive:a.currentFile?.endsWith(y)||!1,depth:t,onClick:()=>{b?s(p):a.openFile(p)}}),b&&v&&n.jsx(tr,{folderPath:p,depth:t+1,expandedFolders:r,toggleFolder:s,workspace:a,connected:o})]},f)})})}function pn({workspace:e}){const[t,r]=c.useState("School"),[s,a]=c.useState(""),[o,i]=c.useState(new Set),l=e.obsidianStatus?.connected===!0,{data:d}=ee({queryKey:["obsidian","files",t],queryFn:()=>q.obsidian.getFiles(t),enabled:l}),f=c.useCallback(h=>{r(h),i(new Set)},[]),b=c.useCallback(()=>{const h=t.split("/");h.pop(),f(h.join("/"))},[t,f]),y=c.useCallback(h=>{i(m=>{const g=new Set(m);return g.has(h)?g.delete(h):g.add(h),g})},[]),p=c.useCallback(()=>{const h=new Date().toISOString().split("T")[0],m=t?`${t}/Session-${h}.md`:`Session-${h}.md`,g=`# Study Session - ${h}

## Summary


## Concepts Covered
- 

## Notes

`;e.setCurrentFile(m),e.setFileContent(g),e.setHasChanges(!0)},[t,e]),v=c.useMemo(()=>{const h=d?.files||[];if(!s.trim())return h;const m=s.toLowerCase();return h.filter(g=>(typeof g=="string"?g:g.path).toLowerCase().includes(m))},[d,s]),N=t.includes("/"),x=c.useMemo(()=>t?t.split("/"):[],[t]);return l?n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsxs("div",{className:"p-2 space-y-1.5 border-b border-primary/30",children:[n.jsxs("div",{className:"relative",children:[n.jsx(Hr,{className:"absolute left-2 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-muted-foreground"}),n.jsx(De,{value:s,onChange:h=>a(h.target.value),placeholder:"Search files...",className:"h-6 pl-7 text-sm font-terminal rounded-none border-secondary/50 bg-black/40"})]}),n.jsxs(K,{size:"sm",variant:"outline",className:"w-full h-5 text-xs font-terminal rounded-none border-primary/50",onClick:p,children:[n.jsx(Ht,{className:"w-2.5 h-2.5 mr-1"}),"New Note"]})]}),n.jsx("div",{className:"flex flex-col gap-0.5 p-1.5 border-b border-primary/30",children:ia.map(h=>n.jsx("button",{onClick:()=>f(h.path),className:`text-left px-2 py-1 text-xs font-terminal rounded-none transition-colors ${t===h.path?"bg-primary/20 text-primary border-l-2 border-primary":"text-muted-foreground hover:text-foreground hover:bg-secondary/20"}`,children:h.name},h.path))}),t&&n.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 font-terminal text-xs text-muted-foreground border-b border-secondary/20 flex-wrap",children:[N&&n.jsx("button",{onClick:b,className:"hover:text-primary shrink-0",title:"Go to parent folder",children:n.jsx(rs,{className:"w-3 h-3"})}),x.map((h,m,g)=>n.jsxs("span",{className:"flex items-center gap-0.5",children:[m>0&&n.jsx("span",{className:"text-muted-foreground",children:"/"}),n.jsx("button",{onClick:()=>f(g.slice(0,m+1).join("/")),className:"hover:text-primary",children:h})]},m))]}),n.jsx(Ge,{className:"flex-1",children:n.jsx("div",{className:"py-1",children:v.map(h=>{const m=typeof h=="string"?h:h.path,g=m.endsWith("/"),k=m.replace(/\/$/,"").split("/").pop()||m,P=t?`${t}/${k}`:k,D=o.has(P),M=e.currentFile?.endsWith(k)||!1;return n.jsxs("div",{children:[n.jsx(er,{name:k,isFolder:g,isExpanded:D,isActive:M,depth:0,onClick:()=>{g?y(P):e.openFile(P)}}),g&&D&&n.jsx(tr,{folderPath:P,depth:1,expandedFolders:o,toggleFolder:y,workspace:e,connected:l})]},m)})})})]}):n.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-4",children:[n.jsx(Rn,{className:"w-6 h-6 text-red-500 mb-2"}),n.jsx("p",{className:"font-terminal text-sm text-red-400 text-center",children:"Obsidian Offline"}),n.jsx("p",{className:"font-terminal text-xs text-muted-foreground text-center mt-1",children:"Open Obsidian with Local REST API"})]})}function It(e,t,{checkForDefaultPrevented:r=!0}={}){return function(a){if(e?.(a),r===!1||!a.defaultPrevented)return t?.(a)}}var la=kn[" useInsertionEffect ".trim().toString()]||Pr;function ca({prop:e,defaultProp:t,onChange:r=()=>{},caller:s}){const[a,o,i]=da({defaultProp:t,onChange:r}),l=e!==void 0,d=l?e:a;{const b=c.useRef(e!==void 0);c.useEffect(()=>{const y=b.current;y!==l&&console.warn(`${s} is changing from ${y?"controlled":"uncontrolled"} to ${l?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),b.current=l},[l,s])}const f=c.useCallback(b=>{if(l){const y=ua(b)?b(e):b;y!==e&&i.current?.(y)}else o(b)},[l,e,o,i]);return[d,f]}function da({defaultProp:e,onChange:t}){const[r,s]=c.useState(e),a=c.useRef(r),o=c.useRef(t);return la(()=>{o.current=t},[t]),c.useEffect(()=>{a.current!==r&&(o.current?.(r),a.current=r)},[r,a]),[r,s,o]}function ua(e){return typeof e=="function"}var Wt="Radio",[ma,nr]=En(Wt),[fa,pa]=ma(Wt),rr=c.forwardRef((e,t)=>{const{__scopeRadio:r,name:s,checked:a=!1,required:o,disabled:i,value:l="on",onCheck:d,form:f,...b}=e,[y,p]=c.useState(null),v=Mt(t,h=>p(h)),N=c.useRef(!1),x=y?f||!!y.closest("form"):!0;return n.jsxs(fa,{scope:r,checked:a,disabled:i,children:[n.jsx(at.button,{type:"button",role:"radio","aria-checked":a,"data-state":ir(a),"data-disabled":i?"":void 0,disabled:i,value:l,...b,ref:v,onClick:It(e.onClick,h=>{a||d?.(),x&&(N.current=h.isPropagationStopped(),N.current||h.stopPropagation())})}),x&&n.jsx(or,{control:y,bubbles:!N.current,name:s,value:l,checked:a,required:o,disabled:i,form:f,style:{transform:"translateX(-100%)"}})]})});rr.displayName=Wt;var sr="RadioIndicator",ar=c.forwardRef((e,t)=>{const{__scopeRadio:r,forceMount:s,...a}=e,o=pa(sr,r);return n.jsx(Rr,{present:s||o.checked,children:n.jsx(at.span,{"data-state":ir(o.checked),"data-disabled":o.disabled?"":void 0,...a,ref:t})})});ar.displayName=sr;var ha="RadioBubbleInput",or=c.forwardRef(({__scopeRadio:e,control:t,checked:r,bubbles:s=!0,...a},o)=>{const i=c.useRef(null),l=Mt(i,o),d=Wr(r),f=Ir(t);return c.useEffect(()=>{const b=i.current;if(!b)return;const y=window.HTMLInputElement.prototype,v=Object.getOwnPropertyDescriptor(y,"checked").set;if(d!==r&&v){const N=new Event("click",{bubbles:s});v.call(b,r),b.dispatchEvent(N)}},[d,r,s]),n.jsx(at.input,{type:"radio","aria-hidden":!0,defaultChecked:r,...a,tabIndex:-1,ref:l,style:{...a.style,...f,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});or.displayName=ha;function ir(e){return e?"checked":"unchecked"}var xa=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],ut="RadioGroup",[ga]=En(ut,[zn,nr]),lr=zn(),cr=nr(),[ba,ya]=ga(ut),dr=c.forwardRef((e,t)=>{const{__scopeRadioGroup:r,name:s,defaultValue:a,value:o,required:i=!1,disabled:l=!1,orientation:d,dir:f,loop:b=!0,onValueChange:y,...p}=e,v=lr(r),N=Mr(f),[x,h]=ca({prop:o,defaultProp:a??null,onChange:y,caller:ut});return n.jsx(ba,{scope:r,name:s,required:i,disabled:l,value:x,onValueChange:h,children:n.jsx(Jr,{asChild:!0,...v,orientation:d,dir:N,loop:b,children:n.jsx(at.div,{role:"radiogroup","aria-required":i,"aria-orientation":d,"data-disabled":l?"":void 0,dir:N,...p,ref:t})})})});dr.displayName=ut;var ur="RadioGroupItem",mr=c.forwardRef((e,t)=>{const{__scopeRadioGroup:r,disabled:s,...a}=e,o=ya(ur,r),i=o.disabled||s,l=lr(r),d=cr(r),f=c.useRef(null),b=Mt(t,f),y=o.value===a.value,p=c.useRef(!1);return c.useEffect(()=>{const v=x=>{xa.includes(x.key)&&(p.current=!0)},N=()=>p.current=!1;return document.addEventListener("keydown",v),document.addEventListener("keyup",N),()=>{document.removeEventListener("keydown",v),document.removeEventListener("keyup",N)}},[]),n.jsx(Yr,{asChild:!0,...l,focusable:!i,active:y,children:n.jsx(rr,{disabled:i,required:o.required,checked:y,...d,...a,name:o.name,ref:b,onCheck:()=>o.onValueChange(a.value),onKeyDown:It(v=>{v.key==="Enter"&&v.preventDefault()}),onFocus:It(a.onFocus,()=>{p.current&&f.current?.click()})})})});mr.displayName=ur;var va="RadioGroupIndicator",fr=c.forwardRef((e,t)=>{const{__scopeRadioGroup:r,...s}=e,a=cr(r);return n.jsx(ar,{...a,...s,ref:t})});fr.displayName=va;var pr=dr,hr=mr,wa=fr;const xr=c.forwardRef(({className:e,...t},r)=>n.jsx(pr,{className:ye("grid gap-2",e),...t,ref:r}));xr.displayName=pr.displayName;const gr=c.forwardRef(({className:e,...t},r)=>n.jsx(hr,{ref:r,className:ye("aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",e),...t,children:n.jsx(wa,{className:"flex items-center justify-center",children:n.jsx(Pn,{className:"h-3.5 w-3.5 fill-primary"})})}));gr.displayName=hr.displayName;const Na=/(\[\[.*?\]\])/g,ja=/!\[\[(.*?)\]\]/g,Sa=[".png",".jpg",".jpeg",".gif",".svg",".webp",".bmp"],Ca=/^\[!([\w-]+)\]\s*(.*)?$/,hn={note:"border-blue-500/50 bg-blue-500/10",tip:"border-green-500/50 bg-green-500/10",important:"border-purple-500/50 bg-purple-500/10",warning:"border-yellow-500/50 bg-yellow-500/10",caution:"border-red-500/50 bg-red-500/10",info:"border-blue-400/50 bg-blue-400/10",abstract:"border-cyan-500/50 bg-cyan-500/10",summary:"border-cyan-500/50 bg-cyan-500/10",todo:"border-blue-500/50 bg-blue-500/10",success:"border-green-500/50 bg-green-500/10",question:"border-yellow-400/50 bg-yellow-400/10",example:"border-purple-400/50 bg-purple-400/10",quote:"border-gray-400/50 bg-gray-400/10",bug:"border-red-400/50 bg-red-400/10",danger:"border-red-500/50 bg-red-500/10",fail:"border-red-500/50 bg-red-500/10",failure:"border-red-500/50 bg-red-500/10"};function jt(e,t){return e.split(Na).map((r,s)=>{const a=r.match(/^\[\[(.*?)\]\]$/);if(a){const o=a[1].includes("|")?a[1].split("|")[1]:a[1],i=a[1].includes("|")?a[1].split("|")[0]:a[1];return n.jsx("span",{className:"text-blue-400 hover:text-blue-300 cursor-pointer underline decoration-dotted",onClick:l=>t?.(i,l.shiftKey),title:`${i} (Shift+click for Obsidian app)`,children:o},s)}return n.jsx("span",{children:r},s)})}function ka(e){return e.replace(ja,(t,r)=>{const s=r.toLowerCase();return Sa.some(o=>s.endsWith(o))?`![${r}](/api/obsidian/vault-file/${encodeURIComponent(r)})`:`[[${r}]]`})}function Ea(e){const t=e.split(`
`),r=[];let s=!1,a="",o="",i=[];const l=()=>{if(!s)return;const d=hn[a.toLowerCase()]||hn.note,f=o||a.charAt(0).toUpperCase()+a.slice(1);r.push(`<div class="callout ${d} border-l-4 rounded px-3 py-2 my-2">`),r.push(`<div class="font-bold text-xs uppercase tracking-wider mb-1">${f}</div>`),r.push(""),r.push(i.join(`
`)),r.push(""),r.push("</div>"),s=!1,i=[]};for(const d of t){if(d.startsWith("> ")){const f=d.slice(2),b=f.match(Ca);if(b&&!s){s=!0,a=b[1],o=b[2]||"";continue}if(s){i.push(f);continue}}else if(d===">"&&s){i.push("");continue}else l();r.push(d)}return l(),r.join(`
`)}function br({content:e,onWikilinkClick:t}){const r=Ea(ka(e)),s={h1:({children:a})=>n.jsx("h1",{className:"text-xl font-bold text-primary border-b border-primary/30 pb-1 mb-3 mt-4",children:a}),h2:({children:a})=>n.jsx("h2",{className:"text-lg font-bold text-primary/90 border-b border-primary/20 pb-1 mb-2 mt-3",children:a}),h3:({children:a})=>n.jsx("h3",{className:"text-base font-semibold text-primary/80 mb-2 mt-3",children:a}),h4:({children:a})=>n.jsx("h4",{className:"text-sm font-semibold text-primary/70 mb-1 mt-2",children:a}),p:({children:a})=>typeof a=="string"?n.jsx("p",{className:"mb-2 leading-relaxed",children:jt(a,t)}):n.jsx("p",{className:"mb-2 leading-relaxed",children:a}),strong:({children:a})=>n.jsx("strong",{className:"font-bold text-foreground",children:a}),em:({children:a})=>n.jsx("em",{className:"italic text-foreground/90",children:a}),ul:({children:a})=>n.jsx("ul",{className:"list-disc list-inside mb-2 space-y-0.5 ml-2",children:a}),ol:({children:a})=>n.jsx("ol",{className:"list-decimal list-inside mb-2 space-y-0.5 ml-2",children:a}),li:({children:a})=>typeof a=="string"?n.jsx("li",{className:"leading-relaxed",children:jt(a,t)}):n.jsx("li",{className:"leading-relaxed",children:a}),blockquote:({children:a})=>n.jsx("blockquote",{className:"border-l-4 border-primary/30 pl-3 my-2 text-muted-foreground italic",children:a}),code:({children:a,className:o})=>o?.startsWith("language-")?n.jsx("code",{className:"block bg-black/80 border border-secondary/40 rounded p-3 my-2 text-xs font-mono overflow-x-auto whitespace-pre",children:a}):n.jsx("code",{className:"bg-secondary/40 px-1.5 py-0.5 rounded text-xs font-mono text-primary",children:a}),pre:({children:a})=>n.jsx("pre",{className:"my-2",children:a}),hr:()=>n.jsx("hr",{className:"border-primary/20 my-4"}),a:({href:a,children:o})=>n.jsx("a",{href:a,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300 underline",children:o}),table:({children:a})=>n.jsx("div",{className:"overflow-x-auto my-2",children:n.jsx("table",{className:"w-full text-xs border-collapse border border-secondary/40",children:a})}),th:({children:a})=>n.jsx("th",{className:"border border-secondary/40 bg-secondary/20 px-2 py-1 text-left font-semibold",children:a}),td:({children:a})=>typeof a=="string"?n.jsx("td",{className:"border border-secondary/40 px-2 py-1",children:jt(a,t)}):n.jsx("td",{className:"border border-secondary/40 px-2 py-1",children:a}),img:({src:a,alt:o})=>n.jsx("img",{src:a,alt:o||"",className:"max-w-full rounded border border-secondary/40 my-2",loading:"lazy"}),del:({children:a})=>n.jsx("del",{className:"line-through text-muted-foreground",children:a}),input:({checked:a,...o})=>n.jsx("input",{type:"checkbox",checked:a,readOnly:!0,className:"mr-1.5 accent-primary",...o})};return n.jsx("div",{className:"obsidian-preview prose-invert max-w-none text-sm leading-relaxed",children:n.jsx(Lr,{remarkPlugins:[_r],components:s,allowedElements:void 0,unwrapDisallowed:!1,children:r})})}function xn(e,t){if(t.length===0)return e;const r=[];for(const s of t)r.push({type:"image_url",image_url:{url:s}});return e.trim()&&r.push({type:"text",text:e}),r}const Pa=`Generate Anki flashcards from the following study material. Output ONLY a numbered list in this exact format:

1. Front: [question]
Back: [answer]
Tags: [comma-separated tags like: Module1, Obj2, TopicName]

Rules:
- Front = the question only (no module/objective prefixes)
- Back = concise answer
- Tags = include Module#, Obj#, and topic keywords
- One card per concept
- No extra text before or after the list

Study material:
[PASTE YOUR NOTES HERE]`,Ra=(e,t)=>{const r=e.split(`
`),s=t.split(`
`),a=[];let o=0,i=0;for(;o<r.length||i<s.length;){const l=r[o],d=s[i];if(o<r.length&&i<s.length&&l===d){a.push(` ${l}`),o+=1,i+=1;continue}o<r.length&&(a.push(`-${l}`),o+=1),i<s.length&&(a.push(`+${d}`),i+=1)}return a};function Ia(){const[e,t]=c.useState("chat"),[r,s]=c.useState([]),[a,o]=c.useState(""),[i,l]=c.useState([]),[d,f]=c.useState(!1),[b,y]=c.useState("anki"),[p,v]=c.useState(!1),[N,x]=c.useState(!1),[h,m]=c.useState(!1),[g,k]=c.useState(null),[P,D]=c.useState(""),[M,I]=c.useState(null),[w,L]=c.useState(null),[O,T]=c.useState(""),[F,Z]=c.useState(""),[V,G]=c.useState({}),[J,ie]=c.useState([]),te=c.useRef(null),pe=c.useRef(null),he=ot(),de=c.useCallback(()=>{te.current&&(te.current.scrollTop=te.current.scrollHeight)},[]);c.useEffect(()=>{de()},[r,de]);const ue=()=>{x(!1),m(!1),k(null),D(""),I(null),L(null),T(""),Z(""),G({}),ie([])},u=R=>{R?x(!0):ue()},S=async R=>{m(!0),k(null),D(R);try{const j=await q.brain.organizePreview(R);if(!j.success||!j.organized||!j.destination)throw new Error(j.error||"Unable to organize notes.");I(j.organized),L(j.destination),T("recommended");const H=j.organized.checklist??[],W={};return H.forEach(X=>{W[X]=!1}),G(W),ie(Ra(R,j.organized.markdown||"")),x(!0),!0}catch(j){const H=j instanceof Error?j.message:String(j);return k(H),!1}finally{m(!1)}},z=R=>{G(j=>({...j,[R]:!j[R]}))},C=Object.values(V).length===0?!0:Object.values(V).every(Boolean),E=()=>w?O==="custom"?F.trim():w.options.find(j=>j.id===O)?.path||"":"",A=async()=>{if(!M)return;const R=E();if(!R){k("Select a destination path.");return}k(null),m(!0),f(!0);try{await ne(P,{destinationPath:R,organizedMarkdown:M.markdown,organizedTitle:M.title,confirmWrite:!0}),ue()}catch(j){const H=j instanceof Error?j.message:String(j);k(H)}finally{m(!1),f(!1)}},_=(R,j)=>{const H=R.startsWith("+"),W=R.startsWith("-");return n.jsx("div",{className:`font-terminal text-[11px] px-2 ${H?"bg-green-900/30 text-green-400":W?"bg-red-900/30 text-red-400":"text-muted-foreground"}`,children:R},j)},B=R=>{const j=new FileReader;j.onload=()=>{typeof j.result=="string"&&l(H=>[...H,j.result])},j.readAsDataURL(R)},le=R=>{const j=R.clipboardData?.items;if(j){for(const H of Array.from(j))if(H.type.startsWith("image/")){R.preventDefault();const W=H.getAsFile();W&&B(W)}}},ce=R=>{const j=R.target.files;if(j){for(const H of Array.from(j))H.type.startsWith("image/")&&B(H);R.target.value=""}},U=async(R,j)=>{s(me=>[...me,{role:"assistant",content:""}]);const H=r.map(me=>({role:me.role,content:me.images?.length?xn(me.content,me.images):me.content})).concat([{role:"user",content:xn(R,j)}]),X=(await fetch("/api/brain/quick-chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:H})})).body?.getReader(),Y=new TextDecoder;if(!X)throw new Error("No response body");let xe="";for(;;){const{done:me,value:Ne}=await X.read();if(me)break;xe+=Y.decode(Ne,{stream:!0});const We=xe.split(`
`);xe=We.pop()??"";for(const Qt of We){if(!Qt.startsWith("data: "))continue;const Xt=Qt.slice(6);if(Xt==="[DONE]")break;try{const Je=JSON.parse(Xt);if(Je.error){s(ft=>{const ge=[...ft];return ge[ge.length-1]={role:"assistant",content:`Error: ${Je.error}`},ge});return}Je.content&&s(ft=>{const ge=[...ft],Zt=ge[ge.length-1];return ge[ge.length-1]={...Zt,content:Zt.content+Je.content},ge})}catch{}}}},ne=async(R,j)=>{try{const X={message:R,syncToObsidian:b==="obsidian"||b==="both",mode:b==="both"?"all":b,destinationPath:j?.destinationPath,organizedMarkdown:j?.organizedMarkdown,organizedTitle:j?.organizedTitle,confirmWrite:j?.confirmWrite},Y=await q.brain.chat(X);let xe=Y.response;const me={cardsCreated:Y.cardsCreated,sessionSaved:Y.sessionSaved,sessionId:Y.sessionId},Ne=[];Y.sessionSaved&&Ne.push(`Session saved (ID: ${Y.sessionId})`),Y.cardsCreated&&Ne.push(`${Y.cardsCreated} Anki cards created`),Y.obsidianSynced&&Ne.push("Synced to Obsidian"),Y.obsidianError&&Ne.push(`Obsidian error: ${Y.obsidianError}`),Ne.length>0&&(xe=`${Ne.join(" | ")}

${xe}`),s(We=>[...We,{role:"assistant",content:xe,meta:me}]),he.invalidateQueries({queryKey:["anki","drafts"]}),he.invalidateQueries({queryKey:["brain","metrics"]}),he.invalidateQueries({queryKey:["sessions"]})}catch(H){s(W=>[...W,{role:"assistant",content:`Error: ${H}`}])}},we=async()=>{const R=a.trim();if(!R&&i.length===0)return;const j={role:"user",content:R,images:[...i]};s(H=>[...H,j]),o(""),l([]),f(!0);try{e==="chat"?await U(R,j.images??[]):b==="obsidian"||b==="both"?await S(R)||s(W=>[...W,{role:"assistant",content:"Error: Unable to prepare preview."}]):await ne(R)}catch(H){s(W=>{const X=W[W.length-1];if(X?.role==="assistant"&&!X.content){const Y=[...W];return Y[Y.length-1]={role:"assistant",content:`Error: ${H}`},Y}return[...W,{role:"assistant",content:`Error: ${H}`}]})}finally{f(!1)}},Ie=R=>{R.key==="Enter"&&!R.shiftKey&&(R.preventDefault(),we())};return n.jsxs(n.Fragment,{children:[n.jsx(Dt,{open:N,onOpenChange:u,children:n.jsxs($t,{className:"max-w-6xl w-full h-[85vh] bg-black border-2 border-primary rounded-none p-4 overflow-hidden",children:[n.jsxs(Ot,{className:"space-y-1",children:[n.jsxs(Lt,{className:"font-arcade text-sm text-primary flex items-center gap-2",children:[n.jsx(Ht,{className:"w-4 h-4"}),"ORGANIZE + REVIEW"]}),n.jsx(_t,{className:"font-terminal text-[11px] text-muted-foreground",children:"Review the organized notes, compare to raw, then choose where to save."})]}),g&&n.jsx("div",{className:"border border-red-500/50 bg-red-900/20 text-red-200 font-terminal text-xs p-2 rounded-none",children:g}),n.jsxs("div",{className:"grid grid-cols-3 gap-4 h-[70vh]",children:[n.jsx("div",{className:"col-span-2 flex flex-col gap-3",children:n.jsxs(Qr,{defaultValue:"preview",className:"w-full",children:[n.jsxs(Xr,{className:"grid grid-cols-3 rounded-none",children:[n.jsx(xt,{value:"preview",className:"rounded-none text-xs",children:"Preview"}),n.jsx(xt,{value:"raw",className:"rounded-none text-xs",children:"Raw"}),n.jsx(xt,{value:"diff",className:"rounded-none text-xs",children:"Diff"})]}),n.jsx(gt,{value:"preview",className:"mt-2",children:n.jsx(Ge,{className:"h-[56vh] border border-secondary/40 rounded-none bg-black/40 p-3",children:n.jsxs("div",{className:"space-y-2",children:[n.jsx("div",{className:"font-arcade text-xs text-primary",children:M?.title||"Untitled"}),n.jsx(br,{content:M?.markdown||""})]})})}),n.jsx(gt,{value:"raw",className:"mt-2",children:n.jsx(Ge,{className:"h-[56vh] border border-secondary/40 rounded-none bg-black/40 p-3",children:n.jsx("pre",{className:"whitespace-pre-wrap font-terminal text-[11px] text-foreground",children:P})})}),n.jsx(gt,{value:"diff",className:"mt-2",children:n.jsx(Ge,{className:"h-[56vh] border border-secondary/40 rounded-none bg-black/40 p-0",children:n.jsx("div",{className:"p-2",children:J.length===0?n.jsx("div",{className:"text-muted-foreground font-terminal text-xs",children:"No diff available."}):J.map((R,j)=>_(R,j))})})})]})}),n.jsxs("div",{className:"col-span-1 flex flex-col gap-3",children:[n.jsxs("div",{className:"border border-secondary/50 bg-black/40 p-3 rounded-none",children:[n.jsx("div",{className:"font-arcade text-[10px] text-primary mb-2",children:"DESTINATION"}),n.jsx(xr,{value:O,onValueChange:T,className:"space-y-2",children:(w?.options||[]).map(R=>n.jsxs("label",{className:"flex items-start gap-2 cursor-pointer",children:[n.jsx(gr,{value:R.id,className:"mt-1"}),n.jsxs("div",{className:"space-y-1",children:[n.jsxs("div",{className:"font-terminal text-[11px] text-foreground flex items-center gap-1",children:[R.label,R.exists&&n.jsx(et,{variant:"outline",className:"text-[9px]",children:"existing"})]}),n.jsx("div",{className:"font-terminal text-[10px] text-muted-foreground break-all",children:R.path||"Custom path"})]})]},R.id))}),O==="custom"&&n.jsxs("div",{className:"mt-2 space-y-1",children:[n.jsx("div",{className:"font-terminal text-[10px] text-muted-foreground",children:"Custom path"}),n.jsx(De,{value:F,onChange:R=>Z(R.target.value),placeholder:"School/Therapeutic Intervention/Module 01 - Title.md",className:"bg-black border-secondary/60 rounded-none text-xs font-terminal"})]})]}),n.jsxs("div",{className:"border border-secondary/50 bg-black/40 p-3 rounded-none",children:[n.jsx("div",{className:"font-arcade text-[10px] text-primary mb-2",children:"REVIEW CHECKLIST"}),n.jsx("div",{className:"space-y-2",children:(M?.checklist||[]).map(R=>n.jsxs("label",{className:"flex items-start gap-2 cursor-pointer",children:[n.jsx(In,{checked:!!V[R],onCheckedChange:()=>z(R)}),n.jsx("span",{className:"font-terminal text-[11px] text-foreground",children:R})]},R))})]}),(M?.suggested_links||[]).length>0&&n.jsxs("div",{className:"border border-secondary/50 bg-black/40 p-3 rounded-none",children:[n.jsx("div",{className:"font-arcade text-[10px] text-primary mb-2",children:"SUGGESTED LINKS"}),n.jsx("div",{className:"space-y-1",children:M?.suggested_links.map(R=>n.jsxs("div",{className:"font-terminal text-[11px] text-muted-foreground",children:["[[",R,"]]"]},R))})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(K,{variant:"outline",className:"flex-1 rounded-none font-terminal text-xs",onClick:()=>ue(),disabled:h,children:"Cancel"}),n.jsxs(K,{className:"flex-1 bg-primary hover:bg-primary/80 rounded-none font-terminal text-xs",onClick:A,disabled:!C||h||!E(),children:[n.jsx(Zr,{className:"w-3 h-3 mr-1"}),h?"Saving...":"Confirm & Save"]})]})]})]})]})}),(()=>{const R=n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"px-3 py-1 border-b border-primary/30 flex items-center justify-between gap-2 shrink-0",children:[n.jsxs("div",{className:"flex bg-black/40 border border-primary/40 rounded-none overflow-hidden mr-2",children:[n.jsxs("button",{onClick:()=>t("chat"),className:`flex items-center gap-1 px-2 py-0.5 text-xs font-arcade transition-colors ${e==="chat"?"bg-primary text-black":"text-muted-foreground hover:text-foreground"}`,children:[n.jsx(Mn,{className:"w-3 h-3"})," CHAT"]}),n.jsxs("button",{onClick:()=>t("ingest"),className:`flex items-center gap-1 px-2 py-0.5 text-xs font-arcade transition-colors ${e==="ingest"?"bg-primary text-black":"text-muted-foreground hover:text-foreground"}`,children:[n.jsx(as,{className:"w-3 h-3"})," INGEST"]})]}),n.jsx("p",{className:"text-xs text-muted-foreground truncate flex-1",children:e==="chat"?"Chat with Gemini Flash":"Paste notes to create cards & save sessions"}),e==="ingest"&&n.jsx("div",{className:"flex bg-black/40 border border-primary/40 rounded-none overflow-hidden shrink-0",children:["anki","obsidian","both"].map(j=>n.jsxs("button",{onClick:()=>y(j),className:`flex items-center gap-1 px-2 py-0.5 text-xs font-arcade transition-colors ${b===j?"bg-primary text-black":"text-muted-foreground hover:text-foreground"}`,children:[j==="anki"&&n.jsxs(n.Fragment,{children:[n.jsx(Be,{className:"w-3 h-3"})," ANKI"]}),j==="obsidian"&&n.jsxs(n.Fragment,{children:[n.jsx(Pt,{className:"w-3 h-3"})," OBSIDIAN"]}),j==="both"&&n.jsx(n.Fragment,{children:"BOTH"})]},j))}),e==="ingest"&&n.jsx("button",{type:"button",className:"bg-primary hover:bg-primary/80 px-2 py-0.5 rounded-none text-xs font-terminal shrink-0",onClick:()=>{navigator.clipboard.writeText(Pa),v(!0),setTimeout(()=>v(!1),2e3)},children:p?"Copied!":"Copy Prompt"})]}),n.jsxs("div",{ref:te,className:"flex-1 overflow-y-auto px-4 py-2 space-y-3",children:[r.length===0&&n.jsx("p",{className:"text-muted-foreground text-sm font-terminal text-center py-8",children:e==="chat"?"Ask anything. Paste screenshots with Ctrl+V.":"Paste your study notes to ingest into Brain."}),r.map((j,H)=>n.jsx("div",{className:`flex ${j.role==="user"?"justify-end":"justify-start"}`,children:n.jsxs("div",{className:`max-w-[80%] rounded-none px-3 py-2 text-sm font-terminal whitespace-pre-wrap ${j.role==="user"?"bg-primary/20 text-foreground border border-primary/30":"bg-secondary/40 text-foreground border border-secondary/60"}`,children:[j.images?.map((W,X)=>n.jsx("img",{src:W,alt:"attached",className:"max-h-32 rounded-none mb-1"},X)),j.content]})},H)),d&&n.jsx("div",{className:"flex justify-start",children:n.jsx("div",{className:"bg-secondary/40 border border-secondary/60 rounded-none px-3 py-2",children:n.jsx(qt,{className:"w-4 h-4 animate-spin text-primary"})})})]}),i.length>0&&n.jsx("div",{className:"px-4 py-1 flex gap-2 flex-wrap shrink-0",children:i.map((j,H)=>n.jsxs("div",{className:"relative",children:[n.jsx("img",{src:j,alt:"pending",className:"h-12 rounded-none border border-primary/30"}),n.jsx("button",{onClick:()=>l(W=>W.filter((X,Y)=>Y!==H)),className:"absolute -top-1 -right-1 bg-destructive rounded-none p-0.5",children:n.jsx(Et,{className:"w-3 h-3"})})]},H))}),n.jsxs("div",{className:"flex items-end gap-2 px-4 py-2 border-t border-primary/30 shrink-0",children:[n.jsx("input",{ref:pe,type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:ce}),e==="chat"&&n.jsx(K,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 shrink-0",onClick:()=>pe.current?.click(),children:n.jsx(gs,{className:"w-4 h-4 text-primary"})}),n.jsx("textarea",{value:a,onChange:j=>o(j.target.value),onKeyDown:Ie,onPaste:le,placeholder:e==="chat"?"Ask anything... (Ctrl+V to paste images)":"Paste study notes to ingest...",rows:e==="ingest"?3:1,className:"flex-1 bg-black/60 border-2 border-muted-foreground/20 rounded-none px-3 py-1.5 text-sm font-terminal resize-none focus:outline-none focus:ring-1 focus:ring-ring"}),n.jsx(K,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 shrink-0",onClick:we,disabled:d,children:n.jsx(es,{className:"w-4 h-4 text-primary"})})]})]});return n.jsx("div",{className:"flex flex-col h-full",children:R})})()]})}function za({workspace:e}){const[t,r]=c.useState(!1);return c.useEffect(()=>{if(!t)return;const s=a=>{a.key==="Escape"&&r(!1)};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[t]),e.currentFile?n.jsxs("div",{className:ye("flex flex-col",t?"fixed inset-0 z-50 bg-black":"h-full"),children:[n.jsxs("div",{className:"flex items-center justify-between px-3 py-1.5 border-b border-secondary/30 bg-black/40",children:[n.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[n.jsxs("span",{className:"font-terminal text-sm text-primary truncate",children:[e.currentFile.split("/").pop(),e.hasChanges&&n.jsx("span",{className:"text-yellow-500 ml-1",children:"*"})]}),n.jsx("button",{onClick:()=>{const s=e.obsidianConfig?.vaultName||"Treys School",a=e.currentFile.replace(/\.md$/,"");window.open(`obsidian://open?vault=${encodeURIComponent(s)}&file=${encodeURIComponent(a)}`,"_blank")},className:"text-muted-foreground hover:text-primary shrink-0",title:"Open in Obsidian",children:n.jsx(ts,{className:"w-3 h-3"})})]}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx(K,{size:"sm",variant:"ghost",className:"h-5 px-2 text-xs font-terminal",onClick:()=>e.setPreviewMode(!e.previewMode),children:e.previewMode?"Edit":"Preview"}),n.jsxs(K,{size:"sm",variant:"ghost",onClick:e.saveFile,disabled:!e.hasChanges||e.isSaving,className:"h-5 px-2 text-xs font-terminal",children:[n.jsx(Ft,{className:"w-3 h-3 mr-1"}),e.isSaving?"Saving...":"Save"]}),n.jsx(K,{size:"sm",variant:"ghost",className:"h-5 px-1.5 text-xs font-terminal",onClick:()=>r(!t),title:t?"Exit fullscreen":"Fullscreen",children:t?n.jsx(ws,{className:"w-3 h-3"}):n.jsx(ys,{className:"w-3 h-3"})})]})]}),e.previewMode?n.jsx("div",{className:"flex-1 p-3 bg-black/60 font-terminal overflow-y-auto",children:n.jsx(br,{content:e.fileContent,onWikilinkClick:e.handleWikilinkClick})}):n.jsx("textarea",{value:e.fileContent,onChange:s=>e.setFileContent(s.target.value),className:"flex-1 w-full p-3 bg-black/60 font-terminal text-sm resize-none focus:outline-none focus:ring-1 focus:ring-primary overflow-y-auto min-h-[200px]",placeholder:"File content...",style:{height:"100%"}})]}):n.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-muted-foreground font-terminal text-sm gap-2",children:[n.jsx(Ht,{className:"w-8 h-8 opacity-30"}),n.jsx("p",{children:"Select a file from the vault sidebar"}),n.jsx("p",{className:"text-xs",children:"or create a new note"})]})}const Ma=c.lazy(()=>At(()=>import("./ConceptMapEditor-tQxxK8-j.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21])).then(e=>({default:e.ConceptMapEditor}))),Aa=c.lazy(()=>At(()=>import("./VaultGraphView-BEFA5tOK.js"),__vite__mapDeps([22,1,2,23,3,4,15,14])).then(e=>({default:e.VaultGraphView}))),Ta=c.lazy(()=>At(()=>import("./MindMapView-DeV1tAK9.js"),__vite__mapDeps([24,1,2,23,3,4,15,14])).then(e=>({default:e.MindMapView})));class Da extends c.Component{constructor(){super(...arguments),this.state={error:null}}static getDerivedStateFromError(t){return{error:t.message}}render(){return this.state.error?n.jsxs("div",{className:"flex flex-col items-center justify-center h-full gap-2 p-4",children:[n.jsx("p",{className:"font-arcade text-xs text-red-400",children:"GRAPH RENDER ERROR"}),n.jsx("p",{className:"font-terminal text-xs text-muted-foreground text-center",children:this.state.error}),n.jsx("button",{className:"font-terminal text-sm text-primary underline",onClick:()=>this.setState({error:null}),children:"Try again"})]}):this.props.children}}function $a(){return n.jsx("div",{className:"flex items-center justify-center h-full",children:n.jsx(qt,{className:"w-6 h-6 animate-spin text-primary"})})}function Oa(){const[e,t]=c.useState("concept"),r=[{id:"concept",label:"Concept Map"},{id:"vault",label:"Vault Graph"},{id:"mindmap",label:"Mind Map"}];return n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsx("div",{className:"flex items-center gap-1 px-3 py-1.5 border-b border-secondary/30 bg-black/40 shrink-0",children:r.map(s=>n.jsx("button",{onClick:()=>t(s.id),className:`px-2.5 py-1 font-terminal text-xs transition-colors ${e===s.id?"bg-primary/20 text-primary border border-primary/40":"text-muted-foreground hover:text-foreground border border-transparent"}`,children:s.label},s.id))}),n.jsx("div",{className:"flex-1 min-h-0 overflow-hidden",children:n.jsx(Da,{children:n.jsxs(c.Suspense,{fallback:n.jsx($a,{}),children:[e==="concept"&&n.jsx(Ma,{}),e==="vault"&&n.jsx(Aa,{}),e==="mindmap"&&n.jsx(Ta,{})]})})})]})}function La(e,t){if(e.match(/^[a-z]+:\/\//i))return e;if(e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i))return e;const r=document.implementation.createHTMLDocument(),s=r.createElement("base"),a=r.createElement("a");return r.head.appendChild(s),r.body.appendChild(a),t&&(s.href=t),a.href=e,a.href}const _a=(()=>{let e=0;const t=()=>`0000${(Math.random()*36**4<<0).toString(36)}`.slice(-4);return()=>(e+=1,`u${t()}${e}`)})();function Se(e){const t=[];for(let r=0,s=e.length;r<s;r++)t.push(e[r]);return t}let Me=null;function yr(e={}){return Me||(e.includeStyleProperties?(Me=e.includeStyleProperties,Me):(Me=Se(window.getComputedStyle(document.documentElement)),Me))}function rt(e,t){const s=(e.ownerDocument.defaultView||window).getComputedStyle(e).getPropertyValue(t);return s?parseFloat(s.replace("px","")):0}function Fa(e){const t=rt(e,"border-left-width"),r=rt(e,"border-right-width");return e.clientWidth+t+r}function Ha(e){const t=rt(e,"border-top-width"),r=rt(e,"border-bottom-width");return e.clientHeight+t+r}function vr(e,t={}){const r=t.width||Fa(e),s=t.height||Ha(e);return{width:r,height:s}}function qa(){let e,t;try{t=process}catch{}const r=t&&t.env?t.env.devicePixelRatio:null;return r&&(e=parseInt(r,10),Number.isNaN(e)&&(e=1)),e||window.devicePixelRatio||1}const ae=16384;function Va(e){(e.width>ae||e.height>ae)&&(e.width>ae&&e.height>ae?e.width>e.height?(e.height*=ae/e.width,e.width=ae):(e.width*=ae/e.height,e.height=ae):e.width>ae?(e.height*=ae/e.width,e.width=ae):(e.width*=ae/e.height,e.height=ae))}function st(e){return new Promise((t,r)=>{const s=new Image;s.onload=()=>{s.decode().then(()=>{requestAnimationFrame(()=>t(s))})},s.onerror=r,s.crossOrigin="anonymous",s.decoding="async",s.src=e})}async function Ga(e){return Promise.resolve().then(()=>new XMLSerializer().serializeToString(e)).then(encodeURIComponent).then(t=>`data:image/svg+xml;charset=utf-8,${t}`)}async function Ba(e,t,r){const s="http://www.w3.org/2000/svg",a=document.createElementNS(s,"svg"),o=document.createElementNS(s,"foreignObject");return a.setAttribute("width",`${t}`),a.setAttribute("height",`${r}`),a.setAttribute("viewBox",`0 0 ${t} ${r}`),o.setAttribute("width","100%"),o.setAttribute("height","100%"),o.setAttribute("x","0"),o.setAttribute("y","0"),o.setAttribute("externalResourcesRequired","true"),a.appendChild(o),o.appendChild(e),Ga(a)}const re=(e,t)=>{if(e instanceof t)return!0;const r=Object.getPrototypeOf(e);return r===null?!1:r.constructor.name===t.name||re(r,t)};function Ka(e){const t=e.getPropertyValue("content");return`${e.cssText} content: '${t.replace(/'|"/g,"")}';`}function Ua(e,t){return yr(t).map(r=>{const s=e.getPropertyValue(r),a=e.getPropertyPriority(r);return`${r}: ${s}${a?" !important":""};`}).join(" ")}function Wa(e,t,r,s){const a=`.${e}:${t}`,o=r.cssText?Ka(r):Ua(r,s);return document.createTextNode(`${a}{${o}}`)}function gn(e,t,r,s){const a=window.getComputedStyle(e,r),o=a.getPropertyValue("content");if(o===""||o==="none")return;const i=_a();try{t.className=`${t.className} ${i}`}catch{return}const l=document.createElement("style");l.appendChild(Wa(i,r,a,s)),t.appendChild(l)}function Ja(e,t,r){gn(e,t,":before",r),gn(e,t,":after",r)}const bn="application/font-woff",yn="image/jpeg",Ya={woff:bn,woff2:bn,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:yn,jpeg:yn,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function Qa(e){const t=/\.([^./]*?)$/g.exec(e);return t?t[1]:""}function Jt(e){const t=Qa(e).toLowerCase();return Ya[t]||""}function Xa(e){return e.split(/,/)[1]}function zt(e){return e.search(/^(data:)/)!==-1}function Za(e,t){return`data:${t};base64,${e}`}async function wr(e,t,r){const s=await fetch(e,t);if(s.status===404)throw new Error(`Resource "${s.url}" not found`);const a=await s.blob();return new Promise((o,i)=>{const l=new FileReader;l.onerror=i,l.onloadend=()=>{try{o(r({res:s,result:l.result}))}catch(d){i(d)}},l.readAsDataURL(a)})}const St={};function eo(e,t,r){let s=e.replace(/\?.*/,"");return r&&(s=e),/ttf|otf|eot|woff2?/i.test(s)&&(s=s.replace(/.*\//,"")),t?`[${t}]${s}`:s}async function Yt(e,t,r){const s=eo(e,t,r.includeQueryParams);if(St[s]!=null)return St[s];r.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+new Date().getTime());let a;try{const o=await wr(e,r.fetchRequestInit,({res:i,result:l})=>(t||(t=i.headers.get("Content-Type")||""),Xa(l)));a=Za(o,t)}catch(o){a=r.imagePlaceholder||"";let i=`Failed to fetch resource: ${e}`;o&&(i=typeof o=="string"?o:o.message),i&&console.warn(i)}return St[s]=a,a}async function to(e){const t=e.toDataURL();return t==="data:,"?e.cloneNode(!1):st(t)}async function no(e,t){if(e.currentSrc){const o=document.createElement("canvas"),i=o.getContext("2d");o.width=e.clientWidth,o.height=e.clientHeight,i?.drawImage(e,0,0,o.width,o.height);const l=o.toDataURL();return st(l)}const r=e.poster,s=Jt(r),a=await Yt(r,s,t);return st(a)}async function ro(e,t){var r;try{if(!((r=e?.contentDocument)===null||r===void 0)&&r.body)return await mt(e.contentDocument.body,t,!0)}catch{}return e.cloneNode(!1)}async function so(e,t){return re(e,HTMLCanvasElement)?to(e):re(e,HTMLVideoElement)?no(e,t):re(e,HTMLIFrameElement)?ro(e,t):e.cloneNode(Nr(e))}const ao=e=>e.tagName!=null&&e.tagName.toUpperCase()==="SLOT",Nr=e=>e.tagName!=null&&e.tagName.toUpperCase()==="SVG";async function oo(e,t,r){var s,a;if(Nr(t))return t;let o=[];return ao(e)&&e.assignedNodes?o=Se(e.assignedNodes()):re(e,HTMLIFrameElement)&&(!((s=e.contentDocument)===null||s===void 0)&&s.body)?o=Se(e.contentDocument.body.childNodes):o=Se(((a=e.shadowRoot)!==null&&a!==void 0?a:e).childNodes),o.length===0||re(e,HTMLVideoElement)||await o.reduce((i,l)=>i.then(()=>mt(l,r)).then(d=>{d&&t.appendChild(d)}),Promise.resolve()),t}function io(e,t,r){const s=t.style;if(!s)return;const a=window.getComputedStyle(e);a.cssText?(s.cssText=a.cssText,s.transformOrigin=a.transformOrigin):yr(r).forEach(o=>{let i=a.getPropertyValue(o);o==="font-size"&&i.endsWith("px")&&(i=`${Math.floor(parseFloat(i.substring(0,i.length-2)))-.1}px`),re(e,HTMLIFrameElement)&&o==="display"&&i==="inline"&&(i="block"),o==="d"&&t.getAttribute("d")&&(i=`path(${t.getAttribute("d")})`),s.setProperty(o,i,a.getPropertyPriority(o))})}function lo(e,t){re(e,HTMLTextAreaElement)&&(t.innerHTML=e.value),re(e,HTMLInputElement)&&t.setAttribute("value",e.value)}function co(e,t){if(re(e,HTMLSelectElement)){const r=t,s=Array.from(r.children).find(a=>e.value===a.getAttribute("value"));s&&s.setAttribute("selected","")}}function uo(e,t,r){return re(t,Element)&&(io(e,t,r),Ja(e,t,r),lo(e,t),co(e,t)),t}async function mo(e,t){const r=e.querySelectorAll?e.querySelectorAll("use"):[];if(r.length===0)return e;const s={};for(let o=0;o<r.length;o++){const l=r[o].getAttribute("xlink:href");if(l){const d=e.querySelector(l),f=document.querySelector(l);!d&&f&&!s[l]&&(s[l]=await mt(f,t,!0))}}const a=Object.values(s);if(a.length){const o="http://www.w3.org/1999/xhtml",i=document.createElementNS(o,"svg");i.setAttribute("xmlns",o),i.style.position="absolute",i.style.width="0",i.style.height="0",i.style.overflow="hidden",i.style.display="none";const l=document.createElementNS(o,"defs");i.appendChild(l);for(let d=0;d<a.length;d++)l.appendChild(a[d]);e.appendChild(i)}return e}async function mt(e,t,r){return!r&&t.filter&&!t.filter(e)?null:Promise.resolve(e).then(s=>so(s,t)).then(s=>oo(e,s,t)).then(s=>uo(e,s,t)).then(s=>mo(s,t))}const jr=/url\((['"]?)([^'"]+?)\1\)/g,fo=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,po=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function ho(e){const t=e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${t})(['"]?\\))`,"g")}function xo(e){const t=[];return e.replace(jr,(r,s,a)=>(t.push(a),r)),t.filter(r=>!zt(r))}async function go(e,t,r,s,a){try{const o=r?La(t,r):t,i=Jt(t);let l;return a||(l=await Yt(o,i,s)),e.replace(ho(t),`$1${l}$3`)}catch{}return e}function bo(e,{preferredFontFormat:t}){return t?e.replace(po,r=>{for(;;){const[s,,a]=fo.exec(r)||[];if(!a)return"";if(a===t)return`src: ${s};`}}):e}function Sr(e){return e.search(jr)!==-1}async function Cr(e,t,r){if(!Sr(e))return e;const s=bo(e,r);return xo(s).reduce((o,i)=>o.then(l=>go(l,i,t,r)),Promise.resolve(s))}async function Ae(e,t,r){var s;const a=(s=t.style)===null||s===void 0?void 0:s.getPropertyValue(e);if(a){const o=await Cr(a,null,r);return t.style.setProperty(e,o,t.style.getPropertyPriority(e)),!0}return!1}async function yo(e,t){await Ae("background",e,t)||await Ae("background-image",e,t),await Ae("mask",e,t)||await Ae("-webkit-mask",e,t)||await Ae("mask-image",e,t)||await Ae("-webkit-mask-image",e,t)}async function vo(e,t){const r=re(e,HTMLImageElement);if(!(r&&!zt(e.src))&&!(re(e,SVGImageElement)&&!zt(e.href.baseVal)))return;const s=r?e.src:e.href.baseVal,a=await Yt(s,Jt(s),t);await new Promise((o,i)=>{e.onload=o,e.onerror=t.onImageErrorHandler?(...d)=>{try{o(t.onImageErrorHandler(...d))}catch(f){i(f)}}:i;const l=e;l.decode&&(l.decode=o),l.loading==="lazy"&&(l.loading="eager"),r?(e.srcset="",e.src=a):e.href.baseVal=a})}async function wo(e,t){const s=Se(e.childNodes).map(a=>kr(a,t));await Promise.all(s).then(()=>e)}async function kr(e,t){re(e,Element)&&(await yo(e,t),await vo(e,t),await wo(e,t))}function No(e,t){const{style:r}=e;t.backgroundColor&&(r.backgroundColor=t.backgroundColor),t.width&&(r.width=`${t.width}px`),t.height&&(r.height=`${t.height}px`);const s=t.style;return s!=null&&Object.keys(s).forEach(a=>{r[a]=s[a]}),e}const vn={};async function wn(e){let t=vn[e];if(t!=null)return t;const s=await(await fetch(e)).text();return t={url:e,cssText:s},vn[e]=t,t}async function Nn(e,t){let r=e.cssText;const s=/url\(["']?([^"')]+)["']?\)/g,o=(r.match(/url\([^)]+\)/g)||[]).map(async i=>{let l=i.replace(s,"$1");return l.startsWith("https://")||(l=new URL(l,e.url).href),wr(l,t.fetchRequestInit,({result:d})=>(r=r.replace(i,`url(${d})`),[i,d]))});return Promise.all(o).then(()=>r)}function jn(e){if(e==null)return[];const t=[],r=/(\/\*[\s\S]*?\*\/)/gi;let s=e.replace(r,"");const a=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){const d=a.exec(s);if(d===null)break;t.push(d[0])}s=s.replace(a,"");const o=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,i="((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})",l=new RegExp(i,"gi");for(;;){let d=o.exec(s);if(d===null){if(d=l.exec(s),d===null)break;o.lastIndex=l.lastIndex}else l.lastIndex=o.lastIndex;t.push(d[0])}return t}async function jo(e,t){const r=[],s=[];return e.forEach(a=>{if("cssRules"in a)try{Se(a.cssRules||[]).forEach((o,i)=>{if(o.type===CSSRule.IMPORT_RULE){let l=i+1;const d=o.href,f=wn(d).then(b=>Nn(b,t)).then(b=>jn(b).forEach(y=>{try{a.insertRule(y,y.startsWith("@import")?l+=1:a.cssRules.length)}catch(p){console.error("Error inserting rule from remote css",{rule:y,error:p})}})).catch(b=>{console.error("Error loading remote css",b.toString())});s.push(f)}})}catch(o){const i=e.find(l=>l.href==null)||document.styleSheets[0];a.href!=null&&s.push(wn(a.href).then(l=>Nn(l,t)).then(l=>jn(l).forEach(d=>{i.insertRule(d,i.cssRules.length)})).catch(l=>{console.error("Error loading remote stylesheet",l)})),console.error("Error inlining remote css file",o)}}),Promise.all(s).then(()=>(e.forEach(a=>{if("cssRules"in a)try{Se(a.cssRules||[]).forEach(o=>{r.push(o)})}catch(o){console.error(`Error while reading CSS rules from ${a.href}`,o)}}),r))}function So(e){return e.filter(t=>t.type===CSSRule.FONT_FACE_RULE).filter(t=>Sr(t.style.getPropertyValue("src")))}async function Co(e,t){if(e.ownerDocument==null)throw new Error("Provided element is not within a Document");const r=Se(e.ownerDocument.styleSheets),s=await jo(r,t);return So(s)}function Er(e){return e.trim().replace(/["']/g,"")}function ko(e){const t=new Set;function r(s){(s.style.fontFamily||getComputedStyle(s).fontFamily).split(",").forEach(o=>{t.add(Er(o))}),Array.from(s.children).forEach(o=>{o instanceof HTMLElement&&r(o)})}return r(e),t}async function Eo(e,t){const r=await Co(e,t),s=ko(e);return(await Promise.all(r.filter(o=>s.has(Er(o.style.fontFamily))).map(o=>{const i=o.parentStyleSheet?o.parentStyleSheet.href:null;return Cr(o.cssText,i,t)}))).join(`
`)}async function Po(e,t){const r=t.fontEmbedCSS!=null?t.fontEmbedCSS:t.skipFonts?null:await Eo(e,t);if(r){const s=document.createElement("style"),a=document.createTextNode(r);s.appendChild(a),e.firstChild?e.insertBefore(s,e.firstChild):e.appendChild(s)}}async function Ro(e,t={}){const{width:r,height:s}=vr(e,t),a=await mt(e,t,!0);return await Po(a,t),await kr(a,t),No(a,t),await Ba(a,r,s)}async function Io(e,t={}){const{width:r,height:s}=vr(e,t),a=await Ro(e,t),o=await st(a),i=document.createElement("canvas"),l=i.getContext("2d"),d=t.pixelRatio||qa(),f=t.canvasWidth||r,b=t.canvasHeight||s;return i.width=f*d,i.height=b*d,t.skipAutoScale||Va(i),i.style.width=`${f}`,i.style.height=`${b}`,t.backgroundColor&&(l.fillStyle=t.backgroundColor,l.fillRect(0,0,i.width,i.height)),l.drawImage(o,0,0,i.width,i.height),i}async function zo(e,t={}){return(await Io(e,t)).toDataURL()}const Ct={title:"Untitled Comparison",columns:["Concept A","Concept B"],rows:[{feature:"Feature 1",values:["",""],isKey:!1},{feature:"Feature 2",values:["",""],isKey:!1},{feature:"Feature 3",values:["",""],isKey:!1}]};function Sn(e){const t=`| Feature | ${e.columns.join(" | ")} |`,r=`|${"----|".repeat(e.columns.length+1)}`,s=e.rows.map(a=>`| ${a.isKey?`**${a.feature}**`:a.feature} | ${a.values.join(" | ")} |`);return[t,r,...s].join(`
`)}function Mo({className:e}){const[t,r]=c.useState(()=>({...Ct,columns:[...Ct.columns],rows:Ct.rows.map(m=>({...m,values:[...m.values]}))})),s=c.useRef(null),{toast:a}=Tt(),o=c.useCallback(m=>{r(g=>({...g,title:m}))},[]),i=c.useCallback((m,g)=>{r(k=>{const P=[...k.columns];return P[m]=g,{...k,columns:P}})},[]),l=c.useCallback((m,g)=>{r(k=>{const P=k.rows.map((D,M)=>M===m?{...D,feature:g}:D);return{...k,rows:P}})},[]),d=c.useCallback((m,g,k)=>{r(P=>{const D=P.rows.map((M,I)=>{if(I!==m)return M;const w=[...M.values];return w[g]=k,{...M,values:w}});return{...P,rows:D}})},[]),f=c.useCallback(m=>{r(g=>{const k=g.rows.map((P,D)=>D===m?{...P,isKey:!P.isKey}:P);return{...g,rows:k}})},[]),b=c.useCallback(()=>{r(m=>{if(m.columns.length>=4)return m;const g=[...m.columns,`Concept ${m.columns.length+1}`],k=m.rows.map(P=>({...P,values:[...P.values,""]}));return{...m,columns:g,rows:k}})},[]),y=c.useCallback(m=>{r(g=>{if(g.columns.length<=2)return g;const k=g.columns.filter((D,M)=>M!==m),P=g.rows.map(D=>({...D,values:D.values.filter((M,I)=>I!==m)}));return{...g,columns:k,rows:P}})},[]),p=c.useCallback(()=>{r(m=>({...m,rows:[...m.rows,{feature:`Feature ${m.rows.length+1}`,values:m.columns.map(()=>""),isKey:!1}]}))},[]),v=c.useCallback(m=>{r(g=>g.rows.length<=1?g:{...g,rows:g.rows.filter((k,P)=>P!==m)})},[]),N=c.useCallback(()=>{const m=Sn(t);navigator.clipboard.writeText(m),a({title:"Markdown copied to clipboard"})},[t,a]),x=c.useCallback(async()=>{if(s.current)try{const m=await zo(s.current,{backgroundColor:"#000",quality:1}),g=document.createElement("a");g.download=`${t.title.replace(/[/\\?%*:|"<>]/g,"-")}.png`,g.href=m,g.click(),a({title:"PNG exported"})}catch(m){a({title:"Export failed",description:String(m),variant:"destructive"})}},[t.title,a]),h=c.useCallback(async()=>{const m=Sn(t),g=t.title.replace(/[/\\?%*:|"<>]/g,"-"),k=`---
type: comparison-table
created: ${new Date().toISOString()}
---

# ${t.title}

${m}
`,P=`Comparison Tables/${g}.md`;try{await q.obsidian.saveFile(P,k),a({title:"Saved to vault",description:P})}catch(D){a({title:"Save failed",description:String(D),variant:"destructive"})}},[t,a]);return n.jsxs("div",{className:ye("flex flex-col h-full",e),children:[n.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 border-b border-secondary/30 bg-black/40 shrink-0 flex-wrap",children:[n.jsxs(K,{size:"sm",variant:"ghost",className:"h-6 px-1.5 text-[9px] font-terminal",onClick:b,disabled:t.columns.length>=4,title:"Add column",children:[n.jsx(ls,{className:"w-3 h-3"}),n.jsx(tn,{className:"w-2 h-2"})]}),n.jsxs(K,{size:"sm",variant:"ghost",className:"h-6 px-1.5 text-[9px] font-terminal",onClick:p,title:"Add row",children:[n.jsx(Cs,{className:"w-3 h-3"}),n.jsx(tn,{className:"w-2 h-2"})]}),n.jsx("div",{className:"w-px h-4 bg-secondary/30"}),n.jsx(K,{size:"sm",variant:"ghost",className:"h-6 px-1.5 text-[9px] font-terminal",onClick:N,title:"Copy markdown",children:n.jsx(ds,{className:"w-3 h-3"})}),n.jsx(K,{size:"sm",variant:"ghost",className:"h-6 px-1.5 text-[9px] font-terminal",onClick:x,title:"Export PNG",children:n.jsx(Vt,{className:"w-3 h-3"})}),n.jsx(K,{size:"sm",variant:"ghost",className:"h-6 px-1.5 text-[9px] font-terminal",onClick:h,title:"Save to vault",children:n.jsx(Ft,{className:"w-3 h-3"})}),n.jsxs("span",{className:"ml-auto text-[9px] font-terminal text-muted-foreground",children:[t.columns.length,"C / ",t.rows.length,"R"]})]}),n.jsx("div",{className:"px-2 py-1 border-b border-secondary/20",children:n.jsx(De,{value:t.title,onChange:m=>o(m.target.value),className:"h-6 text-xs font-arcade bg-transparent border-none px-1 text-primary focus-visible:ring-0",placeholder:"Table title..."})}),n.jsx("div",{className:"flex-1 overflow-auto p-2",children:n.jsxs("div",{ref:s,className:"bg-black/80 border-2 border-primary/50",children:[n.jsxs("div",{className:"flex border-b-2 border-primary/50",children:[n.jsx("div",{className:"w-28 shrink-0 p-1 border-r border-secondary/30 bg-black/60",children:n.jsx("span",{className:"font-arcade text-[9px] text-muted-foreground",children:"FEATURE"})}),t.columns.map((m,g)=>n.jsxs("div",{className:"flex-1 min-w-[100px] p-1 border-r border-secondary/30 bg-black/60 flex items-center gap-1",children:[n.jsx(De,{value:m,onChange:k=>i(g,k.target.value),className:"h-5 text-[10px] font-arcade bg-transparent border-none px-0 text-primary focus-visible:ring-0 flex-1"}),t.columns.length>2&&n.jsx("button",{onClick:()=>y(g),className:"text-muted-foreground hover:text-destructive shrink-0",children:n.jsx(Xe,{className:"w-2.5 h-2.5"})})]},g))]}),t.rows.map((m,g)=>n.jsxs("div",{className:ye("flex border-b border-secondary/20",m.isKey&&"border-l-2 border-l-primary"),children:[n.jsxs("div",{className:"w-28 shrink-0 p-1 border-r border-secondary/30 flex items-center gap-1",children:[n.jsx("button",{onClick:()=>f(g),className:ye("shrink-0",m.isKey?"text-primary":"text-muted-foreground/40 hover:text-muted-foreground"),title:"Toggle key feature",children:n.jsx(Or,{className:"w-2.5 h-2.5",fill:m.isKey?"currentColor":"none"})}),n.jsx(De,{value:m.feature,onChange:k=>l(g,k.target.value),className:ye("h-5 text-[10px] font-terminal bg-transparent border-none px-0 focus-visible:ring-0 flex-1",m.isKey?"text-primary font-bold":"text-secondary-foreground")}),t.rows.length>1&&n.jsx("button",{onClick:()=>v(g),className:"text-muted-foreground hover:text-destructive shrink-0",children:n.jsx(Xe,{className:"w-2.5 h-2.5"})})]}),m.values.map((k,P)=>n.jsx("div",{className:"flex-1 min-w-[100px] p-1 border-r border-secondary/30",children:n.jsx(De,{value:k,onChange:D=>d(g,P,D.target.value),className:"h-5 text-[10px] font-terminal bg-transparent border-none px-0 text-secondary-foreground focus-visible:ring-0",placeholder:"..."})},P))]},g))]})})]})}function Ao({totalCards:e,compact:t}){const[r,s]=c.useState(new Set),[a,o]=c.useState(null),[i,l]=c.useState({front:"",back:"",deckName:""}),d=ot(),{toast:f}=Tt(),{data:b,isLoading:y,refetch:p}=ee({queryKey:["anki","status"],queryFn:q.anki.getStatus,refetchInterval:3e4}),{data:v}=ee({queryKey:["anki","due"],queryFn:q.anki.getDue,enabled:b?.connected===!0}),{data:N=[],refetch:x}=ee({queryKey:["anki","drafts"],queryFn:q.anki.getDrafts}),h=N.filter(w=>w.status==="pending"),m=ve({mutationFn:q.anki.sync,onSuccess:w=>{d.invalidateQueries({queryKey:["anki"]}),x(),f({title:"Anki sync complete",description:w.output||"Cards synced successfully"})},onError:w=>{f({title:"Anki sync failed",description:w.message,variant:"destructive"})}}),g=ve({mutationFn:w=>q.anki.approveDraft(w),onSuccess:()=>x()}),k=ve({mutationFn:w=>q.anki.deleteDraft(w),onMutate:async w=>{await d.cancelQueries({queryKey:["anki","drafts"]});const L=d.getQueryData(["anki","drafts"]);return d.setQueryData(["anki","drafts"],O=>O?O.filter(T=>T.id!==w):[]),{prev:L}},onError:(w,L,O)=>{O?.prev&&d.setQueryData(["anki","drafts"],O.prev)},onSettled:()=>x()}),P=ve({mutationFn:({id:w,data:L})=>q.anki.updateDraft(w,L),onSuccess:()=>{x(),o(null)}}),D=w=>{o(w.id),l({front:w.front,back:w.back,deckName:w.deckName})},M=()=>{a!==null&&P.mutate({id:a,data:i})},I=n.jsx("div",{className:t?"p-3 space-y-3":"p-4 space-y-3",children:y?n.jsx("p",{className:"font-terminal text-xs text-muted-foreground",children:"Checking Anki..."}):b?.connected?n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex flex-wrap items-center gap-4 font-terminal text-xs",children:[n.jsx(et,{variant:"outline",className:"bg-green-500/20 text-green-400 border-green-500",children:"Connected"}),n.jsxs("span",{className:"text-muted-foreground",children:["Cards: ",n.jsx("span",{className:"text-primary font-arcade",children:e})]}),n.jsxs("span",{className:"text-muted-foreground",children:["Due: ",n.jsx("span",{className:"text-secondary font-arcade",children:v?.dueCount||0})]}),n.jsxs("span",{className:"text-muted-foreground",children:["Reviewed: ",n.jsx("span",{className:"font-arcade",children:b.reviewedToday||0})]}),n.jsxs("span",{className:"text-muted-foreground",children:["Decks: ",n.jsx("span",{className:"font-arcade",children:b.decks?.length||0})]})]}),n.jsxs("div",{className:"pt-2 flex gap-2",children:[n.jsxs(K,{size:"sm",variant:"outline",className:"flex-1 font-terminal text-xs",onClick:()=>p(),children:[n.jsx(ht,{className:"w-3 h-3 mr-1"}),"Refresh"]}),n.jsxs(K,{size:"sm",className:"flex-1 font-terminal text-xs bg-secondary hover:bg-secondary/80",onClick:()=>m.mutate(),disabled:m.isPending,children:[m.isPending?n.jsx(qt,{className:"w-3 h-3 mr-1 animate-spin"}):n.jsx(ht,{className:"w-3 h-3 mr-1"}),m.isPending?"Syncing...":"Sync Cards"]})]}),m.isError&&n.jsxs("div",{className:"p-2 bg-red-500/10 border border-red-500/30 text-red-400 font-terminal text-[10px]",children:[n.jsx("span",{className:"font-arcade",children:"SYNC ERROR:"})," ",m.error?.message||"Unknown error",n.jsx(K,{size:"sm",variant:"outline",className:"ml-2 h-5 px-2 text-[10px] font-terminal border-red-500/50 text-red-400",onClick:()=>m.mutate(),disabled:m.isPending,children:"Retry"})]}),h.length>0&&n.jsxs("div",{className:"pt-3 border-t border-secondary/30",children:[n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsxs("span",{className:"font-arcade text-[10px] text-yellow-400",children:["PENDING CARDS (",h.length,")"]}),n.jsx("div",{className:"flex gap-1",children:n.jsx(K,{size:"sm",variant:"outline",className:"h-5 px-2 text-[10px] font-terminal",onClick:()=>{r.size===h.length?s(new Set):s(new Set(h.map(w=>w.id)))},children:r.size===h.length?"None":"All"})})]}),r.size>0&&n.jsxs("div",{className:"flex gap-1 mb-2",children:[n.jsxs(K,{size:"sm",className:"h-6 px-2 text-[10px] font-terminal bg-green-600 hover:bg-green-700",onClick:()=>{r.forEach(w=>g.mutate(w)),s(new Set)},children:[n.jsx(pt,{className:"w-3 h-3 mr-1"}),"Approve (",r.size,")"]}),n.jsxs(K,{size:"sm",variant:"destructive",className:"h-6 px-2 text-[10px] font-terminal",onClick:()=>{r.forEach(w=>k.mutate(w)),s(new Set)},children:[n.jsx(Xe,{className:"w-3 h-3 mr-1"}),"Delete (",r.size,")"]})]}),n.jsx(Ge,{className:"h-[140px]",children:n.jsx("div",{className:"space-y-2",children:h.map(w=>n.jsx("div",{className:`p-2 bg-black/40 border text-xs ${r.has(w.id)?"border-primary":"border-secondary/30"}`,children:n.jsxs("div",{className:"flex items-start gap-2",children:[n.jsx(In,{checked:r.has(w.id),onCheckedChange:L=>{const O=new Set(r);L?O.add(w.id):O.delete(w.id),s(O)},className:"mt-1 border-secondary data-[state=checked]:bg-primary"}),n.jsxs("div",{className:"flex-1 min-w-0 overflow-hidden",children:[n.jsx("div",{className:"font-terminal text-primary truncate",children:w.front}),n.jsx("div",{className:"font-terminal text-muted-foreground mt-1 truncate",children:w.back}),n.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[n.jsx(et,{variant:"outline",className:"text-[9px] border-blue-500/50 text-blue-400 shrink-0",children:w.deckName}),n.jsx(K,{size:"icon",variant:"outline",className:"h-5 w-5 shrink-0 border-yellow-500/50 text-yellow-400 hover:bg-yellow-500/20",onClick:()=>D(w),title:"Edit card",children:n.jsx(Ze,{className:"w-3 h-3"})}),n.jsx(K,{size:"icon",variant:"outline",className:"h-5 w-5 shrink-0 border-green-500/50 text-green-400 hover:bg-green-500/20",onClick:()=>g.mutate(w.id),title:"Approve card",children:n.jsx(pt,{className:"w-3 h-3"})}),n.jsx(K,{size:"icon",variant:"outline",className:"h-5 w-5 shrink-0 border-red-500/50 text-red-400 hover:bg-red-500/20",onClick:()=>k.mutate(w.id),title:"Delete card",children:n.jsx(Xe,{className:"w-3 h-3"})})]})]})]})},w.id))})})]})]}):n.jsxs("div",{className:"text-center space-y-2",children:[n.jsx("p",{className:"font-terminal text-xs text-red-400",children:b?.error||"Anki not connected"}),n.jsx("p",{className:"font-terminal text-xs text-muted-foreground",children:"Open Anki with AnkiConnect plugin"}),n.jsxs(K,{size:"sm",variant:"outline",className:"font-terminal text-xs",onClick:()=>p(),children:[n.jsx(ht,{className:"w-3 h-3 mr-1"}),"Retry"]})]})});return n.jsxs(n.Fragment,{children:[t?I:n.jsxs($e,{className:"bg-black/40 border-2 border-primary rounded-none",children:[n.jsx(Oe,{className:"border-b border-primary/50 p-4",children:n.jsxs(Le,{className:"font-arcade text-sm flex items-center gap-3",children:[n.jsx(Be,{className:"w-4 h-4"}),"ANKI INTEGRATION",b?.connected?n.jsx(pt,{className:"w-3 h-3 text-green-500 ml-auto"}):n.jsx(Et,{className:"w-3 h-3 text-red-500 ml-auto"})]})}),n.jsx(_e,{className:"p-0",children:I})]}),n.jsx(Dt,{open:a!==null,onOpenChange:w=>{w||o(null)},children:n.jsxs($t,{"data-modal":"brain-edit-draft",className:"bg-black border-2 border-primary rounded-none max-w-lg translate-y-0",style:{zIndex:100005,top:"6rem",left:"50%",transform:"translate(-50%, 0)"},children:[n.jsxs(Ot,{children:[n.jsxs(Lt,{className:"font-arcade text-primary flex items-center gap-2",children:[n.jsx(Ze,{className:"w-5 h-5"}),"EDIT CARD"]}),n.jsx(_t,{className:"font-terminal text-muted-foreground",children:"Edit card content and select target deck"})]}),n.jsxs("div",{className:"space-y-4 font-terminal",children:[n.jsxs("div",{children:[n.jsx("label",{className:"text-sm text-muted-foreground",children:"Front (Question)"}),n.jsx(en,{value:i.front,onChange:w=>l(L=>({...L,front:w.target.value})),placeholder:"Card front...",className:"rounded-none border-secondary min-h-[80px]"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-sm text-muted-foreground",children:"Back (Answer)"}),n.jsx(en,{value:i.back,onChange:w=>l(L=>({...L,back:w.target.value})),placeholder:"Card back...",className:"rounded-none border-secondary min-h-[80px]"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-sm text-muted-foreground",children:"Target Deck"}),n.jsxs(Vr,{value:i.deckName,onValueChange:w=>l(L=>({...L,deckName:w})),children:[n.jsx(Gr,{className:"rounded-none border-secondary",children:n.jsx(Br,{placeholder:"Select deck"})}),n.jsxs(Kr,{className:"rounded-none border-secondary bg-black max-h-[200px]",children:[n.jsx(Ce,{value:"PT::EBP",children:"PT::EBP (Evidence Based Practice)"}),n.jsx(Ce,{value:"PT::ExPhys",children:"PT::ExPhys (Exercise Physiology)"}),n.jsx(Ce,{value:"PT::MS1",children:"PT::MS1 (Movement Science 1)"}),n.jsx(Ce,{value:"PT::Neuro",children:"PT::Neuro (Neuroscience)"}),n.jsx(Ce,{value:"PT::TI",children:"PT::TI (Therapeutic Intervention)"}),n.jsx(Ce,{value:"PT::General",children:"PT::General"}),b?.decks?.filter(w=>!w.startsWith("PT::")).map(w=>n.jsx(Ce,{value:w,children:w},w))]})]}),n.jsxs("p",{className:"text-[10px] text-muted-foreground mt-1",children:["Current: ",n.jsx("span",{className:"text-blue-400",children:i.deckName})]})]})]}),n.jsxs(Ar,{className:"gap-2",children:[n.jsxs(K,{variant:"outline",onClick:()=>o(null),className:"font-terminal rounded-none border-secondary hover:bg-secondary/20",children:[n.jsx(Et,{className:"w-4 h-4 mr-2"}),"Cancel"]}),n.jsxs(K,{onClick:M,disabled:P.isPending,className:"font-terminal rounded-none bg-primary hover:bg-primary/80",children:[n.jsx(Ft,{className:"w-4 h-4 mr-2"}),P.isPending?"Saving...":"Save"]})]})]})})]})}const kt=[{id:"edit",label:"EDIT",icon:Ze},{id:"chat",label:"CHAT",icon:Mn},{id:"graph",label:"GRAPH",icon:js},{id:"table",label:"TABLE",icon:Es},{id:"anki",label:"ANKI",icon:Be}];function Cn({workspace:e}){return c.useEffect(()=>{const t=r=>{if(!r.altKey||r.ctrlKey||r.metaKey)return;const s=parseInt(r.key,10)-1;s>=0&&s<kt.length&&(r.preventDefault(),e.setMainMode(kt[s].id))};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[e]),n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsx("div",{className:"flex items-center gap-0 border-b border-primary/40 bg-black/40 shrink-0",children:kt.map(t=>{const r=t.icon,s=e.mainMode===t.id;return n.jsxs("button",{onClick:()=>e.setMainMode(t.id),className:`flex items-center gap-1.5 px-3 py-1.5 font-arcade text-xs transition-colors ${s?"bg-primary text-black":"text-muted-foreground hover:text-foreground"}`,children:[n.jsx(r,{className:"w-3.5 h-3.5"}),t.label,t.id==="anki"&&e.pendingDrafts.length>0&&n.jsx("span",{className:"ml-1 px-1 py-0 text-xs bg-secondary text-black font-arcade",children:e.pendingDrafts.length})]},t.id)})}),n.jsxs("div",{className:"flex-1 min-h-0 overflow-hidden",children:[e.mainMode==="edit"&&n.jsx(za,{workspace:e}),e.mainMode==="chat"&&n.jsx(Ia,{}),e.mainMode==="graph"&&n.jsx(Oa,{}),e.mainMode==="table"&&n.jsx(Mo,{}),e.mainMode==="anki"&&n.jsx(Ao,{totalCards:e.metrics?.totalCards||0,compact:!0})]})]})}function To(){const[e,t]=c.useState(""),[r,s]=c.useState(null),[a,o]=c.useState("auto"),[i,l]=c.useState([]),d=ot(),{toast:f}=Tt(),{data:b=[]}=ee({queryKey:["sessions"],queryFn:q.sessions.getAll}),y=b.slice().sort((x,h)=>{const m=x.date||x.createdAt||"";return(h.date||h.createdAt||"").localeCompare(m)}).slice(0,20),p=ve({mutationFn:()=>q.planner.generate(),onSuccess:x=>{f({title:"Planner tasks generated",description:`${x.tasks_created} review tasks created`}),d.invalidateQueries({queryKey:["planner","queue"]})},onError:x=>{f({title:"Failed to generate tasks",description:x.message,variant:"destructive"})}}),v=ve({mutationFn:async()=>{if(!r)throw new Error("Select a session first");let x;try{x=JSON.parse(e)}catch{throw new Error("Invalid JSON  check syntax")}let h=a;if(h==="auto"){const k=Object.keys(x),P=["source_lock","plan_of_attack","frameworks_used","buckets","confusables_interleaved","anki_cards","glossary","exit_ticket_blurt","exit_ticket_muddiest","exit_ticket_next_action","retrospective_status","spaced_reviews","next_session","errors_by_type","errors_by_severity","error_patterns","spacing_algorithm","rsr_adaptive_adjustment","adaptive_multipliers"];h=k.some(D=>P.includes(D))?"enhanced":"tracker"}const m=h==="tracker"?x:void 0,g=h==="enhanced"?x:void 0;return q.brain.ingestSessionJson(r,m,g)},onSuccess:x=>{f({title:"JSON ingested",description:`${x.fields_updated} fields updated on session #${x.session_id}`}),d.invalidateQueries({queryKey:["sessions"]}),d.invalidateQueries({queryKey:["brain","metrics"]}),f({title:"Next step: Generate planner tasks?",description:"Create review tasks from weak anchors",duration:1e4,action:n.jsx(K,{size:"sm",onClick:()=>p.mutate(),disabled:p.isPending,className:"bg-primary text-black hover:bg-primary/80",children:p.isPending?"Generating...":"Generate Now"})}),t(""),l([])},onError:x=>{f({title:"Ingestion failed",description:x.message,variant:"destructive"})}});function N(){const x=[];if(r||x.push("Select a session"),!e.trim())x.push("Paste JSON first");else try{const h=JSON.parse(e);(typeof h!="object"||Array.isArray(h))&&x.push("JSON must be an object, not array"),h.schema_version&&h.schema_version!=="9.4"&&x.push(`Expected schema_version 9.4, got ${h.schema_version}`)}catch{x.push("Invalid JSON syntax")}return l(x),x.length===0}return n.jsxs($e,{className:"bg-black/40 border-2 border-primary rounded-none",children:[n.jsx(Oe,{className:"border-b border-primary/50 p-4",children:n.jsxs(Le,{className:"font-arcade text-sm flex items-center gap-2",children:[n.jsx("div",{className:"w-4 h-4 bg-primary inline-block"}),"SESSION_JSON_INGEST"]})}),n.jsxs(_e,{className:"p-4 space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"font-terminal text-xs text-muted-foreground block mb-1",children:"TARGET SESSION"}),n.jsxs("select",{value:r??"",onChange:x=>s(x.target.value?Number(x.target.value):null),className:"w-full bg-black border border-primary/50 text-white font-terminal text-xs p-2 rounded-none focus:border-primary outline-none",children:[n.jsx("option",{value:"",children:"-- select session --"}),y.map(x=>n.jsxs("option",{value:x.id,children:["#",x.id," | ",x.date?.slice(0,10)||"?"," | ",x.topic||x.mainTopic||"Untitled"," | ",x.mode||"?"]},x.id))]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"font-terminal text-xs text-muted-foreground block mb-1",children:"JSON TYPE"}),n.jsx("div",{className:"flex gap-2",children:["auto","tracker","enhanced"].map(x=>n.jsx("button",{onClick:()=>o(x),className:`px-3 py-1 font-arcade text-xs rounded-none border ${a===x?"bg-primary text-black border-primary":"border-primary/30 text-muted-foreground hover:text-white"}`,children:x.toUpperCase()},x))})]}),n.jsxs("div",{children:[n.jsx("label",{className:"font-terminal text-xs text-muted-foreground block mb-1",children:"PASTE TRACKER OR ENHANCED JSON"}),n.jsx("textarea",{value:e,onChange:x=>t(x.target.value),placeholder:'{"schema_version": "9.4", "topic": "...", "mode": "Core", ...}',rows:10,className:"w-full bg-black border border-primary/50 text-green-400 font-terminal text-xs p-2 rounded-none focus:border-primary outline-none resize-y"})]}),i.length>0&&n.jsx("div",{className:"border border-red-500/50 bg-red-500/10 p-2 font-terminal text-xs text-red-400 space-y-1",children:i.map((x,h)=>n.jsxs("div",{children:["- ",x]},h))}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("button",{onClick:()=>{N()&&v.mutate()},disabled:v.isPending,className:"px-4 py-2 bg-primary text-black font-arcade text-xs rounded-none hover:bg-primary/80 disabled:opacity-50",children:v.isPending?"INGESTING...":"INGEST"}),n.jsx("button",{onClick:N,className:"px-4 py-2 border border-primary/50 text-primary font-arcade text-xs rounded-none hover:bg-primary/10",children:"VALIDATE"}),n.jsx("button",{onClick:()=>{t(""),l([])},className:"px-4 py-2 border border-primary/30 text-muted-foreground font-arcade text-xs rounded-none hover:text-white",children:"CLEAR"})]})]})]})}const Do=`You are extracting a course schedule for ingestion.

Return ONLY a valid JSON object with NO additional text, NO markdown code blocks, NO explanation.

Structure:
{
  "name": "Course Name (e.g. Anatomy & Physiology II)",
  "term": {
    "startDate": "2026-01-05",
    "endDate": "2026-04-24",
    "timezone": "America/Chicago"
  },
  "events": [
    {
      "type": "class" | "lecture" | "reading" | "topic" | "assignment" | "quiz" | "exam" | "assessment",
      "title": "string",
      "date": "YYYY-MM-DD",
      "dueDate": "YYYY-MM-DD | null",
      "startTime": "HH:MM | null",
      "endTime": "HH:MM | null",
      "daysOfWeek": ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],
      "delivery": "in_person" | "virtual_sync" | "virtual_async" | "hybrid",
      "assessmentType": "EA | null",
      "moduleName": "Module 1: ... | null",
      "notes": "string | null"
    }
  ]
}

Rules:
1. Include ALL schedule items: class meetings, assignments, quizzes, exams, readings, virtual activities, and learning assessments (EA).
2. For repeating class meetings, set daysOfWeek + startTime/endTime, and include term start/end.
3. For one-off items, set date or dueDate.
4. Do NOT include a "modules" array  schedule only.
5. Return ONLY the JSON object, nothing else.

Here's my syllabus:

[PASTE YOUR SYLLABUS BELOW]`,$o=`You are extracting course module structure for ingestion.

Return ONLY a valid JSON object with NO additional text, NO markdown code blocks, NO explanation.

Structure:
{
  "modules": [
    {
      "name": "Module 1: Topic Name",
      "orderIndex": 1,
      "topics": ["Topic A", "Topic B"],
      "readings": ["Chapter 1", "Article X"],
      "assessments": ["Quiz 1", "Exam 1"]
    }
  ]
}

Rules:
1. Include ALL modules/units with their topics, readings, and assessments.
2. orderIndex should be sequential starting at 1.
3. Do NOT include dates or events  structure only.
4. Return ONLY the JSON object, nothing else.

Here's my syllabus:

[PASTE YOUR SYLLABUS BELOW]`,Oo=`I need you to extract learning objectives from my course material.

Return ONLY a valid JSON array with NO additional text, NO markdown code blocks, NO explanation.

Structure for each item:
{
  "loCode": "string",
  "title": "string"
}

Rules:
1. loCode: Preserve original numbering if present, or create sequential "1", "2", "3"...
2. title: Keep the objective text exactly as written
3. Return ONLY the JSON array, nothing else

Here are my learning objectives:

[PASTE YOUR LOs BELOW]`,Lo=`I need you to convert my study session notes into WRAP format.

WRAP format has 4 sections:

Section A: Obsidian Notes
- Main concepts and insights from the session
- Key points to remember

Section B: Anki Cards
- Format: "front: [question]" on one line, "back: [answer]" on next line
- Create cards for important facts and concepts

Section C: Spaced Schedule
- R1=tomorrow
- R2=3d
- R3=1w
- R4=2w

Section D: JSON Logs
\`\`\`json
{
  "merged": {
    "topic": "[main topic]",
    "mode": "Core",
    "duration_minutes": [number],
    "understanding": [1-5],
    "retention": [1-5]
  }
}
\`\`\`

Return ONLY the WRAP formatted content, NO additional text or explanation.

Here are my study notes:

[PASTE YOUR NOTES BELOW]`;function _o(){const e=ot(),[t,r]=c.useState(null),[s,a]=c.useState(null),[o,i]=c.useState("schedule"),[l,d]=c.useState(""),[f,b]=c.useState(""),[y,p]=c.useState(""),[v,N]=c.useState(""),[x,h]=c.useState(null),[m,g]=c.useState(null),[k,P]=c.useState(null),[D,M]=c.useState(null),[I,w]=c.useState(null),[L,O]=c.useState(null),{data:T=[]}=ee({queryKey:["courses"],queryFn:()=>q.courses.getActive()}),{data:F=[]}=ee({queryKey:["modules",t],queryFn:()=>t?q.modules.getByCourse(t):Promise.resolve([]),enabled:!!t}),{data:Z=[]}=ee({queryKey:["learningObjectives",t],queryFn:()=>t?q.learningObjectives.getByCourse(t):Promise.resolve([]),enabled:!!t}),V=u=>{const S=u.trim();if(!S)return"";const z=S.match(/```json\s*([\s\S]*?)```/i)||S.match(/```\s*([\s\S]*?)```/i),C=z?z[1].trim():S,E=C.indexOf("["),A=C.lastIndexOf("]"),_=C.indexOf("{"),B=C.lastIndexOf("}");return E!==-1&&A!==-1&&A>E&&(_===-1||E<_)?C.slice(E,A+1).trim():_!==-1&&B!==-1&&B>_?C.slice(_,B+1).trim():C},G=u=>{navigator.clipboard.writeText(u)},J=ve({mutationFn:async u=>{if(!t)throw new Error("Select a course first");const z={...JSON.parse(V(u)),modules:[]};return q.syllabus.importBulk(t,z)},onSuccess:u=>{e.invalidateQueries({queryKey:["scheduleEvents"]}),d(""),w(null),P({type:"success",message:`Imported: ${u.eventsCreated} events (${u.classMeetingsExpanded} class meetings expanded)`}),h(null)},onError:u=>{P({type:"error",message:u.message||"Failed to import schedule"})}}),ie=ve({mutationFn:async u=>{if(!t)throw new Error("Select a course first");const S=JSON.parse(V(u)),z=S.modules||S;return q.modules.createBulk(t,z)},onSuccess:()=>{e.invalidateQueries({queryKey:["modules"]}),b(""),O(null),M({type:"success",message:"Modules imported successfully"}),h(null)},onError:u=>{M({type:"error",message:u.message||"Failed to import modules"})}}),te=ve({mutationFn:async u=>{if(!t)throw new Error("Select a course first");const S=JSON.parse(V(u));return q.learningObjectives.createBulk(t,s,S)},onSuccess:()=>{e.invalidateQueries({queryKey:["learningObjectives"]}),p(""),h(null)},onError:u=>{h(u.message||"Failed to import LOs")}}),pe=u=>{const S=[];try{const z=V(u);if(!z){w({isValid:!1,errors:["No JSON found"]});return}const C=JSON.parse(z);(!C||typeof C!="object")&&S.push("JSON must be an object"),(!C.name||typeof C.name!="string")&&S.push("Missing 'name' field"),!C.term||typeof C.term!="object"?S.push("Missing 'term' object"):(C.term.startDate||S.push("term.startDate is required"),C.term.endDate||S.push("term.endDate is required")),Array.isArray(C.events)||S.push("Missing 'events' array"),S.length===0?w({isValid:!0,errors:[],preview:{courseName:C.name,eventCount:C.events.length,startDate:C.term?.startDate,endDate:C.term?.endDate}}):w({isValid:!1,errors:S})}catch(z){w({isValid:!1,errors:[`Invalid JSON: ${z.message}`]})}},he=u=>{const S=[];try{const z=V(u);if(!z){O({isValid:!1,errors:["No JSON found"]});return}const C=JSON.parse(z),E=C.modules||(Array.isArray(C)?C:null);Array.isArray(E)?E.length===0&&S.push("modules array is empty"):S.push("Missing 'modules' array"),S.length===0?O({isValid:!0,errors:[],preview:{moduleCount:E.length}}):O({isValid:!1,errors:S})}catch(z){O({isValid:!1,errors:[`Invalid JSON: ${z.message}`]})}},de=async()=>{try{g(null);const u=await q.brain.ingest(v,"pasted_wrap.md");u.sessionSaved?(g({type:"success",message:`Session saved! ID: ${u.sessionId}, Cards: ${u.cardsCreated||0}`}),N("")):g({type:"error",message:u.errors?.join(", ")||u.message})}catch(u){g({type:"error",message:u.message||"Failed to ingest"})}},ue=[{key:"schedule",label:"SCHEDULE",icon:n.jsx(nn,{className:"w-3.5 h-3.5"})},{key:"modules",label:"MODULES",icon:n.jsx(Be,{className:"w-3.5 h-3.5"})},{key:"objectives",label:"OBJECTIVES",icon:n.jsx(Pt,{className:"w-3.5 h-3.5"})}];return n.jsxs("div",{className:"space-y-6 p-4",children:[n.jsx(To,{}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm mb-1 font-terminal text-muted-foreground",children:"Select Course"}),n.jsxs("select",{className:"w-full bg-black border border-secondary rounded-none p-2 font-terminal",value:t||"",onChange:u=>{r(u.target.value?parseInt(u.target.value):null),a(null)},children:[n.jsx("option",{value:"",children:"-- Select Course --"}),T.map(u=>n.jsx("option",{value:u.id,children:u.name},u.id))]})]}),!t&&n.jsx("p",{className:"text-center text-muted-foreground font-terminal text-sm py-8",children:"Select a course above to begin ingestion."}),t&&n.jsxs($e,{className:"bg-black/40 border-2 border-primary rounded-none mb-6",children:[n.jsx(Oe,{className:"border-b border-primary/50 p-4",children:n.jsxs(Le,{className:"font-arcade text-sm flex items-center gap-2",children:[n.jsx(Fr,{className:"w-4 h-4"}),"WRAP SESSION INGESTION"]})}),n.jsxs(_e,{className:"p-4",children:[m&&n.jsx("div",{className:`mb-4 p-3 rounded-none font-terminal text-sm ${m.type==="success"?"bg-green-900/30 border border-green-500 text-green-400":"bg-red-900/30 border border-red-500 text-red-400"}`,children:m.message}),n.jsxs("div",{className:"space-y-4",children:[n.jsx("button",{onClick:()=>G(Lo),className:"bg-primary hover:bg-primary/80 px-3 py-1 rounded-none text-xs font-terminal mb-2",type:"button",children:"Copy Prompt for ChatGPT"}),n.jsx("p",{className:"text-xs text-muted-foreground mb-2 font-terminal",children:"Use ChatGPT to convert your notes to WRAP format, then paste or upload below:"}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm mb-2 font-terminal text-muted-foreground",children:"Paste WRAP Content"}),n.jsx("textarea",{className:"w-full bg-black border border-secondary rounded-none p-2 h-48 font-terminal text-sm",placeholder:"Paste your WRAP session here...",value:v,onChange:u=>{N(u.target.value),g(null)}})]}),n.jsx("button",{onClick:de,disabled:!v,className:"bg-primary hover:bg-primary/80 disabled:opacity-50 px-6 py-3 rounded-none font-arcade text-sm w-full",type:"button",children:"INGEST WRAP SESSION"})]})]})]}),t&&x&&n.jsx("div",{className:"bg-destructive/20 border border-destructive rounded-none p-3 text-destructive font-terminal",children:x}),t&&n.jsxs("div",{className:"space-y-4",children:[n.jsx("div",{className:"flex border-b border-primary/50",children:ue.map(u=>n.jsxs("button",{onClick:()=>i(u.key),className:`flex items-center gap-1.5 px-4 py-2 font-arcade text-xs border-b-2 transition-colors ${o===u.key?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-primary/70"}`,type:"button",children:[u.icon,u.label]},u.key))}),o==="schedule"&&n.jsxs($e,{className:"bg-black/40 border-2 border-primary rounded-none",children:[n.jsx(Oe,{className:"border-b border-primary/50 p-4",children:n.jsxs(Le,{className:"font-arcade text-sm flex items-center gap-2",children:[n.jsx(nn,{className:"w-4 h-4"}),"SCHEDULE IMPORT"]})}),n.jsxs(_e,{className:"p-4 space-y-4",children:[n.jsx("button",{onClick:()=>G(Do),className:"bg-primary hover:bg-primary/80 px-3 py-1 rounded-none text-xs font-terminal",type:"button",children:"Copy Prompt for ChatGPT"}),n.jsx("p",{className:"text-xs text-muted-foreground font-terminal",children:"Paste the ChatGPT response (schedule JSON) below:"}),n.jsx("textarea",{className:"w-full bg-black border border-secondary rounded-none p-2 h-40 font-terminal text-sm",placeholder:'{"name":"...","term":{...},"events":[...]}',value:l,onChange:u=>{d(u.target.value),P(null),u.target.value.trim()?pe(u.target.value):w(null)}}),I&&!I.isValid&&n.jsxs("div",{className:"p-2 border border-red-500 bg-red-900/30 rounded-none font-terminal text-xs text-red-400",children:[n.jsx("div",{className:"font-bold mb-1",children:"Validation Errors:"}),I.errors.map((u,S)=>n.jsxs("div",{children:[" ",u]},S))]}),I?.isValid&&I.preview&&n.jsxs("div",{className:"p-3 border border-primary bg-primary/10 rounded-none font-terminal text-xs text-primary",children:[n.jsx("div",{className:"font-bold mb-2",children:"Valid JSON Preview:"}),n.jsxs("div",{className:"space-y-1",children:[n.jsxs("div",{children:[n.jsx("span",{className:"text-muted-foreground",children:"Course:"})," ",I.preview.courseName]}),n.jsxs("div",{children:[n.jsx("span",{className:"text-muted-foreground",children:"Events:"})," ",I.preview.eventCount]}),I.preview.startDate&&n.jsxs("div",{children:[n.jsx("span",{className:"text-muted-foreground",children:"Start:"})," ",I.preview.startDate]}),I.preview.endDate&&n.jsxs("div",{children:[n.jsx("span",{className:"text-muted-foreground",children:"End:"})," ",I.preview.endDate]})]})]}),n.jsx("button",{onClick:()=>J.mutate(l),disabled:!I?.isValid||J.isPending,className:"bg-secondary hover:bg-secondary/80 disabled:opacity-50 px-4 py-2 rounded-none font-terminal text-xs",type:"button",children:J.isPending?"Importing...":"Import Schedule"}),k&&n.jsx("div",{className:`p-2 border font-terminal text-xs ${k.type==="success"?"border-green-500 text-green-400":"border-red-500 text-red-400"}`,children:k.message})]})]}),o==="modules"&&n.jsxs($e,{className:"bg-black/40 border-2 border-primary rounded-none",children:[n.jsx(Oe,{className:"border-b border-primary/50 p-4",children:n.jsxs(Le,{className:"font-arcade text-sm flex items-center gap-2",children:[n.jsx(Be,{className:"w-4 h-4"}),"MODULES IMPORT"]})}),n.jsxs(_e,{className:"p-4 space-y-4",children:[n.jsx("button",{onClick:()=>G($o),className:"bg-primary hover:bg-primary/80 px-3 py-1 rounded-none text-xs font-terminal",type:"button",children:"Copy Prompt for ChatGPT"}),n.jsx("p",{className:"text-xs text-muted-foreground font-terminal",children:"Paste the ChatGPT response (modules JSON) below:"}),n.jsx("textarea",{className:"w-full bg-black border border-secondary rounded-none p-2 h-40 font-terminal text-sm",placeholder:'{"modules":[{"name":"Module 1: ...","orderIndex":1,"topics":[...],"readings":[...],"assessments":[...]}]}',value:f,onChange:u=>{b(u.target.value),M(null),u.target.value.trim()?he(u.target.value):O(null)}}),L&&!L.isValid&&n.jsxs("div",{className:"p-2 border border-red-500 bg-red-900/30 rounded-none font-terminal text-xs text-red-400",children:[n.jsx("div",{className:"font-bold mb-1",children:"Validation Errors:"}),L.errors.map((u,S)=>n.jsxs("div",{children:[" ",u]},S))]}),L?.isValid&&L.preview&&n.jsxs("div",{className:"p-3 border border-primary bg-primary/10 rounded-none font-terminal text-xs text-primary",children:[n.jsx("div",{className:"font-bold mb-2",children:"Valid JSON Preview:"}),n.jsxs("div",{children:[n.jsx("span",{className:"text-muted-foreground",children:"Modules:"})," ",L.preview.moduleCount]})]}),n.jsx("button",{onClick:()=>ie.mutate(f),disabled:!L?.isValid||ie.isPending,className:"bg-secondary hover:bg-secondary/80 disabled:opacity-50 px-4 py-2 rounded-none font-terminal text-xs",type:"button",children:ie.isPending?"Importing...":"Import Modules"}),D&&n.jsx("div",{className:`p-2 border font-terminal text-xs ${D.type==="success"?"border-green-500 text-green-400":"border-red-500 text-red-400"}`,children:D.message})]})]}),o==="objectives"&&n.jsxs($e,{className:"bg-black/40 border-2 border-primary rounded-none",children:[n.jsx(Oe,{className:"border-b border-primary/50 p-4",children:n.jsxs(Le,{className:"font-arcade text-sm flex items-center gap-2",children:[n.jsx(Pt,{className:"w-4 h-4"}),"LEARNING OBJECTIVES IMPORT"]})}),n.jsxs(_e,{className:"p-4 space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs mb-1 font-terminal text-muted-foreground",children:"Target Module (optional)"}),n.jsxs("select",{className:"w-full bg-black border border-secondary rounded-none p-2 font-terminal",value:s||"",onChange:u=>a(u.target.value?parseInt(u.target.value):null),children:[n.jsx("option",{value:"",children:"-- No Module (Course-level) --"}),F.map(u=>n.jsx("option",{value:u.id,children:u.name},u.id))]})]}),n.jsx("button",{onClick:()=>G(Oo),className:"bg-primary hover:bg-primary/80 px-3 py-1 rounded-none text-xs font-terminal",type:"button",children:"Copy Prompt for ChatGPT"}),n.jsx("p",{className:"text-xs text-muted-foreground font-terminal",children:"Paste the ChatGPT response (JSON array) below:"}),n.jsx("textarea",{className:"w-full bg-black border border-secondary rounded-none p-2 h-32 font-terminal text-sm",placeholder:'[{"loCode": "1.1", "title": "Define..."}]',value:y,onChange:u=>p(u.target.value)}),n.jsx("button",{onClick:()=>te.mutate(y),disabled:!y||te.isPending,className:"bg-secondary hover:bg-secondary/80 disabled:opacity-50 px-4 py-2 rounded-none font-terminal text-xs",type:"button",children:te.isPending?"Importing...":"Import LOs"}),Z.length>0&&n.jsxs("div",{children:[n.jsxs("h4",{className:"font-terminal text-xs mb-2",children:["Current LOs (",Z.length,")"]}),n.jsx("div",{className:"max-h-48 overflow-y-auto",children:Z.map(u=>n.jsxs("div",{className:"text-xs py-1 border-b border-secondary/30 font-terminal",children:[n.jsx("span",{className:"text-primary",children:u.loCode}),": ",u.title,n.jsx("span",{className:`ml-2 text-[10px] px-1 rounded-none ${u.status==="solid"?"bg-green-600":u.status==="in_progress"?"bg-yellow-600":u.status==="need_review"?"bg-orange-600":"bg-secondary"}`,children:u.status})]},u.id))})]})]})]})]})]})}function Fo({workspace:e}){return n.jsx(Dt,{open:e.importOpen,onOpenChange:e.setImportOpen,children:n.jsxs($t,{"data-modal":"brain-import",className:"max-w-2xl bg-black border-2 border-primary rounded-none",children:[n.jsxs(Ot,{children:[n.jsxs(Lt,{className:"font-arcade text-sm text-primary flex items-center gap-2",children:[n.jsx(Vt,{className:"w-4 h-4"}),"IMPORT / INGEST"]}),n.jsx(_t,{className:"font-terminal text-xs text-muted-foreground",children:"Import study materials, JSON session data, or documents into the system."})]}),n.jsx("div",{className:"max-h-[70vh] overflow-y-auto",children:n.jsx(_o,{})})]})})}function Ho(){const e=aa(),[t,r]=c.useState("main");return n.jsx(Tr,{children:n.jsxs("div",{className:"flex flex-col h-[calc(100vh-64px)] min-w-0 overflow-hidden",children:[n.jsx(oa,{workspace:e}),n.jsx("div",{className:"hidden lg:flex flex-1 min-h-0",children:n.jsxs(ta,{direction:"horizontal",autoSaveId:"brain-workspace-v2",className:"h-full",children:[n.jsx(mn,{defaultSize:20,minSize:12,maxSize:35,children:n.jsx("div",{className:"h-full border-r border-primary/30 bg-black/30",children:n.jsx(pn,{workspace:e})})}),n.jsx(na,{withHandle:!0}),n.jsx(mn,{defaultSize:80,minSize:50,children:n.jsx("div",{className:"h-full",children:n.jsx(Cn,{workspace:e})})})]})}),n.jsxs("div",{className:"flex flex-col flex-1 min-h-0 lg:hidden",children:[n.jsxs("div",{className:"flex-1 min-h-0 overflow-auto",children:[t==="vault"&&n.jsx(pn,{workspace:e}),t==="main"&&n.jsx(Cn,{workspace:e})]}),n.jsxs("div",{className:"flex items-center border-t-2 border-primary/50 bg-black/80 shrink-0",children:[n.jsxs("button",{onClick:()=>r("vault"),className:`flex-1 flex flex-col items-center gap-0.5 py-2 text-xs font-terminal transition-colors ${t==="vault"?"text-primary":"text-muted-foreground"}`,children:[n.jsx(Rn,{className:"w-4 h-4"}),"Vault"]}),n.jsxs("button",{onClick:()=>r("main"),className:`flex-1 flex flex-col items-center gap-0.5 py-2 text-xs font-terminal transition-colors ${t==="main"?"text-primary":"text-muted-foreground"}`,children:[n.jsx(Ze,{className:"w-4 h-4"}),"Content"]})]})]}),n.jsx(Fo,{workspace:e})]})})}const oi=Object.freeze(Object.defineProperty({__proto__:null,default:Ho},Symbol.toStringTag,{value:"Module"}));export{rs as A,Vt as D,ws as M,ys as a,oi as b,zo as t};
