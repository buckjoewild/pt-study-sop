import{c as Ce,r as c,j as e,b as ee,R as nt,d as rt,e as W,f as ot,P as ms,g as lt,u as Me,X as je}from"./index-BVSTmnx1.js";import{h as it,i as ct,j as us,u as L,a as U,g as w,S as pe,B as F,L as dt,k as mt,C as Ae,f as ut,l as ze,T as he,P as De,I as Ie,D as ts,c as as,d as ns,e as rs,m as os,n as ie,o as ls}from"./layout-D8Qof7ev.js";import{C as G,a as de,b as me,c as Q}from"./card-BzALnJSy.js";import{e as xt,S as Ne,a as ve,b as we,c as Se,d as $,C as ht}from"./select-73IVq8PI.js";import{B as _e,S as pt,R as is}from"./badge-D2IyW9Bk.js";import{M as ft,T as bt,a as gt,b as Ee,c as Te}from"./tabs-B0zxcXTm.js";import{c as xs,R as yt,T as jt,C as Nt,a as ce,E as vt}from"./index-CDGUP9zD.js";import{A as hs,a as ps,b as fs,c as bs,d as gs,e as ys,f as js,g as Ns}from"./alert-dialog-BtTp0HW5.js";import{B as wt}from"./book-open-D1jq4Q-j.js";import{L as St}from"./loader-circle-C5pqyA_O.js";import{F as Ct,a as cs}from"./folder-DNk3g8oJ.js";import{F as kt}from"./file-text-Biv_qhaf.js";import{i as At,f as Dt}from"./format-D7m0hUtg.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const It=[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M9 13a4.5 4.5 0 0 0 3-4",key:"10igwf"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M12 13h4",key:"1ku699"}],["path",{d:"M12 18h6a2 2 0 0 1 2 2v1",key:"105ag5"}],["path",{d:"M12 8h8",key:"1lhi5i"}],["path",{d:"M16 8V5a2 2 0 0 1 2-2",key:"u6izg6"}],["circle",{cx:"16",cy:"13",r:".5",key:"ry7gng"}],["circle",{cx:"18",cy:"3",r:".5",key:"1aiba7"}],["circle",{cx:"20",cy:"21",r:".5",key:"yhc1fs"}],["circle",{cx:"20",cy:"8",r:".5",key:"1e43v0"}]],Et=Ce("brain-circuit",It);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tt=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],Ot=Ce("database",Tt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pt=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]],Mt=Ce("file",Pt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rt=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],Ft=Ce("image",Rt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qt=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],We=Ce("layers",qt),vs=c.forwardRef(({className:a,...r},n)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:n,className:ee("w-full caption-bottom text-sm",a),...r})}));vs.displayName="Table";const ws=c.forwardRef(({className:a,...r},n)=>e.jsx("thead",{ref:n,className:ee("[&_tr]:border-b",a),...r}));ws.displayName="TableHeader";const Ss=c.forwardRef(({className:a,...r},n)=>e.jsx("tbody",{ref:n,className:ee("[&_tr:last-child]:border-0",a),...r}));Ss.displayName="TableBody";const Lt=c.forwardRef(({className:a,...r},n)=>e.jsx("tfoot",{ref:n,className:ee("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...r}));Lt.displayName="TableFooter";const Be=c.forwardRef(({className:a,...r},n)=>e.jsx("tr",{ref:n,className:ee("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a),...r}));Be.displayName="TableRow";const ne=c.forwardRef(({className:a,...r},n)=>e.jsx("th",{ref:n,className:ee("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",a),...r}));ne.displayName="TableHead";const re=c.forwardRef(({className:a,...r},n)=>e.jsx("td",{ref:n,className:ee("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",a),...r}));re.displayName="TableCell";const $t=c.forwardRef(({className:a,...r},n)=>e.jsx("caption",{ref:n,className:ee("mt-4 text-sm text-muted-foreground",a),...r}));$t.displayName="TableCaption";function zt(a,r,{checkForDefaultPrevented:n=!0}={}){return function(h){if(a?.(h),n===!1||!h.defaultPrevented)return r?.(h)}}var _t=nt[" useInsertionEffect ".trim().toString()]||rt;function Cs({prop:a,defaultProp:r,onChange:n=()=>{},caller:u}){const[h,x,f]=Bt({defaultProp:r,onChange:n}),p=a!==void 0,D=p?a:h;{const N=c.useRef(a!==void 0);c.useEffect(()=>{const d=N.current;d!==p&&console.warn(`${u} is changing from ${d?"controlled":"uncontrolled"} to ${p?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),N.current=p},[p,u])}const k=c.useCallback(N=>{if(p){const d=Kt(N)?N(a):N;d!==a&&f.current?.(d)}else x(N)},[p,a,x,f]);return[D,k]}function Bt({defaultProp:a,onChange:r}){const[n,u]=c.useState(a),h=c.useRef(n),x=c.useRef(r);return _t(()=>{x.current=r},[r]),c.useEffect(()=>{h.current!==n&&(x.current?.(n),h.current=n)},[n,h]),[n,u,x]}function Kt(a){return typeof a=="function"}var se="Accordion",Vt=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[Je,Ut,Ht]=xt(se),[Re]=ot(se,[Ht,xs]),Ye=xs(),ks=W.forwardRef((a,r)=>{const{type:n,...u}=a,h=u,x=u;return e.jsx(Je.Provider,{scope:a.__scopeAccordion,children:n==="multiple"?e.jsx(Gt,{...x,ref:r}):e.jsx(Yt,{...h,ref:r})})});ks.displayName=se;var[As,Wt]=Re(se),[Ds,Jt]=Re(se,{collapsible:!1}),Yt=W.forwardRef((a,r)=>{const{value:n,defaultValue:u,onValueChange:h=()=>{},collapsible:x=!1,...f}=a,[p,D]=Cs({prop:n,defaultProp:u??"",onChange:h,caller:se});return e.jsx(As,{scope:a.__scopeAccordion,value:W.useMemo(()=>p?[p]:[],[p]),onItemOpen:D,onItemClose:W.useCallback(()=>x&&D(""),[x,D]),children:e.jsx(Ds,{scope:a.__scopeAccordion,collapsible:x,children:e.jsx(Is,{...f,ref:r})})})}),Gt=W.forwardRef((a,r)=>{const{value:n,defaultValue:u,onValueChange:h=()=>{},...x}=a,[f,p]=Cs({prop:n,defaultProp:u??[],onChange:h,caller:se}),D=W.useCallback(N=>p((d=[])=>[...d,N]),[p]),k=W.useCallback(N=>p((d=[])=>d.filter(S=>S!==N)),[p]);return e.jsx(As,{scope:a.__scopeAccordion,value:f,onItemOpen:D,onItemClose:k,children:e.jsx(Ds,{scope:a.__scopeAccordion,collapsible:!0,children:e.jsx(Is,{...x,ref:r})})})}),[Qt,Fe]=Re(se),Is=W.forwardRef((a,r)=>{const{__scopeAccordion:n,disabled:u,dir:h,orientation:x="vertical",...f}=a,p=W.useRef(null),D=lt(p,r),k=Ut(n),d=ct(h)==="ltr",S=zt(a.onKeyDown,g=>{if(!Vt.includes(g.key))return;const A=g.target,q=k().filter(t=>!t.ref.current?.disabled),O=q.findIndex(t=>t.ref.current===A),I=q.length;if(O===-1)return;g.preventDefault();let P=O;const J=0,_=I-1,B=()=>{P=O+1,P>_&&(P=J)},z=()=>{P=O-1,P<J&&(P=_)};switch(g.key){case"Home":P=J;break;case"End":P=_;break;case"ArrowRight":x==="horizontal"&&(d?B():z());break;case"ArrowDown":x==="vertical"&&B();break;case"ArrowLeft":x==="horizontal"&&(d?z():B());break;case"ArrowUp":x==="vertical"&&z();break}const K=P%I;q[K].ref.current?.focus()});return e.jsx(Qt,{scope:n,disabled:u,direction:h,orientation:x,children:e.jsx(Je.Slot,{scope:n,children:e.jsx(ms.div,{...f,"data-orientation":x,ref:D,onKeyDown:u?void 0:S})})})}),Pe="AccordionItem",[Zt,Ge]=Re(Pe),Es=W.forwardRef((a,r)=>{const{__scopeAccordion:n,value:u,...h}=a,x=Fe(Pe,n),f=Wt(Pe,n),p=Ye(n),D=it(),k=u&&f.value.includes(u)||!1,N=x.disabled||a.disabled;return e.jsx(Zt,{scope:n,open:k,disabled:N,triggerId:D,children:e.jsx(yt,{"data-orientation":x.orientation,"data-state":Fs(k),...p,...h,ref:r,disabled:N,open:k,onOpenChange:d=>{d?f.onItemOpen(u):f.onItemClose(u)}})})});Es.displayName=Pe;var Ts="AccordionHeader",Os=W.forwardRef((a,r)=>{const{__scopeAccordion:n,...u}=a,h=Fe(se,n),x=Ge(Ts,n);return e.jsx(ms.h3,{"data-orientation":h.orientation,"data-state":Fs(x.open),"data-disabled":x.disabled?"":void 0,...u,ref:r})});Os.displayName=Ts;var Ke="AccordionTrigger",Ps=W.forwardRef((a,r)=>{const{__scopeAccordion:n,...u}=a,h=Fe(se,n),x=Ge(Ke,n),f=Jt(Ke,n),p=Ye(n);return e.jsx(Je.ItemSlot,{scope:n,children:e.jsx(jt,{"aria-disabled":x.open&&!f.collapsible||void 0,"data-orientation":h.orientation,id:x.triggerId,...p,...u,ref:r})})});Ps.displayName=Ke;var Ms="AccordionContent",Rs=W.forwardRef((a,r)=>{const{__scopeAccordion:n,...u}=a,h=Fe(se,n),x=Ge(Ms,n),f=Ye(n);return e.jsx(Nt,{role:"region","aria-labelledby":x.triggerId,"data-orientation":h.orientation,...f,...u,ref:r,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...a.style}})});Rs.displayName=Ms;function Fs(a){return a?"open":"closed"}var Xt=ks,ea=Es,sa=Os,qs=Ps,Ls=Rs;const ta=Xt,Ve=c.forwardRef(({className:a,...r},n)=>e.jsx(ea,{ref:n,className:ee("border-b",a),...r}));Ve.displayName="AccordionItem";const Ue=c.forwardRef(({className:a,children:r,...n},u)=>e.jsx(sa,{className:"flex",children:e.jsxs(qs,{ref:u,className:ee("flex flex-1 items-center justify-between py-4 text-sm font-medium transition-all hover:underline text-left [&[data-state=open]>svg]:rotate-180",a),...n,children:[r,e.jsx(us,{className:"h-4 w-4 shrink-0 text-muted-foreground transition-transform duration-200"})]})}));Ue.displayName=qs.displayName;const He=c.forwardRef(({className:a,children:r,...n},u)=>e.jsx(Ls,{ref:u,className:"overflow-hidden text-sm data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...n,children:e.jsx("div",{className:ee("pb-4 pt-0",a),children:r})}));He.displayName=Ls.displayName;const aa=`You are extracting a full course syllabus for ingestion.

Return ONLY a valid JSON object with NO additional text, NO markdown code blocks, NO explanation.

Top-level structure:
{
  "term": {
    "startDate": "2026-01-05",
    "endDate": "2026-04-24",
    "timezone": "America/Chicago"
  },
  "modules": [
    {
      "name": "Module 1: ...",
      "orderIndex": 1,
      "topics": ["..."],
      "readings": ["..."],
      "assessments": ["..."]
    }
  ],
  "events": [
    {
      "type": "class" | "lecture" | "reading" | "topic" | "assignment" | "quiz" | "exam" | "assessment",
      "title": "string",
      "date": "YYYY-MM-DD",
      "dueDate": "YYYY-MM-DD | null",
      "startTime": "HH:MM | null",
      "endTime": "HH:MM | null",
      "daysOfWeek": ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],
      "delivery": "in_person" | "virtual_sync" | "virtual_async" | "hybrid",
      "assessmentType": "EA | null",
      "moduleName": "Module 1: ... | null",
      "notes": "string | null"
    }
  ]
}

Rules:
1. Include ALL items: class meetings, assignments, quizzes, exams, topics, readings, virtual synchronous/asynchronous activities, and learning assessments (EA).
2. For repeating class meetings, set daysOfWeek + startTime/endTime, and include term start/end.
3. For one-off items, set date or dueDate.
4. Keep moduleName when items belong to a module.
5. Return ONLY the JSON object, nothing else.

Here's my syllabus:

[PASTE YOUR SYLLABUS BELOW]`,na=`I need you to extract learning objectives from my course material.

Return ONLY a valid JSON array with NO additional text, NO markdown code blocks, NO explanation.

Structure for each item:
{
  "loCode": "string",
  "title": "string"
}

Rules:
1. loCode: Preserve original numbering if present, or create sequential "1", "2", "3"...
2. title: Keep the objective text exactly as written
3. Return ONLY the JSON array, nothing else

Here are my learning objectives:

[PASTE YOUR LOs BELOW]`,ra=`I need you to convert my study session notes into WRAP format.

WRAP format has 4 sections:

Section A: Obsidian Notes
- Main concepts and insights from the session
- Key points to remember

Section B: Anki Cards
- Format: "front: [question]" on one line, "back: [answer]" on next line
- Create cards for important facts and concepts

Section C: Spaced Schedule
- R1=tomorrow
- R2=3d
- R3=1w
- R4=2w

Section D: JSON Logs
\`\`\`json
{
  "merged": {
    "topic": "[main topic]",
    "mode": "Core",
    "duration_minutes": [number],
    "understanding": [1-5],
    "retention": [1-5]
  }
}
\`\`\`

Return ONLY the WRAP formatted content, NO additional text or explanation.

Here are my study notes:

[PASTE YOUR NOTES BELOW]`;function oa(){const a=Me(),[r,n]=c.useState(null),[u,h]=c.useState(null),[x,f]=c.useState(""),[p,D]=c.useState(""),[k,N]=c.useState(null),[d,S]=c.useState(""),[g,A]=c.useState(null),[q,O]=c.useState(null),[I,P]=c.useState(null),{data:J=[]}=L({queryKey:["courses"],queryFn:()=>w.courses.getActive()}),{data:_=[]}=L({queryKey:["modules",r],queryFn:()=>r?w.modules.getByCourse(r):Promise.resolve([]),enabled:!!r}),{data:B=[]}=L({queryKey:["learningObjectives",r],queryFn:()=>r?w.learningObjectives.getByCourse(r):Promise.resolve([]),enabled:!!r}),z=U({mutationFn:async l=>{if(!r)throw new Error("Select a course first");const b=JSON.parse(o(l));return w.syllabus.importBulk(r,b)},onSuccess:l=>{a.invalidateQueries({queryKey:["scheduleEvents"]}),a.invalidateQueries({queryKey:["modules"]}),f(""),O({type:"success",message:`Imported: ${l.modulesCreated} modules, ${l.eventsCreated} events (${l.classMeetingsExpanded} class meetings expanded)`}),N(null)},onError:l=>{O({type:"error",message:l.message||"Failed to import syllabus"}),N(l.message||"Failed to import syllabus")}}),K=U({mutationFn:async l=>{if(!r)throw new Error("Select a course first");const b=JSON.parse(o(l));return w.learningObjectives.createBulk(r,u,b)},onSuccess:()=>{a.invalidateQueries({queryKey:["learningObjectives"]}),D(""),N(null)},onError:l=>{N(l.message||"Failed to import LOs")}}),t=l=>{navigator.clipboard.writeText(l)},o=l=>{const b=l.trim();if(!b)return"";const j=b.match(/```json\s*([\s\S]*?)```/i)||b.match(/```\s*([\s\S]*?)```/i),T=j?j[1].trim():b,M=T.indexOf("{"),H=T.lastIndexOf("}");return M!==-1&&H!==-1&&H>M?T.slice(M,H+1).trim():T},m=l=>{const b=[];let j=null;try{const y=o(l);if(!y){b.push("No JSON found in input"),P({isValid:!1,errors:b});return}j=JSON.parse(y)}catch(y){b.push(`Invalid JSON: ${y.message}`),P({isValid:!1,errors:b});return}(!j||typeof j!="object")&&b.push("JSON must be an object");const T=j.name&&typeof j.name=="string"&&j.name.trim(),M=j.term&&typeof j.term=="object",H=Array.isArray(j.modules),te=Array.isArray(j.events);if(T||b.push("Missing or invalid 'name' field"),M||b.push("Missing or invalid 'term' object"),H||b.push("Missing or invalid 'modules' array"),te||b.push("Missing or invalid 'events' array"),M&&(j.term.startDate||b.push("term.startDate is required"),j.term.endDate||b.push("term.endDate is required")),b.length===0){const y={courseName:j.name,moduleCount:j.modules?.length||0,eventCount:j.events?.length||0,startDate:j.term?.startDate,endDate:j.term?.endDate};P({isValid:!0,errors:[],preview:y})}else P({isValid:!1,errors:b})},v=async()=>{try{A(null);const l=d,j=await w.brain.ingest(l,"pasted_wrap.md");j.sessionSaved?(A({type:"success",message:`✓ Session saved! ID: ${j.sessionId}, Cards: ${j.cardsCreated||0}`}),S("")):A({type:"error",message:j.errors?.join(", ")||j.message})}catch(l){A({type:"error",message:l.message||"Failed to ingest"})}};return e.jsxs("div",{className:"space-y-6 p-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1 font-terminal text-muted-foreground",children:"Select Course"}),e.jsxs("select",{className:"w-full bg-black border border-secondary rounded-none p-2 font-terminal",value:r||"",onChange:l=>{n(l.target.value?parseInt(l.target.value):null),h(null)},children:[e.jsx("option",{value:"",children:"-- Select Course --"}),J.map(l=>e.jsx("option",{value:l.id,children:l.name},l.id))]})]}),!r&&e.jsx("p",{className:"text-center text-muted-foreground font-terminal text-sm py-8",children:"Select a course above to begin ingestion."}),r&&e.jsxs("div",{className:"border border-secondary/40 rounded-none p-4 bg-primary/5",children:[e.jsx("h2",{className:"text-xl font-arcade text-primary mb-4",children:"WRAP SESSION INGESTION"}),g&&e.jsx("div",{className:`mb-4 p-3 rounded-none font-terminal text-sm ${g.type==="success"?"bg-green-900/30 border border-green-500 text-green-400":"bg-red-900/30 border border-red-500 text-red-400"}`,children:g.message}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("button",{onClick:()=>t(ra),className:"bg-primary hover:bg-primary/80 px-3 py-1 rounded-none text-xs font-terminal mb-2",type:"button",children:"Copy Prompt for ChatGPT"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-2 font-terminal",children:"Use ChatGPT to convert your notes to WRAP format, then paste or upload below:"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-2 font-terminal text-muted-foreground",children:"Paste WRAP Content"}),e.jsx("textarea",{className:"w-full bg-black border border-secondary rounded-none p-2 h-48 font-terminal text-sm",placeholder:"Paste your WRAP session here...",value:d,onChange:l=>{S(l.target.value),A(null)}})]}),e.jsx("button",{onClick:v,disabled:!d,className:"bg-primary hover:bg-primary/80 disabled:opacity-50 px-6 py-3 rounded-none font-arcade text-sm w-full",type:"button",children:"INGEST WRAP SESSION"})]})]}),r&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-xl font-arcade text-primary",children:"MATERIAL INGESTION"}),k&&e.jsx("div",{className:"bg-destructive/20 border border-destructive rounded-none p-3 text-destructive font-terminal",children:k}),r&&e.jsxs(ta,{type:"multiple",className:"border border-secondary/40 rounded-none divide-y divide-secondary/40",children:[e.jsxs(Ve,{value:"syllabus-import",className:"border-secondary/40",children:[e.jsx(Ue,{className:"font-arcade text-xs text-primary px-3 hover:no-underline",children:"SYLLABUS IMPORT (MODULES + SCHEDULE)"}),e.jsxs(He,{className:"px-3",children:[e.jsx("button",{onClick:()=>t(aa),className:"bg-primary hover:bg-primary/80 px-3 py-1 rounded-none text-xs font-terminal mb-2",type:"button",children:"Copy Prompt for ChatGPT"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-2 font-terminal",children:"Paste the ChatGPT response (combined JSON object) below:"}),e.jsx("textarea",{className:"w-full bg-black border border-secondary rounded-none p-2 h-40 font-terminal text-sm",placeholder:'{"term":{"startDate":"2026-01-15","endDate":"2026-05-01","timezone":"America/Chicago"},"modules":[...],"events":[...]}',value:x,onChange:l=>{f(l.target.value),O(null),l.target.value.trim()?m(l.target.value):P(null)}}),I&&!I.isValid&&e.jsxs("div",{className:"mt-2 p-2 border border-red-500 bg-red-900/30 rounded-none font-terminal text-xs text-red-400",children:[e.jsx("div",{className:"font-bold mb-1",children:"Validation Errors:"}),I.errors.map((l,b)=>e.jsxs("div",{children:["• ",l]},b))]}),I&&I.isValid&&I.preview&&e.jsxs("div",{className:"mt-2 p-3 border border-primary bg-primary/10 rounded-none font-terminal text-xs text-primary",children:[e.jsx("div",{className:"font-bold mb-2",children:"✓ Valid JSON Preview:"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Course:"})," ",I.preview.courseName]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Modules:"})," ",I.preview.moduleCount]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Events:"})," ",I.preview.eventCount]}),I.preview.startDate&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Start:"})," ",I.preview.startDate]}),I.preview.endDate&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"End:"})," ",I.preview.endDate]})]})]}),e.jsx("button",{onClick:()=>z.mutate(x),disabled:!I?.isValid||z.isPending,className:"bg-secondary hover:bg-secondary/80 disabled:opacity-50 px-4 py-2 rounded-none mt-2 font-terminal text-xs",type:"button",children:z.isPending?"Importing...":"Import Syllabus"}),q&&e.jsx("div",{className:`mt-2 p-2 border font-terminal text-xs ${q.type==="success"?"border-green-500 text-green-400":"border-red-500 text-red-400"}`,children:q.message})]})]}),e.jsxs(Ve,{value:"learning-objectives",className:"border-secondary/40",children:[e.jsx(Ue,{className:"font-arcade text-xs text-primary px-3 hover:no-underline",children:"LEARNING OBJECTIVES IMPORT"}),e.jsxs(He,{className:"px-3",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block text-xs mb-1 font-terminal text-muted-foreground",children:"Target Module (optional)"}),e.jsxs("select",{className:"w-full bg-black border border-secondary rounded-none p-2 font-terminal",value:u||"",onChange:l=>h(l.target.value?parseInt(l.target.value):null),children:[e.jsx("option",{value:"",children:"-- No Module (Course-level) --"}),_.map(l=>e.jsx("option",{value:l.id,children:l.name},l.id))]})]}),e.jsx("button",{onClick:()=>t(na),className:"bg-primary hover:bg-primary/80 px-3 py-1 rounded-none text-xs font-terminal mb-2",type:"button",children:"Copy Prompt for ChatGPT"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-2 font-terminal",children:"Paste the ChatGPT response (JSON array) below:"}),e.jsx("textarea",{className:"w-full bg-black border border-secondary rounded-none p-2 h-32 font-terminal text-sm",placeholder:'[{"loCode": "1.1", "title": "Define..."}]',value:p,onChange:l=>D(l.target.value)}),e.jsx("button",{onClick:()=>K.mutate(p),disabled:!p||K.isPending,className:"bg-secondary hover:bg-secondary/80 disabled:opacity-50 px-4 py-2 rounded-none mt-2 font-terminal text-xs",type:"button",children:K.isPending?"Importing...":"Import LOs"}),B.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("h4",{className:"font-terminal text-xs mb-2",children:["Current LOs (",B.length,")"]}),e.jsx("div",{className:"max-h-48 overflow-y-auto",children:B.map(l=>e.jsxs("div",{className:"text-xs py-1 border-b border-secondary/30 font-terminal",children:[e.jsx("span",{className:"text-primary",children:l.loCode}),": ",l.title,e.jsx("span",{className:`ml-2 text-[10px] px-1 rounded ${l.status==="solid"?"bg-green-600":l.status==="in_progress"?"bg-yellow-600":l.status==="need_review"?"bg-orange-600":"bg-gray-600"}`,children:l.status})]},l.id))})]})]})]})]})]})]})}function la(){const a=Me(),[r,n]=c.useState(null),[u,h]=c.useState({}),[x,f]=c.useState({}),[p,D]=c.useState(new Set),[k,N]=c.useState(new Set),[d,S]=c.useState(null),g=c.useRef(null),{data:A=[]}=L({queryKey:["courses"],queryFn:()=>w.courses.getActive()}),{data:q=[]}=L({queryKey:["modules",r],queryFn:()=>r?w.modules.getByCourse(r):Promise.resolve([]),enabled:!!r}),{data:O=[]}=L({queryKey:["scheduleEvents",r],queryFn:()=>r?w.scheduleEvents.getByCourse(r):Promise.resolve([]),enabled:!!r}),I=U({mutationFn:({id:t,data:o})=>w.modules.update(t,o),onSuccess:()=>{a.invalidateQueries({queryKey:["modules"]})}}),P=U({mutationFn:t=>w.modules.delete(t),onSuccess:()=>{a.invalidateQueries({queryKey:["modules"]})}}),J=U({mutationFn:t=>w.modules.deleteMany(t),onSuccess:()=>{a.invalidateQueries({queryKey:["modules"]}),D(new Set)}}),_=U({mutationFn:({id:t,data:o})=>w.scheduleEvents.update(t,o),onSuccess:()=>{a.invalidateQueries({queryKey:["scheduleEvents"]})}}),B=U({mutationFn:t=>w.scheduleEvents.delete(t),onSuccess:()=>{a.invalidateQueries({queryKey:["scheduleEvents"]})}}),z=U({mutationFn:t=>w.scheduleEvents.deleteMany(t),onSuccess:()=>{a.invalidateQueries({queryKey:["scheduleEvents"]}),N(new Set)}}),K=(t,o,m)=>{if(!o.length)return;const v={type:t,ids:o,label:m};g.current=v,S(v)};return e.jsxs("div",{className:"space-y-6 p-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1 font-terminal text-muted-foreground",children:"Select Course"}),e.jsxs("select",{className:"w-full bg-black border border-secondary rounded-none p-2 font-terminal",value:r||"",onChange:t=>{n(t.target.value?parseInt(t.target.value):null)},children:[e.jsx("option",{value:"",children:"-- Select Course --"}),A.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),r&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(G,{className:"brain-card rounded-none",children:[e.jsx(de,{className:"border-b border-secondary/50 p-3",children:e.jsxs(me,{className:"font-arcade text-sm flex items-center gap-2",children:[e.jsx(Ot,{className:"w-4 h-4"}),"MODULES (",q.length,")"]})}),e.jsx(Q,{className:"p-0",children:q.length===0?e.jsx("p",{className:"text-xs text-muted-foreground font-terminal p-4",children:"No modules yet. Import a syllabus to add modules."}):e.jsxs("div",{className:"p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"bg-secondary hover:bg-secondary/80 px-2 py-1 rounded-none text-[10px] font-terminal",type:"button",onClick:()=>{const t=new Set;p.size!==q.length&&q.forEach(o=>t.add(o.id)),D(t)},children:p.size===q.length?"Uncheck All":"Check All"}),e.jsx("button",{className:"bg-destructive hover:bg-destructive/80 px-2 py-1 rounded-none text-[10px] font-terminal",type:"button",disabled:p.size===0,onClick:()=>{K("modules",Array.from(p),`Delete ${p.size} module(s)? This cannot be undone.`)},children:"Delete"}),e.jsx("button",{className:"bg-secondary hover:bg-secondary/80 px-2 py-1 rounded-none text-[10px] font-terminal",type:"button",disabled:p.size===0,onClick:()=>{p.forEach(t=>{const o=u[t];o&&I.mutate({id:t,data:o})}),h(t=>{const o={...t};return p.forEach(m=>{delete o[m]}),o})},children:"Save"})]}),e.jsx(pe,{className:"h-[280px]",children:e.jsxs("table",{className:"w-full text-sm font-terminal",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-secondary/50",children:[e.jsx("th",{className:"text-center p-2 w-8",children:"Select"}),e.jsx("th",{className:"text-left p-2",children:"Module"}),e.jsx("th",{className:"text-center p-2",children:"Order"}),e.jsx("th",{className:"text-center p-2",children:"Files"}),e.jsx("th",{className:"text-center p-2",children:"NotebookLM"}),e.jsx("th",{className:"text-center p-2",children:"Status"}),e.jsx("th",{className:"text-center p-2",children:"Actions"})]})}),e.jsx("tbody",{children:q.map(t=>e.jsxs("tr",{className:"border-b border-secondary/30",children:[e.jsx("td",{className:"text-center p-2",children:e.jsx(ce,{checked:p.has(t.id),onCheckedChange:o=>D(m=>{const v=new Set(m);return o?v.add(t.id):v.delete(t.id),v}),className:"rounded-none border-secondary data-[state=checked]:bg-secondary w-4 h-4"})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{className:"w-full bg-black border border-secondary rounded-none p-1 text-xs font-terminal",value:u[t.id]?.name??t.name,onChange:o=>h(m=>({...m,[t.id]:{...m[t.id],name:o.target.value}}))})}),e.jsx("td",{className:"text-center p-2",children:e.jsx("input",{type:"number",className:"w-16 bg-black border border-secondary rounded-none p-1 text-xs font-terminal text-center",value:u[t.id]?.orderIndex??t.orderIndex??0,onChange:o=>h(m=>({...m,[t.id]:{...m[t.id],orderIndex:parseInt(o.target.value||"0",10)}}))})}),e.jsx("td",{className:"text-center p-2",children:e.jsx(ce,{checked:t.filesDownloaded,onCheckedChange:o=>I.mutate({id:t.id,data:{filesDownloaded:!!o}}),className:"rounded-none border-secondary data-[state=checked]:bg-secondary w-4 h-4"})}),e.jsx("td",{className:"text-center p-2",children:e.jsx(ce,{checked:t.notebooklmLoaded,onCheckedChange:o=>I.mutate({id:t.id,data:{notebooklmLoaded:!!o}}),className:"rounded-none border-secondary data-[state=checked]:bg-secondary w-4 h-4"})}),e.jsx("td",{className:"text-center p-2",children:t.filesDownloaded&&t.notebooklmLoaded?e.jsx("span",{className:"text-green-400",children:"Ready"}):e.jsx("span",{className:"text-yellow-400",children:"Pending"})}),e.jsxs("td",{className:"text-center p-2 space-x-2",children:[e.jsx("button",{className:"bg-secondary hover:bg-secondary/80 px-2 py-1 rounded-none text-[10px] font-terminal",type:"button",disabled:!u[t.id],onClick:()=>{const o=u[t.id];o&&(I.mutate({id:t.id,data:o}),h(m=>{const v={...m};return delete v[t.id],v}))},children:"Save"}),e.jsx("button",{className:"bg-destructive hover:bg-destructive/80 px-2 py-1 rounded-none text-[10px] font-terminal",type:"button",onClick:()=>P.mutate(t.id),children:"Delete"})]})]},t.id))})]})})]})})]}),e.jsxs(G,{className:"brain-card rounded-none",children:[e.jsx(de,{className:"border-b border-secondary/50 p-3",children:e.jsxs(me,{className:"font-arcade text-sm flex items-center gap-2",children:[e.jsx(We,{className:"w-4 h-4"}),"SCHEDULE ITEMS (",O.length,")"]})}),e.jsx(Q,{className:"p-0",children:O.length===0?e.jsx("p",{className:"text-xs text-muted-foreground font-terminal p-4",children:"No schedule items yet. Import a syllabus to add events."}):e.jsxs("div",{className:"p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"bg-secondary hover:bg-secondary/80 px-2 py-1 rounded-none text-[10px] font-terminal",type:"button",onClick:()=>{const t=new Set;k.size!==O.length&&O.forEach(o=>t.add(o.id)),N(t)},children:k.size===O.length?"Uncheck All":"Check All"}),e.jsx("button",{className:"bg-destructive hover:bg-destructive/80 px-2 py-1 rounded-none text-[10px] font-terminal",type:"button",disabled:k.size===0,onClick:()=>{K("schedule",Array.from(k),`Delete ${k.size} schedule item(s)? This cannot be undone.`)},children:"Delete"}),e.jsx("button",{className:"bg-secondary hover:bg-secondary/80 px-2 py-1 rounded-none text-[10px] font-terminal",type:"button",disabled:k.size===0,onClick:()=>{k.forEach(t=>{const o=x[t];o&&_.mutate({id:t,data:o})}),f(t=>{const o={...t};return k.forEach(m=>{delete o[m]}),o})},children:"Save"})]}),e.jsx(pe,{className:"h-[280px]",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-xs font-terminal",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-secondary/50",children:[e.jsx("th",{className:"text-center p-2 w-8",children:"Select"}),e.jsx("th",{className:"text-left p-2",children:"Type"}),e.jsx("th",{className:"text-left p-2",children:"Delivery"}),e.jsx("th",{className:"text-left p-2",children:"Title"}),e.jsx("th",{className:"text-center p-2",children:"Date"}),e.jsx("th",{className:"text-center p-2",children:"Start"}),e.jsx("th",{className:"text-center p-2",children:"End"}),e.jsx("th",{className:"text-center p-2",children:"Due"}),e.jsx("th",{className:"text-left p-2",children:"Notes"}),e.jsx("th",{className:"text-center p-2",children:"Actions"})]})}),e.jsx("tbody",{children:O.map(t=>{const o=x[t.id]||{},m=o.type??t.type??"",v=o.delivery??t.delivery??"",l=o.title??t.title??"",b=o.date??t.date??"",j=o.startTime??t.startTime??"",T=o.endTime??t.endTime??"",M=o.dueDate??t.dueDate??"",H=o.notes??t.notes??"",te=!!x[t.id];return e.jsxs("tr",{className:"border-b border-secondary/30 align-top",children:[e.jsx("td",{className:"text-center p-2",children:e.jsx(ce,{checked:k.has(t.id),onCheckedChange:y=>N(C=>{const Y=new Set(C);return y?Y.add(t.id):Y.delete(t.id),Y}),className:"rounded-none border-secondary data-[state=checked]:bg-secondary w-4 h-4"})}),e.jsx("td",{className:"p-2",children:e.jsx("select",{className:"bg-black border border-secondary rounded-none p-1 text-xs font-terminal",value:m,onChange:y=>f(C=>({...C,[t.id]:{...C[t.id],type:y.target.value}})),children:["class","lecture","reading","topic","assignment","quiz","exam","assessment","other"].map(y=>e.jsx("option",{value:y,children:y},y))})}),e.jsx("td",{className:"p-2",children:e.jsx("select",{className:"bg-black border border-secondary rounded-none p-1 text-xs font-terminal",value:v,onChange:y=>f(C=>({...C,[t.id]:{...C[t.id],delivery:y.target.value}})),children:["","in_person","virtual_sync","virtual_async","online_module","hybrid"].map(y=>e.jsx("option",{value:y,children:y||"--"},y))})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{className:"w-full bg-black border border-secondary rounded-none p-1 text-xs font-terminal",value:l,onChange:y=>f(C=>({...C,[t.id]:{...C[t.id],title:y.target.value}}))})}),e.jsx("td",{className:"text-center p-2",children:e.jsx("input",{type:"date",className:"bg-black border border-secondary rounded-none p-1 text-xs font-terminal",value:b||"",onChange:y=>f(C=>({...C,[t.id]:{...C[t.id],date:y.target.value}}))})}),e.jsx("td",{className:"text-center p-2",children:e.jsx("input",{type:"time",className:"bg-black border border-secondary rounded-none p-1 text-xs font-terminal",value:j||"",onChange:y=>f(C=>({...C,[t.id]:{...C[t.id],startTime:y.target.value}}))})}),e.jsx("td",{className:"text-center p-2",children:e.jsx("input",{type:"time",className:"bg-black border border-secondary rounded-none p-1 text-xs font-terminal",value:T||"",onChange:y=>f(C=>({...C,[t.id]:{...C[t.id],endTime:y.target.value}}))})}),e.jsx("td",{className:"text-center p-2",children:e.jsx("input",{type:"date",className:"bg-black border border-secondary rounded-none p-1 text-xs font-terminal",value:M||"",onChange:y=>f(C=>({...C,[t.id]:{...C[t.id],dueDate:y.target.value}}))})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{className:"w-full bg-black border border-secondary rounded-none p-1 text-xs font-terminal",value:H||"",onChange:y=>f(C=>({...C,[t.id]:{...C[t.id],notes:y.target.value}}))})}),e.jsxs("td",{className:"text-center p-2 space-x-2",children:[e.jsx("button",{className:"bg-secondary hover:bg-secondary/80 px-2 py-1 rounded-none text-[10px] font-terminal",type:"button",disabled:!te,onClick:()=>{_.mutate({id:t.id,data:{type:m,title:l,date:b,startTime:j,endTime:T,dueDate:M,notes:H,delivery:v}}),f(y=>{const C={...y};return delete C[t.id],C})},children:"Save"}),e.jsx("button",{className:"bg-destructive hover:bg-destructive/80 px-2 py-1 rounded-none text-[10px] font-terminal",type:"button",onClick:()=>B.mutate(t.id),children:"Delete"})]})]},t.id)})})]})})})]})})]})]}),e.jsx(hs,{open:!!d,onOpenChange:t=>!t&&S(null),children:e.jsxs(ps,{className:"bg-black border-2 border-primary rounded-none font-terminal text-primary shadow-none max-w-md translate-y-0",style:{zIndex:100005,top:"6rem",left:"50%",transform:"translate(-50%, 0)"},children:[e.jsxs(fs,{className:"text-left",children:[e.jsx(bs,{className:"font-arcade text-destructive",children:"CONFIRM_DELETE"}),e.jsx(gs,{className:"font-terminal text-muted-foreground",children:d?.label})]}),e.jsxs(ys,{className:"gap-2 sm:justify-end",children:[e.jsx(js,{className:"rounded-none border-secondary font-terminal text-xs hover:bg-secondary/20",onClick:()=>{g.current=null,S(null)},children:"CANCEL"}),e.jsx(Ns,{className:"rounded-none bg-destructive text-destructive-foreground font-arcade text-xs hover:bg-destructive/80",type:"button",onClick:()=>{const t=g.current;t&&(t.type==="modules"?J.mutate(t.ids):z.mutate(t.ids),g.current=null,S(null))},children:"DELETE"})]})]})})]})}function ia(){const[a,r]=c.useState(null),{data:n=[]}=L({queryKey:["courses"],queryFn:async()=>{const d=await fetch("/api/courses");if(!d.ok)throw new Error("Failed to fetch courses");return d.json()}}),{data:u=[],isLoading:h}=L({queryKey:["modules",a],queryFn:()=>a?w.modules.getByCourse(a):Promise.resolve([]),enabled:!!a}),{data:x=[]}=L({queryKey:["learningObjectives",a],queryFn:()=>a?w.learningObjectives.getByCourse(a):Promise.resolve([]),enabled:!!a}),{data:f=[]}=L({queryKey:["scheduleEvents",a],queryFn:()=>a?w.scheduleEvents.getByCourse(a):Promise.resolve([]),enabled:!!a}),p=u.reduce((d,S)=>{const g=S.orderIndex||0;return d[g]||(d[g]=[]),d[g].push(S),d},{}),D=x.reduce((d,S)=>{const g=S.moduleId||0;return d[g]||(d[g]=[]),d[g].push(S),d},{}),k=f.reduce((d,S)=>{const g=S.linkedModuleId||0;return d[g]||(d[g]=[]),d[g].push(S),d},{}),N=u.length>0||x.length>0||f.length>0;return e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsxs(G,{className:"brain-card rounded-none",children:[e.jsx(de,{className:"border-b border-secondary/50 p-3",children:e.jsx(me,{className:"font-arcade text-sm",children:"SELECT COURSE"})}),e.jsx(Q,{className:"p-3",children:e.jsxs(Ne,{value:a?.toString()||"",onValueChange:d=>r(d?parseInt(d):null),children:[e.jsx(ve,{className:"rounded-none border-primary",children:e.jsx(we,{placeholder:"Choose a course..."})}),e.jsx(Se,{children:n.map(d=>e.jsx($,{value:d.id.toString(),children:d.name},d.id))})]})})]}),a?h?e.jsx(G,{className:"brain-card rounded-none",children:e.jsx(Q,{className:"p-8 text-center",children:e.jsx("p",{className:"font-terminal text-xs text-muted-foreground",children:"Loading syllabus..."})})}):N?e.jsx(pe,{className:"h-[600px]",children:e.jsx("div",{className:"space-y-4 pr-4",children:Object.entries(p).sort(([d],[S])=>parseInt(d)-parseInt(S)).map(([d,S])=>e.jsxs(G,{className:"brain-card rounded-none",children:[e.jsx(de,{className:"border-b border-secondary/50 p-3",children:e.jsxs(me,{className:"font-arcade text-sm",children:["WEEK ",d]})}),e.jsx(Q,{className:"p-3 space-y-3",children:S.map(g=>e.jsxs("div",{className:"space-y-2 border-l-2 border-secondary/40 pl-3",children:[e.jsx("div",{className:"font-arcade text-xs text-primary",children:g.name}),D[g.id]&&D[g.id].length>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-terminal text-[10px] text-muted-foreground uppercase",children:"Objectives"}),e.jsx("div",{className:"space-y-1",children:D[g.id].map(A=>e.jsxs("div",{className:"font-terminal text-xs text-secondary",children:["• ",A.loCode,": ",A.title]},A.id))})]}),k[g.id]&&k[g.id].length>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-terminal text-[10px] text-muted-foreground uppercase",children:"Events"}),e.jsx("div",{className:"space-y-1",children:k[g.id].map(A=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_e,{variant:"outline",className:`text-[10px] font-terminal ${A.type==="quiz"?"border-yellow-500/50 text-yellow-400":A.type==="exam"?"border-red-500/50 text-red-400":"border-blue-500/50 text-blue-400"}`,children:A.type?.toUpperCase()}),e.jsx("span",{className:"font-terminal text-xs text-muted-foreground",children:A.title}),A.dueDate&&e.jsx("span",{className:"font-terminal text-[10px] text-secondary ml-auto",children:new Date(A.dueDate).toLocaleDateString()})]},A.id))})]})]},g.id))})]},d))})}):e.jsx(G,{className:"brain-card rounded-none",children:e.jsx(Q,{className:"p-8 text-center",children:e.jsx("p",{className:"font-terminal text-xs text-muted-foreground",children:"No syllabus imported"})})}):e.jsx(G,{className:"brain-card rounded-none",children:e.jsx(Q,{className:"p-8 text-center",children:e.jsx("p",{className:"font-terminal text-xs text-muted-foreground",children:"Select a course to view syllabus"})})})]})}function ds(a,r){if(r.length===0)return a;const n=[];for(const u of r)n.push({type:"image_url",image_url:{url:u}});return a.trim()&&n.push({type:"text",text:a}),n}function ca(){const[a,r]=c.useState(!1),[n,u]=c.useState("chat"),[h,x]=c.useState([]),[f,p]=c.useState(""),[D,k]=c.useState([]),[N,d]=c.useState(!1),[S,g]=c.useState("anki"),A=c.useRef(null),q=c.useRef(null),O=Me(),I=c.useCallback(()=>{A.current&&(A.current.scrollTop=A.current.scrollHeight)},[]);c.useEffect(()=>{I()},[h,I]);const P=o=>{const m=new FileReader;m.onload=()=>{typeof m.result=="string"&&k(v=>[...v,m.result])},m.readAsDataURL(o)},J=o=>{const m=o.clipboardData?.items;if(m){for(const v of Array.from(m))if(v.type.startsWith("image/")){o.preventDefault();const l=v.getAsFile();l&&P(l)}}},_=o=>{const m=o.target.files;if(m){for(const v of Array.from(m))v.type.startsWith("image/")&&P(v);o.target.value=""}},B=async(o,m)=>{x(M=>[...M,{role:"assistant",content:""}]);const v=h.map(M=>({role:M.role,content:M.images?.length?ds(M.content,M.images):M.content})).concat([{role:"user",content:ds(o,m)}]),b=(await fetch("/api/brain/quick-chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:v})})).body?.getReader(),j=new TextDecoder;if(!b)throw new Error("No response body");let T="";for(;;){const{done:M,value:H}=await b.read();if(M)break;T+=j.decode(H,{stream:!0});const te=T.split(`
`);T=te.pop()??"";for(const y of te){if(!y.startsWith("data: "))continue;const C=y.slice(6);if(C==="[DONE]")break;try{const Y=JSON.parse(C);if(Y.error){x(ue=>{const Z=[...ue];return Z[Z.length-1]={role:"assistant",content:`Error: ${Y.error}`},Z});return}Y.content&&x(ue=>{const Z=[...ue],V=Z[Z.length-1];return Z[Z.length-1]={...V,content:V.content+Y.content},Z})}catch{}}}},z=async o=>{try{const m=S==="both"?"all":S,v=S==="obsidian"||S==="both",l=await w.brain.chat(o,v,m);let b=l.response;const j={cardsCreated:l.cardsCreated,sessionSaved:l.sessionSaved,sessionId:l.sessionId},T=[];l.sessionSaved&&T.push(`Session saved (ID: ${l.sessionId})`),l.cardsCreated&&T.push(`${l.cardsCreated} Anki cards created`),l.obsidianSynced&&T.push("Synced to Obsidian"),l.obsidianError&&T.push(`Obsidian error: ${l.obsidianError}`),T.length>0&&(b=`${T.join(" | ")}

${b}`),x(M=>[...M,{role:"assistant",content:b,meta:j}]),O.invalidateQueries({queryKey:["anki","drafts"]}),O.invalidateQueries({queryKey:["brain","metrics"]}),O.invalidateQueries({queryKey:["sessions"]})}catch(m){x(v=>[...v,{role:"assistant",content:`Error: ${m}`}])}},K=async()=>{const o=f.trim();if(!o&&D.length===0)return;const m={role:"user",content:o,images:[...D]};x(v=>[...v,m]),p(""),k([]),d(!0);try{n==="chat"?await B(o,m.images??[]):await z(o)}catch(v){x(l=>{const b=l[l.length-1];if(b?.role==="assistant"&&!b.content){const j=[...l];return j[j.length-1]={role:"assistant",content:`Error: ${v}`},j}return[...l,{role:"assistant",content:`Error: ${v}`}]})}finally{d(!1)}},t=o=>{o.key==="Enter"&&!o.shiftKey&&(o.preventDefault(),K())};return a?e.jsxs(G,{className:"brain-card border-primary/30 mb-4",children:[e.jsxs(de,{className:"py-2 px-4 flex flex-row items-center justify-between",children:[e.jsx(me,{className:"text-xs",children:"BRAIN CHAT"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("div",{className:"flex bg-secondary/40 border border-secondary/60 rounded overflow-hidden mr-2",children:[e.jsxs("button",{onClick:()=>u("chat"),className:`flex items-center gap-1 px-2 py-0.5 text-[10px] transition-colors ${n==="chat"?"bg-primary/30 text-primary":"text-muted-foreground hover:text-foreground"}`,children:[e.jsx(ft,{className:"w-3 h-3"})," CHAT"]}),e.jsxs("button",{onClick:()=>u("ingest"),className:`flex items-center gap-1 px-2 py-0.5 text-[10px] transition-colors ${n==="ingest"?"bg-primary/30 text-primary":"text-muted-foreground hover:text-foreground"}`,children:[e.jsx(Et,{className:"w-3 h-3"})," INGEST"]})]}),e.jsx(F,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>r(!1),children:e.jsx(ht,{className:"w-4 h-4"})})]})]}),e.jsxs(Q,{className:"p-0",children:[e.jsxs("div",{className:"px-4 py-1 border-b border-border flex items-center justify-between",children:[e.jsx("p",{className:"text-[10px] text-muted-foreground",children:n==="chat"?"General chat with Gemini Flash — ask anything, paste screenshots":"Study ingestion — paste notes to create Anki cards & save sessions"}),n==="ingest"&&e.jsx("div",{className:"flex bg-secondary/40 border border-secondary/60 rounded overflow-hidden",children:["anki","obsidian","both"].map(o=>e.jsxs("button",{onClick:()=>g(o),className:`flex items-center gap-1 px-2 py-0.5 text-[10px] transition-colors ${S===o?"bg-primary/30 text-primary":"text-muted-foreground hover:text-foreground"}`,children:[o==="anki"&&e.jsxs(e.Fragment,{children:[e.jsx(We,{className:"w-3 h-3"})," ANKI"]}),o==="obsidian"&&e.jsxs(e.Fragment,{children:[e.jsx(wt,{className:"w-3 h-3"})," OBSIDIAN"]}),o==="both"&&e.jsx(e.Fragment,{children:"BOTH"})]},o))})]}),e.jsxs("div",{ref:A,className:"h-64 overflow-y-auto px-4 py-2 space-y-3",children:[h.length===0&&e.jsx("p",{className:"text-muted-foreground text-xs text-center py-8",children:n==="chat"?"Ask anything. Paste screenshots with Ctrl+V.":"Paste your study notes to ingest into Brain."}),h.map((o,m)=>e.jsx("div",{className:`flex ${o.role==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[80%] rounded px-3 py-2 text-sm whitespace-pre-wrap ${o.role==="user"?"bg-primary/20 text-foreground border border-primary/30":"bg-secondary/40 text-foreground border border-secondary/60"}`,children:[o.images?.map((v,l)=>e.jsx("img",{src:v,alt:"attached",className:"max-h-32 rounded mb-1"},l)),o.content]})},m)),N&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"bg-secondary/40 border border-secondary/60 rounded px-3 py-2",children:e.jsx(St,{className:"w-4 h-4 animate-spin text-primary"})})})]}),D.length>0&&e.jsx("div",{className:"px-4 py-1 flex gap-2 flex-wrap",children:D.map((o,m)=>e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:o,alt:"pending",className:"h-12 rounded border border-primary/30"}),e.jsx("button",{onClick:()=>k(v=>v.filter((l,b)=>b!==m)),className:"absolute -top-1 -right-1 bg-destructive rounded-full p-0.5",children:e.jsx(je,{className:"w-3 h-3"})})]},m))}),e.jsxs("div",{className:"flex items-end gap-2 px-4 py-2 border-t border-border",children:[e.jsx("input",{ref:q,type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:_}),n==="chat"&&e.jsx(F,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 shrink-0",onClick:()=>q.current?.click(),children:e.jsx(Ft,{className:"w-4 h-4 text-primary"})}),e.jsx("textarea",{value:f,onChange:o=>p(o.target.value),onKeyDown:t,onPaste:J,placeholder:n==="chat"?"Ask anything... (Ctrl+V to paste images)":"Paste study notes to ingest...",rows:n==="ingest"?3:1,className:"flex-1 bg-transparent border border-input rounded px-3 py-1.5 text-sm resize-none focus:outline-none focus:ring-1 focus:ring-ring"}),e.jsx(F,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 shrink-0",onClick:K,disabled:N,children:e.jsx(pt,{className:"w-4 h-4 text-primary"})})]})]})]}):e.jsxs("button",{onClick:()=>r(!0),className:"w-full flex items-center justify-between brain-card border border-primary/30 px-4 py-2 mb-4 text-sm text-primary hover:bg-primary/10 transition-colors",children:[e.jsx("span",{className:"font-arcade text-xs tracking-widest uppercase",children:"BRAIN CHAT"}),e.jsx(us,{className:"w-4 h-4"})]})}const da=(a,r="MM/dd")=>{if(!a)return"-";try{const n=a instanceof Date?a:new Date(a);return At(n)?Dt(n,r):"-"}catch{return"-"}},Oe=a=>{if(Array.isArray(a))return a.filter(r=>typeof r=="string");if(typeof a=="string"){const r=a.trim();if(!r)return[];try{const n=JSON.parse(r);if(Array.isArray(n))return n.filter(u=>typeof u=="string")}catch{}return r.split(",").map(n=>n.trim()).filter(Boolean)}return[]};function Ca(){const[a,r]=c.useState(new Set),[n,u]=c.useState(null),[h,x]=c.useState(!1),[f,p]=c.useState([]),[D,k]=c.useState(!1),[N,d]=c.useState(new Set),[S,g]=c.useState(null),[A,q]=c.useState({front:"",back:"",deckName:""}),[O,I]=c.useState("all"),[P,J]=c.useState("all"),[_,B]=c.useState(""),[z,K]=c.useState(""),[t,o]=c.useState({mode:"",minutes:"",cards:"",confusions:"",weakAnchors:"",concepts:"",issues:"",notes:""}),[m,v]=c.useState("School"),[l,b]=c.useState(null),[j,T]=c.useState(""),[M,H]=c.useState(!1),[te,y]=c.useState(!1),[C,Y]=c.useState(!1),ue=[{name:"EBP",path:"School/Evidence Based Practice"},{name:"ExPhys",path:"School/Exercise Physiology"},{name:"MS1",path:"School/Movement Science 1"},{name:"Neuro",path:"School/Neuroscience"},{name:"TI",path:"School/Theraputic Intervention"}];c.useEffect(()=>{const s=new URLSearchParams(window.location.search),i=s.get("semester")||"all",E=s.get("start")||"",R=s.get("end")||"";I(i),B(E),K(R)},[]);const{data:Z=[]}=L({queryKey:["courses"],queryFn:()=>w.courses.getActive()}),{data:V=[],isLoading:fe}=L({queryKey:["sessions",O,_,z],queryFn:async()=>{const s=new URLSearchParams;O!=="all"&&s.append("semester",O),_&&s.append("start",_),z&&s.append("end",z);const i=s.toString(),E=i?`/sessions?${i}`:"/sessions",R=await fetch(`/api${E}`);if(!R.ok)throw new Error(`API Error: ${R.statusText}`);return R.json()}}),{data:Qe}=L({queryKey:["brain","metrics"],queryFn:w.brain.getMetrics}),be=Me(),$s=U({mutationFn:s=>w.sessions.deleteMany(s),onSuccess:()=>{be.invalidateQueries({queryKey:["sessions"]}),be.invalidateQueries({queryKey:["brain","metrics"]}),r(new Set)}}),zs=U({mutationFn:({id:s,updates:i})=>w.sessions.update(s,i),onSuccess:()=>{be.invalidateQueries({queryKey:["sessions"]}),be.invalidateQueries({queryKey:["brain","metrics"]}),u(null)}}),_s=s=>{r(i=>{const E=new Set(i);return E.has(s)?E.delete(s):E.add(s),E})},Bs=()=>{a.size===V.length?r(new Set):r(new Set(V.map(s=>s.id)))},Ks=()=>{a.size!==0&&(p(Array.from(a)),x(!0))},Vs=s=>{p([s]),x(!0)},Us=()=>{$s.mutate(f),x(!1),p([])};c.useEffect(()=>{if(n!==null){const s=V.find(i=>i.id===n);s&&o({mode:s.mode||"",minutes:s.minutes?.toString()||"",cards:s.cards?.toString()||"",confusions:Oe(s.confusions).join(", "),weakAnchors:Oe(s.weakAnchors).join(", "),concepts:Oe(s.concepts).join(", "),issues:Oe(s.issues).join(", "),notes:s.notes||""})}},[n,V]);const xe=n!==null?V.find(s=>s.id===n):null,ge=typeof window<"u"&&new URLSearchParams(window.location.search).has("debugModals");c.useEffect(()=>{n!==null&&!fe&&!xe&&(ge&&console.warn("[ModalDebug][Brain] Missing session for edit; closing.",{editingSession:n,sessionsCount:V.length}),u(null))},[ge,n,xe,V.length,fe]),c.useEffect(()=>{ge&&console.info("[ModalDebug][Brain] state",{editingSession:n,hasEditingSessionData:!!xe,deleteDialogOpen:h,sessionsToDelete:f.length,sessionsLoading:fe})},[ge,h,n,xe,fe,f.length]);const Hs=()=>{if(n===null)return;const s=R=>R?R.split(",").map(X=>X.trim()).filter(Boolean):[],i=R=>R.length?JSON.stringify(R):null,E={mode:t.mode||"study",minutes:parseInt(t.minutes)||0,cards:parseInt(t.cards)||0,confusions:i(s(t.confusions)),weakAnchors:i(s(t.weakAnchors)),concepts:i(s(t.concepts)),issues:i(s(t.issues)),notes:t.notes||null};zs.mutate({id:n,updates:E})},{data:oe}=L({queryKey:["obsidian","status"],queryFn:w.obsidian.getStatus,refetchInterval:3e4}),{data:Ze}=L({queryKey:["obsidian","config"],queryFn:w.obsidian.getConfig}),{data:Ws}=L({queryKey:["obsidian","vault-index"],queryFn:()=>w.obsidian.getVaultIndex(),enabled:oe?.connected===!0}),{data:Js,refetch:ma}=L({queryKey:["obsidian","files",m],queryFn:()=>w.obsidian.getFiles(m),enabled:oe?.connected===!0}),qe=async s=>{try{const i=await w.obsidian.getFile(s);i.success&&i.content!==void 0&&(b(s),T(i.content),y(!1))}catch(i){console.error("Failed to load file:",i)}},Ys=async(s,i)=>{if(i){const R=Ze?.vaultName||"PT School Semester 2";window.open(`obsidian://open?vault=${encodeURIComponent(R)}&file=${encodeURIComponent(s)}`,"_blank");return}const E=Ws?.paths?.[s];if(E){await qe(E),Y(!0);return}for(const R of ue)try{await qe(`${R.path}/${s}.md`),Y(!0);return}catch{}console.warn(`Note not found: ${s}`)},Gs=async()=>{if(l){H(!0);try{(await w.obsidian.saveFile(l,j)).success&&y(!1)}catch(s){console.error("Failed to save file:",s)}finally{H(!1)}}},ye=s=>{v(s),b(null),T("")},Qs=()=>{const s=new Date().toISOString().split("T")[0],i=m?`${m}/Session-${s}.md`:`Session-${s}.md`,E=`# Study Session - ${s}

## Summary


## Concepts Covered
- 

## Strengths
- 

## Areas to Review
- 

## Notes

`;b(i),T(E),y(!0)},{data:ae,isLoading:Zs,refetch:Xe}=L({queryKey:["anki","status"],queryFn:w.anki.getStatus,refetchInterval:3e4}),{data:Xs}=L({queryKey:["anki","due"],queryFn:w.anki.getDue,enabled:ae?.connected===!0}),{data:et=[],refetch:ke}=L({queryKey:["anki","drafts"],queryFn:w.anki.getDrafts}),le=et.filter(s=>s.status==="pending"),Le=U({mutationFn:w.anki.sync,onSuccess:()=>{be.invalidateQueries({queryKey:["anki"]}),ke()}}),es=U({mutationFn:s=>w.anki.approveDraft(s),onSuccess:()=>{ke()}}),ss=U({mutationFn:s=>w.anki.deleteDraft(s),onSuccess:()=>{ke()}}),$e=U({mutationFn:({id:s,data:i})=>w.anki.updateDraft(s,i),onSuccess:()=>{ke(),g(null)}}),st=s=>{g(s.id),q({front:s.front,back:s.back,deckName:s.deckName})},tt=()=>{S!==null&&$e.mutate({id:S,data:A})};return e.jsxs(dt,{children:[ge&&e.jsxs("div",{className:"fixed bottom-12 right-4 z-[70] bg-black/80 border border-primary text-primary font-terminal text-[10px] px-2 py-1 rounded-none",children:[e.jsx("div",{children:"Brain modals"}),e.jsxs("div",{children:["Edit session: ",n??"none"]}),e.jsxs("div",{children:["Edit data: ",xe?"yes":"no"]}),e.jsxs("div",{children:["Delete open: ",h?"yes":"no"]}),e.jsxs("div",{children:["Delete count: ",f.length]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h1",{className:"font-arcade text-xl text-primary flex items-center gap-2",children:[e.jsx(mt,{className:"w-6 h-6"}),"BRAIN ANALYTICS"]})}),e.jsx(ca,{}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-arcade text-lg text-primary mb-4",children:"SYSTEM STATUS"}),e.jsx(G,{className:"brain-card rounded-none",children:e.jsx(Q,{className:"p-3",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-3 font-terminal text-xs",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${oe?.connected?"bg-green-500":"bg-red-500"}`}),e.jsx("span",{className:"text-muted-foreground",children:"Obsidian"}),e.jsx("span",{className:"text-primary",children:oe?.connected?"Online":"Offline"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${ae?.connected?"bg-green-500":"bg-red-500"}`}),e.jsx("span",{className:"text-muted-foreground",children:"Anki"}),e.jsx("span",{className:"text-primary",children:ae?.connected?"Connected":"Offline"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-muted-foreground",children:[e.jsxs("span",{children:["Cards: ",e.jsx("span",{className:"text-primary",children:Qe?.totalCards||0})]}),e.jsxs("span",{children:["Drafts: ",e.jsx("span",{className:"text-primary",children:le.length})]})]})]})})})]}),e.jsxs(bt,{defaultValue:"ingestion",className:"w-full",children:[e.jsxs(gt,{className:"grid w-full grid-cols-4 rounded-none bg-black border border-secondary/40",children:[e.jsx(Ee,{value:"ingestion",className:"font-arcade text-xs rounded-none data-[state=active]:bg-primary/20 data-[state=active]:text-primary",children:"INGESTION"}),e.jsx(Ee,{value:"data",className:"font-arcade text-xs rounded-none data-[state=active]:bg-primary/20 data-[state=active]:text-primary",children:"DATA"}),e.jsx(Ee,{value:"integrations",className:"font-arcade text-xs rounded-none data-[state=active]:bg-primary/20 data-[state=active]:text-primary",children:"INTEGRATIONS"}),e.jsx(Ee,{value:"syllabus",className:"font-arcade text-xs rounded-none data-[state=active]:bg-primary/20 data-[state=active]:text-primary",children:"SYLLABUS VIEW"})]}),e.jsx(Te,{value:"ingestion",className:"border border-t-0 border-secondary/40 rounded-none",children:e.jsx(oa,{})}),e.jsx(Te,{value:"data",className:"border border-t-0 border-secondary/40 rounded-none",children:e.jsx(la,{})}),e.jsx(Te,{value:"integrations",className:"border border-t-0 border-secondary/40 rounded-none",children:e.jsxs("div",{className:"space-y-4 p-4 min-w-0",children:[e.jsxs(G,{className:"brain-card rounded-none",children:[e.jsxs(de,{className:"border-b border-secondary/50 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(me,{className:"font-arcade text-sm flex items-center gap-2",children:[e.jsx(Ct,{className:"w-4 h-4"}),"OBSIDIAN VAULT",oe?.connected?e.jsx(Ae,{className:"w-3 h-3 text-green-500"}):e.jsx(je,{className:"w-3 h-3 text-red-500"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(F,{size:"sm",variant:"outline",className:"h-6 px-2 rounded-none font-terminal text-xs",onClick:Qs,disabled:!oe?.connected,children:[e.jsx(kt,{className:"w-3 h-3 mr-1"}),"New Note"]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:D,onChange:s=>k(s.target.checked),disabled:!oe?.connected,className:"w-4 h-4 accent-primary"}),e.jsx("span",{className:"font-terminal text-xs",children:"Auto-Sync"})]})]})]}),e.jsx("div",{className:"flex items-center gap-1 mt-2 flex-wrap",children:ue.map(s=>e.jsx(F,{size:"sm",variant:m===s.path?"default":"outline",className:"h-6 px-2 rounded-none font-terminal text-xs",onClick:()=>ye(s.path),children:s.name},s.path))}),m&&e.jsxs("div",{className:"flex items-center gap-1 mt-2 font-terminal text-xs text-muted-foreground",children:[e.jsx("button",{onClick:()=>ye(""),className:"hover:text-primary",children:"vault"}),m.split("/").map((s,i,E)=>e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ut,{className:"w-3 h-3"}),e.jsx("button",{onClick:()=>ye(E.slice(0,i+1).join("/")),className:"hover:text-primary",children:s})]},i))]})]}),e.jsx(Q,{className:"p-0",children:oe?.connected?e.jsxs("div",{className:"grid md:grid-cols-2 h-[240px] md:h-[300px]",children:[e.jsx("div",{className:"border-r border-secondary/30",children:e.jsx(pe,{className:"h-[240px] md:h-[300px]",children:e.jsxs("div",{className:"p-2 space-y-1",children:[m&&e.jsxs("button",{onClick:()=>{const s=m.split("/");s.pop(),ye(s.join("/"))},className:"w-full flex items-center gap-2 p-2 hover:bg-secondary/20 font-terminal text-xs text-muted-foreground",children:[e.jsx(cs,{className:"w-3 h-3"}),".."]}),Js?.files?.map(s=>{const i=typeof s=="string"?s:s.path,E=i.endsWith("/"),R=i.replace(/\/$/,"").split("/").pop()||i;return e.jsxs("button",{onClick:()=>{if(E){const X=R.replace(/\/$/,"");ye(m?`${m}/${X}`:X)}else{const X=m?`${m}/${R}`:R;qe(X)}},className:`w-full flex items-center gap-2 p-2 hover:bg-secondary/20 font-terminal text-xs ${l?.endsWith(R)?"bg-primary/20 text-primary":""}`,children:[E?e.jsx(cs,{className:"w-3 h-3 text-yellow-500"}):e.jsx(Mt,{className:"w-3 h-3 text-blue-400"}),R]},i)})]})})}),e.jsx("div",{className:"flex flex-col h-[240px] md:h-[300px]",children:l?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between p-2 border-b border-secondary/30",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsxs("span",{className:"font-terminal text-xs text-primary truncate",children:[l.split("/").pop(),te&&e.jsx("span",{className:"text-yellow-500 ml-1",children:"*"})]}),e.jsx("button",{onClick:()=>{const s=Ze?.vaultName||"PT School Semester 2",i=l.replace(/\.md$/,"");window.open(`obsidian://open?vault=${encodeURIComponent(s)}&file=${encodeURIComponent(i)}`,"_blank")},className:"text-muted-foreground hover:text-primary shrink-0",title:"Open in Obsidian app",children:e.jsx(vt,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(F,{size:"sm",variant:"ghost",className:"h-6 px-2 text-[10px]",onClick:()=>Y(!C),children:C?"Edit":"Preview"}),e.jsxs(F,{size:"sm",variant:"ghost",onClick:Gs,disabled:!te||M,className:"h-6 px-2",children:[e.jsx(ze,{className:"w-3 h-3 mr-1"}),M?"Saving...":"Save"]})]})]}),C?e.jsx("div",{className:"flex-1 w-full p-3 bg-black/60 font-terminal text-sm overflow-y-auto whitespace-pre-wrap",children:j.split(`
`).map((s,i)=>e.jsx("div",{children:s.split(/(\[\[.*?\]\])/g).map((E,R)=>{const X=E.match(/^\[\[(.*?)\]\]$/);return X?e.jsx("span",{className:"text-blue-400 hover:text-blue-300 cursor-pointer underline decoration-dotted",onClick:at=>Ys(X[1],at.shiftKey),title:`${X[1]} (Shift+click for Obsidian app)`,children:X[1]},R):e.jsx("span",{children:E},R)})},i))}):e.jsx("textarea",{value:j,onChange:s=>{T(s.target.value),y(!0)},className:"flex-1 w-full p-3 bg-black/60 font-terminal text-sm resize-none focus:outline-none focus:ring-1 focus:ring-primary",placeholder:"File content..."})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center font-terminal text-xs text-muted-foreground",children:"Select a file to edit"})})]}):e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("p",{className:"font-terminal text-xs text-red-400 mb-2",children:"Obsidian Offline"}),e.jsx("p",{className:"font-terminal text-xs text-muted-foreground",children:"Open Obsidian with Local REST API plugin enabled"})]})})]}),e.jsxs(G,{className:"brain-card rounded-none",children:[e.jsx(de,{className:"border-b border-secondary/50 p-3",children:e.jsxs(me,{className:"font-arcade text-xs flex items-center gap-2 text-muted-foreground",children:[e.jsx(We,{className:"w-3 h-3"}),"ANKI INTEGRATION",ae?.connected?e.jsx(Ae,{className:"w-3 h-3 text-green-500 ml-auto"}):e.jsx(je,{className:"w-3 h-3 text-red-500 ml-auto"})]})}),e.jsx(Q,{className:"p-4 space-y-3",children:Zs?e.jsx("p",{className:"font-terminal text-xs text-muted-foreground",children:"Checking Anki..."}):ae?.connected?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-terminal text-xs text-muted-foreground",children:"Status:"}),e.jsx(_e,{variant:"outline",className:"bg-green-500/20 text-green-400 border-green-500",children:"Connected"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-terminal text-xs text-muted-foreground",children:"Cards Created:"}),e.jsx("span",{className:"font-arcade text-xs text-primary",children:Qe?.totalCards||0})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-terminal text-xs text-muted-foreground",children:"Due Today:"}),e.jsx("span",{className:"font-arcade text-xs text-secondary",children:Xs?.dueCount||0})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-terminal text-xs text-muted-foreground",children:"Reviewed Today:"}),e.jsx("span",{className:"font-arcade text-xs text-muted-foreground",children:ae.reviewedToday||0})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-terminal text-xs text-muted-foreground",children:"Decks:"}),e.jsx("span",{className:"font-arcade text-xs text-muted-foreground",children:ae.decks?.length||0})]}),e.jsxs("div",{className:"pt-2 flex gap-2",children:[e.jsxs(F,{size:"sm",variant:"outline",className:"flex-1 font-terminal text-xs",onClick:()=>Xe(),children:[e.jsx(is,{className:"w-3 h-3 mr-1"}),"Refresh"]}),e.jsx(F,{size:"sm",className:"flex-1 font-terminal text-xs bg-secondary hover:bg-secondary/80",onClick:()=>Le.mutate(),disabled:Le.isPending,children:Le.isPending?"Syncing...":"Sync Cards"})]}),le.length>0&&e.jsxs("div",{className:"pt-3 border-t border-secondary/30",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{className:"font-arcade text-[10px] text-yellow-400",children:["PENDING CARDS (",le.length,")"]}),e.jsx("div",{className:"flex gap-1",children:e.jsx(F,{size:"sm",variant:"outline",className:"h-5 px-2 text-[10px] font-terminal",onClick:()=>{N.size===le.length?d(new Set):d(new Set(le.map(s=>s.id)))},children:N.size===le.length?"None":"All"})})]}),N.size>0&&e.jsxs("div",{className:"flex gap-1 mb-2",children:[e.jsxs(F,{size:"sm",className:"h-6 px-2 text-[10px] font-terminal bg-green-600 hover:bg-green-700",onClick:()=>{N.forEach(s=>es.mutate(s)),d(new Set)},children:[e.jsx(Ae,{className:"w-3 h-3 mr-1"}),"Approve (",N.size,")"]}),e.jsxs(F,{size:"sm",variant:"destructive",className:"h-6 px-2 text-[10px] font-terminal",onClick:()=>{N.forEach(s=>ss.mutate(s)),d(new Set)},children:[e.jsx(he,{className:"w-3 h-3 mr-1"}),"Delete (",N.size,")"]})]}),e.jsx(pe,{className:"h-[200px]",children:e.jsx("div",{className:"space-y-2",children:le.map(s=>e.jsx("div",{className:`p-2 bg-black/40 border text-xs ${N.has(s.id)?"border-primary":"border-secondary/30"}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ce,{checked:N.has(s.id),onCheckedChange:i=>{const E=new Set(N);i?E.add(s.id):E.delete(s.id),d(E)},className:"mt-1 border-secondary data-[state=checked]:bg-primary"}),e.jsxs("div",{className:"flex-1 min-w-0 overflow-hidden",children:[e.jsx("div",{className:"font-terminal text-primary truncate",children:s.front}),e.jsx("div",{className:"font-terminal text-muted-foreground mt-1 truncate",children:s.back}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(_e,{variant:"outline",className:"text-[9px] border-blue-500/50 text-blue-400 shrink-0",children:s.deckName}),e.jsx(F,{size:"icon",variant:"outline",className:"h-5 w-5 shrink-0 border-yellow-500/50 text-yellow-400 hover:bg-yellow-500/20",onClick:()=>st(s),title:"Edit card",children:e.jsx(De,{className:"w-3 h-3"})}),e.jsx(F,{size:"icon",variant:"outline",className:"h-5 w-5 shrink-0 border-green-500/50 text-green-400 hover:bg-green-500/20",onClick:()=>es.mutate(s.id),title:"Approve card",children:e.jsx(Ae,{className:"w-3 h-3"})}),e.jsx(F,{size:"icon",variant:"outline",className:"h-5 w-5 shrink-0 border-red-500/50 text-red-400 hover:bg-red-500/20",onClick:()=>ss.mutate(s.id),title:"Delete card",children:e.jsx(he,{className:"w-3 h-3"})})]})]})]})},s.id))})})]})]}):e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("p",{className:"font-terminal text-xs text-red-400",children:ae?.error||"Anki not connected"}),e.jsx("p",{className:"font-terminal text-xs text-muted-foreground",children:"Open Anki with AnkiConnect plugin"}),e.jsxs(F,{size:"sm",variant:"outline",className:"font-terminal text-xs",onClick:()=>Xe(),children:[e.jsx(is,{className:"w-3 h-3 mr-1"}),"Retry"]})]})})]})]})}),e.jsx(Te,{value:"syllabus",className:"border border-t-0 border-secondary/40 rounded-none",children:e.jsx(ia,{})})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-arcade text-lg text-primary mb-4",children:"SESSION EVIDENCE"}),e.jsx(G,{className:"brain-card rounded-none",children:e.jsxs(Q,{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-5 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-arcade text-primary mb-2 block",children:"Semester"}),e.jsxs(Ne,{value:O,onValueChange:s=>{I(s);const i=new URLSearchParams(window.location.search);s==="all"?i.delete("semester"):i.set("semester",s),window.history.replaceState({},"",`?${i.toString()}`)},children:[e.jsx(ve,{className:"rounded-none border-primary",children:e.jsx(we,{})}),e.jsxs(Se,{className:"bg-black border-primary",children:[e.jsx($,{value:"all",children:"All"}),e.jsx($,{value:"1",children:"Semester 1 (Fall 2025)"}),e.jsx($,{value:"2",children:"Semester 2 (Spring 2026)"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-arcade text-primary mb-2 block",children:"Course"}),e.jsxs(Ne,{value:P,onValueChange:s=>J(s),children:[e.jsx(ve,{className:"rounded-none border-primary",children:e.jsx(we,{})}),e.jsxs(Se,{className:"bg-black border-primary",children:[e.jsx($,{value:"all",children:"All"}),Z.map(s=>e.jsx($,{value:String(s.id),children:s.name},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-arcade text-primary mb-2 block",children:"Start Date"}),e.jsx(Ie,{type:"date",value:_,onChange:s=>{B(s.target.value);const i=new URLSearchParams(window.location.search);s.target.value?i.set("start",s.target.value):i.delete("start"),window.history.replaceState({},"",`?${i.toString()}`)},className:"rounded-none border-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-arcade text-primary mb-2 block",children:"End Date"}),e.jsx(Ie,{type:"date",value:z,onChange:s=>{K(s.target.value);const i=new URLSearchParams(window.location.search);s.target.value?i.set("end",s.target.value):i.delete("end"),window.history.replaceState({},"",`?${i.toString()}`)},className:"rounded-none border-primary"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(F,{variant:"outline",onClick:()=>{I("all"),J("all"),B(""),K(""),window.history.replaceState({},"",window.location.pathname)},className:"rounded-none border-primary w-full",children:"Clear Filters"})})]}),fe?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"font-terminal text-xs text-muted-foreground",children:"Loading sessions..."})}):V.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"font-terminal text-xs text-muted-foreground",children:"No sessions found"})}):e.jsx(pe,{className:"h-[400px]",children:e.jsxs(vs,{children:[e.jsx(ws,{children:e.jsxs(Be,{className:"border-secondary/30",children:[e.jsx(ne,{className:"w-12",children:e.jsx(ce,{checked:a.size===V.length&&V.length>0,onCheckedChange:Bs,className:"border-secondary"})}),e.jsx(ne,{className:"font-arcade text-xs text-primary",children:"Date"}),e.jsx(ne,{className:"font-arcade text-xs text-primary",children:"Course"}),e.jsx(ne,{className:"font-arcade text-xs text-primary",children:"Mode"}),e.jsx(ne,{className:"font-arcade text-xs text-primary",children:"Minutes"}),e.jsx(ne,{className:"font-arcade text-xs text-primary",children:"Cards"}),e.jsx(ne,{className:"font-arcade text-xs text-primary",children:"Concepts"}),e.jsx(ne,{className:"font-arcade text-xs text-primary",children:"Actions"})]})}),e.jsx(Ss,{children:V.filter(s=>P==="all"||String(s.courseId)===P).map(s=>e.jsxs(Be,{className:"border-secondary/30 hover:bg-secondary/10",children:[e.jsx(re,{children:e.jsx(ce,{checked:a.has(s.id),onCheckedChange:()=>_s(s.id),className:"border-secondary"})}),e.jsx(re,{className:"font-terminal text-xs",children:da(s.createdAt,"MMM dd, yyyy")}),e.jsx(re,{className:"font-terminal text-xs text-muted-foreground",children:s.topic||"-"}),e.jsx(re,{className:"font-terminal text-xs text-muted-foreground",children:s.mode||"-"}),e.jsx(re,{className:"font-terminal text-xs text-muted-foreground",children:s.minutes||"-"}),e.jsx(re,{className:"font-terminal text-xs text-muted-foreground",children:s.cards||"-"}),e.jsx(re,{className:"font-terminal text-xs text-muted-foreground",children:Array.isArray(s.concepts)?s.concepts.length:0}),e.jsxs(re,{className:"flex gap-1",children:[e.jsx(F,{size:"icon",variant:"outline",className:"h-6 w-6 border-yellow-500/50 text-yellow-400 hover:bg-yellow-500/20",onClick:()=>u(s.id),children:e.jsx(De,{className:"w-3 h-3"})}),e.jsx(F,{size:"icon",variant:"outline",className:"h-6 w-6 border-red-500/50 text-red-400 hover:bg-red-500/20",onClick:()=>Vs(s.id),children:e.jsx(he,{className:"w-3 h-3"})})]})]},s.id))})]})}),a.size>0&&e.jsx("div",{className:"flex gap-2 pt-4 border-t border-secondary/30",children:e.jsxs(F,{size:"sm",className:"flex-1 font-terminal text-xs bg-red-600 hover:bg-red-700",onClick:Ks,children:[e.jsx(he,{className:"w-3 h-3 mr-1"}),"Delete Selected (",a.size,")"]})})]})})]})]})]}),e.jsx(ts,{open:!!xe,onOpenChange:s=>{s||u(null)},children:e.jsxs(as,{"data-modal":"brain-edit-session",className:"bg-black border-2 border-primary rounded-none max-w-2xl translate-y-0",style:{zIndex:100005,top:"6rem",left:"50%",transform:"translate(-50%, 0)"},children:[e.jsxs(ns,{children:[e.jsxs(rs,{className:"font-arcade text-primary flex items-center gap-2",children:[e.jsx(De,{className:"w-5 h-5"}),"EDIT SESSION #",n]}),e.jsx(os,{className:"font-terminal text-muted-foreground",children:"Update WRAP methodology fields for this study session"})]}),e.jsxs("div",{className:"space-y-4 font-terminal",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Mode"}),e.jsxs(Ne,{value:t.mode,onValueChange:s=>o(i=>({...i,mode:s})),children:[e.jsx(ve,{className:"rounded-none border-secondary",children:e.jsx(we,{placeholder:"Select mode"})}),e.jsxs(Se,{className:"rounded-none border-secondary bg-black",children:[e.jsx($,{value:"Core",children:"Core"}),e.jsx($,{value:"Sprint",children:"Sprint"}),e.jsx($,{value:"Drill",children:"Drill"}),e.jsx($,{value:"study",children:"Study"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Minutes"}),e.jsx(Ie,{type:"number",value:t.minutes,onChange:s=>o(i=>({...i,minutes:s.target.value})),className:"rounded-none border-secondary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Cards"}),e.jsx(Ie,{type:"number",value:t.cards,onChange:s=>o(i=>({...i,cards:s.target.value})),className:"rounded-none border-secondary"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Confusions (comma-separated)"}),e.jsx(ie,{value:t.confusions,onChange:s=>o(i=>({...i,confusions:s.target.value})),placeholder:"e.g., muscle insertion points, nerve pathways",className:"rounded-none border-secondary min-h-[60px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Weak Anchors (comma-separated)"}),e.jsx(ie,{value:t.weakAnchors,onChange:s=>o(i=>({...i,weakAnchors:s.target.value})),placeholder:"e.g., brachial plexus diagram, ROM measurements",className:"rounded-none border-secondary min-h-[60px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Concepts (comma-separated)"}),e.jsx(ie,{value:t.concepts,onChange:s=>o(i=>({...i,concepts:s.target.value})),placeholder:"e.g., upper extremity anatomy, peripheral nerves",className:"rounded-none border-secondary min-h-[60px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Issues (comma-separated)"}),e.jsx(ie,{value:t.issues,onChange:s=>o(i=>({...i,issues:s.target.value})),placeholder:"e.g., interrupted by phone, lost focus after 30 min",className:"rounded-none border-secondary min-h-[60px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Notes"}),e.jsx(ie,{value:t.notes,onChange:s=>o(i=>({...i,notes:s.target.value})),placeholder:"Free-form observations about the session",className:"rounded-none border-secondary min-h-[80px]"})]})]}),e.jsxs(ls,{className:"gap-2",children:[e.jsxs(F,{variant:"outline",onClick:()=>u(null),className:"font-terminal rounded-none border-secondary hover:bg-secondary/20",children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"Cancel"]}),e.jsxs(F,{onClick:Hs,className:"font-terminal rounded-none bg-primary hover:bg-primary/80",children:[e.jsx(ze,{className:"w-4 h-4 mr-2"}),"Save Changes"]})]})]})}),e.jsx(hs,{open:h&&f.length>0,onOpenChange:x,children:e.jsxs(ps,{"data-modal":"brain-delete-session",className:"bg-black border-2 border-destructive rounded-none translate-y-0",style:{zIndex:100005,top:"6rem",left:"50%",transform:"translate(-50%, 0)"},children:[e.jsxs(fs,{children:[e.jsxs(bs,{className:"font-arcade text-destructive flex items-center gap-2",children:[e.jsx(he,{className:"w-5 h-5"}),"CONFIRM DELETE"]}),e.jsxs(gs,{className:"font-terminal text-muted-foreground",children:["Are you sure you want to delete ",f.length," session",f.length!==1?"s":"","? This action cannot be undone."]})]}),e.jsxs(ys,{className:"gap-2",children:[e.jsx(js,{className:"font-terminal rounded-none border-secondary hover:bg-secondary/20",children:"Cancel"}),e.jsxs(Ns,{onClick:Us,className:"font-terminal rounded-none bg-destructive hover:bg-destructive/80 text-destructive-foreground",children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]})}),e.jsx(ts,{open:S!==null,onOpenChange:s=>{s||g(null)},children:e.jsxs(as,{"data-modal":"brain-edit-draft",className:"bg-black border-2 border-primary rounded-none max-w-lg translate-y-0",style:{zIndex:100005,top:"6rem",left:"50%",transform:"translate(-50%, 0)"},children:[e.jsxs(ns,{children:[e.jsxs(rs,{className:"font-arcade text-primary flex items-center gap-2",children:[e.jsx(De,{className:"w-5 h-5"}),"EDIT CARD"]}),e.jsx(os,{className:"font-terminal text-muted-foreground",children:"Edit card content and select target deck"})]}),e.jsxs("div",{className:"space-y-4 font-terminal",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Front (Question)"}),e.jsx(ie,{value:A.front,onChange:s=>q(i=>({...i,front:s.target.value})),placeholder:"Card front...",className:"rounded-none border-secondary min-h-[80px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Back (Answer)"}),e.jsx(ie,{value:A.back,onChange:s=>q(i=>({...i,back:s.target.value})),placeholder:"Card back...",className:"rounded-none border-secondary min-h-[80px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Target Deck"}),e.jsxs(Ne,{value:A.deckName,onValueChange:s=>q(i=>({...i,deckName:s})),children:[e.jsx(ve,{className:"rounded-none border-secondary",children:e.jsx(we,{placeholder:"Select deck"})}),e.jsxs(Se,{className:"rounded-none border-secondary bg-black max-h-[200px]",children:[e.jsx($,{value:"PT::EBP",children:"PT::EBP (Evidence Based Practice)"}),e.jsx($,{value:"PT::ExPhys",children:"PT::ExPhys (Exercise Physiology)"}),e.jsx($,{value:"PT::MS1",children:"PT::MS1 (Movement Science 1)"}),e.jsx($,{value:"PT::Neuro",children:"PT::Neuro (Neuroscience)"}),e.jsx($,{value:"PT::TI",children:"PT::TI (Therapeutic Intervention)"}),e.jsx($,{value:"PT::General",children:"PT::General"}),ae?.decks?.filter(s=>!s.startsWith("PT::")).map(s=>e.jsx($,{value:s,children:s},s))]})]}),e.jsxs("p",{className:"text-[10px] text-muted-foreground mt-1",children:["Current: ",e.jsx("span",{className:"text-blue-400",children:A.deckName})]})]})]}),e.jsxs(ls,{className:"gap-2",children:[e.jsxs(F,{variant:"outline",onClick:()=>g(null),className:"font-terminal rounded-none border-secondary hover:bg-secondary/20",children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"Cancel"]}),e.jsxs(F,{onClick:tt,disabled:$e.isPending,className:"font-terminal rounded-none bg-primary hover:bg-primary/80",children:[e.jsx(ze,{className:"w-4 h-4 mr-2"}),$e.isPending?"Saving...":"Save"]})]})]})})]})}export{Ca as default};
