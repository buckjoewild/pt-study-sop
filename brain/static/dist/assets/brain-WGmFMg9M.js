import{c as Ee,r as l,j as e,b as G,R as Ys,d as Gs,e as W,f as Qs,P as as,g as Xs,u as Ke,X as fe}from"./index-CIgktY2R.js";import{h as Zs,i as et,j as ns,u as B,a as H,g as A,S as ue,B as F,L as st,k as tt,C as ge,f as at,l as Re,T as me,P as ye,I as je,D as Je,c as Ye,d as Ge,e as Qe,m as Xe,n as ne,o as Ze}from"./layout-DnWIljps.js";import{C as J,a as oe,b as le,c as Y}from"./card-BuBbwj-d.js";import{e as nt,S as we,a as Ce,b as ke,c as Ae,d as U,C as rt}from"./select-DNYwCH-v.js";import{B as Me,S as ot,R as es}from"./badge-kRIot6Sk.js";import{T as lt,a as dt,b as Ne,c as ve}from"./tabs-CXjBf4VU.js";import{c as rs,R as ct,T as it,C as mt,a as re}from"./index-BdG-sLSo.js";import{A as os,a as ls,b as ds,c as cs,d as is,e as ms,f as us,g as xs}from"./alert-dialog-CVa-yy6W.js";import{L as ut}from"./loader-circle-BPbtM-_x.js";import{F as xt,a as ss}from"./folder-Bfxr_UIQ.js";import{F as ht}from"./file-text-Y5A7a6sq.js";import{i as pt,f as ft}from"./format-D7m0hUtg.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],gt=Ee("database",bt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yt=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]],jt=Ee("file",yt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nt=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],vt=Ee("image",Nt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const St=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],hs=Ee("layers",St),ps=l.forwardRef(({className:a,...r},n)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:n,className:G("w-full caption-bottom text-sm",a),...r})}));ps.displayName="Table";const fs=l.forwardRef(({className:a,...r},n)=>e.jsx("thead",{ref:n,className:G("[&_tr]:border-b",a),...r}));fs.displayName="TableHeader";const bs=l.forwardRef(({className:a,...r},n)=>e.jsx("tbody",{ref:n,className:G("[&_tr:last-child]:border-0",a),...r}));bs.displayName="TableBody";const wt=l.forwardRef(({className:a,...r},n)=>e.jsx("tfoot",{ref:n,className:G("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...r}));wt.displayName="TableFooter";const Fe=l.forwardRef(({className:a,...r},n)=>e.jsx("tr",{ref:n,className:G("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a),...r}));Fe.displayName="TableRow";const ee=l.forwardRef(({className:a,...r},n)=>e.jsx("th",{ref:n,className:G("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",a),...r}));ee.displayName="TableHead";const se=l.forwardRef(({className:a,...r},n)=>e.jsx("td",{ref:n,className:G("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",a),...r}));se.displayName="TableCell";const Ct=l.forwardRef(({className:a,...r},n)=>e.jsx("caption",{ref:n,className:G("mt-4 text-sm text-muted-foreground",a),...r}));Ct.displayName="TableCaption";function kt(a,r,{checkForDefaultPrevented:n=!0}={}){return function(f){if(a?.(f),n===!1||!f.defaultPrevented)return r?.(f)}}var At=Ys[" useInsertionEffect ".trim().toString()]||Gs;function gs({prop:a,defaultProp:r,onChange:n=()=>{},caller:i}){const[f,u,x]=Dt({defaultProp:r,onChange:n}),h=a!==void 0,O=h?a:f;{const g=l.useRef(a!==void 0);l.useEffect(()=>{const c=g.current;c!==h&&console.warn(`${i} is changing from ${c?"controlled":"uncontrolled"} to ${h?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),g.current=h},[h,i])}const D=l.useCallback(g=>{if(h){const c=Et(g)?g(a):g;c!==a&&x.current?.(c)}else u(g)},[h,a,u,x]);return[O,D]}function Dt({defaultProp:a,onChange:r}){const[n,i]=l.useState(a),f=l.useRef(n),u=l.useRef(r);return At(()=>{u.current=r},[r]),l.useEffect(()=>{f.current!==n&&(u.current?.(n),f.current=n)},[n,f]),[n,i,u]}function Et(a){return typeof a=="function"}var Q="Accordion",Tt=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[$e,It,Ot]=nt(Q),[Te]=Qs(Q,[Ot,rs]),Be=rs(),ys=W.forwardRef((a,r)=>{const{type:n,...i}=a,f=i,u=i;return e.jsx($e.Provider,{scope:a.__scopeAccordion,children:n==="multiple"?e.jsx(Ft,{...u,ref:r}):e.jsx(Mt,{...f,ref:r})})});ys.displayName=Q;var[js,Pt]=Te(Q),[Ns,Rt]=Te(Q,{collapsible:!1}),Mt=W.forwardRef((a,r)=>{const{value:n,defaultValue:i,onValueChange:f=()=>{},collapsible:u=!1,...x}=a,[h,O]=gs({prop:n,defaultProp:i??"",onChange:f,caller:Q});return e.jsx(js,{scope:a.__scopeAccordion,value:W.useMemo(()=>h?[h]:[],[h]),onItemOpen:O,onItemClose:W.useCallback(()=>u&&O(""),[u,O]),children:e.jsx(Ns,{scope:a.__scopeAccordion,collapsible:u,children:e.jsx(vs,{...x,ref:r})})})}),Ft=W.forwardRef((a,r)=>{const{value:n,defaultValue:i,onValueChange:f=()=>{},...u}=a,[x,h]=gs({prop:n,defaultProp:i??[],onChange:f,caller:Q}),O=W.useCallback(g=>h((c=[])=>[...c,g]),[h]),D=W.useCallback(g=>h((c=[])=>c.filter(E=>E!==g)),[h]);return e.jsx(js,{scope:a.__scopeAccordion,value:x,onItemOpen:O,onItemClose:D,children:e.jsx(Ns,{scope:a.__scopeAccordion,collapsible:!0,children:e.jsx(vs,{...u,ref:r})})})}),[Lt,Ie]=Te(Q),vs=W.forwardRef((a,r)=>{const{__scopeAccordion:n,disabled:i,dir:f,orientation:u="vertical",...x}=a,h=W.useRef(null),O=Xs(h,r),D=It(n),c=et(f)==="ltr",E=kt(a.onKeyDown,b=>{if(!Tt.includes(b.key))return;const T=b.target,q=D().filter(t=>!t.ref.current?.disabled),L=q.findIndex(t=>t.ref.current===T),I=q.length;if(L===-1)return;b.preventDefault();let R=L;const j=0,C=I-1,k=()=>{R=L+1,R>C&&(R=j)},y=()=>{R=L-1,R<j&&(R=C)};switch(b.key){case"Home":R=j;break;case"End":R=C;break;case"ArrowRight":u==="horizontal"&&(c?k():y());break;case"ArrowDown":u==="vertical"&&k();break;case"ArrowLeft":u==="horizontal"&&(c?y():k());break;case"ArrowUp":u==="vertical"&&y();break}const P=R%I;q[P].ref.current?.focus()});return e.jsx(Lt,{scope:n,disabled:i,direction:f,orientation:u,children:e.jsx($e.Slot,{scope:n,children:e.jsx(as.div,{...x,"data-orientation":u,ref:O,onKeyDown:i?void 0:E})})})}),De="AccordionItem",[qt,Ve]=Te(De),Ss=W.forwardRef((a,r)=>{const{__scopeAccordion:n,value:i,...f}=a,u=Ie(De,n),x=Pt(De,n),h=Be(n),O=Zs(),D=i&&x.value.includes(i)||!1,g=u.disabled||a.disabled;return e.jsx(qt,{scope:n,open:D,disabled:g,triggerId:O,children:e.jsx(ct,{"data-orientation":u.orientation,"data-state":Es(D),...h,...f,ref:r,disabled:g,open:D,onOpenChange:c=>{c?x.onItemOpen(i):x.onItemClose(i)}})})});Ss.displayName=De;var ws="AccordionHeader",Cs=W.forwardRef((a,r)=>{const{__scopeAccordion:n,...i}=a,f=Ie(Q,n),u=Ve(ws,n);return e.jsx(as.h3,{"data-orientation":f.orientation,"data-state":Es(u.open),"data-disabled":u.disabled?"":void 0,...i,ref:r})});Cs.displayName=ws;var Le="AccordionTrigger",ks=W.forwardRef((a,r)=>{const{__scopeAccordion:n,...i}=a,f=Ie(Q,n),u=Ve(Le,n),x=Rt(Le,n),h=Be(n);return e.jsx($e.ItemSlot,{scope:n,children:e.jsx(it,{"aria-disabled":u.open&&!x.collapsible||void 0,"data-orientation":f.orientation,id:u.triggerId,...h,...i,ref:r})})});ks.displayName=Le;var As="AccordionContent",Ds=W.forwardRef((a,r)=>{const{__scopeAccordion:n,...i}=a,f=Ie(Q,n),u=Ve(As,n),x=Be(n);return e.jsx(mt,{role:"region","aria-labelledby":u.triggerId,"data-orientation":f.orientation,...x,...i,ref:r,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...a.style}})});Ds.displayName=As;function Es(a){return a?"open":"closed"}var zt=ys,_t=Ss,Kt=Cs,Ts=ks,Is=Ds;const $t=zt,qe=l.forwardRef(({className:a,...r},n)=>e.jsx(_t,{ref:n,className:G("border-b",a),...r}));qe.displayName="AccordionItem";const ze=l.forwardRef(({className:a,children:r,...n},i)=>e.jsx(Kt,{className:"flex",children:e.jsxs(Ts,{ref:i,className:G("flex flex-1 items-center justify-between py-4 text-sm font-medium transition-all hover:underline text-left [&[data-state=open]>svg]:rotate-180",a),...n,children:[r,e.jsx(ns,{className:"h-4 w-4 shrink-0 text-muted-foreground transition-transform duration-200"})]})}));ze.displayName=Ts.displayName;const _e=l.forwardRef(({className:a,children:r,...n},i)=>e.jsx(Is,{ref:i,className:"overflow-hidden text-sm data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...n,children:e.jsx("div",{className:G("pb-4 pt-0",a),children:r})}));_e.displayName=Is.displayName;const Bt=`You are extracting a full course syllabus for ingestion.

Return ONLY a valid JSON object with NO additional text, NO markdown code blocks, NO explanation.

Top-level structure:
{
  "term": {
    "startDate": "2026-01-05",
    "endDate": "2026-04-24",
    "timezone": "America/Chicago"
  },
  "modules": [
    {
      "name": "Module 1: ...",
      "orderIndex": 1,
      "topics": ["..."],
      "readings": ["..."],
      "assessments": ["..."]
    }
  ],
  "events": [
    {
      "type": "class" | "lecture" | "reading" | "topic" | "assignment" | "quiz" | "exam" | "assessment",
      "title": "string",
      "date": "YYYY-MM-DD",
      "dueDate": "YYYY-MM-DD | null",
      "startTime": "HH:MM | null",
      "endTime": "HH:MM | null",
      "daysOfWeek": ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],
      "delivery": "in_person" | "virtual_sync" | "virtual_async" | "hybrid",
      "assessmentType": "EA | null",
      "moduleName": "Module 1: ... | null",
      "notes": "string | null"
    }
  ]
}

Rules:
1. Include ALL items: class meetings, assignments, quizzes, exams, topics, readings, virtual synchronous/asynchronous activities, and learning assessments (EA).
2. For repeating class meetings, set daysOfWeek + startTime/endTime, and include term start/end.
3. For one-off items, set date or dueDate.
4. Keep moduleName when items belong to a module.
5. Return ONLY the JSON object, nothing else.

Here's my syllabus:

[PASTE YOUR SYLLABUS BELOW]`,Vt=`I need you to extract learning objectives from my course material.

Return ONLY a valid JSON array with NO additional text, NO markdown code blocks, NO explanation.

Structure for each item:
{
  "loCode": "string",
  "title": "string"
}

Rules:
1. loCode: Preserve original numbering if present, or create sequential "1", "2", "3"...
2. title: Keep the objective text exactly as written
3. Return ONLY the JSON array, nothing else

Here are my learning objectives:

[PASTE YOUR LOs BELOW]`,Ut=`I need you to convert my study session notes into WRAP format.

WRAP format has 4 sections:

Section A: Obsidian Notes
- Main concepts and insights from the session
- Key points to remember

Section B: Anki Cards
- Format: "front: [question]" on one line, "back: [answer]" on next line
- Create cards for important facts and concepts

Section C: Spaced Schedule
- R1=tomorrow
- R2=3d
- R3=1w
- R4=2w

Section D: JSON Logs
\`\`\`json
{
  "merged": {
    "topic": "[main topic]",
    "mode": "Core",
    "duration_minutes": [number],
    "understanding": [1-5],
    "retention": [1-5]
  }
}
\`\`\`

Return ONLY the WRAP formatted content, NO additional text or explanation.

Here are my study notes:

[PASTE YOUR NOTES BELOW]`;function Ht(){const a=Ke(),[r,n]=l.useState(null),[i,f]=l.useState(null),[u,x]=l.useState(""),[h,O]=l.useState(""),[D,g]=l.useState(null),[c,E]=l.useState(""),[b,T]=l.useState(null),[q,L]=l.useState(null),[I,R]=l.useState(null),{data:j=[]}=B({queryKey:["courses"],queryFn:()=>A.courses.getActive()}),{data:C=[]}=B({queryKey:["modules",r],queryFn:()=>r?A.modules.getByCourse(r):Promise.resolve([]),enabled:!!r}),{data:k=[]}=B({queryKey:["learningObjectives",r],queryFn:()=>r?A.learningObjectives.getByCourse(r):Promise.resolve([]),enabled:!!r}),y=H({mutationFn:async d=>{if(!r)throw new Error("Select a course first");const v=JSON.parse(m(d));return A.syllabus.importBulk(r,v)},onSuccess:d=>{a.invalidateQueries({queryKey:["scheduleEvents"]}),a.invalidateQueries({queryKey:["modules"]}),x(""),L({type:"success",message:`Imported: ${d.modulesCreated} modules, ${d.eventsCreated} events (${d.classMeetingsExpanded} class meetings expanded)`}),g(null)},onError:d=>{L({type:"error",message:d.message||"Failed to import syllabus"}),g(d.message||"Failed to import syllabus")}}),P=H({mutationFn:async d=>{if(!r)throw new Error("Select a course first");const v=JSON.parse(m(d));return A.learningObjectives.createBulk(r,i,v)},onSuccess:()=>{a.invalidateQueries({queryKey:["learningObjectives"]}),O(""),g(null)},onError:d=>{g(d.message||"Failed to import LOs")}}),t=d=>{navigator.clipboard.writeText(d)},m=d=>{const v=d.trim();if(!v)return"";const S=v.match(/```json\s*([\s\S]*?)```/i)||v.match(/```\s*([\s\S]*?)```/i),K=S?S[1].trim():v,V=K.indexOf("{"),M=K.lastIndexOf("}");return V!==-1&&M!==-1&&M>V?K.slice(V,M+1).trim():K},N=d=>{const v=[];let S=null;try{const p=m(d);if(!p){v.push("No JSON found in input"),R({isValid:!1,errors:v});return}S=JSON.parse(p)}catch(p){v.push(`Invalid JSON: ${p.message}`),R({isValid:!1,errors:v});return}(!S||typeof S!="object")&&v.push("JSON must be an object");const K=S.name&&typeof S.name=="string"&&S.name.trim(),V=S.term&&typeof S.term=="object",M=Array.isArray(S.modules),Z=Array.isArray(S.events);if(K||v.push("Missing or invalid 'name' field"),V||v.push("Missing or invalid 'term' object"),M||v.push("Missing or invalid 'modules' array"),Z||v.push("Missing or invalid 'events' array"),V&&(S.term.startDate||v.push("term.startDate is required"),S.term.endDate||v.push("term.endDate is required")),v.length===0){const p={courseName:S.name,moduleCount:S.modules?.length||0,eventCount:S.events?.length||0,startDate:S.term?.startDate,endDate:S.term?.endDate};R({isValid:!0,errors:[],preview:p})}else R({isValid:!1,errors:v})},_=async()=>{try{T(null);const d=c,S=await A.brain.ingest(d,"pasted_wrap.md");S.sessionSaved?(T({type:"success",message:`✓ Session saved! ID: ${S.sessionId}, Cards: ${S.cardsCreated||0}`}),E("")):T({type:"error",message:S.errors?.join(", ")||S.message})}catch(d){T({type:"error",message:d.message||"Failed to ingest"})}};return e.jsxs("div",{className:"space-y-6 p-4",children:[e.jsxs("div",{className:"border border-secondary/40 rounded-none p-4 bg-primary/5",children:[e.jsx("h2",{className:"text-xl font-arcade text-primary mb-4",children:"WRAP SESSION INGESTION"}),b&&e.jsx("div",{className:`mb-4 p-3 rounded-none font-terminal text-sm ${b.type==="success"?"bg-green-900/30 border border-green-500 text-green-400":"bg-red-900/30 border border-red-500 text-red-400"}`,children:b.message}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("button",{onClick:()=>t(Ut),className:"bg-primary hover:bg-primary/80 px-3 py-1 rounded-none text-xs font-terminal mb-2",type:"button",children:"Copy Prompt for ChatGPT"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-2 font-terminal",children:"Use ChatGPT to convert your notes to WRAP format, then paste or upload below:"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-2 font-terminal text-muted-foreground",children:"Paste WRAP Content"}),e.jsx("textarea",{className:"w-full bg-black border border-secondary rounded-none p-2 h-48 font-terminal text-sm",placeholder:"Paste your WRAP session here...",value:c,onChange:d=>{E(d.target.value),T(null)}})]}),e.jsx("button",{onClick:_,disabled:!c,className:"bg-primary hover:bg-primary/80 disabled:opacity-50 px-6 py-3 rounded-none font-arcade text-sm w-full",type:"button",children:"INGEST WRAP SESSION"})]})]}),e.jsx("h2",{className:"text-xl font-arcade text-primary",children:"MATERIAL INGESTION"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1 font-terminal text-muted-foreground",children:"Select Course"}),e.jsxs("select",{className:"w-full bg-black border border-secondary rounded-none p-2 font-terminal",value:r||"",onChange:d=>{n(d.target.value?parseInt(d.target.value):null),f(null)},children:[e.jsx("option",{value:"",children:"-- Select Course --"}),j.map(d=>e.jsx("option",{value:d.id,children:d.name},d.id))]})]}),D&&e.jsx("div",{className:"bg-destructive/20 border border-destructive rounded-none p-3 text-destructive font-terminal",children:D}),r&&e.jsxs($t,{type:"multiple",className:"border border-secondary/40 rounded-none divide-y divide-secondary/40",children:[e.jsxs(qe,{value:"syllabus-import",className:"border-secondary/40",children:[e.jsx(ze,{className:"font-arcade text-xs text-primary px-3 hover:no-underline",children:"SYLLABUS IMPORT (MODULES + SCHEDULE)"}),e.jsxs(_e,{className:"px-3",children:[e.jsx("button",{onClick:()=>t(Bt),className:"bg-primary hover:bg-primary/80 px-3 py-1 rounded-none text-xs font-terminal mb-2",type:"button",children:"Copy Prompt for ChatGPT"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-2 font-terminal",children:"Paste the ChatGPT response (combined JSON object) below:"}),e.jsx("textarea",{className:"w-full bg-black border border-secondary rounded-none p-2 h-40 font-terminal text-sm",placeholder:'{"term":{"startDate":"2026-01-15","endDate":"2026-05-01","timezone":"America/Chicago"},"modules":[...],"events":[...]}',value:u,onChange:d=>{x(d.target.value),L(null),d.target.value.trim()?N(d.target.value):R(null)}}),I&&!I.isValid&&e.jsxs("div",{className:"mt-2 p-2 border border-red-500 bg-red-900/30 rounded-none font-terminal text-xs text-red-400",children:[e.jsx("div",{className:"font-bold mb-1",children:"Validation Errors:"}),I.errors.map((d,v)=>e.jsxs("div",{children:["• ",d]},v))]}),I&&I.isValid&&I.preview&&e.jsxs("div",{className:"mt-2 p-3 border border-primary bg-primary/10 rounded-none font-terminal text-xs text-primary",children:[e.jsx("div",{className:"font-bold mb-2",children:"✓ Valid JSON Preview:"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Course:"})," ",I.preview.courseName]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Modules:"})," ",I.preview.moduleCount]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Events:"})," ",I.preview.eventCount]}),I.preview.startDate&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Start:"})," ",I.preview.startDate]}),I.preview.endDate&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"End:"})," ",I.preview.endDate]})]})]}),e.jsx("button",{onClick:()=>y.mutate(u),disabled:!I?.isValid||y.isPending,className:"bg-secondary hover:bg-secondary/80 disabled:opacity-50 px-4 py-2 rounded-none mt-2 font-terminal text-xs",type:"button",children:y.isPending?"Importing...":"Import Syllabus"}),q&&e.jsx("div",{className:`mt-2 p-2 border font-terminal text-xs ${q.type==="success"?"border-green-500 text-green-400":"border-red-500 text-red-400"}`,children:q.message})]})]}),e.jsxs(qe,{value:"learning-objectives",className:"border-secondary/40",children:[e.jsx(ze,{className:"font-arcade text-xs text-primary px-3 hover:no-underline",children:"LEARNING OBJECTIVES IMPORT"}),e.jsxs(_e,{className:"px-3",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block text-xs mb-1 font-terminal text-muted-foreground",children:"Target Module (optional)"}),e.jsxs("select",{className:"w-full bg-black border border-secondary rounded-none p-2 font-terminal",value:i||"",onChange:d=>f(d.target.value?parseInt(d.target.value):null),children:[e.jsx("option",{value:"",children:"-- No Module (Course-level) --"}),C.map(d=>e.jsx("option",{value:d.id,children:d.name},d.id))]})]}),e.jsx("button",{onClick:()=>t(Vt),className:"bg-primary hover:bg-primary/80 px-3 py-1 rounded-none text-xs font-terminal mb-2",type:"button",children:"Copy Prompt for ChatGPT"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-2 font-terminal",children:"Paste the ChatGPT response (JSON array) below:"}),e.jsx("textarea",{className:"w-full bg-black border border-secondary rounded-none p-2 h-32 font-terminal text-sm",placeholder:'[{"loCode": "1.1", "title": "Define..."}]',value:h,onChange:d=>O(d.target.value)}),e.jsx("button",{onClick:()=>P.mutate(h),disabled:!h||P.isPending,className:"bg-secondary hover:bg-secondary/80 disabled:opacity-50 px-4 py-2 rounded-none mt-2 font-terminal text-xs",type:"button",children:P.isPending?"Importing...":"Import LOs"}),k.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("h4",{className:"font-terminal text-xs mb-2",children:["Current LOs (",k.length,")"]}),e.jsx("div",{className:"max-h-48 overflow-y-auto",children:k.map(d=>e.jsxs("div",{className:"text-xs py-1 border-b border-secondary/30 font-terminal",children:[e.jsx("span",{className:"text-primary",children:d.loCode}),": ",d.title,e.jsx("span",{className:`ml-2 text-[10px] px-1 rounded ${d.status==="solid"?"bg-green-600":d.status==="in_progress"?"bg-yellow-600":d.status==="need_review"?"bg-orange-600":"bg-gray-600"}`,children:d.status})]},d.id))})]})]})]})]})]})}function Wt(){const a=Ke(),[r,n]=l.useState(null),[i,f]=l.useState({}),[u,x]=l.useState({}),[h,O]=l.useState(new Set),[D,g]=l.useState(new Set),[c,E]=l.useState(null),b=l.useRef(null),{data:T=[]}=B({queryKey:["courses"],queryFn:()=>A.courses.getActive()}),{data:q=[]}=B({queryKey:["modules",r],queryFn:()=>r?A.modules.getByCourse(r):Promise.resolve([]),enabled:!!r}),{data:L=[]}=B({queryKey:["scheduleEvents",r],queryFn:()=>r?A.scheduleEvents.getByCourse(r):Promise.resolve([]),enabled:!!r}),I=H({mutationFn:({id:t,data:m})=>A.modules.update(t,m),onSuccess:()=>{a.invalidateQueries({queryKey:["modules"]})}}),R=H({mutationFn:t=>A.modules.delete(t),onSuccess:()=>{a.invalidateQueries({queryKey:["modules"]})}}),j=H({mutationFn:t=>A.modules.deleteMany(t),onSuccess:()=>{a.invalidateQueries({queryKey:["modules"]}),O(new Set)}}),C=H({mutationFn:({id:t,data:m})=>A.scheduleEvents.update(t,m),onSuccess:()=>{a.invalidateQueries({queryKey:["scheduleEvents"]})}}),k=H({mutationFn:t=>A.scheduleEvents.delete(t),onSuccess:()=>{a.invalidateQueries({queryKey:["scheduleEvents"]})}}),y=H({mutationFn:t=>A.scheduleEvents.deleteMany(t),onSuccess:()=>{a.invalidateQueries({queryKey:["scheduleEvents"]}),g(new Set)}}),P=(t,m,N)=>{if(!m.length)return;const _={type:t,ids:m,label:N};b.current=_,E(_)};return e.jsxs("div",{className:"space-y-6 p-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1 font-terminal text-muted-foreground",children:"Select Course"}),e.jsxs("select",{className:"w-full bg-black border border-secondary rounded-none p-2 font-terminal",value:r||"",onChange:t=>{n(t.target.value?parseInt(t.target.value):null)},children:[e.jsx("option",{value:"",children:"-- Select Course --"}),T.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),r&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(J,{className:"brain-card rounded-none",children:[e.jsx(oe,{className:"border-b border-secondary/50 p-3",children:e.jsxs(le,{className:"font-arcade text-sm flex items-center gap-2",children:[e.jsx(gt,{className:"w-4 h-4"}),"MODULES (",q.length,")"]})}),e.jsx(Y,{className:"p-0",children:q.length===0?e.jsx("p",{className:"text-xs text-muted-foreground font-terminal p-4",children:"No modules yet. Import a syllabus to add modules."}):e.jsxs("div",{className:"p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"bg-secondary hover:bg-secondary/80 px-2 py-1 rounded-none text-[10px] font-terminal",type:"button",onClick:()=>{const t=new Set;h.size!==q.length&&q.forEach(m=>t.add(m.id)),O(t)},children:h.size===q.length?"Uncheck All":"Check All"}),e.jsx("button",{className:"bg-destructive hover:bg-destructive/80 px-2 py-1 rounded-none text-[10px] font-terminal",type:"button",disabled:h.size===0,onClick:()=>{P("modules",Array.from(h),`Delete ${h.size} module(s)? This cannot be undone.`)},children:"Delete"}),e.jsx("button",{className:"bg-secondary hover:bg-secondary/80 px-2 py-1 rounded-none text-[10px] font-terminal",type:"button",disabled:h.size===0,onClick:()=>{h.forEach(t=>{const m=i[t];m&&I.mutate({id:t,data:m})}),f(t=>{const m={...t};return h.forEach(N=>{delete m[N]}),m})},children:"Save"})]}),e.jsx(ue,{className:"h-[280px]",children:e.jsxs("table",{className:"w-full text-sm font-terminal",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-secondary/50",children:[e.jsx("th",{className:"text-center p-2 w-8",children:"Select"}),e.jsx("th",{className:"text-left p-2",children:"Module"}),e.jsx("th",{className:"text-center p-2",children:"Order"}),e.jsx("th",{className:"text-center p-2",children:"Files"}),e.jsx("th",{className:"text-center p-2",children:"NotebookLM"}),e.jsx("th",{className:"text-center p-2",children:"Status"}),e.jsx("th",{className:"text-center p-2",children:"Actions"})]})}),e.jsx("tbody",{children:q.map(t=>e.jsxs("tr",{className:"border-b border-secondary/30",children:[e.jsx("td",{className:"text-center p-2",children:e.jsx(re,{checked:h.has(t.id),onCheckedChange:m=>O(N=>{const _=new Set(N);return m?_.add(t.id):_.delete(t.id),_}),className:"rounded-none border-secondary data-[state=checked]:bg-secondary w-4 h-4"})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{className:"w-full bg-black border border-secondary rounded-none p-1 text-xs font-terminal",value:i[t.id]?.name??t.name,onChange:m=>f(N=>({...N,[t.id]:{...N[t.id],name:m.target.value}}))})}),e.jsx("td",{className:"text-center p-2",children:e.jsx("input",{type:"number",className:"w-16 bg-black border border-secondary rounded-none p-1 text-xs font-terminal text-center",value:i[t.id]?.orderIndex??t.orderIndex??0,onChange:m=>f(N=>({...N,[t.id]:{...N[t.id],orderIndex:parseInt(m.target.value||"0",10)}}))})}),e.jsx("td",{className:"text-center p-2",children:e.jsx(re,{checked:t.filesDownloaded,onCheckedChange:m=>I.mutate({id:t.id,data:{filesDownloaded:!!m}}),className:"rounded-none border-secondary data-[state=checked]:bg-secondary w-4 h-4"})}),e.jsx("td",{className:"text-center p-2",children:e.jsx(re,{checked:t.notebooklmLoaded,onCheckedChange:m=>I.mutate({id:t.id,data:{notebooklmLoaded:!!m}}),className:"rounded-none border-secondary data-[state=checked]:bg-secondary w-4 h-4"})}),e.jsx("td",{className:"text-center p-2",children:t.filesDownloaded&&t.notebooklmLoaded?e.jsx("span",{className:"text-green-400",children:"Ready"}):e.jsx("span",{className:"text-yellow-400",children:"Pending"})}),e.jsxs("td",{className:"text-center p-2 space-x-2",children:[e.jsx("button",{className:"bg-secondary hover:bg-secondary/80 px-2 py-1 rounded-none text-[10px] font-terminal",type:"button",disabled:!i[t.id],onClick:()=>{const m=i[t.id];m&&(I.mutate({id:t.id,data:m}),f(N=>{const _={...N};return delete _[t.id],_}))},children:"Save"}),e.jsx("button",{className:"bg-destructive hover:bg-destructive/80 px-2 py-1 rounded-none text-[10px] font-terminal",type:"button",onClick:()=>R.mutate(t.id),children:"Delete"})]})]},t.id))})]})})]})})]}),e.jsxs(J,{className:"brain-card rounded-none",children:[e.jsx(oe,{className:"border-b border-secondary/50 p-3",children:e.jsxs(le,{className:"font-arcade text-sm flex items-center gap-2",children:[e.jsx(hs,{className:"w-4 h-4"}),"SCHEDULE ITEMS (",L.length,")"]})}),e.jsx(Y,{className:"p-0",children:L.length===0?e.jsx("p",{className:"text-xs text-muted-foreground font-terminal p-4",children:"No schedule items yet. Import a syllabus to add events."}):e.jsxs("div",{className:"p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"bg-secondary hover:bg-secondary/80 px-2 py-1 rounded-none text-[10px] font-terminal",type:"button",onClick:()=>{const t=new Set;D.size!==L.length&&L.forEach(m=>t.add(m.id)),g(t)},children:D.size===L.length?"Uncheck All":"Check All"}),e.jsx("button",{className:"bg-destructive hover:bg-destructive/80 px-2 py-1 rounded-none text-[10px] font-terminal",type:"button",disabled:D.size===0,onClick:()=>{P("schedule",Array.from(D),`Delete ${D.size} schedule item(s)? This cannot be undone.`)},children:"Delete"}),e.jsx("button",{className:"bg-secondary hover:bg-secondary/80 px-2 py-1 rounded-none text-[10px] font-terminal",type:"button",disabled:D.size===0,onClick:()=>{D.forEach(t=>{const m=u[t];m&&C.mutate({id:t,data:m})}),x(t=>{const m={...t};return D.forEach(N=>{delete m[N]}),m})},children:"Save"})]}),e.jsx(ue,{className:"h-[280px]",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-xs font-terminal",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-secondary/50",children:[e.jsx("th",{className:"text-center p-2 w-8",children:"Select"}),e.jsx("th",{className:"text-left p-2",children:"Type"}),e.jsx("th",{className:"text-left p-2",children:"Delivery"}),e.jsx("th",{className:"text-left p-2",children:"Title"}),e.jsx("th",{className:"text-center p-2",children:"Date"}),e.jsx("th",{className:"text-center p-2",children:"Start"}),e.jsx("th",{className:"text-center p-2",children:"End"}),e.jsx("th",{className:"text-center p-2",children:"Due"}),e.jsx("th",{className:"text-left p-2",children:"Notes"}),e.jsx("th",{className:"text-center p-2",children:"Actions"})]})}),e.jsx("tbody",{children:L.map(t=>{const m=u[t.id]||{},N=m.type??t.type??"",_=m.delivery??t.delivery??"",d=m.title??t.title??"",v=m.date??t.date??"",S=m.startTime??t.startTime??"",K=m.endTime??t.endTime??"",V=m.dueDate??t.dueDate??"",M=m.notes??t.notes??"",Z=!!u[t.id];return e.jsxs("tr",{className:"border-b border-secondary/30 align-top",children:[e.jsx("td",{className:"text-center p-2",children:e.jsx(re,{checked:D.has(t.id),onCheckedChange:p=>g(w=>{const de=new Set(w);return p?de.add(t.id):de.delete(t.id),de}),className:"rounded-none border-secondary data-[state=checked]:bg-secondary w-4 h-4"})}),e.jsx("td",{className:"p-2",children:e.jsx("select",{className:"bg-black border border-secondary rounded-none p-1 text-xs font-terminal",value:N,onChange:p=>x(w=>({...w,[t.id]:{...w[t.id],type:p.target.value}})),children:["class","lecture","reading","topic","assignment","quiz","exam","assessment","other"].map(p=>e.jsx("option",{value:p,children:p},p))})}),e.jsx("td",{className:"p-2",children:e.jsx("select",{className:"bg-black border border-secondary rounded-none p-1 text-xs font-terminal",value:_,onChange:p=>x(w=>({...w,[t.id]:{...w[t.id],delivery:p.target.value}})),children:["","in_person","virtual_sync","virtual_async","online_module","hybrid"].map(p=>e.jsx("option",{value:p,children:p||"--"},p))})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{className:"w-full bg-black border border-secondary rounded-none p-1 text-xs font-terminal",value:d,onChange:p=>x(w=>({...w,[t.id]:{...w[t.id],title:p.target.value}}))})}),e.jsx("td",{className:"text-center p-2",children:e.jsx("input",{type:"date",className:"bg-black border border-secondary rounded-none p-1 text-xs font-terminal",value:v||"",onChange:p=>x(w=>({...w,[t.id]:{...w[t.id],date:p.target.value}}))})}),e.jsx("td",{className:"text-center p-2",children:e.jsx("input",{type:"time",className:"bg-black border border-secondary rounded-none p-1 text-xs font-terminal",value:S||"",onChange:p=>x(w=>({...w,[t.id]:{...w[t.id],startTime:p.target.value}}))})}),e.jsx("td",{className:"text-center p-2",children:e.jsx("input",{type:"time",className:"bg-black border border-secondary rounded-none p-1 text-xs font-terminal",value:K||"",onChange:p=>x(w=>({...w,[t.id]:{...w[t.id],endTime:p.target.value}}))})}),e.jsx("td",{className:"text-center p-2",children:e.jsx("input",{type:"date",className:"bg-black border border-secondary rounded-none p-1 text-xs font-terminal",value:V||"",onChange:p=>x(w=>({...w,[t.id]:{...w[t.id],dueDate:p.target.value}}))})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{className:"w-full bg-black border border-secondary rounded-none p-1 text-xs font-terminal",value:M||"",onChange:p=>x(w=>({...w,[t.id]:{...w[t.id],notes:p.target.value}}))})}),e.jsxs("td",{className:"text-center p-2 space-x-2",children:[e.jsx("button",{className:"bg-secondary hover:bg-secondary/80 px-2 py-1 rounded-none text-[10px] font-terminal",type:"button",disabled:!Z,onClick:()=>{C.mutate({id:t.id,data:{type:N,title:d,date:v,startTime:S,endTime:K,dueDate:V,notes:M,delivery:_}}),x(p=>{const w={...p};return delete w[t.id],w})},children:"Save"}),e.jsx("button",{className:"bg-destructive hover:bg-destructive/80 px-2 py-1 rounded-none text-[10px] font-terminal",type:"button",onClick:()=>k.mutate(t.id),children:"Delete"})]})]},t.id)})})]})})})]})})]})]}),e.jsx(os,{open:!!c,onOpenChange:t=>!t&&E(null),children:e.jsxs(ls,{className:"bg-black border-2 border-primary rounded-none font-terminal text-primary shadow-none max-w-md translate-y-0",style:{zIndex:100005,top:"6rem",left:"50%",transform:"translate(-50%, 0)"},children:[e.jsxs(ds,{className:"text-left",children:[e.jsx(cs,{className:"font-arcade text-destructive",children:"CONFIRM_DELETE"}),e.jsx(is,{className:"font-terminal text-muted-foreground",children:c?.label})]}),e.jsxs(ms,{className:"gap-2 sm:justify-end",children:[e.jsx(us,{className:"rounded-none border-secondary font-terminal text-xs hover:bg-secondary/20",onClick:()=>{b.current=null,E(null)},children:"CANCEL"}),e.jsx(xs,{className:"rounded-none bg-destructive text-destructive-foreground font-arcade text-xs hover:bg-destructive/80",type:"button",onClick:()=>{const t=b.current;t&&(t.type==="modules"?j.mutate(t.ids):y.mutate(t.ids),b.current=null,E(null))},children:"DELETE"})]})]})})]})}function Jt(){const[a,r]=l.useState(null),{data:n=[]}=B({queryKey:["courses"],queryFn:async()=>{const c=await fetch("/api/courses");if(!c.ok)throw new Error("Failed to fetch courses");return c.json()}}),{data:i=[],isLoading:f}=B({queryKey:["modules",a],queryFn:()=>a?A.modules.getByCourse(a):Promise.resolve([]),enabled:!!a}),{data:u=[]}=B({queryKey:["learningObjectives",a],queryFn:()=>a?A.learningObjectives.getByCourse(a):Promise.resolve([]),enabled:!!a}),{data:x=[]}=B({queryKey:["scheduleEvents",a],queryFn:()=>a?A.scheduleEvents.getByCourse(a):Promise.resolve([]),enabled:!!a}),h=i.reduce((c,E)=>{const b=E.orderIndex||0;return c[b]||(c[b]=[]),c[b].push(E),c},{}),O=u.reduce((c,E)=>{const b=E.moduleId||0;return c[b]||(c[b]=[]),c[b].push(E),c},{}),D=x.reduce((c,E)=>{const b=E.linkedModuleId||0;return c[b]||(c[b]=[]),c[b].push(E),c},{}),g=i.length>0||u.length>0||x.length>0;return e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsxs(J,{className:"brain-card rounded-none",children:[e.jsx(oe,{className:"border-b border-secondary/50 p-3",children:e.jsx(le,{className:"font-arcade text-sm",children:"SELECT COURSE"})}),e.jsx(Y,{className:"p-3",children:e.jsxs(we,{value:a?.toString()||"",onValueChange:c=>r(c?parseInt(c):null),children:[e.jsx(Ce,{className:"rounded-none border-primary",children:e.jsx(ke,{placeholder:"Choose a course..."})}),e.jsx(Ae,{children:n.map(c=>e.jsx(U,{value:c.id.toString(),children:c.name},c.id))})]})})]}),a?f?e.jsx(J,{className:"brain-card rounded-none",children:e.jsx(Y,{className:"p-8 text-center",children:e.jsx("p",{className:"font-terminal text-xs text-muted-foreground",children:"Loading syllabus..."})})}):g?e.jsx(ue,{className:"h-[600px]",children:e.jsx("div",{className:"space-y-4 pr-4",children:Object.entries(h).sort(([c],[E])=>parseInt(c)-parseInt(E)).map(([c,E])=>e.jsxs(J,{className:"brain-card rounded-none",children:[e.jsx(oe,{className:"border-b border-secondary/50 p-3",children:e.jsxs(le,{className:"font-arcade text-sm",children:["WEEK ",c]})}),e.jsx(Y,{className:"p-3 space-y-3",children:E.map(b=>e.jsxs("div",{className:"space-y-2 border-l-2 border-secondary/40 pl-3",children:[e.jsx("div",{className:"font-arcade text-xs text-primary",children:b.name}),O[b.id]&&O[b.id].length>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-terminal text-[10px] text-muted-foreground uppercase",children:"Objectives"}),e.jsx("div",{className:"space-y-1",children:O[b.id].map(T=>e.jsxs("div",{className:"font-terminal text-xs text-secondary",children:["• ",T.loCode,": ",T.title]},T.id))})]}),D[b.id]&&D[b.id].length>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-terminal text-[10px] text-muted-foreground uppercase",children:"Events"}),e.jsx("div",{className:"space-y-1",children:D[b.id].map(T=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Me,{variant:"outline",className:`text-[10px] font-terminal ${T.type==="quiz"?"border-yellow-500/50 text-yellow-400":T.type==="exam"?"border-red-500/50 text-red-400":"border-blue-500/50 text-blue-400"}`,children:T.type?.toUpperCase()}),e.jsx("span",{className:"font-terminal text-xs text-muted-foreground",children:T.title}),T.dueDate&&e.jsx("span",{className:"font-terminal text-[10px] text-secondary ml-auto",children:new Date(T.dueDate).toLocaleDateString()})]},T.id))})]})]},b.id))})]},c))})}):e.jsx(J,{className:"brain-card rounded-none",children:e.jsx(Y,{className:"p-8 text-center",children:e.jsx("p",{className:"font-terminal text-xs text-muted-foreground",children:"No syllabus imported"})})}):e.jsx(J,{className:"brain-card rounded-none",children:e.jsx(Y,{className:"p-8 text-center",children:e.jsx("p",{className:"font-terminal text-xs text-muted-foreground",children:"Select a course to view syllabus"})})})]})}function ts(a,r){if(r.length===0)return a;const n=[];for(const i of r)n.push({type:"image_url",image_url:{url:i}});return a.trim()&&n.push({type:"text",text:a}),n}function Yt(){const[a,r]=l.useState(!1),[n,i]=l.useState([]),[f,u]=l.useState(""),[x,h]=l.useState([]),[O,D]=l.useState(!1),g=l.useRef(null),c=l.useRef(null),E=l.useRef(null),b=l.useCallback(()=>{g.current&&(g.current.scrollTop=g.current.scrollHeight)},[]);l.useEffect(()=>{b()},[n,b]);const T=j=>{const C=new FileReader;C.onload=()=>{typeof C.result=="string"&&h(k=>[...k,C.result])},C.readAsDataURL(j)},q=j=>{const C=j.clipboardData?.items;if(C){for(const k of Array.from(C))if(k.type.startsWith("image/")){j.preventDefault();const y=k.getAsFile();y&&T(y)}}},L=j=>{const C=j.target.files;if(C){for(const k of Array.from(C))k.type.startsWith("image/")&&T(k);j.target.value=""}},I=async()=>{const j=f.trim();if(!j&&x.length===0)return;const C={role:"user",content:j,images:[...x]};i(k=>[...k,C]),u(""),h([]),D(!0);try{const k=n.map(N=>({role:N.role,content:N.images?.length?ts(N.content,N.images):N.content})).concat([{role:"user",content:ts(j,C.images??[])}]);i(N=>[...N,{role:"assistant",content:""}]);const P=(await fetch("/api/brain/quick-chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:k})})).body?.getReader(),t=new TextDecoder;if(!P)throw new Error("No response body");let m="";for(;;){const{done:N,value:_}=await P.read();if(N)break;m+=t.decode(_,{stream:!0});const d=m.split(`
`);m=d.pop()??"";for(const v of d){if(!v.startsWith("data: "))continue;const S=v.slice(6);if(S==="[DONE]")break;try{const K=JSON.parse(S);if(K.error){i(V=>{const M=[...V];return M[M.length-1]={role:"assistant",content:`Error: ${K.error}`},M});break}K.content&&i(V=>{const M=[...V],Z=M[M.length-1];return M[M.length-1]={...Z,content:Z.content+K.content},M})}catch{}}}}catch(k){i(y=>{const P=y[y.length-1];if(P?.role==="assistant"&&!P.content){const t=[...y];return t[t.length-1]={role:"assistant",content:`Error: ${k}`},t}return[...y,{role:"assistant",content:`Error: ${k}`}]})}finally{D(!1)}},R=j=>{j.key==="Enter"&&!j.shiftKey&&(j.preventDefault(),I())};return a?e.jsxs(J,{className:"brain-card border-primary/30 mb-4",children:[e.jsxs(oe,{className:"py-2 px-4 flex flex-row items-center justify-between",children:[e.jsx(le,{className:"text-xs",children:"KIMI K2.5 CHAT"}),e.jsx(F,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>r(!1),children:e.jsx(rt,{className:"w-4 h-4"})})]}),e.jsxs(Y,{className:"p-0",children:[e.jsxs("div",{ref:g,className:"h-64 overflow-y-auto px-4 py-2 space-y-3",children:[n.length===0&&e.jsx("p",{className:"text-muted-foreground text-xs text-center py-8",children:"Ask Kimi anything. Paste screenshots with Ctrl+V."}),n.map((j,C)=>e.jsx("div",{className:`flex ${j.role==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[80%] rounded px-3 py-2 text-sm whitespace-pre-wrap ${j.role==="user"?"bg-primary/20 text-foreground border border-primary/30":"bg-secondary/40 text-foreground border border-secondary/60"}`,children:[j.images?.map((k,y)=>e.jsx("img",{src:k,alt:"attached",className:"max-h-32 rounded mb-1"},y)),j.content]})},C)),O&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"bg-secondary/40 border border-secondary/60 rounded px-3 py-2",children:e.jsx(ut,{className:"w-4 h-4 animate-spin text-primary"})})})]}),x.length>0&&e.jsx("div",{className:"px-4 py-1 flex gap-2 flex-wrap",children:x.map((j,C)=>e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:j,alt:"pending",className:"h-12 rounded border border-primary/30"}),e.jsx("button",{onClick:()=>h(k=>k.filter((y,P)=>P!==C)),className:"absolute -top-1 -right-1 bg-destructive rounded-full p-0.5",children:e.jsx(fe,{className:"w-3 h-3"})})]},C))}),e.jsxs("div",{className:"flex items-end gap-2 px-4 py-2 border-t border-border",children:[e.jsx("input",{ref:c,type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:L}),e.jsx(F,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 shrink-0",onClick:()=>c.current?.click(),children:e.jsx(vt,{className:"w-4 h-4 text-primary"})}),e.jsx("textarea",{ref:E,value:f,onChange:j=>u(j.target.value),onKeyDown:R,onPaste:q,placeholder:"Ask Kimi... (Ctrl+V to paste images)",rows:1,className:"flex-1 bg-transparent border border-input rounded px-3 py-1.5 text-sm resize-none focus:outline-none focus:ring-1 focus:ring-ring"}),e.jsx(F,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 shrink-0",onClick:I,disabled:O,children:e.jsx(ot,{className:"w-4 h-4 text-primary"})})]})]})]}):e.jsxs("button",{onClick:()=>r(!0),className:"w-full flex items-center justify-between brain-card border border-primary/30 px-4 py-2 mb-4 text-sm text-primary hover:bg-primary/10 transition-colors",children:[e.jsx("span",{className:"font-arcade text-xs tracking-widest uppercase",children:"KIMI K2.5 CHAT"}),e.jsx(ns,{className:"w-4 h-4"})]})}const Gt=(a,r="MM/dd")=>{if(!a)return"-";try{const n=a instanceof Date?a:new Date(a);return pt(n)?ft(n,r):"-"}catch{return"-"}},Se=a=>{if(Array.isArray(a))return a.filter(r=>typeof r=="string");if(typeof a=="string"){const r=a.trim();if(!r)return[];try{const n=JSON.parse(r);if(Array.isArray(n))return n.filter(i=>typeof i=="string")}catch{}return r.split(",").map(n=>n.trim()).filter(Boolean)}return[]};function ia(){const[a,r]=l.useState(new Set),[n,i]=l.useState(null),[f,u]=l.useState(!1),[x,h]=l.useState([]),[O,D]=l.useState(!1),[g,c]=l.useState(new Set),[E,b]=l.useState(null),[T,q]=l.useState({front:"",back:"",deckName:""}),[L,I]=l.useState("all"),[R,j]=l.useState(""),[C,k]=l.useState(""),[y,P]=l.useState({mode:"",minutes:"",cards:"",confusions:"",weakAnchors:"",concepts:"",issues:"",notes:""}),[t,m]=l.useState("School"),[N,_]=l.useState(null),[d,v]=l.useState(""),[S,K]=l.useState(!1),[V,M]=l.useState(!1),Z=[{name:"EBP",path:"School/Evidence Based Practice"},{name:"ExPhys",path:"School/Exercise Physiology"},{name:"MS1",path:"School/Movement Science 1"},{name:"Neuro",path:"School/Neuroscience"},{name:"TI",path:"School/Theraputic Intervention"}];l.useEffect(()=>{const s=new URLSearchParams(window.location.search),o=s.get("semester")||"all",z=s.get("start")||"",$=s.get("end")||"";I(o),j(z),k($)},[]);const{data:p=[],isLoading:w}=B({queryKey:["sessions",L,R,C],queryFn:async()=>{const s=new URLSearchParams;L!=="all"&&s.append("semester",L),R&&s.append("start",R),C&&s.append("end",C);const o=s.toString(),z=o?`/sessions?${o}`:"/sessions",$=await fetch(`/api${z}`);if(!$.ok)throw new Error(`API Error: ${$.statusText}`);return $.json()}}),{data:de}=B({queryKey:["brain","metrics"],queryFn:A.brain.getMetrics}),xe=Ke(),Os=H({mutationFn:s=>A.sessions.deleteMany(s),onSuccess:()=>{xe.invalidateQueries({queryKey:["sessions"]}),xe.invalidateQueries({queryKey:["brain","metrics"]}),r(new Set)}}),Ps=H({mutationFn:({id:s,updates:o})=>A.sessions.update(s,o),onSuccess:()=>{xe.invalidateQueries({queryKey:["sessions"]}),xe.invalidateQueries({queryKey:["brain","metrics"]}),i(null)}}),Rs=s=>{r(o=>{const z=new Set(o);return z.has(s)?z.delete(s):z.add(s),z})},Ms=()=>{a.size===p.length?r(new Set):r(new Set(p.map(s=>s.id)))},Fs=()=>{a.size!==0&&(h(Array.from(a)),u(!0))},Ls=s=>{h([s]),u(!0)},qs=()=>{Os.mutate(x),u(!1),h([])};l.useEffect(()=>{if(n!==null){const s=p.find(o=>o.id===n);s&&P({mode:s.mode||"",minutes:s.minutes?.toString()||"",cards:s.cards?.toString()||"",confusions:Se(s.confusions).join(", "),weakAnchors:Se(s.weakAnchors).join(", "),concepts:Se(s.concepts).join(", "),issues:Se(s.issues).join(", "),notes:s.notes||""})}},[n,p]);const ce=n!==null?p.find(s=>s.id===n):null,he=typeof window<"u"&&new URLSearchParams(window.location.search).has("debugModals");l.useEffect(()=>{n!==null&&!w&&!ce&&(he&&console.warn("[ModalDebug][Brain] Missing session for edit; closing.",{editingSession:n,sessionsCount:p.length}),i(null))},[he,n,ce,p.length,w]),l.useEffect(()=>{he&&console.info("[ModalDebug][Brain] state",{editingSession:n,hasEditingSessionData:!!ce,deleteDialogOpen:f,sessionsToDelete:x.length,sessionsLoading:w})},[he,f,n,ce,w,x.length]);const zs=()=>{if(n===null)return;const s=$=>$?$.split(",").map(ie=>ie.trim()).filter(Boolean):[],o=$=>$.length?JSON.stringify($):null,z={mode:y.mode||"study",minutes:parseInt(y.minutes)||0,cards:parseInt(y.cards)||0,confusions:o(s(y.confusions)),weakAnchors:o(s(y.weakAnchors)),concepts:o(s(y.concepts)),issues:o(s(y.issues)),notes:y.notes||null};Ps.mutate({id:n,updates:z})},{data:te}=B({queryKey:["obsidian","status"],queryFn:A.obsidian.getStatus,refetchInterval:3e4}),{data:_s,refetch:Qt}=B({queryKey:["obsidian","files",t],queryFn:()=>A.obsidian.getFiles(t),enabled:te?.connected===!0}),Ks=async s=>{try{const o=await A.obsidian.getFile(s);o.success&&o.content!==void 0&&(_(s),v(o.content),M(!1))}catch(o){console.error("Failed to load file:",o)}},$s=async()=>{if(N){K(!0);try{(await A.obsidian.saveFile(N,d)).success&&M(!1)}catch(s){console.error("Failed to save file:",s)}finally{K(!1)}}},pe=s=>{m(s),_(null),v("")},Bs=()=>{const s=new Date().toISOString().split("T")[0],o=t?`${t}/Session-${s}.md`:`Session-${s}.md`,z=`# Study Session - ${s}

## Summary


## Concepts Covered
- 

## Strengths
- 

## Areas to Review
- 

## Notes

`;_(o),v(z),M(!0)},{data:X,isLoading:Vs,refetch:Ue}=B({queryKey:["anki","status"],queryFn:A.anki.getStatus,refetchInterval:3e4}),{data:Us}=B({queryKey:["anki","due"],queryFn:A.anki.getDue,enabled:X?.connected===!0}),{data:Hs=[],refetch:be}=B({queryKey:["anki","drafts"],queryFn:A.anki.getDrafts}),ae=Hs.filter(s=>s.status==="pending"),Oe=H({mutationFn:A.anki.sync,onSuccess:()=>{xe.invalidateQueries({queryKey:["anki"]}),be()}}),He=H({mutationFn:s=>A.anki.approveDraft(s),onSuccess:()=>{be()}}),We=H({mutationFn:s=>A.anki.deleteDraft(s),onSuccess:()=>{be()}}),Pe=H({mutationFn:({id:s,data:o})=>A.anki.updateDraft(s,o),onSuccess:()=>{be(),b(null)}}),Ws=s=>{b(s.id),q({front:s.front,back:s.back,deckName:s.deckName})},Js=()=>{E!==null&&Pe.mutate({id:E,data:T})};return e.jsxs(st,{children:[he&&e.jsxs("div",{className:"fixed bottom-12 right-4 z-[70] bg-black/80 border border-primary text-primary font-terminal text-[10px] px-2 py-1 rounded-none",children:[e.jsx("div",{children:"Brain modals"}),e.jsxs("div",{children:["Edit session: ",n??"none"]}),e.jsxs("div",{children:["Edit data: ",ce?"yes":"no"]}),e.jsxs("div",{children:["Delete open: ",f?"yes":"no"]}),e.jsxs("div",{children:["Delete count: ",x.length]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h1",{className:"font-arcade text-xl text-primary flex items-center gap-2",children:[e.jsx(tt,{className:"w-6 h-6"}),"BRAIN ANALYTICS"]})}),e.jsx(Yt,{}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-arcade text-lg text-primary mb-4",children:"SYSTEM STATUS"}),e.jsx(J,{className:"brain-card rounded-none",children:e.jsx(Y,{className:"p-3",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-3 font-terminal text-xs",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${te?.connected?"bg-green-500":"bg-red-500"}`}),e.jsx("span",{className:"text-muted-foreground",children:"Obsidian"}),e.jsx("span",{className:"text-primary",children:te?.connected?"Online":"Offline"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${X?.connected?"bg-green-500":"bg-red-500"}`}),e.jsx("span",{className:"text-muted-foreground",children:"Anki"}),e.jsx("span",{className:"text-primary",children:X?.connected?"Connected":"Offline"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-muted-foreground",children:[e.jsxs("span",{children:["Cards: ",e.jsx("span",{className:"text-primary",children:de?.totalCards||0})]}),e.jsxs("span",{children:["Drafts: ",e.jsx("span",{className:"text-primary",children:ae.length})]})]})]})})})]}),e.jsxs(lt,{defaultValue:"ingestion",className:"w-full",children:[e.jsxs(dt,{className:"grid w-full grid-cols-4 rounded-none bg-black border border-secondary/40",children:[e.jsx(Ne,{value:"ingestion",className:"font-arcade text-xs rounded-none data-[state=active]:bg-primary/20 data-[state=active]:text-primary",children:"INGESTION"}),e.jsx(Ne,{value:"data",className:"font-arcade text-xs rounded-none data-[state=active]:bg-primary/20 data-[state=active]:text-primary",children:"DATA"}),e.jsx(Ne,{value:"integrations",className:"font-arcade text-xs rounded-none data-[state=active]:bg-primary/20 data-[state=active]:text-primary",children:"INTEGRATIONS"}),e.jsx(Ne,{value:"syllabus",className:"font-arcade text-xs rounded-none data-[state=active]:bg-primary/20 data-[state=active]:text-primary",children:"SYLLABUS VIEW"})]}),e.jsx(ve,{value:"ingestion",className:"border border-t-0 border-secondary/40 rounded-none",children:e.jsx(Ht,{})}),e.jsx(ve,{value:"data",className:"border border-t-0 border-secondary/40 rounded-none",children:e.jsx(Wt,{})}),e.jsx(ve,{value:"integrations",className:"border border-t-0 border-secondary/40 rounded-none",children:e.jsxs("div",{className:"space-y-4 p-4 min-w-0",children:[e.jsxs(J,{className:"brain-card rounded-none",children:[e.jsxs(oe,{className:"border-b border-secondary/50 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(le,{className:"font-arcade text-sm flex items-center gap-2",children:[e.jsx(xt,{className:"w-4 h-4"}),"OBSIDIAN VAULT",te?.connected?e.jsx(ge,{className:"w-3 h-3 text-green-500"}):e.jsx(fe,{className:"w-3 h-3 text-red-500"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(F,{size:"sm",variant:"outline",className:"h-6 px-2 rounded-none font-terminal text-xs",onClick:Bs,disabled:!te?.connected,children:[e.jsx(ht,{className:"w-3 h-3 mr-1"}),"New Note"]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:O,onChange:s=>D(s.target.checked),disabled:!te?.connected,className:"w-4 h-4 accent-primary"}),e.jsx("span",{className:"font-terminal text-xs",children:"Auto-Sync"})]})]})]}),e.jsx("div",{className:"flex items-center gap-1 mt-2 flex-wrap",children:Z.map(s=>e.jsx(F,{size:"sm",variant:t===s.path?"default":"outline",className:"h-6 px-2 rounded-none font-terminal text-xs",onClick:()=>pe(s.path),children:s.name},s.path))}),t&&e.jsxs("div",{className:"flex items-center gap-1 mt-2 font-terminal text-xs text-muted-foreground",children:[e.jsx("button",{onClick:()=>pe(""),className:"hover:text-primary",children:"vault"}),t.split("/").map((s,o,z)=>e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(at,{className:"w-3 h-3"}),e.jsx("button",{onClick:()=>pe(z.slice(0,o+1).join("/")),className:"hover:text-primary",children:s})]},o))]})]}),e.jsx(Y,{className:"p-0",children:te?.connected?e.jsxs("div",{className:"grid md:grid-cols-2 h-[240px] md:h-[300px]",children:[e.jsx("div",{className:"border-r border-secondary/30",children:e.jsx(ue,{className:"h-[240px] md:h-[300px]",children:e.jsxs("div",{className:"p-2 space-y-1",children:[t&&e.jsxs("button",{onClick:()=>{const s=t.split("/");s.pop(),pe(s.join("/"))},className:"w-full flex items-center gap-2 p-2 hover:bg-secondary/20 font-terminal text-xs text-muted-foreground",children:[e.jsx(ss,{className:"w-3 h-3"}),".."]}),_s?.files?.map(s=>{const o=typeof s=="string"?s:s.path,z=o.endsWith("/"),$=o.replace(/\/$/,"").split("/").pop()||o;return e.jsxs("button",{onClick:()=>{if(z){const ie=$.replace(/\/$/,"");pe(t?`${t}/${ie}`:ie)}else{const ie=t?`${t}/${$}`:$;Ks(ie)}},className:`w-full flex items-center gap-2 p-2 hover:bg-secondary/20 font-terminal text-xs ${N?.endsWith($)?"bg-primary/20 text-primary":""}`,children:[z?e.jsx(ss,{className:"w-3 h-3 text-yellow-500"}):e.jsx(jt,{className:"w-3 h-3 text-blue-400"}),$]},o)})]})})}),e.jsx("div",{className:"flex flex-col h-[240px] md:h-[300px]",children:N?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between p-2 border-b border-secondary/30",children:[e.jsxs("span",{className:"font-terminal text-xs text-primary truncate",children:[N.split("/").pop(),V&&e.jsx("span",{className:"text-yellow-500 ml-1",children:"*"})]}),e.jsxs(F,{size:"sm",variant:"ghost",onClick:$s,disabled:!V||S,className:"h-6 px-2",children:[e.jsx(Re,{className:"w-3 h-3 mr-1"}),S?"Saving...":"Save"]})]}),e.jsx("textarea",{value:d,onChange:s=>{v(s.target.value),M(!0)},className:"flex-1 w-full p-3 bg-black/60 font-terminal text-sm resize-none focus:outline-none focus:ring-1 focus:ring-primary",placeholder:"File content..."})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center font-terminal text-xs text-muted-foreground",children:"Select a file to edit"})})]}):e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("p",{className:"font-terminal text-xs text-red-400 mb-2",children:"Obsidian Offline"}),e.jsx("p",{className:"font-terminal text-xs text-muted-foreground",children:"Open Obsidian with Local REST API plugin enabled"})]})})]}),e.jsxs(J,{className:"brain-card rounded-none",children:[e.jsx(oe,{className:"border-b border-secondary/50 p-3",children:e.jsxs(le,{className:"font-arcade text-xs flex items-center gap-2 text-muted-foreground",children:[e.jsx(hs,{className:"w-3 h-3"}),"ANKI INTEGRATION",X?.connected?e.jsx(ge,{className:"w-3 h-3 text-green-500 ml-auto"}):e.jsx(fe,{className:"w-3 h-3 text-red-500 ml-auto"})]})}),e.jsx(Y,{className:"p-4 space-y-3",children:Vs?e.jsx("p",{className:"font-terminal text-xs text-muted-foreground",children:"Checking Anki..."}):X?.connected?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-terminal text-xs text-muted-foreground",children:"Status:"}),e.jsx(Me,{variant:"outline",className:"bg-green-500/20 text-green-400 border-green-500",children:"Connected"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-terminal text-xs text-muted-foreground",children:"Cards Created:"}),e.jsx("span",{className:"font-arcade text-xs text-primary",children:de?.totalCards||0})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-terminal text-xs text-muted-foreground",children:"Due Today:"}),e.jsx("span",{className:"font-arcade text-xs text-secondary",children:Us?.dueCount||0})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-terminal text-xs text-muted-foreground",children:"Reviewed Today:"}),e.jsx("span",{className:"font-arcade text-xs text-muted-foreground",children:X.reviewedToday||0})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-terminal text-xs text-muted-foreground",children:"Decks:"}),e.jsx("span",{className:"font-arcade text-xs text-muted-foreground",children:X.decks?.length||0})]}),e.jsxs("div",{className:"pt-2 flex gap-2",children:[e.jsxs(F,{size:"sm",variant:"outline",className:"flex-1 font-terminal text-xs",onClick:()=>Ue(),children:[e.jsx(es,{className:"w-3 h-3 mr-1"}),"Refresh"]}),e.jsx(F,{size:"sm",className:"flex-1 font-terminal text-xs bg-secondary hover:bg-secondary/80",onClick:()=>Oe.mutate(),disabled:Oe.isPending,children:Oe.isPending?"Syncing...":"Sync Cards"})]}),ae.length>0&&e.jsxs("div",{className:"pt-3 border-t border-secondary/30",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{className:"font-arcade text-[10px] text-yellow-400",children:["PENDING CARDS (",ae.length,")"]}),e.jsx("div",{className:"flex gap-1",children:e.jsx(F,{size:"sm",variant:"outline",className:"h-5 px-2 text-[10px] font-terminal",onClick:()=>{g.size===ae.length?c(new Set):c(new Set(ae.map(s=>s.id)))},children:g.size===ae.length?"None":"All"})})]}),g.size>0&&e.jsxs("div",{className:"flex gap-1 mb-2",children:[e.jsxs(F,{size:"sm",className:"h-6 px-2 text-[10px] font-terminal bg-green-600 hover:bg-green-700",onClick:()=>{g.forEach(s=>He.mutate(s)),c(new Set)},children:[e.jsx(ge,{className:"w-3 h-3 mr-1"}),"Approve (",g.size,")"]}),e.jsxs(F,{size:"sm",variant:"destructive",className:"h-6 px-2 text-[10px] font-terminal",onClick:()=>{g.forEach(s=>We.mutate(s)),c(new Set)},children:[e.jsx(me,{className:"w-3 h-3 mr-1"}),"Delete (",g.size,")"]})]}),e.jsx(ue,{className:"h-[200px]",children:e.jsx("div",{className:"space-y-2",children:ae.map(s=>e.jsx("div",{className:`p-2 bg-black/40 border text-xs ${g.has(s.id)?"border-primary":"border-secondary/30"}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(re,{checked:g.has(s.id),onCheckedChange:o=>{const z=new Set(g);o?z.add(s.id):z.delete(s.id),c(z)},className:"mt-1 border-secondary data-[state=checked]:bg-primary"}),e.jsxs("div",{className:"flex-1 min-w-0 overflow-hidden",children:[e.jsx("div",{className:"font-terminal text-primary truncate",children:s.front}),e.jsx("div",{className:"font-terminal text-muted-foreground mt-1 truncate",children:s.back}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(Me,{variant:"outline",className:"text-[9px] border-blue-500/50 text-blue-400 shrink-0",children:s.deckName}),e.jsx(F,{size:"icon",variant:"outline",className:"h-5 w-5 shrink-0 border-yellow-500/50 text-yellow-400 hover:bg-yellow-500/20",onClick:()=>Ws(s),title:"Edit card",children:e.jsx(ye,{className:"w-3 h-3"})}),e.jsx(F,{size:"icon",variant:"outline",className:"h-5 w-5 shrink-0 border-green-500/50 text-green-400 hover:bg-green-500/20",onClick:()=>He.mutate(s.id),title:"Approve card",children:e.jsx(ge,{className:"w-3 h-3"})}),e.jsx(F,{size:"icon",variant:"outline",className:"h-5 w-5 shrink-0 border-red-500/50 text-red-400 hover:bg-red-500/20",onClick:()=>We.mutate(s.id),title:"Delete card",children:e.jsx(me,{className:"w-3 h-3"})})]})]})]})},s.id))})})]})]}):e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("p",{className:"font-terminal text-xs text-red-400",children:X?.error||"Anki not connected"}),e.jsx("p",{className:"font-terminal text-xs text-muted-foreground",children:"Open Anki with AnkiConnect plugin"}),e.jsxs(F,{size:"sm",variant:"outline",className:"font-terminal text-xs",onClick:()=>Ue(),children:[e.jsx(es,{className:"w-3 h-3 mr-1"}),"Retry"]})]})})]})]})}),e.jsx(ve,{value:"syllabus",className:"border border-t-0 border-secondary/40 rounded-none",children:e.jsx(Jt,{})})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-arcade text-lg text-primary mb-4",children:"SESSION EVIDENCE"}),e.jsx(J,{className:"brain-card rounded-none",children:e.jsxs(Y,{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-arcade text-primary mb-2 block",children:"Semester"}),e.jsxs(we,{value:L,onValueChange:s=>{I(s);const o=new URLSearchParams(window.location.search);s==="all"?o.delete("semester"):o.set("semester",s),window.history.replaceState({},"",`?${o.toString()}`)},children:[e.jsx(Ce,{className:"rounded-none border-primary",children:e.jsx(ke,{})}),e.jsxs(Ae,{children:[e.jsx(U,{value:"all",children:"All"}),e.jsx(U,{value:"1",children:"Semester 1 (Fall 2025)"}),e.jsx(U,{value:"2",children:"Semester 2 (Spring 2026)"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-arcade text-primary mb-2 block",children:"Start Date"}),e.jsx(je,{type:"date",value:R,onChange:s=>{j(s.target.value);const o=new URLSearchParams(window.location.search);s.target.value?o.set("start",s.target.value):o.delete("start"),window.history.replaceState({},"",`?${o.toString()}`)},className:"rounded-none border-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-arcade text-primary mb-2 block",children:"End Date"}),e.jsx(je,{type:"date",value:C,onChange:s=>{k(s.target.value);const o=new URLSearchParams(window.location.search);s.target.value?o.set("end",s.target.value):o.delete("end"),window.history.replaceState({},"",`?${o.toString()}`)},className:"rounded-none border-primary"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(F,{variant:"outline",onClick:()=>{I("all"),j(""),k(""),window.history.replaceState({},"",window.location.pathname)},className:"rounded-none border-primary w-full",children:"Clear Filters"})})]}),w?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"font-terminal text-xs text-muted-foreground",children:"Loading sessions..."})}):p.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"font-terminal text-xs text-muted-foreground",children:"No sessions found"})}):e.jsx(ue,{className:"h-[400px]",children:e.jsxs(ps,{children:[e.jsx(fs,{children:e.jsxs(Fe,{className:"border-secondary/30",children:[e.jsx(ee,{className:"w-12",children:e.jsx(re,{checked:a.size===p.length&&p.length>0,onCheckedChange:Ms,className:"border-secondary"})}),e.jsx(ee,{className:"font-arcade text-xs text-primary",children:"Date"}),e.jsx(ee,{className:"font-arcade text-xs text-primary",children:"Mode"}),e.jsx(ee,{className:"font-arcade text-xs text-primary",children:"Minutes"}),e.jsx(ee,{className:"font-arcade text-xs text-primary",children:"Cards"}),e.jsx(ee,{className:"font-arcade text-xs text-primary",children:"Concepts"}),e.jsx(ee,{className:"font-arcade text-xs text-primary",children:"Actions"})]})}),e.jsx(bs,{children:p.map(s=>e.jsxs(Fe,{className:"border-secondary/30 hover:bg-secondary/10",children:[e.jsx(se,{children:e.jsx(re,{checked:a.has(s.id),onCheckedChange:()=>Rs(s.id),className:"border-secondary"})}),e.jsx(se,{className:"font-terminal text-xs",children:Gt(s.createdAt,"MMM dd, yyyy")}),e.jsx(se,{className:"font-terminal text-xs text-muted-foreground",children:s.mode||"-"}),e.jsx(se,{className:"font-terminal text-xs text-muted-foreground",children:s.minutes||"-"}),e.jsx(se,{className:"font-terminal text-xs text-muted-foreground",children:s.cards||"-"}),e.jsx(se,{className:"font-terminal text-xs text-muted-foreground",children:Array.isArray(s.concepts)?s.concepts.length:0}),e.jsxs(se,{className:"flex gap-1",children:[e.jsx(F,{size:"icon",variant:"outline",className:"h-6 w-6 border-yellow-500/50 text-yellow-400 hover:bg-yellow-500/20",onClick:()=>i(s.id),children:e.jsx(ye,{className:"w-3 h-3"})}),e.jsx(F,{size:"icon",variant:"outline",className:"h-6 w-6 border-red-500/50 text-red-400 hover:bg-red-500/20",onClick:()=>Ls(s.id),children:e.jsx(me,{className:"w-3 h-3"})})]})]},s.id))})]})}),a.size>0&&e.jsx("div",{className:"flex gap-2 pt-4 border-t border-secondary/30",children:e.jsxs(F,{size:"sm",className:"flex-1 font-terminal text-xs bg-red-600 hover:bg-red-700",onClick:Fs,children:[e.jsx(me,{className:"w-3 h-3 mr-1"}),"Delete Selected (",a.size,")"]})})]})})]})]})]}),e.jsx(Je,{open:!!ce,onOpenChange:s=>{s||i(null)},children:e.jsxs(Ye,{"data-modal":"brain-edit-session",className:"bg-black border-2 border-primary rounded-none max-w-2xl translate-y-0",style:{zIndex:100005,top:"6rem",left:"50%",transform:"translate(-50%, 0)"},children:[e.jsxs(Ge,{children:[e.jsxs(Qe,{className:"font-arcade text-primary flex items-center gap-2",children:[e.jsx(ye,{className:"w-5 h-5"}),"EDIT SESSION #",n]}),e.jsx(Xe,{className:"font-terminal text-muted-foreground",children:"Update WRAP methodology fields for this study session"})]}),e.jsxs("div",{className:"space-y-4 font-terminal",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Mode"}),e.jsxs(we,{value:y.mode,onValueChange:s=>P(o=>({...o,mode:s})),children:[e.jsx(Ce,{className:"rounded-none border-secondary",children:e.jsx(ke,{placeholder:"Select mode"})}),e.jsxs(Ae,{className:"rounded-none border-secondary bg-black",children:[e.jsx(U,{value:"Core",children:"Core"}),e.jsx(U,{value:"Sprint",children:"Sprint"}),e.jsx(U,{value:"Drill",children:"Drill"}),e.jsx(U,{value:"study",children:"Study"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Minutes"}),e.jsx(je,{type:"number",value:y.minutes,onChange:s=>P(o=>({...o,minutes:s.target.value})),className:"rounded-none border-secondary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Cards"}),e.jsx(je,{type:"number",value:y.cards,onChange:s=>P(o=>({...o,cards:s.target.value})),className:"rounded-none border-secondary"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Confusions (comma-separated)"}),e.jsx(ne,{value:y.confusions,onChange:s=>P(o=>({...o,confusions:s.target.value})),placeholder:"e.g., muscle insertion points, nerve pathways",className:"rounded-none border-secondary min-h-[60px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Weak Anchors (comma-separated)"}),e.jsx(ne,{value:y.weakAnchors,onChange:s=>P(o=>({...o,weakAnchors:s.target.value})),placeholder:"e.g., brachial plexus diagram, ROM measurements",className:"rounded-none border-secondary min-h-[60px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Concepts (comma-separated)"}),e.jsx(ne,{value:y.concepts,onChange:s=>P(o=>({...o,concepts:s.target.value})),placeholder:"e.g., upper extremity anatomy, peripheral nerves",className:"rounded-none border-secondary min-h-[60px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Issues (comma-separated)"}),e.jsx(ne,{value:y.issues,onChange:s=>P(o=>({...o,issues:s.target.value})),placeholder:"e.g., interrupted by phone, lost focus after 30 min",className:"rounded-none border-secondary min-h-[60px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Notes"}),e.jsx(ne,{value:y.notes,onChange:s=>P(o=>({...o,notes:s.target.value})),placeholder:"Free-form observations about the session",className:"rounded-none border-secondary min-h-[80px]"})]})]}),e.jsxs(Ze,{className:"gap-2",children:[e.jsxs(F,{variant:"outline",onClick:()=>i(null),className:"font-terminal rounded-none border-secondary hover:bg-secondary/20",children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),"Cancel"]}),e.jsxs(F,{onClick:zs,className:"font-terminal rounded-none bg-primary hover:bg-primary/80",children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),"Save Changes"]})]})]})}),e.jsx(os,{open:f&&x.length>0,onOpenChange:u,children:e.jsxs(ls,{"data-modal":"brain-delete-session",className:"bg-black border-2 border-destructive rounded-none translate-y-0",style:{zIndex:100005,top:"6rem",left:"50%",transform:"translate(-50%, 0)"},children:[e.jsxs(ds,{children:[e.jsxs(cs,{className:"font-arcade text-destructive flex items-center gap-2",children:[e.jsx(me,{className:"w-5 h-5"}),"CONFIRM DELETE"]}),e.jsxs(is,{className:"font-terminal text-muted-foreground",children:["Are you sure you want to delete ",x.length," session",x.length!==1?"s":"","? This action cannot be undone."]})]}),e.jsxs(ms,{className:"gap-2",children:[e.jsx(us,{className:"font-terminal rounded-none border-secondary hover:bg-secondary/20",children:"Cancel"}),e.jsxs(xs,{onClick:qs,className:"font-terminal rounded-none bg-destructive hover:bg-destructive/80 text-destructive-foreground",children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]})}),e.jsx(Je,{open:E!==null,onOpenChange:s=>{s||b(null)},children:e.jsxs(Ye,{"data-modal":"brain-edit-draft",className:"bg-black border-2 border-primary rounded-none max-w-lg translate-y-0",style:{zIndex:100005,top:"6rem",left:"50%",transform:"translate(-50%, 0)"},children:[e.jsxs(Ge,{children:[e.jsxs(Qe,{className:"font-arcade text-primary flex items-center gap-2",children:[e.jsx(ye,{className:"w-5 h-5"}),"EDIT CARD"]}),e.jsx(Xe,{className:"font-terminal text-muted-foreground",children:"Edit card content and select target deck"})]}),e.jsxs("div",{className:"space-y-4 font-terminal",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Front (Question)"}),e.jsx(ne,{value:T.front,onChange:s=>q(o=>({...o,front:s.target.value})),placeholder:"Card front...",className:"rounded-none border-secondary min-h-[80px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Back (Answer)"}),e.jsx(ne,{value:T.back,onChange:s=>q(o=>({...o,back:s.target.value})),placeholder:"Card back...",className:"rounded-none border-secondary min-h-[80px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Target Deck"}),e.jsxs(we,{value:T.deckName,onValueChange:s=>q(o=>({...o,deckName:s})),children:[e.jsx(Ce,{className:"rounded-none border-secondary",children:e.jsx(ke,{placeholder:"Select deck"})}),e.jsxs(Ae,{className:"rounded-none border-secondary bg-black max-h-[200px]",children:[e.jsx(U,{value:"PT::EBP",children:"PT::EBP (Evidence Based Practice)"}),e.jsx(U,{value:"PT::ExPhys",children:"PT::ExPhys (Exercise Physiology)"}),e.jsx(U,{value:"PT::MS1",children:"PT::MS1 (Movement Science 1)"}),e.jsx(U,{value:"PT::Neuro",children:"PT::Neuro (Neuroscience)"}),e.jsx(U,{value:"PT::TI",children:"PT::TI (Therapeutic Intervention)"}),e.jsx(U,{value:"PT::General",children:"PT::General"}),X?.decks?.filter(s=>!s.startsWith("PT::")).map(s=>e.jsx(U,{value:s,children:s},s))]})]}),e.jsxs("p",{className:"text-[10px] text-muted-foreground mt-1",children:["Current: ",e.jsx("span",{className:"text-blue-400",children:T.deckName})]})]})]}),e.jsxs(Ze,{className:"gap-2",children:[e.jsxs(F,{variant:"outline",onClick:()=>b(null),className:"font-terminal rounded-none border-secondary hover:bg-secondary/20",children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),"Cancel"]}),e.jsxs(F,{onClick:Js,disabled:Pe.isPending,className:"font-terminal rounded-none bg-primary hover:bg-primary/80",children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),Pe.isPending?"Saving...":"Save"]})]})]})})]})}export{ia as default};
