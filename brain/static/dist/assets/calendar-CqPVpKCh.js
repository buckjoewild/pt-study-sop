import{c as _s,r as d,j as n,b as K,i as Ps,k as V,l as St,R as zs,f as Lr,a as Ys,P as Gn,g as Us,u as $s,d as Kn,X as Or,e as Fr}from"./index-DF-Ci4pY.js";import{w as Gs,x as Ks,B as U,f as At,h as Mt,j as Lt,k as Ot,I as H,t as Ft,v as On,m as Rt,y as Hs,z as _r,u as Ye,e as Q,p as q,S as Fn,L as Bs,i as fr,q as Vs}from"./layout-DTksDvAT.js";import{C as Pr,a as zr,b as qs,d as Qs,B as Nn,c as Ws}from"./badge-CHdU4YP4.js";import{C as _t}from"./checkbox-C2pP7FBD.js";import{S as ne,a as re,b as se,c as ae,d as T,C as Zs}from"./select-Ctls9wht.js";import{P as Xt}from"./plus-Lju3iire.js";import{C as Hn}from"./index-ph0M9LG5.js";import{t as be,e as _n,m as Bn,g as qe,h as Vn,j as Xs,b as Yr,f as B,a as ot,c as Js,i as ea,s as jn,k as mr,C as Ur,l as ta}from"./isTomorrow-BB-nbDwD.js";import{C as na}from"./clock-C_AltzvL.js";import{L as ra}from"./link-CCFveJj-.js";import{L as sa}from"./loader-circle-b8bJQH5G.js";import{S as aa}from"./send-BNkO-TRT.js";import{R as $r,S as oa}from"./search-CTRw4orC.js";import{E as ia}from"./external-link-DxZAScSn.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const la=[["path",{d:"M21 5H3",key:"1fi0y6"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M17 19H3",key:"z6ezky"}]],Gr=_s("text-align-start",la);function Pn(e,r){const t=be(e);if(isNaN(r))return _n(e,NaN);if(!r)return t;const s=t.getDate(),o=_n(e,t.getTime());o.setMonth(t.getMonth()+r+1,0);const i=o.getDate();return s>=i?o:(t.setFullYear(o.getFullYear(),o.getMonth(),s),t)}function ca(e,r){const t=+be(e);return _n(e,t+r)}function da(e,r){return ca(e,r*Bn)}function Kr(e,r){const t=r*7;return qe(e,t)}function ua(e){return r=>{const t=Math.trunc,s=t(r);return s===0?0:s}}function fa(e,r){return+be(e)-+be(r)}function hr(e,r,t){const s=fa(e,r)/Vn;return ua()(s)}function wn(e){const r=be(e),t=r.getMonth();return r.setFullYear(r.getFullYear(),t+1,0),r.setHours(23,59,59,999),r}function Cn(e,r){const t=be(e.start),s=be(e.end);let o=+t>+s;const i=o?+t:+s,l=o?s:t;l.setHours(0,0,0,0);let c=1;const u=[];for(;+l<=i;)u.push(be(l)),l.setDate(l.getDate()+c),l.setHours(0,0,0,0);return o?u.reverse():u}function En(e){const r=be(e);return r.setDate(1),r.setHours(0,0,0,0),r}function gr(e,r){const t=Xs(),s=r?.weekStartsOn??r?.locale?.options?.weekStartsOn??t.weekStartsOn??t.locale?.options?.weekStartsOn??0,o=be(e),i=o.getDay(),l=(i<s?-7:0)+6-(i-s);return o.setDate(o.getDate()+l),o.setHours(23,59,59,999),o}function xr(e,r){const t=be(e),s=be(r);return t.getFullYear()===s.getFullYear()&&t.getMonth()===s.getMonth()}function ma(e,r){return qe(e,-1)}function Hr(e,r){const s=pa(e);let o;if(s.date){const u=ba(s.date,2);o=ya(u.restDateString,u.year)}if(!o||isNaN(o.getTime()))return new Date(NaN);const i=o.getTime();let l=0,c;if(s.time&&(l=va(s.time),isNaN(l)))return new Date(NaN);if(s.timezone){if(c=Na(s.timezone),isNaN(c))return new Date(NaN)}else{const u=new Date(i+l),m=new Date(0);return m.setFullYear(u.getUTCFullYear(),u.getUTCMonth(),u.getUTCDate()),m.setHours(u.getUTCHours(),u.getUTCMinutes(),u.getUTCSeconds(),u.getUTCMilliseconds()),m}return new Date(i+l+c)}const qt={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},ha=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,ga=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,xa=/^([+-])(\d{2})(?::?(\d{2}))?$/;function pa(e){const r={},t=e.split(qt.dateTimeDelimiter);let s;if(t.length>2)return r;if(/:/.test(t[0])?s=t[0]:(r.date=t[0],s=t[1],qt.timeZoneDelimiter.test(r.date)&&(r.date=e.split(qt.timeZoneDelimiter)[0],s=e.substr(r.date.length,e.length))),s){const o=qt.timezone.exec(s);o?(r.time=s.replace(o[1],""),r.timezone=o[1]):r.time=s}return r}function ba(e,r){const t=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+r)+"})|(\\d{2}|[+-]\\d{"+(2+r)+"})$)"),s=e.match(t);if(!s)return{year:NaN,restDateString:""};const o=s[1]?parseInt(s[1]):null,i=s[2]?parseInt(s[2]):null;return{year:i===null?o:i*100,restDateString:e.slice((s[1]||s[2]).length)}}function ya(e,r){if(r===null)return new Date(NaN);const t=e.match(ha);if(!t)return new Date(NaN);const s=!!t[4],o=Dt(t[1]),i=Dt(t[2])-1,l=Dt(t[3]),c=Dt(t[4]),u=Dt(t[5])-1;if(s)return Da(r,c,u)?ja(r,c,u):new Date(NaN);{const m=new Date(0);return!Ca(r,i,l)||!Ea(r,o)?new Date(NaN):(m.setUTCFullYear(r,i,Math.max(o,l)),m)}}function Dt(e){return e?parseInt(e):1}function va(e){const r=e.match(ga);if(!r)return NaN;const t=Dn(r[1]),s=Dn(r[2]),o=Dn(r[3]);return Sa(t,s,o)?t*Bn+s*Vn+o*1e3:NaN}function Dn(e){return e&&parseFloat(e.replace(",","."))||0}function Na(e){if(e==="Z")return 0;const r=e.match(xa);if(!r)return 0;const t=r[1]==="+"?-1:1,s=parseInt(r[2]),o=r[3]&&parseInt(r[3])||0;return Ra(s,o)?t*(s*Bn+o*Vn):NaN}function ja(e,r,t){const s=new Date(0);s.setUTCFullYear(e,0,4);const o=s.getUTCDay()||7,i=(r-1)*7+t+1-o;return s.setUTCDate(s.getUTCDate()+i),s}const wa=[31,null,31,30,31,30,31,31,30,31,30,31];function Br(e){return e%400===0||e%4===0&&e%100!==0}function Ca(e,r,t){return r>=0&&r<=11&&t>=1&&t<=(wa[r]||(Br(e)?29:28))}function Ea(e,r){return r>=1&&r<=(Br(e)?366:365)}function Da(e,r,t){return r>=1&&r<=53&&t>=0&&t<=6}function Sa(e,r,t){return e===24?r===0&&t===0:t>=0&&t<60&&r>=0&&r<60&&e>=0&&e<25}function Ra(e,r){return r>=0&&r<=59}function it(e,r){const t=be(e);return t.setHours(r),t}function lt(e,r){const t=be(e);return t.setMinutes(r),t}function pr(e,r){return Pn(e,-1)}function Ta(e,r){return Kr(e,-1)}var Ia=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],ka=Ia.reduce((e,r)=>{const t=Gs(`Primitive.${r}`),s=d.forwardRef((o,i)=>{const{asChild:l,...c}=o,u=l?t:r;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),n.jsx(u,{...c,ref:i})});return s.displayName=`Primitive.${r}`,{...e,[r]:s}},{}),Aa="Label",Vr=d.forwardRef((e,r)=>n.jsx(ka.label,{...e,ref:r,onMouseDown:t=>{t.target.closest("button, input, select, textarea")||(e.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));Vr.displayName=Aa;var qr=Vr;const Ma=Ps("font-terminal text-base font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),F=d.forwardRef(({className:e,...r},t)=>n.jsx(qr,{ref:t,className:K(Ma(),e),...r}));F.displayName=qr.displayName;function La(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];return d.useMemo(()=>s=>{r.forEach(o=>o(s))},r)}const an=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function ht(e){const r=Object.prototype.toString.call(e);return r==="[object Window]"||r==="[object global]"}function qn(e){return"nodeType"in e}function ge(e){var r,t;return e?ht(e)?e:qn(e)&&(r=(t=e.ownerDocument)==null?void 0:t.defaultView)!=null?r:window:window}function Qn(e){const{Document:r}=ge(e);return e instanceof r}function Ut(e){return ht(e)?!1:e instanceof ge(e).HTMLElement}function Qr(e){return e instanceof ge(e).SVGElement}function gt(e){return e?ht(e)?e.document:qn(e)?Qn(e)?e:Ut(e)||Qr(e)?e.ownerDocument:document:document:document}const ke=an?d.useLayoutEffect:d.useEffect;function on(e){const r=d.useRef(e);return ke(()=>{r.current=e}),d.useCallback(function(){for(var t=arguments.length,s=new Array(t),o=0;o<t;o++)s[o]=arguments[o];return r.current==null?void 0:r.current(...s)},[])}function Oa(){const e=d.useRef(null),r=d.useCallback((s,o)=>{e.current=setInterval(s,o)},[]),t=d.useCallback(()=>{e.current!==null&&(clearInterval(e.current),e.current=null)},[]);return[r,t]}function Pt(e,r){r===void 0&&(r=[e]);const t=d.useRef(e);return ke(()=>{t.current!==e&&(t.current=e)},r),t}function $t(e,r){const t=d.useRef();return d.useMemo(()=>{const s=e(t.current);return t.current=s,s},[...r])}function Jt(e){const r=on(e),t=d.useRef(null),s=d.useCallback(o=>{o!==t.current&&r?.(o,t.current),t.current=o},[]);return[t,s]}function en(e){const r=d.useRef();return d.useEffect(()=>{r.current=e},[e]),r.current}let Sn={};function Gt(e,r){return d.useMemo(()=>{if(r)return r;const t=Sn[e]==null?0:Sn[e]+1;return Sn[e]=t,e+"-"+t},[e,r])}function Wr(e){return function(r){for(var t=arguments.length,s=new Array(t>1?t-1:0),o=1;o<t;o++)s[o-1]=arguments[o];return s.reduce((i,l)=>{const c=Object.entries(l);for(const[u,m]of c){const f=i[u];f!=null&&(i[u]=f+e*m)}return i},{...r})}}const mt=Wr(1),zt=Wr(-1);function Fa(e){return"clientX"in e&&"clientY"in e}function ln(e){if(!e)return!1;const{KeyboardEvent:r}=ge(e.target);return r&&e instanceof r}function _a(e){if(!e)return!1;const{TouchEvent:r}=ge(e.target);return r&&e instanceof r}function tn(e){if(_a(e)){if(e.touches&&e.touches.length){const{clientX:r,clientY:t}=e.touches[0];return{x:r,y:t}}else if(e.changedTouches&&e.changedTouches.length){const{clientX:r,clientY:t}=e.changedTouches[0];return{x:r,y:t}}}return Fa(e)?{x:e.clientX,y:e.clientY}:null}const $e=Object.freeze({Translate:{toString(e){if(!e)return;const{x:r,y:t}=e;return"translate3d("+(r?Math.round(r):0)+"px, "+(t?Math.round(t):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:r,scaleY:t}=e;return"scaleX("+r+") scaleY("+t+")"}},Transform:{toString(e){if(e)return[$e.Translate.toString(e),$e.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:r,duration:t,easing:s}=e;return r+" "+t+"ms "+s}}}),br="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function Pa(e){return e.matches(br)?e:e.querySelector(br)}const za={display:"none"};function Ya(e){let{id:r,value:t}=e;return V.createElement("div",{id:r,style:za},t)}function Ua(e){let{id:r,announcement:t,ariaLiveType:s="assertive"}=e;const o={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return V.createElement("div",{id:r,style:o,role:"status","aria-live":s,"aria-atomic":!0},t)}function $a(){const[e,r]=d.useState("");return{announce:d.useCallback(s=>{s!=null&&r(s)},[]),announcement:e}}const Zr=d.createContext(null);function Ga(e){const r=d.useContext(Zr);d.useEffect(()=>{if(!r)throw new Error("useDndMonitor must be used within a children of <DndContext>");return r(e)},[e,r])}function Ka(){const[e]=d.useState(()=>new Set),r=d.useCallback(s=>(e.add(s),()=>e.delete(s)),[e]);return[d.useCallback(s=>{let{type:o,event:i}=s;e.forEach(l=>{var c;return(c=l[o])==null?void 0:c.call(l,i)})},[e]),r]}const Ha={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},Ba={onDragStart(e){let{active:r}=e;return"Picked up draggable item "+r.id+"."},onDragOver(e){let{active:r,over:t}=e;return t?"Draggable item "+r.id+" was moved over droppable area "+t.id+".":"Draggable item "+r.id+" is no longer over a droppable area."},onDragEnd(e){let{active:r,over:t}=e;return t?"Draggable item "+r.id+" was dropped over droppable area "+t.id:"Draggable item "+r.id+" was dropped."},onDragCancel(e){let{active:r}=e;return"Dragging was cancelled. Draggable item "+r.id+" was dropped."}};function Va(e){let{announcements:r=Ba,container:t,hiddenTextDescribedById:s,screenReaderInstructions:o=Ha}=e;const{announce:i,announcement:l}=$a(),c=Gt("DndLiveRegion"),[u,m]=d.useState(!1);if(d.useEffect(()=>{m(!0)},[]),Ga(d.useMemo(()=>({onDragStart(p){let{active:x}=p;i(r.onDragStart({active:x}))},onDragMove(p){let{active:x,over:y}=p;r.onDragMove&&i(r.onDragMove({active:x,over:y}))},onDragOver(p){let{active:x,over:y}=p;i(r.onDragOver({active:x,over:y}))},onDragEnd(p){let{active:x,over:y}=p;i(r.onDragEnd({active:x,over:y}))},onDragCancel(p){let{active:x,over:y}=p;i(r.onDragCancel({active:x,over:y}))}}),[i,r])),!u)return null;const f=V.createElement(V.Fragment,null,V.createElement(Ya,{id:s,value:o.draggable}),V.createElement(Ua,{id:c,announcement:l}));return t?St.createPortal(f,t):f}var Z;(function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"})(Z||(Z={}));function nn(){}function zn(e,r){return d.useMemo(()=>({sensor:e,options:r??{}}),[e,r])}function Xr(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];return d.useMemo(()=>[...r].filter(s=>s!=null),[...r])}const Ae=Object.freeze({x:0,y:0});function Jr(e,r){return Math.sqrt(Math.pow(e.x-r.x,2)+Math.pow(e.y-r.y,2))}function qa(e,r){const t=tn(e);if(!t)return"0 0";const s={x:(t.x-r.left)/r.width*100,y:(t.y-r.top)/r.height*100};return s.x+"% "+s.y+"%"}function es(e,r){let{data:{value:t}}=e,{data:{value:s}}=r;return t-s}function Qa(e,r){let{data:{value:t}}=e,{data:{value:s}}=r;return s-t}function yr(e){let{left:r,top:t,height:s,width:o}=e;return[{x:r,y:t},{x:r+o,y:t},{x:r,y:t+s},{x:r+o,y:t+s}]}function ts(e,r){if(!e||e.length===0)return null;const[t]=e;return t[r]}function vr(e,r,t){return r===void 0&&(r=e.left),t===void 0&&(t=e.top),{x:r+e.width*.5,y:t+e.height*.5}}const ns=e=>{let{collisionRect:r,droppableRects:t,droppableContainers:s}=e;const o=vr(r,r.left,r.top),i=[];for(const l of s){const{id:c}=l,u=t.get(c);if(u){const m=Jr(vr(u),o);i.push({id:c,data:{droppableContainer:l,value:m}})}}return i.sort(es)},Wa=e=>{let{collisionRect:r,droppableRects:t,droppableContainers:s}=e;const o=yr(r),i=[];for(const l of s){const{id:c}=l,u=t.get(c);if(u){const m=yr(u),f=o.reduce((x,y,S)=>x+Jr(m[S],y),0),p=Number((f/4).toFixed(4));i.push({id:c,data:{droppableContainer:l,value:p}})}}return i.sort(es)};function Za(e,r){const t=Math.max(r.top,e.top),s=Math.max(r.left,e.left),o=Math.min(r.left+r.width,e.left+e.width),i=Math.min(r.top+r.height,e.top+e.height),l=o-s,c=i-t;if(s<o&&t<i){const u=r.width*r.height,m=e.width*e.height,f=l*c,p=f/(u+m-f);return Number(p.toFixed(4))}return 0}const Xa=e=>{let{collisionRect:r,droppableRects:t,droppableContainers:s}=e;const o=[];for(const i of s){const{id:l}=i,c=t.get(l);if(c){const u=Za(c,r);u>0&&o.push({id:l,data:{droppableContainer:i,value:u}})}}return o.sort(Qa)};function Ja(e,r,t){return{...e,scaleX:r&&t?r.width/t.width:1,scaleY:r&&t?r.height/t.height:1}}function rs(e,r){return e&&r?{x:e.left-r.left,y:e.top-r.top}:Ae}function eo(e){return function(t){for(var s=arguments.length,o=new Array(s>1?s-1:0),i=1;i<s;i++)o[i-1]=arguments[i];return o.reduce((l,c)=>({...l,top:l.top+e*c.y,bottom:l.bottom+e*c.y,left:l.left+e*c.x,right:l.right+e*c.x}),{...t})}}const to=eo(1);function ss(e){if(e.startsWith("matrix3d(")){const r=e.slice(9,-1).split(/, /);return{x:+r[12],y:+r[13],scaleX:+r[0],scaleY:+r[5]}}else if(e.startsWith("matrix(")){const r=e.slice(7,-1).split(/, /);return{x:+r[4],y:+r[5],scaleX:+r[0],scaleY:+r[3]}}return null}function no(e,r,t){const s=ss(r);if(!s)return e;const{scaleX:o,scaleY:i,x:l,y:c}=s,u=e.left-l-(1-o)*parseFloat(t),m=e.top-c-(1-i)*parseFloat(t.slice(t.indexOf(" ")+1)),f=o?e.width/o:e.width,p=i?e.height/i:e.height;return{width:f,height:p,top:m,right:u+f,bottom:m+p,left:u}}const ro={ignoreTransform:!1};function xt(e,r){r===void 0&&(r=ro);let t=e.getBoundingClientRect();if(r.ignoreTransform){const{transform:m,transformOrigin:f}=ge(e).getComputedStyle(e);m&&(t=no(t,m,f))}const{top:s,left:o,width:i,height:l,bottom:c,right:u}=t;return{top:s,left:o,width:i,height:l,bottom:c,right:u}}function Nr(e){return xt(e,{ignoreTransform:!0})}function so(e){const r=e.innerWidth,t=e.innerHeight;return{top:0,left:0,right:r,bottom:t,width:r,height:t}}function ao(e,r){return r===void 0&&(r=ge(e).getComputedStyle(e)),r.position==="fixed"}function oo(e,r){r===void 0&&(r=ge(e).getComputedStyle(e));const t=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(o=>{const i=r[o];return typeof i=="string"?t.test(i):!1})}function cn(e,r){const t=[];function s(o){if(r!=null&&t.length>=r||!o)return t;if(Qn(o)&&o.scrollingElement!=null&&!t.includes(o.scrollingElement))return t.push(o.scrollingElement),t;if(!Ut(o)||Qr(o)||t.includes(o))return t;const i=ge(e).getComputedStyle(o);return o!==e&&oo(o,i)&&t.push(o),ao(o,i)?t:s(o.parentNode)}return e?s(e):t}function as(e){const[r]=cn(e,1);return r??null}function Rn(e){return!an||!e?null:ht(e)?e:qn(e)?Qn(e)||e===gt(e).scrollingElement?window:Ut(e)?e:null:null}function os(e){return ht(e)?e.scrollX:e.scrollLeft}function is(e){return ht(e)?e.scrollY:e.scrollTop}function Yn(e){return{x:os(e),y:is(e)}}var ee;(function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"})(ee||(ee={}));function ls(e){return!an||!e?!1:e===document.scrollingElement}function cs(e){const r={x:0,y:0},t=ls(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},s={x:e.scrollWidth-t.width,y:e.scrollHeight-t.height},o=e.scrollTop<=r.y,i=e.scrollLeft<=r.x,l=e.scrollTop>=s.y,c=e.scrollLeft>=s.x;return{isTop:o,isLeft:i,isBottom:l,isRight:c,maxScroll:s,minScroll:r}}const io={x:.2,y:.2};function lo(e,r,t,s,o){let{top:i,left:l,right:c,bottom:u}=t;s===void 0&&(s=10),o===void 0&&(o=io);const{isTop:m,isBottom:f,isLeft:p,isRight:x}=cs(e),y={x:0,y:0},S={x:0,y:0},j={height:r.height*o.y,width:r.width*o.x};return!m&&i<=r.top+j.height?(y.y=ee.Backward,S.y=s*Math.abs((r.top+j.height-i)/j.height)):!f&&u>=r.bottom-j.height&&(y.y=ee.Forward,S.y=s*Math.abs((r.bottom-j.height-u)/j.height)),!x&&c>=r.right-j.width?(y.x=ee.Forward,S.x=s*Math.abs((r.right-j.width-c)/j.width)):!p&&l<=r.left+j.width&&(y.x=ee.Backward,S.x=s*Math.abs((r.left+j.width-l)/j.width)),{direction:y,speed:S}}function co(e){if(e===document.scrollingElement){const{innerWidth:i,innerHeight:l}=window;return{top:0,left:0,right:i,bottom:l,width:i,height:l}}const{top:r,left:t,right:s,bottom:o}=e.getBoundingClientRect();return{top:r,left:t,right:s,bottom:o,width:e.clientWidth,height:e.clientHeight}}function ds(e){return e.reduce((r,t)=>mt(r,Yn(t)),Ae)}function uo(e){return e.reduce((r,t)=>r+os(t),0)}function fo(e){return e.reduce((r,t)=>r+is(t),0)}function us(e,r){if(r===void 0&&(r=xt),!e)return;const{top:t,left:s,bottom:o,right:i}=r(e);as(e)&&(o<=0||i<=0||t>=window.innerHeight||s>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const mo=[["x",["left","right"],uo],["y",["top","bottom"],fo]];class Wn{constructor(r,t){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const s=cn(t),o=ds(s);this.rect={...r},this.width=r.width,this.height=r.height;for(const[i,l,c]of mo)for(const u of l)Object.defineProperty(this,u,{get:()=>{const m=c(s),f=o[i]-m;return this.rect[u]+f},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Tt{constructor(r){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(t=>{var s;return(s=this.target)==null?void 0:s.removeEventListener(...t)})},this.target=r}add(r,t,s){var o;(o=this.target)==null||o.addEventListener(r,t,s),this.listeners.push([r,t,s])}}function ho(e){const{EventTarget:r}=ge(e);return e instanceof r?e:gt(e)}function Tn(e,r){const t=Math.abs(e.x),s=Math.abs(e.y);return typeof r=="number"?Math.sqrt(t**2+s**2)>r:"x"in r&&"y"in r?t>r.x&&s>r.y:"x"in r?t>r.x:"y"in r?s>r.y:!1}var Ee;(function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"})(Ee||(Ee={}));function jr(e){e.preventDefault()}function go(e){e.stopPropagation()}var Y;(function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"})(Y||(Y={}));const fs={start:[Y.Space,Y.Enter],cancel:[Y.Esc],end:[Y.Space,Y.Enter,Y.Tab]},xo=(e,r)=>{let{currentCoordinates:t}=r;switch(e.code){case Y.Right:return{...t,x:t.x+25};case Y.Left:return{...t,x:t.x-25};case Y.Down:return{...t,y:t.y+25};case Y.Up:return{...t,y:t.y-25}}};class Zn{constructor(r){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=r;const{event:{target:t}}=r;this.props=r,this.listeners=new Tt(gt(t)),this.windowListeners=new Tt(ge(t)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Ee.Resize,this.handleCancel),this.windowListeners.add(Ee.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Ee.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:r,onStart:t}=this.props,s=r.node.current;s&&us(s),t(Ae)}handleKeyDown(r){if(ln(r)){const{active:t,context:s,options:o}=this.props,{keyboardCodes:i=fs,coordinateGetter:l=xo,scrollBehavior:c="smooth"}=o,{code:u}=r;if(i.end.includes(u)){this.handleEnd(r);return}if(i.cancel.includes(u)){this.handleCancel(r);return}const{collisionRect:m}=s.current,f=m?{x:m.left,y:m.top}:Ae;this.referenceCoordinates||(this.referenceCoordinates=f);const p=l(r,{active:t,context:s.current,currentCoordinates:f});if(p){const x=zt(p,f),y={x:0,y:0},{scrollableAncestors:S}=s.current;for(const j of S){const C=r.code,{isTop:M,isRight:I,isLeft:b,isBottom:D,maxScroll:A,minScroll:w}=cs(j),L=co(j),g={x:Math.min(C===Y.Right?L.right-L.width/2:L.right,Math.max(C===Y.Right?L.left:L.left+L.width/2,p.x)),y:Math.min(C===Y.Down?L.bottom-L.height/2:L.bottom,Math.max(C===Y.Down?L.top:L.top+L.height/2,p.y))},k=C===Y.Right&&!I||C===Y.Left&&!b,P=C===Y.Down&&!D||C===Y.Up&&!M;if(k&&g.x!==p.x){const z=j.scrollLeft+x.x,ce=C===Y.Right&&z<=A.x||C===Y.Left&&z>=w.x;if(ce&&!x.y){j.scrollTo({left:z,behavior:c});return}ce?y.x=j.scrollLeft-z:y.x=C===Y.Right?j.scrollLeft-A.x:j.scrollLeft-w.x,y.x&&j.scrollBy({left:-y.x,behavior:c});break}else if(P&&g.y!==p.y){const z=j.scrollTop+x.y,ce=C===Y.Down&&z<=A.y||C===Y.Up&&z>=w.y;if(ce&&!x.x){j.scrollTo({top:z,behavior:c});return}ce?y.y=j.scrollTop-z:y.y=C===Y.Down?j.scrollTop-A.y:j.scrollTop-w.y,y.y&&j.scrollBy({top:-y.y,behavior:c});break}}this.handleMove(r,mt(zt(p,this.referenceCoordinates),y))}}}handleMove(r,t){const{onMove:s}=this.props;r.preventDefault(),s(t)}handleEnd(r){const{onEnd:t}=this.props;r.preventDefault(),this.detach(),t()}handleCancel(r){const{onCancel:t}=this.props;r.preventDefault(),this.detach(),t()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}Zn.activators=[{eventName:"onKeyDown",handler:(e,r,t)=>{let{keyboardCodes:s=fs,onActivation:o}=r,{active:i}=t;const{code:l}=e.nativeEvent;if(s.start.includes(l)){const c=i.activatorNode.current;return c&&e.target!==c?!1:(e.preventDefault(),o?.({event:e.nativeEvent}),!0)}return!1}}];function wr(e){return!!(e&&"distance"in e)}function Cr(e){return!!(e&&"delay"in e)}class Xn{constructor(r,t,s){var o;s===void 0&&(s=ho(r.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=r,this.events=t;const{event:i}=r,{target:l}=i;this.props=r,this.events=t,this.document=gt(l),this.documentListeners=new Tt(this.document),this.listeners=new Tt(s),this.windowListeners=new Tt(ge(l)),this.initialCoordinates=(o=tn(i))!=null?o:Ae,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:r,props:{options:{activationConstraint:t,bypassActivationConstraint:s}}}=this;if(this.listeners.add(r.move.name,this.handleMove,{passive:!1}),this.listeners.add(r.end.name,this.handleEnd),r.cancel&&this.listeners.add(r.cancel.name,this.handleCancel),this.windowListeners.add(Ee.Resize,this.handleCancel),this.windowListeners.add(Ee.DragStart,jr),this.windowListeners.add(Ee.VisibilityChange,this.handleCancel),this.windowListeners.add(Ee.ContextMenu,jr),this.documentListeners.add(Ee.Keydown,this.handleKeydown),t){if(s!=null&&s({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(Cr(t)){this.timeoutId=setTimeout(this.handleStart,t.delay),this.handlePending(t);return}if(wr(t)){this.handlePending(t);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(r,t){const{active:s,onPending:o}=this.props;o(s,r,this.initialCoordinates,t)}handleStart(){const{initialCoordinates:r}=this,{onStart:t}=this.props;r&&(this.activated=!0,this.documentListeners.add(Ee.Click,go,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Ee.SelectionChange,this.removeTextSelection),t(r))}handleMove(r){var t;const{activated:s,initialCoordinates:o,props:i}=this,{onMove:l,options:{activationConstraint:c}}=i;if(!o)return;const u=(t=tn(r))!=null?t:Ae,m=zt(o,u);if(!s&&c){if(wr(c)){if(c.tolerance!=null&&Tn(m,c.tolerance))return this.handleCancel();if(Tn(m,c.distance))return this.handleStart()}if(Cr(c)&&Tn(m,c.tolerance))return this.handleCancel();this.handlePending(c,m);return}r.cancelable&&r.preventDefault(),l(u)}handleEnd(){const{onAbort:r,onEnd:t}=this.props;this.detach(),this.activated||r(this.props.active),t()}handleCancel(){const{onAbort:r,onCancel:t}=this.props;this.detach(),this.activated||r(this.props.active),t()}handleKeydown(r){r.code===Y.Esc&&this.handleCancel()}removeTextSelection(){var r;(r=this.document.getSelection())==null||r.removeAllRanges()}}const po={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class dn extends Xn{constructor(r){const{event:t}=r,s=gt(t.target);super(r,po,s)}}dn.activators=[{eventName:"onPointerDown",handler:(e,r)=>{let{nativeEvent:t}=e,{onActivation:s}=r;return!t.isPrimary||t.button!==0?!1:(s?.({event:t}),!0)}}];const bo={move:{name:"mousemove"},end:{name:"mouseup"}};var Un;(function(e){e[e.RightClick=2]="RightClick"})(Un||(Un={}));class yo extends Xn{constructor(r){super(r,bo,gt(r.event.target))}}yo.activators=[{eventName:"onMouseDown",handler:(e,r)=>{let{nativeEvent:t}=e,{onActivation:s}=r;return t.button===Un.RightClick?!1:(s?.({event:t}),!0)}}];const In={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class vo extends Xn{constructor(r){super(r,In)}static setup(){return window.addEventListener(In.move.name,r,{capture:!1,passive:!1}),function(){window.removeEventListener(In.move.name,r)};function r(){}}}vo.activators=[{eventName:"onTouchStart",handler:(e,r)=>{let{nativeEvent:t}=e,{onActivation:s}=r;const{touches:o}=t;return o.length>1?!1:(s?.({event:t}),!0)}}];var It;(function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"})(It||(It={}));var rn;(function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"})(rn||(rn={}));function No(e){let{acceleration:r,activator:t=It.Pointer,canScroll:s,draggingRect:o,enabled:i,interval:l=5,order:c=rn.TreeOrder,pointerCoordinates:u,scrollableAncestors:m,scrollableAncestorRects:f,delta:p,threshold:x}=e;const y=wo({delta:p,disabled:!i}),[S,j]=Oa(),C=d.useRef({x:0,y:0}),M=d.useRef({x:0,y:0}),I=d.useMemo(()=>{switch(t){case It.Pointer:return u?{top:u.y,bottom:u.y,left:u.x,right:u.x}:null;case It.DraggableRect:return o}},[t,o,u]),b=d.useRef(null),D=d.useCallback(()=>{const w=b.current;if(!w)return;const L=C.current.x*M.current.x,g=C.current.y*M.current.y;w.scrollBy(L,g)},[]),A=d.useMemo(()=>c===rn.TreeOrder?[...m].reverse():m,[c,m]);d.useEffect(()=>{if(!i||!m.length||!I){j();return}for(const w of A){if(s?.(w)===!1)continue;const L=m.indexOf(w),g=f[L];if(!g)continue;const{direction:k,speed:P}=lo(w,g,I,r,x);for(const z of["x","y"])y[z][k[z]]||(P[z]=0,k[z]=0);if(P.x>0||P.y>0){j(),b.current=w,S(D,l),C.current=P,M.current=k;return}}C.current={x:0,y:0},M.current={x:0,y:0},j()},[r,D,s,j,i,l,JSON.stringify(I),JSON.stringify(y),S,m,A,f,JSON.stringify(x)])}const jo={x:{[ee.Backward]:!1,[ee.Forward]:!1},y:{[ee.Backward]:!1,[ee.Forward]:!1}};function wo(e){let{delta:r,disabled:t}=e;const s=en(r);return $t(o=>{if(t||!s||!o)return jo;const i={x:Math.sign(r.x-s.x),y:Math.sign(r.y-s.y)};return{x:{[ee.Backward]:o.x[ee.Backward]||i.x===-1,[ee.Forward]:o.x[ee.Forward]||i.x===1},y:{[ee.Backward]:o.y[ee.Backward]||i.y===-1,[ee.Forward]:o.y[ee.Forward]||i.y===1}}},[t,r,s])}function Co(e,r){const t=r!=null?e.get(r):void 0,s=t?t.node.current:null;return $t(o=>{var i;return r==null?null:(i=s??o)!=null?i:null},[s,r])}function Eo(e,r){return d.useMemo(()=>e.reduce((t,s)=>{const{sensor:o}=s,i=o.activators.map(l=>({eventName:l.eventName,handler:r(l.handler,s)}));return[...t,...i]},[]),[e,r])}var Yt;(function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"})(Yt||(Yt={}));var $n;(function(e){e.Optimized="optimized"})($n||($n={}));const Er=new Map;function Do(e,r){let{dragging:t,dependencies:s,config:o}=r;const[i,l]=d.useState(null),{frequency:c,measure:u,strategy:m}=o,f=d.useRef(e),p=C(),x=Pt(p),y=d.useCallback(function(M){M===void 0&&(M=[]),!x.current&&l(I=>I===null?M:I.concat(M.filter(b=>!I.includes(b))))},[x]),S=d.useRef(null),j=$t(M=>{if(p&&!t)return Er;if(!M||M===Er||f.current!==e||i!=null){const I=new Map;for(let b of e){if(!b)continue;if(i&&i.length>0&&!i.includes(b.id)&&b.rect.current){I.set(b.id,b.rect.current);continue}const D=b.node.current,A=D?new Wn(u(D),D):null;b.rect.current=A,A&&I.set(b.id,A)}return I}return M},[e,i,t,p,u]);return d.useEffect(()=>{f.current=e},[e]),d.useEffect(()=>{p||y()},[t,p]),d.useEffect(()=>{i&&i.length>0&&l(null)},[JSON.stringify(i)]),d.useEffect(()=>{p||typeof c!="number"||S.current!==null||(S.current=setTimeout(()=>{y(),S.current=null},c))},[c,p,y,...s]),{droppableRects:j,measureDroppableContainers:y,measuringScheduled:i!=null};function C(){switch(m){case Yt.Always:return!1;case Yt.BeforeDragging:return t;default:return!t}}}function Jn(e,r){return $t(t=>e?t||(typeof r=="function"?r(e):e):null,[r,e])}function So(e,r){return Jn(e,r)}function Ro(e){let{callback:r,disabled:t}=e;const s=on(r),o=d.useMemo(()=>{if(t||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:i}=window;return new i(s)},[s,t]);return d.useEffect(()=>()=>o?.disconnect(),[o]),o}function un(e){let{callback:r,disabled:t}=e;const s=on(r),o=d.useMemo(()=>{if(t||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:i}=window;return new i(s)},[t]);return d.useEffect(()=>()=>o?.disconnect(),[o]),o}function To(e){return new Wn(xt(e),e)}function Dr(e,r,t){r===void 0&&(r=To);const[s,o]=d.useState(null);function i(){o(u=>{if(!e)return null;if(e.isConnected===!1){var m;return(m=u??t)!=null?m:null}const f=r(e);return JSON.stringify(u)===JSON.stringify(f)?u:f})}const l=Ro({callback(u){if(e)for(const m of u){const{type:f,target:p}=m;if(f==="childList"&&p instanceof HTMLElement&&p.contains(e)){i();break}}}}),c=un({callback:i});return ke(()=>{i(),e?(c?.observe(e),l?.observe(document.body,{childList:!0,subtree:!0})):(c?.disconnect(),l?.disconnect())},[e]),s}function Io(e){const r=Jn(e);return rs(e,r)}const Sr=[];function ko(e){const r=d.useRef(e),t=$t(s=>e?s&&s!==Sr&&e&&r.current&&e.parentNode===r.current.parentNode?s:cn(e):Sr,[e]);return d.useEffect(()=>{r.current=e},[e]),t}function Ao(e){const[r,t]=d.useState(null),s=d.useRef(e),o=d.useCallback(i=>{const l=Rn(i.target);l&&t(c=>c?(c.set(l,Yn(l)),new Map(c)):null)},[]);return d.useEffect(()=>{const i=s.current;if(e!==i){l(i);const c=e.map(u=>{const m=Rn(u);return m?(m.addEventListener("scroll",o,{passive:!0}),[m,Yn(m)]):null}).filter(u=>u!=null);t(c.length?new Map(c):null),s.current=e}return()=>{l(e),l(i)};function l(c){c.forEach(u=>{const m=Rn(u);m?.removeEventListener("scroll",o)})}},[o,e]),d.useMemo(()=>e.length?r?Array.from(r.values()).reduce((i,l)=>mt(i,l),Ae):ds(e):Ae,[e,r])}function Rr(e,r){r===void 0&&(r=[]);const t=d.useRef(null);return d.useEffect(()=>{t.current=null},r),d.useEffect(()=>{const s=e!==Ae;s&&!t.current&&(t.current=e),!s&&t.current&&(t.current=null)},[e]),t.current?zt(e,t.current):Ae}function Mo(e){d.useEffect(()=>{if(!an)return;const r=e.map(t=>{let{sensor:s}=t;return s.setup==null?void 0:s.setup()});return()=>{for(const t of r)t?.()}},e.map(r=>{let{sensor:t}=r;return t}))}function Lo(e,r){return d.useMemo(()=>e.reduce((t,s)=>{let{eventName:o,handler:i}=s;return t[o]=l=>{i(l,r)},t},{}),[e,r])}function ms(e){return d.useMemo(()=>e?so(e):null,[e])}const Tr=[];function Oo(e,r){r===void 0&&(r=xt);const[t]=e,s=ms(t?ge(t):null),[o,i]=d.useState(Tr);function l(){i(()=>e.length?e.map(u=>ls(u)?s:new Wn(r(u),u)):Tr)}const c=un({callback:l});return ke(()=>{c?.disconnect(),l(),e.forEach(u=>c?.observe(u))},[e]),o}function hs(e){if(!e)return null;if(e.children.length>1)return e;const r=e.children[0];return Ut(r)?r:e}function Fo(e){let{measure:r}=e;const[t,s]=d.useState(null),o=d.useCallback(m=>{for(const{target:f}of m)if(Ut(f)){s(p=>{const x=r(f);return p?{...p,width:x.width,height:x.height}:x});break}},[r]),i=un({callback:o}),l=d.useCallback(m=>{const f=hs(m);i?.disconnect(),f&&i?.observe(f),s(f?r(f):null)},[r,i]),[c,u]=Jt(l);return d.useMemo(()=>({nodeRef:c,rect:t,setRef:u}),[t,c,u])}const _o=[{sensor:dn,options:{}},{sensor:Zn,options:{}}],Po={current:{}},Zt={draggable:{measure:Nr},droppable:{measure:Nr,strategy:Yt.WhileDragging,frequency:$n.Optimized},dragOverlay:{measure:xt}};class kt extends Map{get(r){var t;return r!=null&&(t=super.get(r))!=null?t:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(r=>{let{disabled:t}=r;return!t})}getNodeFor(r){var t,s;return(t=(s=this.get(r))==null?void 0:s.node.current)!=null?t:void 0}}const zo={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new kt,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:nn},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:Zt,measureDroppableContainers:nn,windowRect:null,measuringScheduled:!1},gs={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:nn,draggableNodes:new Map,over:null,measureDroppableContainers:nn},Kt=d.createContext(gs),xs=d.createContext(zo);function Yo(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new kt}}}function Uo(e,r){switch(r.type){case Z.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:r.initialCoordinates,active:r.active}};case Z.DragMove:return e.draggable.active==null?e:{...e,draggable:{...e.draggable,translate:{x:r.coordinates.x-e.draggable.initialCoordinates.x,y:r.coordinates.y-e.draggable.initialCoordinates.y}}};case Z.DragEnd:case Z.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case Z.RegisterDroppable:{const{element:t}=r,{id:s}=t,o=new kt(e.droppable.containers);return o.set(s,t),{...e,droppable:{...e.droppable,containers:o}}}case Z.SetDroppableDisabled:{const{id:t,key:s,disabled:o}=r,i=e.droppable.containers.get(t);if(!i||s!==i.key)return e;const l=new kt(e.droppable.containers);return l.set(t,{...i,disabled:o}),{...e,droppable:{...e.droppable,containers:l}}}case Z.UnregisterDroppable:{const{id:t,key:s}=r,o=e.droppable.containers.get(t);if(!o||s!==o.key)return e;const i=new kt(e.droppable.containers);return i.delete(t),{...e,droppable:{...e.droppable,containers:i}}}default:return e}}function $o(e){let{disabled:r}=e;const{active:t,activatorEvent:s,draggableNodes:o}=d.useContext(Kt),i=en(s),l=en(t?.id);return d.useEffect(()=>{if(!r&&!s&&i&&l!=null){if(!ln(i)||document.activeElement===i.target)return;const c=o.get(l);if(!c)return;const{activatorNode:u,node:m}=c;if(!u.current&&!m.current)return;requestAnimationFrame(()=>{for(const f of[u.current,m.current]){if(!f)continue;const p=Pa(f);if(p){p.focus();break}}})}},[s,r,o,l,i]),null}function ps(e,r){let{transform:t,...s}=r;return e!=null&&e.length?e.reduce((o,i)=>i({transform:o,...s}),t):t}function Go(e){return d.useMemo(()=>({draggable:{...Zt.draggable,...e?.draggable},droppable:{...Zt.droppable,...e?.droppable},dragOverlay:{...Zt.dragOverlay,...e?.dragOverlay}}),[e?.draggable,e?.droppable,e?.dragOverlay])}function Ko(e){let{activeNode:r,measure:t,initialRect:s,config:o=!0}=e;const i=d.useRef(!1),{x:l,y:c}=typeof o=="boolean"?{x:o,y:o}:o;ke(()=>{if(!l&&!c||!r){i.current=!1;return}if(i.current||!s)return;const m=r?.node.current;if(!m||m.isConnected===!1)return;const f=t(m),p=rs(f,s);if(l||(p.x=0),c||(p.y=0),i.current=!0,Math.abs(p.x)>0||Math.abs(p.y)>0){const x=as(m);x&&x.scrollBy({top:p.y,left:p.x})}},[r,l,c,s,t])}const fn=d.createContext({...Ae,scaleX:1,scaleY:1});var Qe;(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"})(Qe||(Qe={}));const bs=d.memo(function(r){var t,s,o,i;let{id:l,accessibility:c,autoScroll:u=!0,children:m,sensors:f=_o,collisionDetection:p=Xa,measuring:x,modifiers:y,...S}=r;const j=d.useReducer(Uo,void 0,Yo),[C,M]=j,[I,b]=Ka(),[D,A]=d.useState(Qe.Uninitialized),w=D===Qe.Initialized,{draggable:{active:L,nodes:g,translate:k},droppable:{containers:P}}=C,z=L!=null?g.get(L):null,ce=d.useRef({initial:null,translated:null}),v=d.useMemo(()=>{var X;return L!=null?{id:L,data:(X=z?.data)!=null?X:Po,rect:ce}:null},[L,z]),_=d.useRef(null),[oe,Me]=d.useState(null),[ie,ye]=d.useState(null),de=Pt(S,Object.values(S)),We=Gt("DndDescribedBy",l),Le=d.useMemo(()=>P.getEnabled(),[P]),te=Go(x),{droppableRects:xe,measureDroppableContainers:De,measuringScheduled:Ze}=Do(Le,{dragging:w,dependencies:[k.x,k.y],config:te.droppable}),ve=Co(g,L),pt=d.useMemo(()=>ie?tn(ie):null,[ie]),Oe=Vt(),Se=So(ve,te.draggable.measure);Ko({activeNode:L!=null?g.get(L):null,config:Oe.layoutShiftCompensation,initialRect:Se,measure:te.draggable.measure});const G=Dr(ve,te.draggable.measure,Se),Xe=Dr(ve?ve.parentElement:null),we=d.useRef({activatorEvent:null,active:null,activeNode:ve,collisionRect:null,collisions:null,droppableRects:xe,draggableNodes:g,draggingNode:null,draggingNodeRect:null,droppableContainers:P,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Ge=P.getNodeFor((t=we.current.over)==null?void 0:t.id),pe=Fo({measure:te.dragOverlay.measure}),Fe=(s=pe.nodeRef.current)!=null?s:ve,Ke=w?(o=pe.rect)!=null?o:G:null,Je=!!(pe.nodeRef.current&&pe.rect),et=Io(Je?null:G),ct=ms(Fe?ge(Fe):null),Ne=ko(w?Ge??ve:null),dt=Oo(Ne),tt=ps(y,{transform:{x:k.x-et.x,y:k.y-et.y,scaleX:1,scaleY:1},activatorEvent:ie,active:v,activeNodeRect:G,containerNodeRect:Xe,draggingNodeRect:Ke,over:we.current.over,overlayNodeRect:pe.rect,scrollableAncestors:Ne,scrollableAncestorRects:dt,windowRect:ct}),hn=pt?mt(pt,k):null,gn=Ao(Ne),ar=Rr(gn),Ht=Rr(gn,[G]),He=mt(tt,ar),Ue=Ke?to(Ke,tt):null,nt=v&&Ue?p({active:v,collisionRect:Ue,droppableRects:xe,droppableContainers:Le,pointerCoordinates:hn}):null,bt=ts(nt,"id"),[Re,xn]=d.useState(null),or=Je?tt:mt(tt,Ht),ut=Ja(or,(i=Re?.rect)!=null?i:null,G),yt=d.useRef(null),ft=d.useCallback((X,ue)=>{let{sensor:fe,options:_e}=ue;if(_.current==null)return;const me=g.get(_.current);if(!me)return;const he=X.nativeEvent,Ce=new fe({active:_.current,activeNode:me,event:he,options:_e,context:we,onAbort(W){if(!g.get(W))return;const{onDragAbort:je}=de.current,Te={id:W};je?.(Te),I({type:"onDragAbort",event:Te})},onPending(W,Pe,je,Te){if(!g.get(W))return;const{onDragPending:ze}=de.current,Ie={id:W,constraint:Pe,initialCoordinates:je,offset:Te};ze?.(Ie),I({type:"onDragPending",event:Ie})},onStart(W){const Pe=_.current;if(Pe==null)return;const je=g.get(Pe);if(!je)return;const{onDragStart:Te}=de.current,rt={activatorEvent:he,active:{id:Pe,data:je.data,rect:ce}};St.unstable_batchedUpdates(()=>{Te?.(rt),A(Qe.Initializing),M({type:Z.DragStart,initialCoordinates:W,active:Pe}),I({type:"onDragStart",event:rt}),Me(yt.current),ye(he)})},onMove(W){M({type:Z.DragMove,coordinates:W})},onEnd:Be(Z.DragEnd),onCancel:Be(Z.DragCancel)});yt.current=Ce;function Be(W){return async function(){const{active:je,collisions:Te,over:rt,scrollAdjustedTranslate:ze}=we.current;let Ie=null;if(je&&ze){const{cancelDrop:st}=de.current;Ie={activatorEvent:he,active:je,collisions:Te,delta:ze,over:rt},W===Z.DragEnd&&typeof st=="function"&&await Promise.resolve(st(Ie))&&(W=Z.DragCancel)}_.current=null,St.unstable_batchedUpdates(()=>{M({type:W}),A(Qe.Uninitialized),xn(null),Me(null),ye(null),yt.current=null;const st=W===Z.DragEnd?"onDragEnd":"onDragCancel";if(Ie){const Ve=de.current[st];Ve?.(Ie),I({type:st,event:Ie})}})}}},[g]),vt=d.useCallback((X,ue)=>(fe,_e)=>{const me=fe.nativeEvent,he=g.get(_e);if(_.current!==null||!he||me.dndKit||me.defaultPrevented)return;const Ce={active:he};X(fe,ue.options,Ce)===!0&&(me.dndKit={capturedBy:ue.sensor},_.current=_e,ft(fe,ue))},[g,ft]),Bt=Eo(f,vt);Mo(f),ke(()=>{G&&D===Qe.Initializing&&A(Qe.Initialized)},[G,D]),d.useEffect(()=>{const{onDragMove:X}=de.current,{active:ue,activatorEvent:fe,collisions:_e,over:me}=we.current;if(!ue||!fe)return;const he={active:ue,activatorEvent:fe,collisions:_e,delta:{x:He.x,y:He.y},over:me};St.unstable_batchedUpdates(()=>{X?.(he),I({type:"onDragMove",event:he})})},[He.x,He.y]),d.useEffect(()=>{const{active:X,activatorEvent:ue,collisions:fe,droppableContainers:_e,scrollAdjustedTranslate:me}=we.current;if(!X||_.current==null||!ue||!me)return;const{onDragOver:he}=de.current,Ce=_e.get(bt),Be=Ce&&Ce.rect.current?{id:Ce.id,rect:Ce.rect.current,data:Ce.data,disabled:Ce.disabled}:null,W={active:X,activatorEvent:ue,collisions:fe,delta:{x:me.x,y:me.y},over:Be};St.unstable_batchedUpdates(()=>{xn(Be),he?.(W),I({type:"onDragOver",event:W})})},[bt]),ke(()=>{we.current={activatorEvent:ie,active:v,activeNode:ve,collisionRect:Ue,collisions:nt,droppableRects:xe,draggableNodes:g,draggingNode:Fe,draggingNodeRect:Ke,droppableContainers:P,over:Re,scrollableAncestors:Ne,scrollAdjustedTranslate:He},ce.current={initial:Ke,translated:Ue}},[v,ve,nt,Ue,g,Fe,Ke,xe,P,Re,Ne,He]),No({...Oe,delta:k,draggingRect:Ue,pointerCoordinates:hn,scrollableAncestors:Ne,scrollableAncestorRects:dt});const le=d.useMemo(()=>({active:v,activeNode:ve,activeNodeRect:G,activatorEvent:ie,collisions:nt,containerNodeRect:Xe,dragOverlay:pe,draggableNodes:g,droppableContainers:P,droppableRects:xe,over:Re,measureDroppableContainers:De,scrollableAncestors:Ne,scrollableAncestorRects:dt,measuringConfiguration:te,measuringScheduled:Ze,windowRect:ct}),[v,ve,G,ie,nt,Xe,pe,g,P,xe,Re,De,Ne,dt,te,Ze,ct]),pn=d.useMemo(()=>({activatorEvent:ie,activators:Bt,active:v,activeNodeRect:G,ariaDescribedById:{draggable:We},dispatch:M,draggableNodes:g,over:Re,measureDroppableContainers:De}),[ie,Bt,v,G,M,We,g,Re,De]);return V.createElement(Zr.Provider,{value:b},V.createElement(Kt.Provider,{value:pn},V.createElement(xs.Provider,{value:le},V.createElement(fn.Provider,{value:ut},m)),V.createElement($o,{disabled:c?.restoreFocus===!1})),V.createElement(Va,{...c,hiddenTextDescribedById:We}));function Vt(){const X=oe?.autoScrollEnabled===!1,ue=typeof u=="object"?u.enabled===!1:u===!1,fe=w&&!X&&!ue;return typeof u=="object"?{...u,enabled:fe}:{enabled:fe}}}),Ho=d.createContext(null),Ir="button",Bo="Draggable";function Vo(e){let{id:r,data:t,disabled:s=!1,attributes:o}=e;const i=Gt(Bo),{activators:l,activatorEvent:c,active:u,activeNodeRect:m,ariaDescribedById:f,draggableNodes:p,over:x}=d.useContext(Kt),{role:y=Ir,roleDescription:S="draggable",tabIndex:j=0}=o??{},C=u?.id===r,M=d.useContext(C?fn:Ho),[I,b]=Jt(),[D,A]=Jt(),w=Lo(l,r),L=Pt(t);ke(()=>(p.set(r,{id:r,key:i,node:I,activatorNode:D,data:L}),()=>{const k=p.get(r);k&&k.key===i&&p.delete(r)}),[p,r]);const g=d.useMemo(()=>({role:y,tabIndex:j,"aria-disabled":s,"aria-pressed":C&&y===Ir?!0:void 0,"aria-roledescription":S,"aria-describedby":f.draggable}),[s,y,j,C,S,f.draggable]);return{active:u,activatorEvent:c,activeNodeRect:m,attributes:g,isDragging:C,listeners:s?void 0:w,node:I,over:x,setNodeRef:b,setActivatorNodeRef:A,transform:M}}function ys(){return d.useContext(xs)}const qo="Droppable",Qo={timeout:25};function Wo(e){let{data:r,disabled:t=!1,id:s,resizeObserverConfig:o}=e;const i=Gt(qo),{active:l,dispatch:c,over:u,measureDroppableContainers:m}=d.useContext(Kt),f=d.useRef({disabled:t}),p=d.useRef(!1),x=d.useRef(null),y=d.useRef(null),{disabled:S,updateMeasurementsFor:j,timeout:C}={...Qo,...o},M=Pt(j??s),I=d.useCallback(()=>{if(!p.current){p.current=!0;return}y.current!=null&&clearTimeout(y.current),y.current=setTimeout(()=>{m(Array.isArray(M.current)?M.current:[M.current]),y.current=null},C)},[C]),b=un({callback:I,disabled:S||!l}),D=d.useCallback((g,k)=>{b&&(k&&(b.unobserve(k),p.current=!1),g&&b.observe(g))},[b]),[A,w]=Jt(D),L=Pt(r);return d.useEffect(()=>{!b||!A.current||(b.disconnect(),p.current=!1,b.observe(A.current))},[A,b]),d.useEffect(()=>(c({type:Z.RegisterDroppable,element:{id:s,key:i,disabled:t,node:A,rect:x,data:L}}),()=>c({type:Z.UnregisterDroppable,key:i,id:s})),[s]),d.useEffect(()=>{t!==f.current.disabled&&(c({type:Z.SetDroppableDisabled,id:s,key:i,disabled:t}),f.current.disabled=t)},[s,i,t,c]),{active:l,rect:x,isOver:u?.id===s,node:A,over:u,setNodeRef:w}}function Zo(e){let{animation:r,children:t}=e;const[s,o]=d.useState(null),[i,l]=d.useState(null),c=en(t);return!t&&!s&&c&&o(c),ke(()=>{if(!i)return;const u=s?.key,m=s?.props.id;if(u==null||m==null){o(null);return}Promise.resolve(r(m,i)).then(()=>{o(null)})},[r,s,i]),V.createElement(V.Fragment,null,t,s?d.cloneElement(s,{ref:l}):null)}const Xo={x:0,y:0,scaleX:1,scaleY:1};function Jo(e){let{children:r}=e;return V.createElement(Kt.Provider,{value:gs},V.createElement(fn.Provider,{value:Xo},r))}const ei={position:"fixed",touchAction:"none"},ti=e=>ln(e)?"transform 250ms ease":void 0,ni=d.forwardRef((e,r)=>{let{as:t,activatorEvent:s,adjustScale:o,children:i,className:l,rect:c,style:u,transform:m,transition:f=ti}=e;if(!c)return null;const p=o?m:{...m,scaleX:1,scaleY:1},x={...ei,width:c.width,height:c.height,top:c.top,left:c.left,transform:$e.Transform.toString(p),transformOrigin:o&&s?qa(s,c):void 0,transition:typeof f=="function"?f(s):f,...u};return V.createElement(t,{className:l,style:x,ref:r},i)}),ri=e=>r=>{let{active:t,dragOverlay:s}=r;const o={},{styles:i,className:l}=e;if(i!=null&&i.active)for(const[c,u]of Object.entries(i.active))u!==void 0&&(o[c]=t.node.style.getPropertyValue(c),t.node.style.setProperty(c,u));if(i!=null&&i.dragOverlay)for(const[c,u]of Object.entries(i.dragOverlay))u!==void 0&&s.node.style.setProperty(c,u);return l!=null&&l.active&&t.node.classList.add(l.active),l!=null&&l.dragOverlay&&s.node.classList.add(l.dragOverlay),function(){for(const[u,m]of Object.entries(o))t.node.style.setProperty(u,m);l!=null&&l.active&&t.node.classList.remove(l.active)}},si=e=>{let{transform:{initial:r,final:t}}=e;return[{transform:$e.Transform.toString(r)},{transform:$e.Transform.toString(t)}]},ai={duration:250,easing:"ease",keyframes:si,sideEffects:ri({styles:{active:{opacity:"0"}}})};function oi(e){let{config:r,draggableNodes:t,droppableContainers:s,measuringConfiguration:o}=e;return on((i,l)=>{if(r===null)return;const c=t.get(i);if(!c)return;const u=c.node.current;if(!u)return;const m=hs(l);if(!m)return;const{transform:f}=ge(l).getComputedStyle(l),p=ss(f);if(!p)return;const x=typeof r=="function"?r:ii(r);return us(u,o.draggable.measure),x({active:{id:i,data:c.data,node:u,rect:o.draggable.measure(u)},draggableNodes:t,dragOverlay:{node:l,rect:o.dragOverlay.measure(m)},droppableContainers:s,measuringConfiguration:o,transform:p})})}function ii(e){const{duration:r,easing:t,sideEffects:s,keyframes:o}={...ai,...e};return i=>{let{active:l,dragOverlay:c,transform:u,...m}=i;if(!r)return;const f={x:c.rect.left-l.rect.left,y:c.rect.top-l.rect.top},p={scaleX:u.scaleX!==1?l.rect.width*u.scaleX/c.rect.width:1,scaleY:u.scaleY!==1?l.rect.height*u.scaleY/c.rect.height:1},x={x:u.x-f.x,y:u.y-f.y,...p},y=o({...m,active:l,dragOverlay:c,transform:{initial:u,final:x}}),[S]=y,j=y[y.length-1];if(JSON.stringify(S)===JSON.stringify(j))return;const C=s?.({active:l,dragOverlay:c,...m}),M=c.node.animate(y,{duration:r,easing:t,fill:"forwards"});return new Promise(I=>{M.onfinish=()=>{C?.(),I()}})}}let kr=0;function li(e){return d.useMemo(()=>{if(e!=null)return kr++,kr},[e])}const ci=V.memo(e=>{let{adjustScale:r=!1,children:t,dropAnimation:s,style:o,transition:i,modifiers:l,wrapperElement:c="div",className:u,zIndex:m=999}=e;const{activatorEvent:f,active:p,activeNodeRect:x,containerNodeRect:y,draggableNodes:S,droppableContainers:j,dragOverlay:C,over:M,measuringConfiguration:I,scrollableAncestors:b,scrollableAncestorRects:D,windowRect:A}=ys(),w=d.useContext(fn),L=li(p?.id),g=ps(l,{activatorEvent:f,active:p,activeNodeRect:x,containerNodeRect:y,draggingNodeRect:C.rect,over:M,overlayNodeRect:C.rect,scrollableAncestors:b,scrollableAncestorRects:D,transform:w,windowRect:A}),k=Jn(x),P=oi({config:s,draggableNodes:S,droppableContainers:j,measuringConfiguration:I}),z=k?C.setRef:void 0;return V.createElement(Jo,null,V.createElement(Zo,{animation:P},p&&L?V.createElement(ni,{key:L,id:p.id,ref:z,as:c,activatorEvent:f,adjustScale:r,className:u,transition:i,rect:k,style:{zIndex:m,...o},transform:g},t):null))});function er(e,r,t){const s=e.slice();return s.splice(t<0?s.length+t:t,0,s.splice(r,1)[0]),s}function di(e,r){return e.reduce((t,s,o)=>{const i=r.get(s);return i&&(t[o]=i),t},Array(e.length))}function Qt(e){return e!==null&&e>=0}function ui(e,r){if(e===r)return!0;if(e.length!==r.length)return!1;for(let t=0;t<e.length;t++)if(e[t]!==r[t])return!1;return!0}function fi(e){return typeof e=="boolean"?{draggable:e,droppable:e}:e}const vs=e=>{let{rects:r,activeIndex:t,overIndex:s,index:o}=e;const i=er(r,s,t),l=r[o],c=i[o];return!c||!l?null:{x:c.left-l.left,y:c.top-l.top,scaleX:c.width/l.width,scaleY:c.height/l.height}},Wt={scaleX:1,scaleY:1},Ns=e=>{var r;let{activeIndex:t,activeNodeRect:s,index:o,rects:i,overIndex:l}=e;const c=(r=i[t])!=null?r:s;if(!c)return null;if(o===t){const m=i[l];return m?{x:0,y:t<l?m.top+m.height-(c.top+c.height):m.top-c.top,...Wt}:null}const u=mi(i,o,t);return o>t&&o<=l?{x:0,y:-c.height-u,...Wt}:o<t&&o>=l?{x:0,y:c.height+u,...Wt}:{x:0,y:0,...Wt}};function mi(e,r,t){const s=e[r],o=e[r-1],i=e[r+1];return s?t<r?o?s.top-(o.top+o.height):i?i.top-(s.top+s.height):0:i?i.top-(s.top+s.height):o?s.top-(o.top+o.height):0:0}const js="Sortable",ws=V.createContext({activeIndex:-1,containerId:js,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:vs,disabled:{draggable:!1,droppable:!1}});function Cs(e){let{children:r,id:t,items:s,strategy:o=vs,disabled:i=!1}=e;const{active:l,dragOverlay:c,droppableRects:u,over:m,measureDroppableContainers:f}=ys(),p=Gt(js,t),x=c.rect!==null,y=d.useMemo(()=>s.map(w=>typeof w=="object"&&"id"in w?w.id:w),[s]),S=l!=null,j=l?y.indexOf(l.id):-1,C=m?y.indexOf(m.id):-1,M=d.useRef(y),I=!ui(y,M.current),b=C!==-1&&j===-1||I,D=fi(i);ke(()=>{I&&S&&f(y)},[I,y,S,f]),d.useEffect(()=>{M.current=y},[y]);const A=d.useMemo(()=>({activeIndex:j,containerId:p,disabled:D,disableTransforms:b,items:y,overIndex:C,useDragOverlay:x,sortedRects:di(y,u),strategy:o}),[j,p,D.draggable,D.droppable,b,y,C,u,x,o]);return V.createElement(ws.Provider,{value:A},r)}const hi=e=>{let{id:r,items:t,activeIndex:s,overIndex:o}=e;return er(t,s,o).indexOf(r)},gi=e=>{let{containerId:r,isSorting:t,wasDragging:s,index:o,items:i,newIndex:l,previousItems:c,previousContainerId:u,transition:m}=e;return!m||!s||c!==i&&o===l?!1:t?!0:l!==o&&r===u},xi={duration:200,easing:"ease"},Es="transform",pi=$e.Transition.toString({property:Es,duration:0,easing:"linear"}),bi={roleDescription:"sortable"};function yi(e){let{disabled:r,index:t,node:s,rect:o}=e;const[i,l]=d.useState(null),c=d.useRef(t);return ke(()=>{if(!r&&t!==c.current&&s.current){const u=o.current;if(u){const m=xt(s.current,{ignoreTransform:!0}),f={x:u.left-m.left,y:u.top-m.top,scaleX:u.width/m.width,scaleY:u.height/m.height};(f.x||f.y)&&l(f)}}t!==c.current&&(c.current=t)},[r,t,s,o]),d.useEffect(()=>{i&&l(null)},[i]),i}function tr(e){let{animateLayoutChanges:r=gi,attributes:t,disabled:s,data:o,getNewIndex:i=hi,id:l,strategy:c,resizeObserverConfig:u,transition:m=xi}=e;const{items:f,containerId:p,activeIndex:x,disabled:y,disableTransforms:S,sortedRects:j,overIndex:C,useDragOverlay:M,strategy:I}=d.useContext(ws),b=vi(s,y),D=f.indexOf(l),A=d.useMemo(()=>({sortable:{containerId:p,index:D,items:f},...o}),[p,o,D,f]),w=d.useMemo(()=>f.slice(f.indexOf(l)),[f,l]),{rect:L,node:g,isOver:k,setNodeRef:P}=Wo({id:l,data:A,disabled:b.droppable,resizeObserverConfig:{updateMeasurementsFor:w,...u}}),{active:z,activatorEvent:ce,activeNodeRect:v,attributes:_,setNodeRef:oe,listeners:Me,isDragging:ie,over:ye,setActivatorNodeRef:de,transform:We}=Vo({id:l,data:A,attributes:{...bi,...t},disabled:b.draggable}),Le=La(P,oe),te=!!z,xe=te&&!S&&Qt(x)&&Qt(C),De=!M&&ie,Ze=De&&xe?We:null,pt=xe?Ze??(c??I)({rects:j,activeNodeRect:v,activeIndex:x,overIndex:C,index:D}):null,Oe=Qt(x)&&Qt(C)?i({id:l,items:f,activeIndex:x,overIndex:C}):D,Se=z?.id,G=d.useRef({activeId:Se,items:f,newIndex:Oe,containerId:p}),Xe=f!==G.current.items,we=r({active:z,containerId:p,isDragging:ie,isSorting:te,id:l,index:D,items:f,newIndex:G.current.newIndex,previousItems:G.current.items,previousContainerId:G.current.containerId,transition:m,wasDragging:G.current.activeId!=null}),Ge=yi({disabled:!we,index:D,node:g,rect:L});return d.useEffect(()=>{te&&G.current.newIndex!==Oe&&(G.current.newIndex=Oe),p!==G.current.containerId&&(G.current.containerId=p),f!==G.current.items&&(G.current.items=f)},[te,Oe,p,f]),d.useEffect(()=>{if(Se===G.current.activeId)return;if(Se!=null&&G.current.activeId==null){G.current.activeId=Se;return}const Fe=setTimeout(()=>{G.current.activeId=Se},50);return()=>clearTimeout(Fe)},[Se]),{active:z,activeIndex:x,attributes:_,data:A,rect:L,index:D,newIndex:Oe,items:f,isOver:k,isSorting:te,isDragging:ie,listeners:Me,node:g,overIndex:C,over:ye,setNodeRef:Le,setActivatorNodeRef:de,setDroppableNodeRef:P,setDraggableNodeRef:oe,transform:Ge??pt,transition:pe()};function pe(){if(Ge||Xe&&G.current.newIndex===D)return pi;if(!(De&&!ln(ce)||!m)&&(te||we))return $e.Transition.toString({...m,property:Es})}}function vi(e,r){var t,s;return typeof e=="boolean"?{draggable:e,droppable:!1}:{draggable:(t=e?.draggable)!=null?t:r.draggable,droppable:(s=e?.droppable)!=null?s:r.droppable}}function sn(e){if(!e)return!1;const r=e.data.current;return!!(r&&"sortable"in r&&typeof r.sortable=="object"&&"containerId"in r.sortable&&"items"in r.sortable&&"index"in r.sortable)}const Ni=[Y.Down,Y.Right,Y.Up,Y.Left],ji=(e,r)=>{let{context:{active:t,collisionRect:s,droppableRects:o,droppableContainers:i,over:l,scrollableAncestors:c}}=r;if(Ni.includes(e.code)){if(e.preventDefault(),!t||!s)return;const u=[];i.getEnabled().forEach(p=>{if(!p||p!=null&&p.disabled)return;const x=o.get(p.id);if(x)switch(e.code){case Y.Down:s.top<x.top&&u.push(p);break;case Y.Up:s.top>x.top&&u.push(p);break;case Y.Left:s.left>x.left&&u.push(p);break;case Y.Right:s.left<x.left&&u.push(p);break}});const m=Wa({collisionRect:s,droppableRects:o,droppableContainers:u});let f=ts(m,"id");if(f===l?.id&&m.length>1&&(f=m[1].id),f!=null){const p=i.get(t.id),x=i.get(f),y=x?o.get(x.id):null,S=x?.node.current;if(S&&y&&p&&x){const C=cn(S).some((w,L)=>c[L]!==w),M=Ds(p,x),I=wi(p,x),b=C||!M?{x:0,y:0}:{x:I?s.width-y.width:0,y:I?s.height-y.height:0},D={x:y.left,y:y.top};return b.x&&b.y?D:zt(D,b)}}}};function Ds(e,r){return!sn(e)||!sn(r)?!1:e.data.current.sortable.containerId===r.data.current.sortable.containerId}function wi(e,r){return!sn(e)||!sn(r)||!Ds(e,r)?!1:e.data.current.sortable.index<r.data.current.sortable.index}function Ci(e,r,{checkForDefaultPrevented:t=!0}={}){return function(o){if(e?.(o),t===!1||!o.defaultPrevented)return r?.(o)}}var Ei=zs[" useInsertionEffect ".trim().toString()]||Lr;function Di({prop:e,defaultProp:r,onChange:t=()=>{},caller:s}){const[o,i,l]=Si({defaultProp:r,onChange:t}),c=e!==void 0,u=c?e:o;{const f=d.useRef(e!==void 0);d.useEffect(()=>{const p=f.current;p!==c&&console.warn(`${s} is changing from ${p?"controlled":"uncontrolled"} to ${c?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),f.current=c},[c,s])}const m=d.useCallback(f=>{if(c){const p=Ri(f)?f(e):f;p!==e&&l.current?.(p)}else i(f)},[c,e,i,l]);return[u,m]}function Si({defaultProp:e,onChange:r}){const[t,s]=d.useState(e),o=d.useRef(t),i=d.useRef(r);return Ei(()=>{i.current=r},[r]),d.useEffect(()=>{o.current!==t&&(i.current?.(t),o.current=t)},[t,o]),[t,s,i]}function Ri(e){return typeof e=="function"}var mn="Collapsible",[Ti]=Ys(mn),[Ii,nr]=Ti(mn),Ss=d.forwardRef((e,r)=>{const{__scopeCollapsible:t,open:s,defaultOpen:o,disabled:i,onOpenChange:l,...c}=e,[u,m]=Di({prop:s,defaultProp:o??!1,onChange:l,caller:mn});return n.jsx(Ii,{scope:t,disabled:i,contentId:Ks(),open:u,onOpenToggle:d.useCallback(()=>m(f=>!f),[m]),children:n.jsx(Gn.div,{"data-state":sr(u),"data-disabled":i?"":void 0,...c,ref:r})})});Ss.displayName=mn;var Rs="CollapsibleTrigger",Ts=d.forwardRef((e,r)=>{const{__scopeCollapsible:t,...s}=e,o=nr(Rs,t);return n.jsx(Gn.button,{type:"button","aria-controls":o.contentId,"aria-expanded":o.open||!1,"data-state":sr(o.open),"data-disabled":o.disabled?"":void 0,disabled:o.disabled,...s,ref:r,onClick:Ci(e.onClick,o.onOpenToggle)})});Ts.displayName=Rs;var rr="CollapsibleContent",Is=d.forwardRef((e,r)=>{const{forceMount:t,...s}=e,o=nr(rr,e.__scopeCollapsible);return n.jsx(Us,{present:t||o.open,children:({present:i})=>n.jsx(ki,{...s,ref:r,present:i})})});Is.displayName=rr;var ki=d.forwardRef((e,r)=>{const{__scopeCollapsible:t,present:s,children:o,...i}=e,l=nr(rr,t),[c,u]=d.useState(s),m=d.useRef(null),f=$s(r,m),p=d.useRef(0),x=p.current,y=d.useRef(0),S=y.current,j=l.open||c,C=d.useRef(j),M=d.useRef(void 0);return d.useEffect(()=>{const I=requestAnimationFrame(()=>C.current=!1);return()=>cancelAnimationFrame(I)},[]),Lr(()=>{const I=m.current;if(I){M.current=M.current||{transitionDuration:I.style.transitionDuration,animationName:I.style.animationName},I.style.transitionDuration="0s",I.style.animationName="none";const b=I.getBoundingClientRect();p.current=b.height,y.current=b.width,C.current||(I.style.transitionDuration=M.current.transitionDuration,I.style.animationName=M.current.animationName),u(s)}},[l.open,s]),n.jsx(Gn.div,{"data-state":sr(l.open),"data-disabled":l.disabled?"":void 0,id:l.contentId,hidden:!j,...i,ref:f,style:{"--radix-collapsible-content-height":x?`${x}px`:void 0,"--radix-collapsible-content-width":S?`${S}px`:void 0,...e.style},children:j&&o})});function sr(e){return e?"open":"closed"}var Ai=Ss;const Mi=Ai,Li=Ts,Oi=Is;function Fi({dateStr:e}){if(!e)return null;try{const r=Hr(e);if(!Yr(r))return null;let t=B(r,"MMM d");ot(r)&&(t="Today"),Js(r)&&(t="Tomorrow");const s=ea(r)&&!ot(r);return n.jsxs("div",{className:`flex items-center gap-1 text-[10px] border px-1.5 py-0.5 rounded-none ${s?"text-red-400 border-red-400/50":"text-muted-foreground border-border"}`,children:[n.jsx(Hs,{className:"w-3 h-3"}),t]})}catch{return null}}function Ar({task:e,onToggle:r,onDelete:t,onEdit:s}){const{attributes:o,listeners:i,setNodeRef:l,transform:c,transition:u,isDragging:m}=tr({id:e.id,data:{type:"Task",...e}}),f={transform:$e.Translate.toString(c),transition:u,opacity:m?.5:1};return n.jsx("div",{ref:l,style:f,...o,...i,className:"mb-2 touch-none select-none relative group",children:n.jsxs("div",{className:`
            p-3 rounded-none border border-transparent hover:border-primary/30 transition-all
            flex gap-3 items-start bg-transparent hover:bg-primary/5
            ${m?"ring-2 ring-primary/50 bg-primary/10 z-50":""}
        `,onClick:()=>s(e),children:[n.jsx("div",{onClick:p=>{p.stopPropagation(),r(e)},className:`
                mt-0.5 w-5 h-5 rounded-none border-2 flex items-center justify-center cursor-pointer transition-colors
                ${e.status==="completed"?"bg-primary border-primary":"border-muted-foreground/60 hover:border-primary"}
            `,children:e.status==="completed"&&n.jsx("div",{className:"w-2.5 h-1.5 border-b-2 border-l-2 border-black rotate-[-45deg] mb-0.5"})}),n.jsxs("div",{className:"flex-1 min-w-0 space-y-1",children:[n.jsx("div",{className:`text-sm font-terminal leading-tight truncate ${e.status==="completed"?"line-through text-muted-foreground":"text-foreground"}`,children:e.title}),(e.notes||e.due)&&n.jsxs("div",{className:"flex flex-wrap gap-2 items-center mt-1",children:[e.due&&n.jsx(Fi,{dateStr:e.due}),e.notes&&n.jsxs("div",{className:"flex items-center text-[10px] text-muted-foreground gap-1",children:[n.jsx(Gr,{className:"w-3 h-3"}),n.jsx("span",{className:"truncate max-w-[150px] opacity-70 font-terminal",children:e.notes.split(`
`)[0]})]})]})]})]})})}function Mr({task:e,isOpen:r,onClose:t,onSave:s,onDelete:o,isCreating:i,activeListId:l,availableLists:c=[]}){const[u,m]=d.useState(""),[f,p]=d.useState(""),[x,y]=d.useState(""),[S,j]=d.useState(""),[C,M]=d.useState("");d.useEffect(()=>{if(r){if(i)m(""),p(""),y(""),j(""),M(l||c[0]?.id||"");else if(e)if(m(e.title),p(e.notes||""),M(e.listId),e.due)try{const b=Hr(e.due);Yr(b)&&y(B(b,"yyyy-MM-dd"))}catch{}else y("")}},[r,e,i,l]);const I=()=>{if(!u)return;let b;x&&(b=S?`${x}T${S}:00Z`:`${x}T00:00:00Z`),s({title:u,notes:f,due:b,listId:C}),t()};return n.jsx(At,{open:r,onOpenChange:b=>!b&&t(),children:n.jsxs(Mt,{className:"sm:max-w-[500px] border-2 border-primary bg-black text-foreground p-0 gap-0 overflow-hidden shadow-2xl rounded-none",children:[n.jsx(Lt,{className:"sr-only",children:i?"Create New Task":"Edit Task"}),n.jsx(Ot,{className:"sr-only",children:i?"Enter task details to create a new task.":"Modify task details."}),n.jsx("div",{className:"p-6 pb-2",children:n.jsx(H,{value:u,onChange:b=>m(b.target.value),placeholder:"Add title",className:"text-2xl font-terminal bg-transparent border-0 border-b border-primary/30 rounded-none px-0 py-2 focus-visible:ring-0 focus-visible:border-primary placeholder:text-muted-foreground/50 h-auto",autoFocus:i})}),n.jsxs("div",{className:"p-6 pt-2 space-y-4",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(na,{className:"w-5 h-5 text-muted-foreground shrink-0"}),n.jsxs("div",{className:"flex-1 flex gap-2",children:[n.jsx(H,{type:"date",value:x,onChange:b=>y(b.target.value),className:"bg-secondary/20 border-secondary text-sm w-[150px] rounded-none"}),n.jsx(H,{type:"time",value:S,onChange:b=>j(b.target.value),className:"bg-secondary/20 border-secondary text-sm w-[120px] rounded-none"})]})]}),n.jsxs("div",{className:"flex items-center gap-2 pl-7",children:[n.jsxs("div",{className:"text-sm text-muted-foreground flex items-center gap-2 cursor-not-allowed opacity-70 font-terminal",children:[n.jsx("div",{className:"w-4 h-4 rounded-none border border-current"}),"Does not repeat"]}),n.jsxs("div",{className:"text-sm text-muted-foreground flex items-center gap-2 ml-4 cursor-not-allowed opacity-70 font-terminal",children:[n.jsx("div",{className:"w-4 h-4 border border-current rounded-none"}),"All day"]})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(Gr,{className:"w-5 h-5 text-muted-foreground shrink-0 mt-2"}),n.jsx(Ft,{value:f,onChange:b=>p(b.target.value),placeholder:"Add description",className:"bg-transparent border-0 resize-none min-h-[100px] focus-visible:ring-0 p-0 text-sm leading-relaxed placeholder:text-muted-foreground/50 font-terminal rounded-none"})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"w-5 shrink-0"}),n.jsxs(ne,{value:C,onValueChange:M,children:[n.jsx(re,{className:"w-[150px] h-8 bg-secondary/20 border-secondary text-xs rounded-none",children:n.jsx(se,{placeholder:"Select List"})}),n.jsx(ae,{children:c.map(b=>n.jsx(T,{value:b.id,children:b.title},b.id))})]})]})]}),n.jsxs(On,{className:"p-4 bg-secondary/10 flex justify-between items-center border-t border-secondary",children:[!i&&e?n.jsx(U,{variant:"ghost",size:"icon",onClick:()=>{confirm("Delete?")&&(o(e.id,e.listId),t())},children:n.jsx(Rt,{className:"w-4 h-4 text-muted-foreground hover:text-primary"})}):n.jsx("div",{}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(U,{variant:"ghost",onClick:t,className:"hover:bg-secondary/20 rounded-none font-terminal",children:"Cancel"}),n.jsx(U,{onClick:I,disabled:!u,className:"bg-primary hover:bg-primary/80 text-primary-foreground rounded-none px-6 font-terminal",children:"Save"})]})]})]})})}function _i({listId:e,title:r,tasks:t,onAddTask:s,onEdit:o,onToggle:i,onDelete:l}){const{setNodeRef:c}=tr({id:e,data:{type:"Container",listId:e}}),u=t.filter(f=>f.status!=="completed"),m=t.filter(f=>f.status==="completed");return n.jsxs("div",{ref:c,className:"flex-1 min-w-[260px] max-w-[300px] flex flex-col h-full bg-black/40 rounded-none overflow-hidden border-2 border-secondary my-1",children:[n.jsxs("div",{className:"p-4 flex items-center justify-between pb-2 border-b border-secondary",children:[n.jsx("h3",{className:"font-arcade text-xs text-primary tracking-wide truncate uppercase",children:r}),n.jsx("div",{className:"flex gap-1",children:n.jsxs(U,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-primary rounded-none",children:[n.jsx("div",{className:"w-1 h-1 bg-current mb-0.5"}),n.jsx("div",{className:"w-1 h-1 bg-current mb-0.5"}),n.jsx("div",{className:"w-1 h-1 bg-current"})]})})]}),n.jsx("div",{className:"px-4 py-2 border-b border-secondary/50",children:n.jsxs("button",{onClick:()=>s(e),className:"flex items-center gap-2 text-sm text-muted-foreground hover:text-primary transition-colors group w-full text-left font-terminal",children:[n.jsx("div",{className:"w-6 h-6 rounded-none bg-secondary/20 flex items-center justify-center group-hover:bg-primary/20 group-hover:text-primary border border-secondary",children:n.jsx(Xt,{className:"w-4 h-4"})}),"Add a task"]})}),n.jsx("div",{className:"flex-1 overflow-y-auto px-2 py-2 overflow-x-hidden",children:n.jsxs(Cs,{items:t.map(f=>f.id),strategy:Ns,children:[u.length>0?n.jsx("div",{className:"space-y-1",children:u.map(f=>n.jsx(Ar,{task:f,onToggle:i,onEdit:o,onDelete:l},f.id))}):m.length===0&&n.jsx("div",{className:"flex flex-col items-center justify-center py-12 text-center opacity-40",children:n.jsx("p",{className:"text-sm font-terminal",children:"No tasks yet"})}),m.length>0&&n.jsx("div",{className:"mt-4 pt-2 border-t border-secondary/50",children:n.jsxs(Mi,{children:[n.jsxs(Li,{className:"flex items-center gap-2 text-sm font-terminal text-muted-foreground hover:text-primary w-full py-2 px-2 hover:bg-primary/5 rounded-none transition-colors",children:[n.jsx(Hn,{className:"w-4 h-4 transition-transform ui-open:rotate-90"}),"Completed (",m.length,")"]}),n.jsx(Oi,{className:"space-y-1 pl-2 mt-1",children:m.map(f=>n.jsx(Ar,{task:f,onToggle:i,onEdit:o,onDelete:l},f.id))})]})})]})})]})}function Pi({onClick:e}){return n.jsxs(U,{onClick:e,variant:"outline",size:"sm",className:"rounded-none font-arcade text-xs border-primary text-primary hover:bg-primary hover:text-black",children:[n.jsx(_r,{className:"w-4 h-4 mr-1"})," AI_ASSIST"]})}function zi({isOpen:e,onClose:r}){const[t,s]=d.useState([]),[o,i]=d.useState(""),l=d.useRef(null),c=Kn(),{data:u,isLoading:m,refetch:f}=Ye({queryKey:["google-status"],queryFn:q.google.getStatus,retry:1,enabled:e}),p=Q({mutationFn:async()=>{const{authUrl:j}=await q.google.getAuthUrl();window.location.href=j}});d.useEffect(()=>{e&&f()},[e,f]),d.useEffect(()=>{l.current&&(l.current.scrollTop=l.current.scrollHeight)},[t,e]);const x=Q({mutationFn:async j=>q.calendar.assistant(j),onSuccess:j=>{s(C=>[...C,{role:"assistant",content:j.response,isError:!j.success}]),c.invalidateQueries({queryKey:["events"]}),c.invalidateQueries({queryKey:["google-tasks"]}),c.invalidateQueries({queryKey:["google-calendar"]}),c.refetchQueries({queryKey:["google-calendar"]})},onError:j=>{s(C=>[...C,{role:"assistant",content:`Network Error: ${j}`,isError:!0}])}}),y=()=>{if(!o.trim())return;const j={role:"user",content:o};s(C=>[...C,j]),i(""),x.mutate(o)},S=j=>{j.key==="Enter"&&!j.shiftKey&&(j.preventDefault(),y())};return e?n.jsxs(Pr,{className:"fixed left-0 top-[68px] bottom-[40px] w-[380px] shadow-2xl z-50 flex flex-col border-r-2 border-primary bg-black text-white rounded-none animate-in fade-in slide-in-from-left-4 duration-300",children:[n.jsxs(zr,{className:"p-3 border-b border-primary/50 flex flex-row items-center justify-between bg-primary/10",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(_r,{className:"w-5 h-5 text-primary"}),n.jsxs("div",{children:[n.jsx(qs,{className:"text-sm font-arcade tracking-wider text-primary",children:"AI_ASSISTANT"}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Qs,{className:"text-[10px] text-muted-foreground font-terminal",children:"Calendar + Tasks Assistant"}),!m&&u?.connected&&n.jsx("span",{className:"text-[9px] font-arcade text-green-400",children:"CONNECTED"})]})]})]}),n.jsx(U,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:r,children:n.jsx(Or,{className:"h-4 w-4 text-muted-foreground hover:text-white"})})]}),n.jsx(Fn,{className:"flex-1 p-3",ref:l,children:n.jsxs("div",{className:"space-y-3",children:[!m&&!u?.connected&&n.jsxs("div",{className:"border border-yellow-500/50 bg-yellow-500/10 text-yellow-200 text-[10px] font-terminal px-3 py-2 flex items-center justify-between gap-3",children:[n.jsx("span",{children:"Calendar not connected."}),n.jsxs(U,{size:"sm",variant:"outline",className:"h-6 px-2 rounded-none border-yellow-500 text-yellow-200 hover:bg-yellow-500/20 font-arcade text-[9px]",onClick:()=>p.mutate(),disabled:p.isPending,children:[n.jsx(ra,{className:"w-3 h-3 mr-1"}),p.isPending?"CONNECTING...":"CONNECT GOOGLE CALENDAR"]})]}),t.length===0&&n.jsxs("div",{className:"text-center text-muted-foreground text-xs mt-8 space-y-2",children:[n.jsx("p",{className:"font-terminal",children:"Ask me to create events or tasks."}),n.jsx("p",{className:"text-[10px] opacity-50 font-terminal",children:'"Add a workout tomorrow at 3pm"'}),n.jsx("p",{className:"text-[10px] opacity-50 font-terminal",children:'"Schedule PT study session Friday 2pm"'})]}),t.map((j,C)=>n.jsx("div",{className:`flex ${j.role==="user"?"justify-end":"justify-start"}`,children:n.jsx("div",{className:`max-w-[85%] px-3 py-2 text-xs font-terminal whitespace-pre-wrap ${j.role==="user"?"bg-primary text-black":j.isError?"bg-red-500/10 border border-red-500/50 text-red-300":"bg-white/10 text-white border border-white/10"}`,children:j.content})},C)),x.isPending&&n.jsx("div",{className:"flex justify-start",children:n.jsxs("div",{className:"bg-white/5 border border-white/10 px-3 py-2 text-[10px] flex items-center gap-2 text-muted-foreground font-terminal",children:[n.jsx(sa,{className:"h-3 w-3 animate-spin"}),"Thinking..."]})})]})}),n.jsxs("div",{className:"p-3 border-t border-primary/50",children:[n.jsxs("div",{className:"flex gap-2",children:[n.jsx(H,{value:o,onChange:j=>i(j.target.value),onKeyDown:S,placeholder:"Type a command...",className:"bg-black border-secondary font-terminal text-sm rounded-none focus-visible:ring-primary",disabled:x.isPending}),n.jsx(U,{onClick:y,disabled:x.isPending||!o.trim(),className:"rounded-none bg-primary text-black hover:bg-primary/90",children:n.jsx(aa,{className:"h-4 w-4"})})]}),n.jsx("div",{className:"text-[9px] text-center mt-1 text-muted-foreground/50 font-terminal",children:"OpenRouter  GPT-4o-mini"})]})]}):null}const kn=["America/New_York","America/Chicago","America/Denver","America/Los_Angeles","America/Phoenix","America/Anchorage","America/Indiana/Indianapolis","America/Detroit","America/Boise","America/Juneau","Pacific/Honolulu"];function Yi({open:e,onOpenChange:r,event:t,onEventChange:s,onSave:o,onDeleteInstance:i,onDeleteSeries:l,onEditSeries:c,mode:u="series",courseOptions:m=[]}){const[f,p]=d.useState("details"),[x,y]=d.useState(""),S=u==="instance",j=d.useMemo(()=>{if(typeof Intl<"u"&&"supportedValuesOf"in Intl)try{const v=Intl.supportedValuesOf("timeZone").filter(_=>_.startsWith("America/")||_==="Pacific/Honolulu").slice().sort();return v.length>0?v:kn}catch{return kn}return kn},[]);d.useEffect(()=>{if(!e||!t?.recurringEventId||!t.calendarId||t.recurrence&&t.recurrence.length>0)return;let v=!1;return fetch(`/api/google-calendar/events/${encodeURIComponent(t.recurringEventId)}?calendarId=${encodeURIComponent(t.calendarId)}`).then(_=>_.ok?_.json():null).then(_=>{v||!_?.recurrence||s({...t,recurrence:_.recurrence})}).catch(()=>{}),()=>{v=!0}},[e,t?.recurringEventId,t?.calendarId,t?.recurrence,s]);const C=v=>{switch(v){case"RRULE:FREQ=DAILY":return"Daily";case"RRULE:FREQ=WEEKLY":return"Weekly";case"RRULE:FREQ=MONTHLY":return"Monthly";case"RRULE:FREQ=YEARLY":return"Yearly";default:return v||"Unavailable"}},M=d.useMemo(()=>{if(!t)return"__none__";if(t.courseId)return String(t.courseId);if(t.course){const v=m.find(_=>_.name===t.course);if(v)return String(v.id)}return"__none__"},[t,m]);if(!t)return null;const I=!!t.start?.date&&!t.start?.dateTime,b=t.start?.timeZone||t.extendedProperties?.private?.timeZone||Intl.DateTimeFormat().resolvedOptions().timeZone||"UTC",D=j[0]||"America/New_York",A=j.includes(b)?b:D,w=(v,_)=>{s({...t,[v]:_})},L=v=>{if(v==="__none__"){s({...t,course:void 0,courseId:void 0,courseCode:void 0});return}const _=m.find(oe=>String(oe.id)===v);_&&s({...t,course:_.name,courseId:_.id,courseCode:_.code||void 0})},g=v=>{if(v){const _=(t.start?.dateTime||"").substring(0,10)||new Date().toISOString().substring(0,10),oe=(t.end?.dateTime||"").substring(0,10)||_;s({...t,start:{date:_},end:{date:oe}})}else{const _=t.start?.date||new Date().toISOString().substring(0,10);s({...t,start:{dateTime:`${_}T09:00`},end:{dateTime:`${_}T10:00`}})}},k=v=>{const _={...t.extendedProperties,private:{...t.extendedProperties?.private||{},timeZone:v}},oe=t.start?.dateTime?{...t.start,timeZone:v}:t.start,Me=t.end?.dateTime?{...t.end,timeZone:v}:t.end;s({...t,start:oe,end:Me,extendedProperties:_})},P=()=>{const v=x.trim();if(!v||!v.includes("@"))return;const _=t.attendees||[];_.some(oe=>oe.email===v)||(w("attendees",[..._,{email:v}]),y(""))},z=v=>{w("attendees",(t.attendees||[]).filter(_=>_.email!==v))},ce=[{id:"details",label:"DETAILS"},{id:"time",label:"TIME"},{id:"recurrence",label:"REPEAT"},{id:"people",label:"PEOPLE"},{id:"settings",label:"SETTINGS"}];return n.jsx(At,{open:e,onOpenChange:r,children:n.jsxs(Mt,{"data-modal":"calendar-edit-google",className:"font-arcade bg-black border-2 border-green-500 rounded-none max-w-none w-[min(96vw,42rem)] p-0 overflow-hidden translate-y-0 max-h-[calc(100vh-4rem)]",style:{zIndex:100005,top:"3rem",left:"50%",transform:"translate(-50%, 0)"},children:[n.jsx(Lt,{className:"sr-only",children:"Edit Google Calendar event"}),n.jsx(Ot,{className:"sr-only",children:"Update event details, time, recurrence, attendees, and settings."}),n.jsxs("div",{className:"flex flex-col h-full min-h-0",children:[n.jsxs("div",{className:"bg-green-500/20 border-b border-green-500 p-4 flex items-center justify-between shrink-0",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"w-2 h-2 bg-green-500 animate-pulse"}),n.jsx("span",{className:"text-green-500 font-bold tracking-wider",children:"EDIT_EVENT"})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[S&&c&&n.jsx(U,{size:"sm",variant:"ghost",onClick:c,className:"h-6 px-2 border border-green-500/50 text-green-500 hover:bg-green-500/10 rounded-none font-arcade text-[10px]",children:"EDIT SERIES"}),n.jsxs("div",{className:"flex gap-1",children:[S&&n.jsx(Nn,{variant:"outline",className:"text-[10px] border-green-500 text-green-500",children:"INSTANCE"}),u==="series"&&t.recurrence&&n.jsx(Nn,{variant:"outline",className:"text-[10px] border-green-500 text-green-500",children:"SERIES"}),(t.conferenceData||t.hangoutLink)&&n.jsx(Nn,{variant:"outline",className:"text-[10px] border-blue-400 text-blue-400",children:"ONLINE"})]})]})]}),n.jsx("div",{className:"flex border-b border-green-500/30 shrink-0",children:ce.map(v=>n.jsx("button",{className:K("flex-1 py-2 text-[10px] font-arcade transition-colors",f===v.id?"text-green-500 border-b-2 border-green-500 bg-green-500/10":"text-zinc-500 hover:text-zinc-300"),onClick:()=>p(v.id),children:v.label},v.id))}),n.jsxs("div",{className:"p-5 space-y-4 overflow-y-auto flex-1 min-h-0",children:[f==="details"&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(F,{className:"text-xs text-green-500/80",children:"TITLE_"}),n.jsx(H,{value:t.summary||"",onChange:v=>w("summary",v.target.value),className:"bg-black border-green-500/50 focus:border-green-500 text-green-500 font-terminal text-lg h-12 rounded-none"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(F,{className:"text-xs text-green-500/80",children:"DESCRIPTION_"}),n.jsx(Ft,{value:t.description||"",onChange:v=>w("description",v.target.value),className:"bg-black border-green-500/50 text-green-500 font-terminal min-h-[80px] rounded-none resize-none"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(F,{className:"text-xs text-green-500/80",children:"LOCATION_"}),n.jsx(H,{value:t.location||"",onChange:v=>w("location",v.target.value),className:"bg-black border-green-500/50 text-green-500 font-terminal rounded-none"})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(F,{className:"text-xs text-green-500/80",children:"EVENT_TYPE_"}),n.jsxs(ne,{value:t.eventType||"study",onValueChange:v=>w("eventType",v),children:[n.jsx(re,{className:"bg-black border-green-500/50 text-green-500 rounded-none h-8 font-terminal text-xs",children:n.jsx(se,{})}),n.jsxs(ae,{className:"bg-black border-green-500 text-green-500 font-terminal rounded-none z-[100010]",children:[n.jsx(T,{value:"study",children:"STUDY"}),n.jsx(T,{value:"lecture",children:"LECTURE"}),n.jsx(T,{value:"exam",children:"EXAM"}),n.jsx(T,{value:"synchronous",children:"SYNCHRONOUS"}),n.jsx(T,{value:"online",children:"ONLINE"})]})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(F,{className:"text-xs text-green-500/80",children:"COURSE_"}),n.jsxs(ne,{value:M,onValueChange:L,children:[n.jsx(re,{className:"bg-black border-green-500/50 text-green-500 rounded-none h-8 font-terminal text-xs",children:n.jsx(se,{placeholder:"Select course"})}),n.jsxs(ae,{className:"bg-black border-green-500 text-green-500 font-terminal z-[100010]",children:[n.jsx(T,{value:"__none__",children:"None"}),m.length===0&&n.jsx(T,{value:"__empty__",disabled:!0,children:"No courses found"}),m.map(v=>n.jsx(T,{value:String(v.id),children:v.name},v.id))]})]})]})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(F,{className:"text-xs text-green-500/80",children:"WEIGHT_"}),n.jsx(H,{value:t.weight||"",onChange:v=>w("weight",v.target.value),placeholder:"e.g. High, Medium, Low",className:"bg-black border-green-500/50 text-green-500 font-terminal rounded-none"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(F,{className:"text-xs text-green-500/80",children:"COLOR_ID_"}),n.jsxs(ne,{value:t.colorId||"0",onValueChange:v=>w("colorId",v==="0"?void 0:v),children:[n.jsx(re,{className:"bg-black border-green-500/50 text-green-500 rounded-none h-8 font-terminal text-xs",children:n.jsx(se,{placeholder:"Default"})}),n.jsxs(ae,{className:"bg-black border-green-500 text-green-500 font-terminal rounded-none z-[100010]",children:[n.jsx(T,{value:"0",children:"Default"}),n.jsx(T,{value:"1",children:"Lavender"}),n.jsx(T,{value:"2",children:"Sage"}),n.jsx(T,{value:"3",children:"Grape"}),n.jsx(T,{value:"4",children:"Flamingo"}),n.jsx(T,{value:"5",children:"Banana"}),n.jsx(T,{value:"6",children:"Tangerine"}),n.jsx(T,{value:"7",children:"Peacock"}),n.jsx(T,{value:"8",children:"Graphite"}),n.jsx(T,{value:"9",children:"Blueberry"}),n.jsx(T,{value:"10",children:"Basil"}),n.jsx(T,{value:"11",children:"Tomato"})]})]})]})]})]}),f==="time"&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[n.jsx(_t,{id:"all-day",checked:I,onCheckedChange:v=>g(!!v),className:"border-green-500/50 data-[state=checked]:bg-green-500"}),n.jsx(F,{htmlFor:"all-day",className:"text-xs text-green-500/80 cursor-pointer",children:"ALL DAY EVENT"})]}),I?n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(F,{className:"text-xs text-green-500/80",children:"START_DATE_"}),n.jsx(H,{type:"date",value:t.start?.date||"",onChange:v=>s({...t,start:{date:v.target.value}}),className:"bg-black border-green-500/50 text-green-500 font-terminal rounded-none"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(F,{className:"text-xs text-green-500/80",children:"END_DATE_"}),n.jsx(H,{type:"date",value:t.end?.date||"",onChange:v=>s({...t,end:{date:v.target.value}}),className:"bg-black border-green-500/50 text-green-500 font-terminal rounded-none"})]})]}):n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(F,{className:"text-xs text-green-500/80",children:"START_"}),n.jsx(H,{type:"datetime-local",value:t.start?.dateTime?.substring(0,16)||"",onChange:v=>s({...t,start:{dateTime:v.target.value}}),className:"bg-black border-green-500/50 text-green-500 font-terminal rounded-none"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(F,{className:"text-xs text-green-500/80",children:"END_"}),n.jsx(H,{type:"datetime-local",value:t.end?.dateTime?.substring(0,16)||"",onChange:v=>s({...t,end:{dateTime:v.target.value}}),className:"bg-black border-green-500/50 text-green-500 font-terminal rounded-none"})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(F,{className:"text-xs text-green-500/80",children:"TIMEZONE_"}),n.jsxs(ne,{value:A,onValueChange:k,children:[n.jsx(re,{className:"bg-black border-green-500/50 text-green-500 rounded-none h-8 font-terminal text-xs",children:n.jsx(se,{placeholder:"Select timezone"})}),n.jsx(ae,{className:"bg-black border-green-500 text-green-500 font-terminal z-[100010]",children:j.map(v=>n.jsx(T,{value:v,children:v},v))})]})]})]}),f==="recurrence"&&n.jsx(n.Fragment,{children:t.recurringEventId?n.jsxs("div",{className:"space-y-2",children:[n.jsx("p",{className:"text-xs text-yellow-500 font-terminal",children:"This is a single instance of a recurring event. Recurrence can only be edited on the series."}),n.jsxs("p",{className:"text-[10px] text-green-300 font-terminal",children:["Series pattern: ",C(t.recurrence?.[0])]}),S&&c&&n.jsx(U,{size:"sm",variant:"ghost",onClick:c,className:"mt-2 h-7 px-3 border border-green-500/50 text-green-500 hover:bg-green-500/10 rounded-none font-arcade text-[10px]",children:"EDIT SERIES"})]}):n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsxs(F,{className:"text-xs text-green-500/80 flex items-center gap-2",children:["PATTERN_ ",n.jsx($r,{className:"w-3 h-3"})]}),n.jsxs(ne,{value:t.recurrence?.[0]||"none",onValueChange:v=>w("recurrence",v==="none"?void 0:[v]),children:[n.jsx(re,{className:"bg-black border-green-500/50 text-green-500 rounded-none h-8 font-terminal text-xs",children:n.jsx(se,{placeholder:"No Recurrence"})}),n.jsxs(ae,{className:"bg-black border-green-500 text-green-500 font-terminal rounded-none z-[100010]",children:[n.jsx(T,{value:"none",children:"None"}),n.jsx(T,{value:"RRULE:FREQ=DAILY",children:"Daily"}),n.jsx(T,{value:"RRULE:FREQ=WEEKLY",children:"Weekly"}),n.jsx(T,{value:"RRULE:FREQ=MONTHLY",children:"Monthly"}),n.jsx(T,{value:"RRULE:FREQ=YEARLY",children:"Yearly"})]})]})]}),t.recurrence&&!["RRULE:FREQ=DAILY","RRULE:FREQ=WEEKLY","RRULE:FREQ=MONTHLY","RRULE:FREQ=YEARLY"].includes(t.recurrence[0])&&n.jsxs("div",{className:"space-y-2",children:[n.jsx(F,{className:"text-xs text-green-500/80",children:"CUSTOM_RRULE_"}),n.jsx(Ft,{value:t.recurrence[0],onChange:v=>w("recurrence",[v.target.value]),className:"bg-black border-green-500/30 text-green-100/70 text-[10px] font-mono h-12 rounded-none",placeholder:"RRULE:FREQ=WEEKLY;BYDAY=MO,WE"})]})]})}),f==="people"&&n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(F,{className:"text-xs text-green-500/80",children:"ATTENDEES_"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(H,{value:x,onChange:v=>y(v.target.value),onKeyDown:v=>v.key==="Enter"&&P(),placeholder:"email@example.com",className:"bg-black border-green-500/50 text-green-500 font-terminal rounded-none text-xs flex-1"}),n.jsx(U,{size:"sm",onClick:P,className:"rounded-none bg-green-500 text-black hover:bg-green-400 h-9 px-3",children:n.jsx(Xt,{className:"w-3 h-3"})})]})]}),n.jsxs("div",{className:"space-y-1",children:[(t.attendees||[]).map(v=>n.jsxs("div",{className:"flex items-center justify-between p-2 border border-zinc-800 text-xs font-terminal",children:[n.jsx("span",{className:"text-green-500",children:v.email}),n.jsxs("div",{className:"flex items-center gap-2",children:[v.responseStatus&&n.jsx("span",{className:K("text-[10px]",v.responseStatus==="accepted"?"text-green-400":v.responseStatus==="declined"?"text-red-400":"text-yellow-400"),children:v.responseStatus.toUpperCase()}),!v.self&&n.jsx("button",{onClick:()=>z(v.email),className:"text-red-500 hover:text-red-400",children:n.jsx(Or,{className:"w-3 h-3"})})]})]},v.email)),(!t.attendees||t.attendees.length===0)&&n.jsx("p",{className:"text-xs text-zinc-500 font-terminal",children:"No attendees"})]})]}),f==="settings"&&n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(F,{className:"text-xs text-green-500/80",children:"VISIBILITY_"}),n.jsxs(ne,{value:t.visibility||"default",onValueChange:v=>w("visibility",v==="default"?void 0:v),children:[n.jsx(re,{className:"bg-black border-green-500/50 text-green-500 rounded-none h-8 font-terminal text-xs",children:n.jsx(se,{})}),n.jsxs(ae,{className:"bg-black border-green-500 text-green-500 font-terminal z-[100010]",children:[n.jsx(T,{value:"default",children:"Default"}),n.jsx(T,{value:"public",children:"Public"}),n.jsx(T,{value:"private",children:"Private"})]})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(F,{className:"text-xs text-green-500/80",children:"AVAILABILITY_"}),n.jsxs(ne,{value:t.transparency||"opaque",onValueChange:v=>w("transparency",v),children:[n.jsx(re,{className:"bg-black border-green-500/50 text-green-500 rounded-none h-8 font-terminal text-xs",children:n.jsx(se,{})}),n.jsxs(ae,{className:"bg-black border-green-500 text-green-500 font-terminal z-[100010]",children:[n.jsx(T,{value:"opaque",children:"Busy"}),n.jsx(T,{value:"transparent",children:"Free"})]})]})]}),(t.conferenceData||t.hangoutLink)&&n.jsxs("div",{className:"space-y-2",children:[n.jsx(F,{className:"text-xs text-green-500/80",children:"CONFERENCE_"}),n.jsxs("div",{className:"p-2 border border-blue-500/30",children:[n.jsx("p",{className:"text-xs text-blue-400 font-terminal",children:t.conferenceData?.conferenceSolution?.name||"Google Meet"}),t.conferenceData?.entryPoints?.map((v,_)=>n.jsx("a",{href:v.uri,target:"_blank",rel:"noopener noreferrer",className:"text-[10px] text-blue-300 hover:underline block mt-1 font-mono",children:v.uri},_)),t.hangoutLink&&!t.conferenceData&&n.jsx("a",{href:t.hangoutLink,target:"_blank",rel:"noopener noreferrer",className:"text-[10px] text-blue-300 hover:underline block mt-1 font-mono",children:t.hangoutLink})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(F,{className:"text-xs text-green-500/80",children:"REMINDERS_"}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(_t,{id:"use-default-reminders",checked:t.reminders?.useDefault!==!1,onCheckedChange:v=>w("reminders",v?{useDefault:!0}:{useDefault:!1,overrides:t.reminders?.overrides||[]}),className:"border-green-500/50 data-[state=checked]:bg-green-500"}),n.jsx(F,{htmlFor:"use-default-reminders",className:"text-xs text-green-500/80 cursor-pointer",children:"Use default reminders"})]})]})]})]}),n.jsxs("div",{className:"p-4 flex items-center justify-between gap-4 border-t border-green-500/20 shrink-0",children:[n.jsx("div",{className:"flex items-center gap-2",children:S?n.jsxs(n.Fragment,{children:[n.jsxs(U,{variant:"destructive",size:"sm",onClick:i,className:"rounded-none bg-red-900/20 text-red-400 hover:bg-red-900/40 border border-red-900/50 font-arcade text-[10px]",children:[n.jsx(Rt,{className:"w-4 h-4 mr-2"})," DELETE INSTANCE"]}),n.jsxs(U,{variant:"destructive",size:"sm",onClick:l,className:"rounded-none bg-red-900/10 text-red-500 hover:bg-red-900/30 border border-red-900/50 font-arcade text-[10px]",children:[n.jsx(Rt,{className:"w-4 h-4 mr-2"})," DELETE SERIES"]})]}):n.jsxs(U,{variant:"destructive",size:"sm",onClick:l,className:"rounded-none bg-red-900/20 text-red-500 hover:bg-red-900/40 border border-red-900/50 font-arcade text-xs",children:[n.jsx(Rt,{className:"w-4 h-4 mr-2"})," DELETE"]})}),n.jsxs("div",{className:"flex gap-2",children:[n.jsxs(U,{variant:"ghost",className:"bg-transparent border border-green-500/50 text-green-500 hover:bg-green-500/10 rounded-none font-arcade text-xs",onClick:()=>t.htmlLink&&window.open(t.htmlLink,"_blank"),children:[n.jsx(ia,{className:"w-4 h-4 mr-2"})," OPEN"]}),n.jsx(U,{className:"bg-green-500 text-black hover:bg-green-400 rounded-none font-arcade text-xs px-6",onClick:o,children:"SAVE"})]})]})]})]})})}const An=["America/New_York","America/Chicago","America/Denver","America/Los_Angeles","America/Phoenix","America/Anchorage","America/Indiana/Indianapolis","America/Detroit","America/Boise","America/Juneau","Pacific/Honolulu"],Ui=[{value:"#ef4444",label:"Red"},{value:"#f97316",label:"Orange"},{value:"#eab308",label:"Yellow"},{value:"#22c55e",label:"Green"},{value:"#06b6d4",label:"Cyan"},{value:"#3b82f6",label:"Blue"},{value:"#8b5cf6",label:"Purple"},{value:"#ec4899",label:"Pink"},{value:"#6b7280",label:"Gray"}],$i=[{id:"details",label:"DETAILS"},{id:"time",label:"TIME"},{id:"recurrence",label:"REPEAT"},{id:"people",label:"PEOPLE"},{id:"settings",label:"SETTINGS"}];function Gi({open:e,onOpenChange:r,event:t,onEventChange:s,onSave:o,onDelete:i,courseOptions:l=[]}){const[c,u]=d.useState("details"),[m,f]=d.useState(""),p=d.useMemo(()=>{if(typeof Intl<"u"&&"supportedValuesOf"in Intl)try{const g=Intl.supportedValuesOf("timeZone").filter(k=>k.startsWith("America/")||k==="Pacific/Honolulu").slice().sort();return g.length>0?g:An}catch{return An}return An},[]),x=d.useMemo(()=>{if(!t)return"__none__";if(t.courseId)return String(t.courseId);if(t.course){const g=l.find(k=>k.name===t.course);if(g)return String(g.id)}return"__none__"},[t,l]);if(!t)return null;const y=new Date(t.date),S=t.endDate?new Date(t.endDate):null,j=t.timeZone||Intl.DateTimeFormat().resolvedOptions().timeZone||"UTC",C=p[0]||"America/New_York",M=p.includes(j)?j:C,I=(()=>{const g=t.recurrence||"none";return g==="daily"?"RRULE:FREQ=DAILY":g==="weekly"?"RRULE:FREQ=WEEKLY":g==="monthly"?"RRULE:FREQ=MONTHLY":g==="yearly"?"RRULE:FREQ=YEARLY":g})(),b=["RRULE:FREQ=DAILY","RRULE:FREQ=WEEKLY","RRULE:FREQ=MONTHLY","RRULE:FREQ=YEARLY"],D=(g,k)=>{s({...t,[g]:k})},A=g=>{if(g==="__none__"){s({...t,course:null,courseId:null});return}const k=l.find(P=>String(P.id)===g);k&&s({...t,course:k.name,courseId:k.id})},w=()=>{const g=m.trim();if(!g||!g.includes("@"))return;const k=t.attendees||[];k.some(P=>P.email===g)||(D("attendees",[...k,{email:g}]),f(""))},L=g=>{D("attendees",(t.attendees||[]).filter(k=>k.email!==g))};return n.jsx(At,{open:e,onOpenChange:r,children:n.jsxs(Mt,{"data-modal":"calendar-edit-local",className:"font-arcade bg-black border-2 border-primary rounded-none max-w-lg p-0 overflow-hidden translate-y-0 max-h-[calc(100vh-4rem)]",style:{zIndex:100005,top:"3rem",left:"50%",transform:"translate(-50%, 0)"},children:[n.jsx(Lt,{className:"sr-only",children:"Edit Event"}),n.jsx(Ot,{className:"sr-only",children:"Make changes to your event here. Click save when you're done."}),n.jsxs("div",{className:"flex flex-col h-full min-h-0",children:[n.jsxs("div",{className:"bg-primary/20 border-b border-primary p-4 flex items-center gap-2 shrink-0",children:[n.jsx("div",{className:"w-2 h-2 rounded-full bg-primary animate-pulse"}),n.jsx("span",{className:"text-primary font-bold tracking-wider",children:"EDIT_EVENT"})]}),n.jsx("div",{className:"flex border-b border-primary/30 shrink-0",children:$i.map(g=>n.jsx("button",{className:K("flex-1 py-2 text-[10px] font-arcade transition-colors",c===g.id?"text-primary border-b-2 border-primary bg-primary/10":"text-zinc-500 hover:text-zinc-300"),onClick:()=>u(g.id),children:g.label},g.id))}),n.jsxs("div",{className:"p-5 space-y-4 overflow-y-auto flex-1 min-h-0",children:[c==="details"&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(F,{className:"text-xs text-primary/80",children:"TITLE_"}),n.jsx(H,{value:t.title,onChange:g=>D("title",g.target.value),className:"bg-black border-primary/50 focus:border-primary text-primary font-terminal text-lg h-12 rounded-none"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(F,{className:"text-xs text-primary/80",children:"DESCRIPTION_"}),n.jsx(Ft,{value:t.notes||"",onChange:g=>D("notes",g.target.value),className:"bg-black border-primary/50 text-primary font-terminal min-h-[80px] rounded-none resize-none"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(F,{className:"text-xs text-primary/80",children:"LOCATION_"}),n.jsx(H,{value:t.location||"",onChange:g=>D("location",g.target.value||null),className:"bg-black border-primary/50 text-primary font-terminal rounded-none"})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(F,{className:"text-xs text-primary/80",children:"EVENT_TYPE_"}),n.jsxs(ne,{value:t.eventType||"study",onValueChange:g=>D("eventType",g),children:[n.jsx(re,{className:"bg-black border-primary/50 text-primary rounded-none h-8 font-terminal text-xs",children:n.jsx(se,{})}),n.jsxs(ae,{className:"bg-black border-primary text-primary font-terminal z-[100010]",children:[n.jsx(T,{value:"study",children:"STUDY"}),n.jsx(T,{value:"lecture",children:"LECTURE"}),n.jsx(T,{value:"exam",children:"EXAM"}),n.jsx(T,{value:"synchronous",children:"SYNCHRONOUS"}),n.jsx(T,{value:"online",children:"ONLINE"})]})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(F,{className:"text-xs text-primary/80",children:"COURSE_"}),n.jsxs(ne,{value:x,onValueChange:A,children:[n.jsx(re,{className:"bg-black border-primary/50 text-primary rounded-none h-8 font-terminal text-xs",children:n.jsx(se,{placeholder:"Select course"})}),n.jsxs(ae,{className:"bg-black border-primary text-primary font-terminal z-[100010]",children:[n.jsx(T,{value:"__none__",children:"None"}),l.length===0&&n.jsx(T,{value:"__empty__",disabled:!0,children:"No courses found"}),l.map(g=>n.jsx(T,{value:String(g.id),children:g.name},g.id))]})]})]})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(F,{className:"text-xs text-primary/80",children:"WEIGHT_"}),n.jsx(H,{value:t.weight||"",onChange:g=>D("weight",g.target.value||null),placeholder:"e.g. High, Medium, Low",className:"bg-black border-primary/50 text-primary font-terminal rounded-none"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(F,{className:"text-xs text-primary/80",children:"COLOR_"}),n.jsx("div",{className:"flex gap-2 flex-wrap",children:Ui.map(g=>n.jsx("button",{className:K("w-7 h-7 rounded-sm border-2 transition-all",t.color===g.value?"border-white scale-110":"border-transparent hover:border-white/30"),style:{backgroundColor:g.value},onClick:()=>D("color",g.value),title:g.label},g.value))})]})]})]}),c==="time"&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[n.jsx(_t,{id:"local-all-day",checked:t.allDay??!1,onCheckedChange:g=>D("allDay",!!g),className:"border-primary/50 data-[state=checked]:bg-primary"}),n.jsx(F,{htmlFor:"local-all-day",className:"text-xs text-primary/80 cursor-pointer",children:"ALL DAY EVENT"})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(F,{className:"text-xs text-primary/80",children:"START_DATE_"}),n.jsx(H,{type:"date",value:B(y,"yyyy-MM-dd"),onChange:g=>{const[k,P]=[y.getHours(),y.getMinutes()];D("date",lt(it(new Date(g.target.value),k),P))},className:"bg-black border-primary/50 text-primary font-terminal rounded-none"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(F,{className:"text-xs text-primary/80",children:"END_DATE_"}),n.jsx(H,{type:"date",value:S?B(S,"yyyy-MM-dd"):"",onChange:g=>{const k=g.target.value;D("endDate",k?new Date(k):null)},className:"bg-black border-primary/50 text-primary font-terminal rounded-none"})]})]}),!t.allDay&&n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(F,{className:"text-xs text-primary/80",children:"START_TIME_"}),n.jsx(H,{type:"time",value:B(y,"HH:mm"),onChange:g=>{const[k,P]=g.target.value.split(":").map(Number);D("date",lt(it(y,k),P))},className:"bg-black border-primary/50 text-primary font-terminal rounded-none"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(F,{className:"text-xs text-primary/80",children:"END_TIME_"}),n.jsx(H,{type:"time",value:S?B(S,"HH:mm"):"",onChange:g=>{if(!g.target.value)return;const[k,P]=g.target.value.split(":").map(Number);D("endDate",lt(it(S||y,k),P))},className:"bg-black border-primary/50 text-primary font-terminal rounded-none"})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(F,{className:"text-xs text-primary/80",children:"TIMEZONE_"}),n.jsxs(ne,{value:M,onValueChange:g=>D("timeZone",g),children:[n.jsx(re,{className:"bg-black border-primary/50 text-primary rounded-none h-8 font-terminal text-xs",children:n.jsx(se,{placeholder:"Select timezone"})}),n.jsx(ae,{className:"bg-black border-primary text-primary font-terminal z-[100010]",children:p.map(g=>n.jsx(T,{value:g,children:g},g))})]})]})]}),c==="recurrence"&&n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(F,{className:"text-xs text-primary/80",children:"PATTERN_"}),n.jsxs(ne,{value:I,onValueChange:g=>D("recurrence",g==="none"?null:g),children:[n.jsx(re,{className:"bg-black border-primary/50 text-primary rounded-none h-8 font-terminal text-xs",children:n.jsx(se,{placeholder:"No Recurrence"})}),n.jsxs(ae,{className:"bg-black border-primary text-primary font-terminal z-[100010]",children:[n.jsx(T,{value:"none",children:"None"}),n.jsx(T,{value:"RRULE:FREQ=DAILY",children:"Daily"}),n.jsx(T,{value:"RRULE:FREQ=WEEKLY",children:"Weekly"}),n.jsx(T,{value:"RRULE:FREQ=MONTHLY",children:"Monthly"}),n.jsx(T,{value:"RRULE:FREQ=YEARLY",children:"Yearly"})]})]})]}),t.recurrence&&!b.includes(I)&&I!=="none"&&n.jsxs("div",{className:"space-y-2",children:[n.jsx(F,{className:"text-xs text-primary/80",children:"CUSTOM_RRULE_"}),n.jsx(Ft,{value:t.recurrence,onChange:g=>D("recurrence",g.target.value),className:"bg-black border-primary/30 text-primary text-[10px] font-mono h-12 rounded-none",placeholder:"RRULE:FREQ=WEEKLY;BYDAY=MO,WE"})]})]}),c==="people"&&n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(F,{className:"text-xs text-primary/80",children:"ATTENDEES_"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(H,{value:m,onChange:g=>f(g.target.value),onKeyDown:g=>g.key==="Enter"&&w(),placeholder:"email@example.com",className:"bg-black border-primary/50 text-primary font-terminal rounded-none text-xs flex-1"}),n.jsx(U,{size:"sm",onClick:w,className:"rounded-none bg-primary text-black hover:bg-primary/90 h-9 px-3",children:"ADD"})]})]}),n.jsxs("div",{className:"space-y-1",children:[(t.attendees||[]).map(g=>n.jsxs("div",{className:"flex items-center justify-between p-2 border border-zinc-800 text-xs font-terminal",children:[n.jsx("span",{className:"text-primary",children:g.email}),n.jsxs("div",{className:"flex items-center gap-2",children:[g.responseStatus&&n.jsx("span",{className:K("text-[10px]",g.responseStatus==="accepted"?"text-green-400":g.responseStatus==="declined"?"text-red-400":"text-yellow-400"),children:g.responseStatus.toUpperCase()}),!g.self&&n.jsx("button",{onClick:()=>L(g.email),className:"text-red-500 hover:text-red-400",children:"X"})]})]},g.email)),(!t.attendees||t.attendees.length===0)&&n.jsx("p",{className:"text-xs text-zinc-500 font-terminal",children:"No attendees"})]})]}),c==="settings"&&n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(F,{className:"text-xs text-primary/80",children:"VISIBILITY_"}),n.jsxs(ne,{value:t.visibility||"default",onValueChange:g=>D("visibility",g==="default"?null:g),children:[n.jsx(re,{className:"bg-black border-primary/50 text-primary rounded-none h-8 font-terminal text-xs",children:n.jsx(se,{})}),n.jsxs(ae,{className:"bg-black border-primary text-primary font-terminal z-[100010]",children:[n.jsx(T,{value:"default",children:"Default"}),n.jsx(T,{value:"public",children:"Public"}),n.jsx(T,{value:"private",children:"Private"})]})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(F,{className:"text-xs text-primary/80",children:"AVAILABILITY_"}),n.jsxs(ne,{value:t.transparency||"opaque",onValueChange:g=>D("transparency",g),children:[n.jsx(re,{className:"bg-black border-primary/50 text-primary rounded-none h-8 font-terminal text-xs",children:n.jsx(se,{})}),n.jsxs(ae,{className:"bg-black border-primary text-primary font-terminal z-[100010]",children:[n.jsx(T,{value:"opaque",children:"Busy"}),n.jsx(T,{value:"transparent",children:"Free"})]})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(F,{className:"text-xs text-primary/80",children:"REMINDERS_"}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(_t,{id:"use-default-reminders-local",checked:t.reminders?.useDefault!==!1,onCheckedChange:g=>D("reminders",g?{useDefault:!0}:{useDefault:!1,overrides:t.reminders?.overrides||[]}),className:"border-primary/50 data-[state=checked]:bg-primary"}),n.jsx(F,{htmlFor:"use-default-reminders-local",className:"text-xs text-primary/80 cursor-pointer",children:"Use default reminders"})]})]})]})]}),n.jsxs("div",{className:"p-4 flex items-center justify-between gap-4 border-t border-primary/20 shrink-0",children:[n.jsxs(U,{variant:"destructive",size:"sm",onClick:i,className:"rounded-none bg-red-900/20 text-red-500 hover:bg-red-900/40 border border-red-900/50 font-arcade text-xs",children:[n.jsx(Rt,{className:"w-4 h-4 mr-2"})," DELETE"]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(U,{variant:"ghost",className:"bg-transparent border border-primary/50 text-primary hover:bg-primary/10 rounded-none font-arcade text-xs",onClick:()=>r(!1),children:"CANCEL"}),n.jsx(U,{className:"bg-primary text-black hover:bg-primary/90 rounded-none font-arcade text-xs px-6",onClick:o,children:"SAVE"})]})]})]})]})})}const Ki=e=>{let{transform:r}=e;return{...r,x:0}},Mn=e=>{if(!e)return new Date;const[r,t,s]=e.split("-").map(Number);return!r||!t||!s?new Date(e):new Date(r,t-1,s)},Ln=Array.from({length:24},(e,r)=>r),at=60;function Hi({tasks:e,taskLists:r}){const t=Kn(),{toast:s}=Fr(),[o,i]=d.useState(null),[l,c]=d.useState(null),[u,m]=d.useState(0),[f,p]=d.useState(null),x=Xr(zn(dn,{activationConstraint:{distance:8}}),zn(Zn,{coordinateGetter:ji})),y=Q({mutationFn:b=>q.googleTasks.move(b.taskId,b.listId,b.destListId,b.previous,b.parent),onSuccess:()=>t.invalidateQueries({queryKey:["google-tasks"]}),onError:()=>s({title:"Move Failed",variant:"destructive"})}),S=Q({mutationFn:b=>q.googleTasks.update(b.id,b.listId,b.data),onSuccess:()=>{t.invalidateQueries({queryKey:["google-tasks"]}),c(null)}}),j=Q({mutationFn:b=>q.googleTasks.create(b.listId,{title:b.title,status:"needsAction"}),onSuccess:()=>t.invalidateQueries({queryKey:["google-tasks"]})}),C=Q({mutationFn:b=>q.googleTasks.delete(b.id,b.listId),onSuccess:()=>t.invalidateQueries({queryKey:["google-tasks"]})}),M=Q({mutationFn:b=>q.googleTasks.update(b.id,b.listId,{status:b.status==="completed"?"needsAction":"completed"}),onSuccess:()=>t.invalidateQueries({queryKey:["google-tasks"]})}),I=b=>{const{active:D,over:A}=b;if(i(null),!A)return;const w=e.find(g=>g.id===D.id);if(!w)return;let L=null;if(A.data.current?.listId)L=A.data.current.listId;else if(A.data.current?.type==="Container")L=A.id;else{const g=e.find(k=>k.id===A.id);g&&(L=g.listId)}if(L&&(D.id!==A.id||w.listId!==L)){const g=e.filter(P=>P.listId===L).sort((P,z)=>(P.position||"").localeCompare(z.position||""));let k;if(D.id!==A.id){e.findIndex(z=>z.id===D.id);const P=g.findIndex(z=>z.id===A.id);P!==-1&&P>0&&(k=g[P-1].id)}y.mutate({taskId:w.id,listId:w.listId,destListId:L,previous:k})}};return n.jsxs(bs,{sensors:x,collisionDetection:ns,onDragEnd:I,onDragStart:b=>i(b.active.id),children:[n.jsxs("div",{className:"flex h-full items-start justify-center gap-4 pt-4",children:[n.jsx(U,{variant:"ghost",size:"icon",onClick:()=>m(b=>(b-1+r.length)%r.length),className:"h-10 w-10 mt-3 rounded-none border border-secondary hover:bg-primary/10 hover:text-primary shrink-0",children:n.jsx(Ur,{className:"h-5 w-5"})}),r.length>0&&(()=>{const b=r[u],D=e.filter(A=>A.listId===b.id).sort((A,w)=>(A.position||"").localeCompare(w.position||""));return n.jsx("div",{className:"h-full w-[320px] shrink-0",children:n.jsx(_i,{listId:b.id,title:b.title,tasks:D,onAddTask:A=>p(A),onEdit:A=>c(A),onToggle:A=>M.mutate(A),onDelete:(A,w)=>{confirm("Delete task?")&&C.mutate({id:A,listId:w})}},b.id)})})(),n.jsx(U,{variant:"ghost",size:"icon",onClick:()=>m(b=>(b+1)%r.length),className:"h-10 w-10 mt-3 rounded-none border border-secondary hover:bg-primary/10 hover:text-primary shrink-0",children:n.jsx(Hn,{className:"h-5 w-5"})})]}),n.jsx(ci,{children:o?n.jsx("div",{className:"opacity-80 rotate-2 cursor-grabbing",children:n.jsx("div",{className:"p-2 border bg-card text-primary font-arcade text-xs border-primary",children:e.find(b=>b.id===o)?.title||"Task"})}):null}),n.jsx(Mr,{task:l,isOpen:!!l,onClose:()=>c(null),onSave:b=>{l&&S.mutate({id:l.id,listId:l.listId,data:b})},onDelete:(b,D)=>C.mutate({id:b,listId:D}),availableLists:r}),n.jsx(Mr,{task:null,isOpen:!!f,isCreating:!0,activeListId:f||void 0,availableLists:r,onClose:()=>p(null),onSave:b=>{f&&b.title&&j.mutate({listId:f,title:b.title,...b})},onDelete:()=>{}})]})}function Bi({cal:e,isHidden:r,onToggle:t}){const{attributes:s,listeners:o,setNodeRef:i,transform:l,transition:c}=tr({id:e.id}),u={transform:$e.Transform.toString(l),transition:c};return n.jsxs("div",{ref:i,style:u,className:K("flex items-center gap-3 p-2 border border-secondary hover:bg-secondary/30 transition-colors",r&&"opacity-50"),children:[n.jsx("div",{...s,...o,className:"cursor-grab text-muted-foreground hover:text-foreground",children:n.jsx(Vs,{className:"w-4 h-4"})}),n.jsx("div",{className:"w-4 h-4 rounded-sm",style:{backgroundColor:e.color}}),n.jsx("span",{className:"font-terminal text-sm flex-1 cursor-pointer",onClick:t,children:e.name}),n.jsx("span",{className:K("font-arcade text-[10px] px-2 py-0.5 cursor-pointer",r?"text-red-500":"text-green-500"),onClick:t,children:r?"HIDDEN":"VISIBLE"})]})}function il(){const e=Kn(),{toast:r}=Fr(),[t,s]=d.useState(new Date),[o,i]=d.useState("month"),[l,c]=d.useState(!1),[u,m]=d.useState(!1),[f,p]=d.useState(null),[x,y]=d.useState({title:"",date:"",endDate:"",startTime:"09:00",endTime:"10:00",allDay:!1,eventType:"study",color:"#ef4444",recurrence:"",calendarId:""}),[S,j]=d.useState(()=>{try{const a=localStorage.getItem("selectedCalendars");if(a){const h=JSON.parse(a);if(Array.isArray(h))return new Set(h)}}catch{}return new Set}),[C,M]=d.useState(!0),[I,b]=d.useState(!1),[D,A]=d.useState(""),[w,L]=d.useState(null),[g,k]=d.useState(!1),[P,z]=d.useState("series"),[ce,v]=d.useState(!1),[_,oe]=d.useState(!1),[Me,ie]=d.useState(!1),ye=typeof window<"u"&&new URLSearchParams(window.location.search).has("debugModals"),[de,We]=d.useState(()=>{const a=localStorage.getItem("pinnedCalendars");return a?JSON.parse(a):[]}),[Le,te]=d.useState(()=>{const a=localStorage.getItem("hiddenCalendars");return a?JSON.parse(a):[]}),[xe,De]=d.useState(!1),Ze=Xr(zn(dn,{activationConstraint:{distance:5}})),[ve,pt]=d.useState(!1);d.useEffect(()=>{u&&!f&&(ye&&console.warn("[ModalDebug][Calendar] Edit modal open without event; closing."),m(!1))},[ye,f,u]),d.useEffect(()=>{g&&!w&&(ye&&console.warn("[ModalDebug][Calendar] Google edit modal open without event; closing."),k(!1))},[ye,w,g]),d.useEffect(()=>{ye&&console.info("[ModalDebug][Calendar] state",{showEditModal:u,selectedEvent:f?.id??null,showGoogleEditModal:g,selectedGoogleEvent:w?.id??null,googleEditMode:P,showCalendarSettings:xe,showEventModal:l})},[ye,f,w,P,xe,u,l,g]);const Oe=a=>{te(h=>{const N=h.includes(a),R=N?h.filter(E=>E!==a):[...h,a];return localStorage.setItem("hiddenCalendars",JSON.stringify(R)),N||j(E=>{const O=new Set(E);return O.delete(a),O}),R})},Se=En(t),G=wn(t),Xe=jn(Se,{weekStartsOn:0}),we=gr(G,{weekStartsOn:0}),Ge=Cn({start:Xe,end:we}),pe=jn(t,{weekStartsOn:0}),Fe=Cn({start:pe,end:qe(pe,6)}),{data:Ke=[]}=Ye({queryKey:["events"],queryFn:q.events.getAll}),Je=Ke.map(a=>({...a,date:new Date(a.date),endDate:a.endDate?new Date(a.endDate):null,createdAt:new Date(a.createdAt)})),{data:et=[],isLoading:ct,refetch:Ne}=Ye({queryKey:["google-calendar",t.getFullYear(),t.getMonth()],queryFn:async()=>{const a=En(pr(t)).toISOString(),h=wn(Pn(t,1)).toISOString(),N=await fetch(`/api/google-calendar/events?timeMin=${encodeURIComponent(a)}&timeMax=${encodeURIComponent(h)}`);if(!N.ok)throw new Error("Failed to fetch");return N.json()}}),{data:dt=[]}=Ye({queryKey:["tasks"],queryFn:q.tasks.getAll}),{data:tt=[],isLoading:hn,isError:gn,refetch:ar}=Ye({queryKey:["google-tasks"],queryFn:q.googleTasks.getAll,retry:1}),{data:Ht=[]}=Ye({queryKey:["courses"],queryFn:q.courses.getActive}),{data:He=[]}=Ye({queryKey:["google-task-lists"],queryFn:q.googleTasks.getLists}),{data:Ue=[],refetch:nt}=Ye({queryKey:["google-calendar-list"],queryFn:async()=>{const a=await fetch("/api/google-calendar/calendars");if(!a.ok)throw new Error("Failed to fetch calendar list");return a.json()}}),{data:bt,refetch:Re,isLoading:xn,error:or}=Ye({queryKey:["google-status"],queryFn:q.google.getStatus,retry:1}),ut=!!bt?.connected,yt=async()=>{if(!Me){ie(!0);try{const a=await Re();if(a.data&&!a.data.connected){r({title:"SYNC_FAILED",description:"Google is not connected.",variant:"destructive"});return}const R=((await nt()).data||[]).map(O=>O.id).filter(Boolean);let E=null;if(R.length>0){const O=await fetch("/api/gcal/sync",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({calendar_ids:R})});if(!O.ok)throw new Error("Failed to sync with Google.");const $=await O.json();if($?.success===!1)throw new Error($.error||"Sync failed.");E=$||null}if(R.length>0){const O=new Set(R);j(O),te([]),typeof window<"u"&&(localStorage.setItem("selectedCalendars",JSON.stringify(R)),localStorage.setItem("hiddenCalendars",JSON.stringify([]))),b(!1)}if(e.invalidateQueries({queryKey:["events"]}),await Ne(),E){const O=[typeof E.imported=="number"?`${E.imported} imported`:null,typeof E.updated=="number"?`${E.updated} updated`:null,typeof E.pushed=="number"?`${E.pushed} pushed`:null].filter(Boolean).join(", "),$=E.errors?.length?` (${E.errors.length} errors)`:"";r({title:"SYNCED",description:`Google sync complete${O?`: ${O}`:""}${$}.`})}else r({title:"SYNCED",description:"Google calendars refreshed."})}catch(a){r({title:"SYNC_FAILED",description:a instanceof Error?a.message:"Unable to sync Google calendars.",variant:"destructive"})}finally{ie(!1)}}},ft=Q({mutationFn:async()=>{const{authUrl:a}=await q.google.getAuthUrl();window.location.href=a}});Q({mutationFn:q.google.disconnect,onSuccess:()=>{Re(),e.invalidateQueries({queryKey:["google-calendar-events"]}),e.invalidateQueries({queryKey:["google-calendar-list"]}),e.invalidateQueries({queryKey:["google-tasks"]})}});const{data:vt=[]}=Ye({queryKey:["calendar-order"],queryFn:async()=>{const a=await fetch("/api/calendar-order?userId=default");return a.ok?a.json():[]}}),Bt=Q({mutationFn:async a=>{if(!(await fetch("/api/calendar-order",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:"default",order:a})})).ok)throw new Error("Failed to save calendar order")},onMutate:async a=>{await e.cancelQueries({queryKey:["calendar-order"]}),e.setQueryData(["calendar-order"],a)},onError:()=>{e.invalidateQueries({queryKey:["calendar-order"]})}}),le=d.useMemo(()=>{const a=Ue.map(h=>({id:h.id,name:h.summary,color:h.backgroundColor||"#888888"}));if(vt.length>0){const h=new Map(vt.map((N,R)=>[N,R]));a.sort((N,R)=>{const E=h.get(N.id)??999,O=h.get(R.id)??999;return E-O})}return a},[Ue,vt]),pn=d.useMemo(()=>le.filter(a=>!Le.includes(a.id)),[le,Le]),Vt=d.useMemo(()=>{const a=Ht.map(N=>({id:N.id,name:N.name,code:N.code??null})).filter(N=>!!N.name),h=new Map;return a.forEach(N=>{h.has(N.id)||h.set(N.id,N)}),Array.from(h.values()).sort((N,R)=>N.name.localeCompare(R.name))},[Ht]);d.useEffect(()=>{if(le.length>0&&S.size===0&&!localStorage.getItem("selectedCalendars")){const a=de.length>0?de:le.slice(0,2).map(h=>h.id);j(new Set(a))}},[le,de]),d.useEffect(()=>{if(le.length>0&&de.length===0&&!localStorage.getItem("pinnedCalendars")){const a=le.slice(0,2).map(h=>h.id);We(a),localStorage.setItem("pinnedCalendars",JSON.stringify(a))}},[le,de]);const X=a=>{j(h=>{const N=new Set(h);return N.has(a)?N.delete(a):N.add(a),N}),b(!0)},ue=Q({mutationFn:q.events.create,onSuccess:()=>{e.invalidateQueries({queryKey:["events"]}),c(!1),je()}}),fe=Q({mutationFn:({id:a,data:h})=>q.events.update(a,h),onSuccess:()=>{e.invalidateQueries({queryKey:["events"]}),m(!1),p(null)}}),_e=Q({mutationFn:q.events.delete,onSuccess:()=>{e.invalidateQueries({queryKey:["events"]}),m(!1),p(null)}});Q({mutationFn:q.tasks.create,onSuccess:()=>{e.invalidateQueries({queryKey:["tasks"]})}}),Q({mutationFn:({id:a,status:h})=>q.tasks.update(a,{status:h==="completed"?"pending":"completed"}),onSuccess:()=>{e.invalidateQueries({queryKey:["tasks"]})}}),Q({mutationFn:async a=>{const h=await fetch("/api/google-tasks/@default",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:a})});if(!h.ok)throw new Error("Failed to create task");return h.json()},onSuccess:()=>{e.invalidateQueries({queryKey:["google-tasks"]})}}),Q({mutationFn:async({taskId:a,completed:h})=>{const N=await fetch(`/api/google-tasks/@default/${a}/toggle`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({completed:h})});if(!N.ok)throw new Error("Failed to toggle task");return N.json()},onSuccess:()=>{e.invalidateQueries({queryKey:["google-tasks"]})}});const me=Q({mutationFn:async({eventId:a,calendarId:h})=>{const N=await fetch(`/api/google-calendar/events/${encodeURIComponent(a)}?calendarId=${encodeURIComponent(h)}`,{method:"DELETE"});if(!N.ok)throw new Error("Failed to delete event");return N.status===204?null:N.json()},onSuccess:()=>{e.invalidateQueries({queryKey:["google-calendar"]}),Ne(),r({title:"EVENT_DELETED",description:"Event removed from Google Calendar"}),k(!1),L(null)},onError:a=>{r({title:"DELETE_FAILED",description:a.message,variant:"destructive"})}}),he=Q({mutationFn:async a=>{if(!a.calendarId)throw new Error("Missing calendarId");const h={...a.extendedProperties?.private||{}};a.eventType!==void 0?h.eventType=a.eventType:delete h.eventType,a.course!==void 0?h.course=a.course:delete h.course,a.courseId!==void 0?h.courseId=String(a.courseId):delete h.courseId,a.courseCode!==void 0?h.courseCode=a.courseCode:delete h.courseCode,a.weight!==void 0?h.weight=a.weight:delete h.weight;const N=a.extendedProperties?.private?.timeZone||a.start?.timeZone;N&&(h.timeZone=N);const R=Object.keys(h).length?{private:h}:void 0,E=await fetch(`/api/google-calendar/events/${encodeURIComponent(a.id)}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({calendarId:a.calendarId,summary:a.summary,description:a.description,location:a.location,start:a.start,end:a.end,recurrence:a.recurringEventId?void 0:a.recurrence,attendees:a.attendees,visibility:a.visibility,transparency:a.transparency,colorId:a.colorId,reminders:a.reminders,extendedProperties:R})});if(!E.ok)throw new Error("Failed to update google event");return E.json()},onSuccess:()=>{e.invalidateQueries({queryKey:["google-calendar"]}),Ne(),r({title:"EVENT_UPDATED",description:"Changes synced to Google Calendar"}),k(!1)},onError:a=>{r({title:"SYNC_FAILED",description:a.message,variant:"destructive"})}}),Ce=Q({mutationFn:async a=>{const h=await fetch("/api/google-calendar/events",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!h.ok)throw new Error("Failed to create Google event");return h.json()},onSuccess:()=>{e.invalidateQueries({queryKey:["google-calendar"]}),Ne(),c(!1),je(),r({title:"EVENT_CREATED",description:"Saved to Google Calendar"})},onError:a=>{r({title:"CREATE_FAILED",description:a.message,variant:"destructive"})}}),Be=()=>{!w||!w.calendarId||confirm("Delete this single occurrence?")&&me.mutate({eventId:w.id,calendarId:w.calendarId})},W=()=>{if(!w||!w.calendarId)return;const a=w.recurringEventId||w.id;confirm("Delete the ENTIRE series? This cannot be undone.")&&me.mutate({eventId:a,calendarId:w.calendarId})},Pe=()=>{w&&he.mutate(w)},je=()=>{y({title:"",date:"",endDate:"",startTime:"09:00",endTime:"10:00",allDay:!1,eventType:"study",color:"#ef4444",recurrence:"",calendarId:""})},Te=a=>{if(!a||a==="none")return null;if(a.startsWith("RRULE:"))return a;switch(a){case"daily":return"RRULE:FREQ=DAILY";case"weekly":return"RRULE:FREQ=WEEKLY";case"monthly":return"RRULE:FREQ=MONTHLY";case"yearly":return"RRULE:FREQ=YEARLY";default:return a}},rt=a=>"summary"in a,ze=a=>{if(rt(a)){const h=!!a.start?.date&&!a.start?.dateTime,N=a.start?.dateTime||a.start?.date||new Date().toISOString(),R=a.end?.dateTime||a.end?.date||N,E=h&&a.start?.date?Mn(a.start.date):new Date(N);let O=h&&a.end?.date?Mn(a.end.date):new Date(R);h&&a.start?.date&&a.end?.date&&a.end.date>a.start.date&&(O=qe(Mn(a.end.date),-1));const $=!!(a.conferenceData||a.hangoutLink),J=a.eventType||a.extendedProperties?.private?.eventType;return{id:a.id,title:a.summary||"Untitled",start:E,end:O,allDay:h,isGoogle:!0,eventType:J||($?"online":"synchronous"),calendarColor:a.calendarColor,calendarName:a.calendarSummary,originalEvent:a}}else{const h=a,N=new Date(h.date),R=h.endDate?new Date(h.endDate):da(N,1);return{id:h.id,title:h.title,start:N,end:R,allDay:h.allDay||!1,isGoogle:!1,eventType:h.eventType,calendarColor:h.color||void 0,originalEvent:a}}},Ie=a=>!a.calendarId||a.calendarId==="local",st=()=>{if(x.title&&x.date){const[a,h]=x.startTime.split(":").map(Number),[N,R]=x.endTime.split(":").map(Number),E=lt(it(new Date(x.date),a),h);let O=null;if(x.allDay)x.endDate&&(O=new Date(x.endDate));else{const J=x.endDate||x.date;O=lt(it(new Date(J),N),R)}const $=Te(x.recurrence);if(x.calendarId&&x.calendarId!=="local"){if(!ut){r({title:"SYNC_FAILED",description:"Google is not connected.",variant:"destructive"});return}const J=x.allDay&&x.endDate?qe(new Date(x.endDate),1):O;Ce.mutate({calendarId:x.calendarId,title:x.title,date:E,endDate:J,allDay:x.allDay,recurrence:$});return}ue.mutate({title:x.title,date:E,endDate:O,allDay:x.allDay,eventType:x.eventType,color:x.color,recurrence:$,calendarId:"local"})}},Ve=(a,h)=>{const N=h??9;y({title:"",date:B(a,"yyyy-MM-dd"),endDate:"",startTime:`${N.toString().padStart(2,"0")}:00`,endTime:`${(N+1).toString().padStart(2,"0")}:00`,allDay:!1,eventType:"study",color:"#ef4444",recurrence:"",calendarId:"local"}),c(!0)},ks=a=>{a&&(p(a),m(!0))},ir=(a,h)=>{const N=a.extendedProperties?.private||{},R=N.courseId?Number.parseInt(N.courseId,10):void 0,E=Number.isFinite(R)?R:void 0;return{...a,calendarId:a.calendarId??h?.calendarId,calendarSummary:a.calendarSummary??h?.calendarSummary,calendarColor:a.calendarColor??h?.calendarColor,eventType:a.eventType||N.eventType||h?.eventType,course:a.course||N.course||h?.course,courseId:a.courseId??E??h?.courseId,courseCode:a.courseCode||N.courseCode||h?.courseCode,weight:a.weight||N.weight||h?.weight}},As=(a,h)=>{if(!a)return;const N=a.recurringEventId?"instance":"series";z(N),L(ir(a)),k(!0)},Ms=async()=>{if(!(!w?.recurringEventId||!w.calendarId))try{const a=await fetch(`/api/google-calendar/events/${encodeURIComponent(w.recurringEventId)}?calendarId=${encodeURIComponent(w.calendarId)}`);if(!a.ok)throw new Error("Failed to load series");const h=await a.json(),N=ir({...h,calendarId:w.calendarId,calendarSummary:w.calendarSummary,calendarColor:w.calendarColor},w);L(N),z("series")}catch(a){r({title:"LOAD_FAILED",description:a?.message||"Unknown error",variant:"destructive"})}},Nt=a=>{a.isGoogle?As(a.originalEvent):ks(a.originalEvent)};d.useMemo(()=>{if(!D.trim())return[];const a=D.toLowerCase(),h=[];return C&&Je.forEach(N=>{ut&&!Ie(N)||N.title.toLowerCase().includes(a)&&h.push(ze(N))}),et.forEach(N=>{S.has(N.calendarId||"")&&N.summary?.toLowerCase().includes(a)&&h.push(ze(N))}),h.sort((N,R)=>N.start.getTime()-R.start.getTime())},[D,Je,et,C,S]);const lr=d.useMemo(()=>{const a=[];return C&&Je.forEach(h=>{ut&&!Ie(h)||a.push(ze(h))}),et.forEach(h=>{S.has(h.calendarId||"")&&a.push(ze(h))}),a},[Je,et,C,S,ut]),Ls=d.useMemo(()=>{const a=new Map;return lr.forEach(h=>{const N=mr(h.start),R=mr(h.end);let E=N;for(;E<=R;){const O=B(E,"yyyy-MM-dd");a.has(O)||a.set(O,[]),a.get(O).push(h),E=qe(E,1)}}),a.forEach(h=>{h.sort((N,R)=>N.allDay&&!R.allDay?-1:!N.allDay&&R.allDay?1:N.start.getTime()-R.start.getTime())}),a},[lr]),jt=a=>{const h=B(a,"yyyy-MM-dd");return Ls.get(h)||[]},cr=a=>{s(o==="month"?a==="prev"?pr(t):Pn(t,1):o==="week"?a==="prev"?Ta(t):Kr(t,1):a==="prev"?ma(t):qe(t,1))},Os=()=>s(new Date),bn=a=>{s(a),i("day")};dt.filter(a=>a.status==="pending").length,tt.filter(a=>a.status==="needsAction").length;const Fs=()=>o==="month"?B(t,"MMMM yyyy").toUpperCase():o==="week"?`${B(pe,"MMM d")} - ${B(qe(pe,6),"MMM d, yyyy")}`.toUpperCase():B(t,"EEEE, MMMM d, yyyy").toUpperCase(),wt=a=>{const h="backdrop-blur-sm shadow-sm transition-all duration-200 hover:scale-[1.02] hover:z-50 hover:shadow-lg";if(a.calendarColor)return`${h} text-white font-medium border-l-4`;if(a.isGoogle)return`${h} text-white font-medium border-l-4`;switch(a.eventType){case"study":return`${h} bg-red-500/30 text-white border-l-4 border-red-500`;case"lecture":return`${h} bg-cyan-500/30 text-white border-l-4 border-cyan-500`;case"exam":return`${h} bg-amber-500/30 text-white border-l-4 border-amber-500`;default:return`${h} bg-red-500/30 text-white border-l-4 border-red-500`}},Ct=a=>{if(a.calendarColor){const h=a.calendarColor.replace("#",""),N=parseInt(h.substring(0,2),16),R=parseInt(h.substring(2,4),16),E=parseInt(h.substring(4,6),16);return{backgroundColor:`rgba(${N}, ${R}, ${E}, 0.35)`,borderLeftColor:a.calendarColor,boxShadow:"0 4px 6px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.1)"}}return{boxShadow:"0 4px 6px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.1)"}},dr=(a,h,N=0,R=1)=>{const E=hr(a.start,h),O=hr(a.end,a.start),$=E/60*at,J=Math.max(O/60*at,24),Et=R>1?`${100/R}%`:"calc(100% - 4px)",yn=R>1?`${N/R*100}%`:"0",vn={top:`${$}px`,height:`${J}px`,width:Et,left:yn};return a.calendarColor&&(vn.backgroundColor=a.calendarColor,vn.borderLeftColor=a.calendarColor),vn},ur=a=>{const h=new Map;if(a.length===0)return h;const N=[...a].sort((E,O)=>E.start.getTime()-O.start.getTime()),R=[];for(const E of N){let O=-1;for(let $=0;$<R.length;$++)if(E.start>=R[$]){O=$;break}O===-1?(O=R.length,R.push(E.end)):R[O]=E.end,h.set(E.id,{column:O,totalColumns:1})}for(const E of N){let O=1;for(const J of N)if(E.id!==J.id&&E.start<J.end&&E.end>J.start){const Et=h.get(E.id)?.column||0,yn=h.get(J.id)?.column||0;O=Math.max(O,Et+1,yn+1)}const $=h.get(E.id);$&&h.set(E.id,{...$,totalColumns:O})}return h};return n.jsxs(Bs,{children:[ye&&n.jsxs("div",{className:"fixed bottom-12 right-4 z-[70] bg-black/80 border border-primary text-primary font-terminal text-[10px] px-2 py-1 rounded-none",children:[n.jsx("div",{children:"Calendar modals"}),n.jsxs("div",{children:["Edit event: ",u?"open":"closed"]}),n.jsxs("div",{children:["Selected event: ",f?.id??"none"]}),n.jsxs("div",{children:["Google edit: ",g?"open":"closed"]}),n.jsxs("div",{children:["Google event: ",w?.id??"none"]}),n.jsxs("div",{children:["Manage calendars: ",xe?"open":"closed"]}),n.jsxs("div",{children:["Create event: ",l?"open":"closed"]})]}),n.jsx("div",{className:"h-[calc(100vh-80px)]",children:n.jsx("div",{className:"flex flex-col h-full",children:n.jsxs(Pr,{className:"bg-black/40 border-2 border-primary rounded-none flex-1 flex flex-col overflow-hidden",children:[n.jsxs(zr,{className:"border-b border-primary/30 p-4 flex flex-row justify-between items-center shrink-0",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx(U,{size:"sm",variant:"outline",className:"rounded-none border-primary text-primary hover:bg-primary hover:text-black font-arcade text-xs",onClick:Os,"data-testid":"button-today",children:"TODAY"}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx(U,{size:"icon",variant:"ghost",className:"h-8 w-8 rounded-none hover:bg-primary/20",onClick:()=>cr("prev"),"data-testid":"button-prev",children:n.jsx(Ur,{className:"h-4 w-4"})}),n.jsx(U,{size:"icon",variant:"ghost",className:"h-8 w-8 rounded-none hover:bg-primary/20",onClick:()=>cr("next"),"data-testid":"button-next",children:n.jsx(Hn,{className:"h-4 w-4"})})]}),n.jsxs("div",{className:"relative",children:[n.jsxs("button",{className:"font-arcade text-sm md:text-lg text-primary hover:text-primary/80 flex items-center gap-1 transition-colors",onClick:()=>oe(!_),"data-testid":"text-header-title",children:[Fs(),n.jsx(Zs,{className:K("w-4 h-4 transition-transform",_&&"rotate-180")})]}),_&&n.jsx("div",{className:"absolute top-full left-0 mt-2 z-50 bg-black border-2 border-primary p-2 shadow-lg",children:n.jsxs("div",{className:"grid grid-cols-7 gap-1 text-center min-w-[200px]",children:[["S","M","T","W","T","F","S"].map((a,h)=>n.jsx("div",{className:"font-arcade text-[8px] text-muted-foreground p-1",children:a},h)),Cn({start:jn(En(t),{weekStartsOn:0}),end:gr(wn(t),{weekStartsOn:0})}).slice(0,42).map((a,h)=>n.jsx("button",{onClick:()=>{bn(a),oe(!1)},className:K("font-terminal text-[10px] p-1 hover:bg-primary/20 transition-colors",!xr(a,t)&&"text-muted-foreground/50",ot(a)&&"bg-primary text-black",ta(a,t)&&!ot(a)&&"ring-1 ring-primary"),children:B(a,"d")},h))]})})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("div",{className:"relative hidden md:block",children:[n.jsx(oa,{className:"absolute left-2 top-1/2 -translate-y-1/2 w-3 h-3 text-muted-foreground"}),n.jsx(H,{className:"rounded-none bg-black/60 border-secondary pl-7 pr-2 font-terminal text-xs h-8 w-40",placeholder:"Search...",value:D,onChange:a=>A(a.target.value),"data-testid":"input-search-events"})]}),n.jsx(Pi,{onClick:()=>v(!0)}),n.jsx(U,{size:"sm",variant:"ghost",className:"rounded-none hover:bg-primary/20",onClick:yt,disabled:ct||Me,"data-testid":"button-sync",children:n.jsx($r,{className:K("h-4 w-4",(ct||Me)&&"animate-spin")})}),n.jsx("div",{className:"flex border border-secondary rounded-none",children:["month","week","day","tasks"].map(a=>n.jsx(U,{size:"sm",variant:o===a?"default":"ghost",className:K("rounded-none font-arcade text-xs px-3",o===a?"bg-primary text-black":""),onClick:()=>i(a),"data-testid":`button-${a}-view`,children:a.toUpperCase()},a))}),n.jsxs(U,{size:"sm",className:"rounded-none font-arcade text-xs bg-primary text-black hover:bg-primary/90",onClick:()=>Ve(t),"data-testid":"button-create-event-header",children:[n.jsx(Xt,{className:"w-4 h-4 mr-1"})," CREATE"]})]})]}),n.jsxs("div",{className:"px-4 py-1.5 border-b border-primary/20 bg-black/60 flex items-center gap-3 shrink-0",children:[n.jsxs("div",{className:"flex items-center gap-4 overflow-x-auto flex-1 min-w-0",children:[n.jsx("span",{className:"font-arcade text-xs text-muted-foreground shrink-0",children:"CALENDARS:"}),n.jsxs("div",{className:"flex items-center gap-2 cursor-pointer hover:opacity-80 transition-opacity shrink-0",onClick:()=>M(!C),children:[n.jsx("div",{className:K("w-3 h-3 rounded-sm",C?"bg-primary":"bg-muted-foreground/30")}),n.jsx("span",{className:K("font-terminal text-sm",C?"text-primary":"text-muted-foreground"),children:"Local"})]}),pn.map(a=>n.jsxs("div",{className:"flex items-center gap-1.5 cursor-pointer hover:opacity-80 transition-opacity shrink-0",onClick:()=>X(a.id),children:[n.jsx("div",{className:"w-3 h-3 rounded-sm",style:{backgroundColor:S.has(a.id)?a.color:"rgba(100,100,100,0.3)"}}),n.jsx("span",{className:K("font-terminal text-sm truncate max-w-[100px]",S.has(a.id)?"":"text-muted-foreground"),children:a.name})]},a.id)),Le.length>0&&n.jsxs("span",{className:"font-terminal text-[10px] text-muted-foreground shrink-0",children:["+",Le.length," hidden"]})]}),n.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[n.jsxs(U,{size:"sm",variant:"ghost",className:"h-6 px-2 rounded-none hover:bg-primary/20 font-arcade text-[9px] flex items-center gap-1.5",onClick:()=>{localStorage.setItem("selectedCalendars",JSON.stringify(Array.from(S))),b(!1),r({title:"SAVED",description:`${S.size} calendar(s) saved`})},children:[n.jsx("div",{className:K("w-2 h-2 rounded-full",I?"bg-red-500":"bg-green-500")}),"SAVE"]}),n.jsx(U,{size:"sm",variant:"ghost",className:"h-6 px-2 rounded-none hover:bg-primary/20 font-arcade text-[9px]",onClick:()=>{ye&&console.info("[ModalDebug][Calendar] MANAGE click"),De(!0)},children:"MANAGE"}),bt?.connected?n.jsxs("div",{className:"flex items-center gap-1 text-green-500",children:[n.jsx("div",{className:"w-2 h-2 rounded-full bg-current"}),n.jsx("span",{className:"font-terminal text-[10px]",children:"SYNCED"})]}):n.jsx(U,{size:"sm",variant:"outline",className:"h-6 px-2 rounded-none border-yellow-500 text-yellow-500 hover:bg-yellow-500/20 font-arcade text-[9px]",onClick:()=>ft.mutate(),disabled:ft.isPending,children:ft.isPending?"CONNECTING...":"CONNECT GOOGLE"})]})]}),n.jsx(At,{open:xe,onOpenChange:De,modal:!1,children:n.jsxs(Mt,{"data-modal":"calendar-manage",className:"bg-black border-2 border-primary rounded-none max-w-md pointer-events-auto translate-y-0 data-[state=open]:animate-none data-[state=closed]:animate-none",style:{zIndex:100005,top:"6rem",left:"50%",transform:"translate(-50%, 0)"},children:[n.jsxs(fr,{children:[n.jsx(Lt,{className:"font-arcade text-primary",children:"MANAGE CALENDARS"}),n.jsx(Ot,{className:"sr-only",children:"Reorder or hide calendars."})]}),n.jsxs("div",{className:"space-y-2 max-h-[400px] overflow-y-auto",children:[n.jsx("p",{className:"font-terminal text-xs text-muted-foreground mb-4",children:"Drag to reorder. Click to show/hide."}),n.jsx(bs,{sensors:Ze,collisionDetection:ns,modifiers:[Ki],onDragEnd:a=>{const{active:h,over:N}=a;if(!N||h.id===N.id)return;const R=le.findIndex($=>$.id===h.id),E=le.findIndex($=>$.id===N.id);if(R===-1||E===-1)return;const O=er(le,R,E);Bt.mutate(O.map($=>$.id))},children:n.jsx(Cs,{items:le.map(a=>a.id),strategy:Ns,children:le.map(a=>n.jsx(Bi,{cal:a,isHidden:Le.includes(a.id),onToggle:()=>Oe(a.id)},a.id))})})]}),n.jsx(On,{children:n.jsx(U,{variant:"outline",className:"rounded-none border-primary font-arcade text-xs",onClick:()=>De(!1),children:"CLOSE"})})]})}),n.jsxs(Ws,{className:"p-0 flex-1 overflow-hidden flex flex-col",children:[o==="month"&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"grid grid-cols-7 border-b border-secondary bg-secondary/20 shrink-0",children:["SUN","MON","TUE","WED","THU","FRI","SAT"].map(a=>n.jsx("div",{className:"p-2 text-center font-arcade text-xs text-zinc-400 border-r border-secondary last:border-r-0",children:a},a))}),n.jsx("div",{className:"grid grid-cols-7 flex-1 overflow-auto",children:Ge.map((a,h)=>{const N=jt(a),R=xr(a,t),E=ot(a);return n.jsxs("div",{onClick:()=>bn(a),className:K("min-h-[180px] border-r border-b border-secondary p-1.5 cursor-pointer transition-colors hover:bg-secondary/30",!R&&"bg-secondary/10 text-muted-foreground",h%7===6&&"border-r-0"),"data-testid":`day-cell-${B(a,"yyyy-MM-dd")}`,children:[n.jsx("div",{className:K("text-right font-mono text-sm w-6 h-6 flex items-center justify-center ml-auto",E&&"bg-red-500 text-white rounded-none font-bold"),children:B(a,"d")}),n.jsxs("div",{className:"space-y-0.5 mt-1",children:[N.slice(0,3).map((O,$)=>n.jsxs("div",{className:K("text-xs font-mono truncate px-1.5 py-1 rounded cursor-pointer hover:brightness-110",wt(O)),style:Ct(O),title:O.title,onClick:J=>{J.stopPropagation(),Nt(O)},children:[O.eventType==="online"&&n.jsx("span",{className:"inline-block w-1.5 h-1.5 rounded-full bg-primary/60 mr-1 align-middle",title:"Online"}),O.title]},`${O.id}-${$}`)),N.length>3&&n.jsxs("div",{className:"text-[10px] font-mono text-zinc-400 px-1 mt-0.5",children:["+",N.length-3," more"]})]})]},h)})})]}),o==="week"&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"grid grid-cols-8 border-b border-secondary bg-secondary/20 shrink-0",children:[n.jsx("div",{className:"p-2 w-16 border-r border-secondary"}),Fe.map(a=>n.jsxs("div",{className:"p-2 text-center border-r border-secondary last:border-r-0 cursor-pointer hover:bg-secondary/30",onClick:()=>bn(a),children:[n.jsx("div",{className:"font-arcade text-xs text-zinc-400",children:B(a,"EEE").toUpperCase()}),n.jsx("div",{className:K("font-mono text-lg mt-1 w-8 h-8 flex items-center justify-center mx-auto",ot(a)&&"bg-red-500 text-white rounded-none font-bold"),children:B(a,"d")})]},a.toISOString()))]}),n.jsxs("div",{className:"grid grid-cols-8 border-b border-secondary bg-secondary/10 shrink-0",children:[n.jsx("div",{className:"p-1 w-16 border-r border-secondary text-xs font-mono text-muted-foreground text-right pr-2",children:"ALL DAY"}),Fe.map(a=>{const h=jt(a).filter(N=>N.allDay);return n.jsx("div",{className:"border-r border-secondary last:border-r-0 p-0.5 min-h-[28px]",children:h.map((N,R)=>n.jsx("div",{className:K("text-[10px] font-mono truncate px-1.5 py-0.5 rounded cursor-pointer hover:brightness-110",wt(N)),style:Ct(N),onClick:E=>{E.stopPropagation(),Nt(N)},children:N.title},R))},`allday-${a.toISOString()}`)})]}),n.jsx(Fn,{className:"flex-1",children:n.jsxs("div",{className:"grid grid-cols-8 relative",style:{height:`${24*at}px`},children:[n.jsx("div",{className:"w-16 border-r border-secondary",children:Ln.map(a=>n.jsx("div",{className:"border-b border-secondary/50 text-right pr-2 font-mono text-[11px] text-muted-foreground",style:{height:`${at}px`},children:a===0?"12 AM":a<12?`${a} AM`:a===12?"12 PM":`${a-12} PM`},a))}),Fe.map(a=>{const h=it(lt(a,0),0),N=jt(a).filter(E=>!E.allDay),R=ur(N);return n.jsxs("div",{className:"relative border-r border-secondary/50 last:border-r-0",children:[Ln.map(E=>n.jsx("div",{className:"border-b border-secondary/30 cursor-pointer hover:bg-secondary/20",style:{height:`${at}px`},onClick:()=>Ve(a,E)},E)),N.map((E,O)=>{const $=R.get(E.id)||{column:0,totalColumns:1},J={...dr(E,h,$.column,$.totalColumns),...Ct(E)};return n.jsxs("div",{className:K("absolute rounded p-1 cursor-pointer overflow-hidden",wt(E)),style:J,onClick:Et=>{Et.stopPropagation(),Nt(E)},children:[n.jsx("div",{className:"text-xs font-mono font-medium truncate",children:E.title}),n.jsx("div",{className:"text-[10px] opacity-80 font-mono",children:B(E.start,"h:mma")})]},O)})]},a.toISOString())})]})})]}),o==="day"&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"p-4 border-b border-secondary bg-secondary/20 shrink-0 flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("div",{className:"font-arcade text-xs text-zinc-400",children:B(t,"EEEE").toUpperCase()}),n.jsx("div",{className:K("font-mono text-2xl font-bold",ot(t)&&"text-red-500"),children:B(t,"d")})]}),n.jsxs(U,{size:"sm",className:"rounded-none font-arcade text-xs bg-red-500 text-white hover:bg-red-600",onClick:()=>Ve(t),"data-testid":"button-create-event",children:[n.jsx(Xt,{className:"w-4 h-4 mr-1"})," CREATE"]})]}),(()=>{const a=jt(t).filter(h=>h.allDay);return a.length===0?null:n.jsxs("div",{className:"p-3 border-b border-secondary/50 bg-black/40 shrink-0 flex gap-2 flex-wrap items-center",children:[n.jsx("span",{className:"font-mono text-sm text-muted-foreground",children:"ALL DAY:"}),a.map((h,N)=>n.jsx("div",{className:K("text-sm font-mono px-3 py-1 rounded cursor-pointer hover:brightness-110",wt(h)),style:Ct(h),onClick:R=>{R.stopPropagation(),Nt(h)},children:h.title},N))]})})(),n.jsx(Fn,{className:"flex-1",children:n.jsxs("div",{className:"relative",style:{height:`${24*at}px`},children:[Ln.map(a=>n.jsxs("div",{className:"flex border-b border-secondary/30 cursor-pointer hover:bg-secondary/20",style:{height:`${at}px`},onClick:()=>Ve(t,a),children:[n.jsx("div",{className:"w-20 text-right pr-2 font-mono text-xs text-muted-foreground shrink-0 pt-1",children:a===0?"12 AM":a<12?`${a} AM`:a===12?"12 PM":`${a-12} PM`}),n.jsx("div",{className:"flex-1 border-l border-secondary/50"})]},a)),(()=>{const a=jt(t).filter(R=>!R.allDay),h=ur(a),N=it(lt(t,0),0);return n.jsx("div",{className:"absolute top-0 left-20 right-0",children:a.map((R,E)=>{const O=h.get(R.id)||{column:0,totalColumns:1},$={...dr(R,N,O.column,O.totalColumns),...Ct(R)};return n.jsxs("div",{className:K("absolute rounded p-2 cursor-pointer",wt(R)),style:$,onClick:J=>{J.stopPropagation(),Nt(R)},children:[n.jsx("div",{className:"font-bold text-sm font-mono truncate",children:R.title}),n.jsxs("div",{className:"text-xs font-mono opacity-80",children:[B(R.start,"h:mm a")," - ",B(R.end,"h:mm a")]})]},E)})})})()]})})]}),o==="tasks"&&n.jsx("div",{className:"flex-1 overflow-hidden bg-black/40 p-4",children:n.jsx(Hi,{tasks:tt,taskLists:He})})]})]})})}),n.jsx(At,{open:l,onOpenChange:c,children:n.jsxs(Mt,{"data-modal":"calendar-create",className:"bg-black border-2 border-primary rounded-none max-w-lg max-h-[90vh] overflow-y-auto translate-y-0",style:{zIndex:100005,top:"6rem",left:"50%",transform:"translate(-50%, 0)"},children:[n.jsxs(fr,{children:[n.jsx(Lt,{className:"font-arcade text-primary",children:"CREATE_EVENT"}),n.jsx(Ot,{className:"sr-only",children:"Create a new event."})]}),n.jsxs("div",{className:"space-y-4 py-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(F,{className:"font-arcade text-sm",children:"TITLE"}),n.jsx(H,{className:"rounded-none bg-black border-secondary focus-visible:ring-primary",placeholder:"Event title...",value:x.title,onChange:a=>y({...x,title:a.target.value}),"data-testid":"input-modal-title"})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(F,{className:"font-arcade text-sm",children:"START DATE"}),n.jsx(H,{type:"date",className:"rounded-none bg-black border-secondary",value:x.date,onChange:a=>y({...x,date:a.target.value}),"data-testid":"input-modal-date"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(F,{className:"font-arcade text-sm",children:"END DATE"}),n.jsx(H,{type:"date",className:"rounded-none bg-black border-secondary",value:x.endDate,onChange:a=>y({...x,endDate:a.target.value}),placeholder:x.date,"data-testid":"input-modal-end-date"})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(_t,{id:"allDay",checked:x.allDay,onCheckedChange:a=>y({...x,allDay:!!a})}),n.jsx(F,{htmlFor:"allDay",className:"font-terminal text-sm",children:"All day"})]}),!x.allDay&&n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(F,{className:"font-arcade text-sm",children:"START TIME"}),n.jsx(H,{type:"time",className:"rounded-none bg-black border-secondary",value:x.startTime,onChange:a=>y({...x,startTime:a.target.value}),"data-testid":"input-modal-start"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(F,{className:"font-arcade text-sm",children:"END TIME"}),n.jsx(H,{type:"time",className:"rounded-none bg-black border-secondary",value:x.endTime,onChange:a=>y({...x,endTime:a.target.value}),"data-testid":"input-modal-end"})]})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(F,{className:"font-arcade text-sm",children:"TYPE"}),n.jsxs(ne,{value:x.eventType,onValueChange:a=>y({...x,eventType:a}),children:[n.jsx(re,{className:"rounded-none bg-black border-secondary","data-testid":"select-event-type",children:n.jsx(se,{})}),n.jsxs(ae,{className:"rounded-none bg-black border-primary z-[100010]",children:[n.jsx(T,{value:"study",children:"STUDY"}),n.jsx(T,{value:"lecture",children:"LECTURE"}),n.jsx(T,{value:"exam",children:"EXAM"}),n.jsx(T,{value:"synchronous",children:"SYNCHRONOUS"}),n.jsx(T,{value:"online",children:"ONLINE"})]})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(F,{className:"font-arcade text-sm",children:"COLOR"}),n.jsx("div",{className:"flex gap-2 flex-wrap",children:["#ef4444","#f97316","#eab308","#22c55e","#3b82f6","#8b5cf6","#ec4899","#6b7280"].map(a=>n.jsx("button",{type:"button",className:K("w-6 h-6 rounded-sm border-2",x.color===a?"border-white":"border-transparent"),style:{backgroundColor:a},onClick:()=>y({...x,color:a}),"data-testid":`color-${a}`},a))})]})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(F,{className:"font-arcade text-sm",children:"REPEAT"}),n.jsxs(ne,{value:x.recurrence,onValueChange:a=>y({...x,recurrence:a}),children:[n.jsx(re,{className:"rounded-none bg-black border-secondary","data-testid":"select-recurrence",children:n.jsx(se,{placeholder:"No repeat"})}),n.jsxs(ae,{className:"rounded-none bg-black border-primary z-[100010]",children:[n.jsx(T,{value:"none",children:"NO REPEAT"}),n.jsx(T,{value:"daily",children:"DAILY"}),n.jsx(T,{value:"weekly",children:"WEEKLY"}),n.jsx(T,{value:"monthly",children:"MONTHLY"}),n.jsx(T,{value:"yearly",children:"YEARLY"})]})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(F,{className:"font-arcade text-sm",children:"CALENDAR"}),n.jsxs(ne,{value:x.calendarId,onValueChange:a=>y({...x,calendarId:a}),children:[n.jsx(re,{className:"rounded-none bg-black border-secondary","data-testid":"select-calendar",children:n.jsx(se,{placeholder:"Local"})}),n.jsxs(ae,{className:"rounded-none bg-black border-primary z-[100010]",children:[n.jsx(T,{value:"local",children:"LOCAL"}),le.map(a=>n.jsx(T,{value:a.id,children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"w-3 h-3 rounded-sm",style:{backgroundColor:a.color}}),a.name]})},a.id))]})]})]})]})]}),n.jsxs(On,{children:[n.jsx(U,{variant:"ghost",className:"rounded-none font-arcade text-xs",onClick:()=>c(!1),children:"CANCEL"}),n.jsx(U,{className:"rounded-none font-arcade text-xs bg-primary text-black hover:bg-primary/90",onClick:st,disabled:!x.title||!x.date,"data-testid":"button-save-event",children:"SAVE"})]})]})}),f&&n.jsx(Gi,{open:u,onOpenChange:a=>{m(a),a||p(null)},event:f,onEventChange:p,courseOptions:Vt,onSave:()=>{f&&fe.mutate({id:f.id,data:{title:f.title,date:f.date,endDate:f.endDate,allDay:f.allDay,eventType:f.eventType,courseId:f.courseId??null,course:f.course,weight:f.weight,notes:f.notes,color:f.color,recurrence:f.recurrence,location:f.location,attendees:f.attendees,visibility:f.visibility,transparency:f.transparency,reminders:f.reminders,timeZone:f.timeZone}})},onDelete:()=>{f&&_e.mutate(f.id)}}),w&&n.jsx(Yi,{open:g,onOpenChange:a=>{k(a),a||(L(null),z("series"))},event:w,onEventChange:L,courseOptions:Vt,onSave:Pe,onDeleteInstance:Be,onDeleteSeries:W,onEditSeries:Ms,mode:P}),n.jsx(zi,{isOpen:ce,onClose:()=>v(!1)})]})}export{il as default};
