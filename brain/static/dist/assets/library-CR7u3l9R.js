import{c as C,d as A,r as u,j as e,X as N}from"./index-DNiXFxuq.js";import{u as I,e as f,L as P,o as F,n as g,l as S,m as X,p as m}from"./layout-Bv2I3pU6.js";import{B as y,C as v}from"./badge-mmm3Gl33.js";import{f as T,i as B,b as E,P as b,c as _,M as w,T as r,d as O,I as a,a as R,t as n}from"./MaterialUploader-CuXSFEyk.js";import{L as U}from"./loader-circle-CpN3pi7X.js";import{F as q}from"./file-text-DRCFnyM0.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["circle",{cx:"9",cy:"12",r:"3",key:"u3jwor"}],["rect",{width:"20",height:"14",x:"2",y:"5",rx:"7",key:"g7kal2"}]],Q=C("toggle-left",K);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["circle",{cx:"15",cy:"12",r:"3",key:"1afu0r"}],["rect",{width:"20",height:"14",x:"2",y:"5",rx:"7",key:"g7kal2"}]],z=C("toggle-right",Y),G={pdf:"PDF",docx:"DOCX",pptx:"PPTX",md:"MD",txt:"TXT"};function H(t){return t<1024?`${t}B`:t<1024*1024?`${(t/1024).toFixed(0)}KB`:`${(t/(1024*1024)).toFixed(1)}MB`}function te(){const t=A(),[c,l]=u.useState(null),[o,p]=u.useState(""),[k,d]=u.useState(null),{data:x=[],isLoading:L}=I({queryKey:["tutor-materials"],queryFn:()=>m.tutor.getMaterials()}),h=f({mutationFn:({id:s,data:i})=>m.tutor.updateMaterial(s,i),onSuccess:()=>{t.invalidateQueries({queryKey:["tutor-materials"]}),l(null),n.success("Material updated")},onError:s=>{n.error(`Update failed: ${s instanceof Error?s.message:"Unknown"}`)}}),M=f({mutationFn:s=>m.tutor.deleteMaterial(s),onSuccess:()=>{t.invalidateQueries({queryKey:["tutor-materials"]}),t.invalidateQueries({queryKey:["tutor-content-sources"]}),d(null),n.success("Material deleted")},onError:s=>{n.error(`Delete failed: ${s instanceof Error?s.message:"Unknown"}`)}}),$=s=>{l(s.id),p(s.title)},j=()=>{c===null||!o.trim()||h.mutate({id:c,data:{title:o.trim()}})},D=s=>{h.mutate({id:s.id,data:{enabled:!s.enabled}})};return e.jsx(P,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:T}),e.jsx("h1",{className:B,children:"MATERIALS LIBRARY"})]}),e.jsxs(y,{variant:"outline",className:`${E} h-5 px-2`,children:[x.length," files"]})]}),e.jsx(v,{className:"bg-black/40 border-2 border-primary rounded-none",children:e.jsxs("div",{className:b,children:[e.jsx("div",{className:`${_} mb-3`,children:"UPLOAD MATERIALS"}),e.jsx(w,{})]})}),e.jsx(v,{className:"bg-black/40 border-2 border-primary rounded-none",children:e.jsxs("div",{className:b,children:[e.jsx("div",{className:`${_} mb-3`,children:"YOUR MATERIALS"}),L?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(U,{className:`${T} animate-spin text-muted-foreground`})}):x.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(q,{className:"w-8 h-8 text-muted-foreground/30 mx-auto mb-2"}),e.jsx("div",{className:r,children:"No materials uploaded yet"}),e.jsx("div",{className:`${r} opacity-60`,children:"Upload PDF, DOCX, PPTX, MD, or TXT files above"})]}):e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"grid grid-cols-[1fr_60px_70px_80px_90px] gap-2 px-2 py-1 border-b border-primary/20",children:[e.jsx("div",{className:r,children:"Title"}),e.jsx("div",{className:r,children:"Type"}),e.jsx("div",{className:r,children:"Size"}),e.jsx("div",{className:r,children:"Status"}),e.jsx("div",{className:`${r} text-right`,children:"Actions"})]}),x.map(s=>e.jsxs("div",{className:`grid grid-cols-[1fr_60px_70px_80px_90px] gap-2 px-2 py-1.5 items-center border-b border-primary/10 hover:bg-primary/5 transition-colors ${s.enabled?"":"opacity-50"}`,children:[e.jsx("div",{className:"min-w-0",children:c===s.id?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("input",{value:o,onChange:i=>p(i.target.value),className:`${O} flex-1 h-9 py-1 text-base`,autoFocus:!0,onKeyDown:i=>{i.key==="Enter"&&j(),i.key==="Escape"&&l(null)}}),e.jsx("button",{onClick:j,className:"text-primary hover:text-primary/80",children:e.jsx(g,{className:a})}),e.jsx("button",{onClick:()=>l(null),className:"text-muted-foreground hover:text-foreground",children:e.jsx(N,{className:a})})]}):e.jsxs("div",{className:`${R} truncate`,title:s.title,children:[s.title,s.extraction_error&&e.jsx("span",{className:"text-red-400 ml-1",title:s.extraction_error,children:"[ERR]"})]})}),e.jsx(y,{variant:"outline",className:`${E} h-4 px-1 w-fit`,children:G[s.file_type]||s.file_type.toUpperCase()}),e.jsx("div",{className:r,children:H(s.file_size)}),e.jsx("button",{onClick:()=>D(s),className:`flex items-center gap-1 ${r} hover:text-foreground transition-colors`,children:s.enabled?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:`${a} text-primary`}),e.jsx("span",{children:"On"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:a}),e.jsx("span",{children:"Off"})]})}),e.jsxs("div",{className:"flex items-center gap-1 justify-end",children:[e.jsx("button",{onClick:()=>$(s),className:"text-muted-foreground hover:text-primary transition-colors p-0.5",title:"Edit title",children:e.jsx(S,{className:a})}),k===s.id?e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx("button",{onClick:()=>M.mutate(s.id),className:"text-red-400 hover:text-red-300 p-0.5",title:"Confirm delete",children:e.jsx(g,{className:a})}),e.jsx("button",{onClick:()=>d(null),className:"text-muted-foreground hover:text-foreground p-0.5",title:"Cancel",children:e.jsx(N,{className:a})})]}):e.jsx("button",{onClick:()=>d(s.id),className:"text-muted-foreground hover:text-red-400 transition-colors p-0.5",title:"Delete",children:e.jsx(X,{className:a})})]})]},s.id))]})]})})]})})}export{te as default};
