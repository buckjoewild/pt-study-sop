import{c as J,j as e,r as c,X as K,e as he,d as ue}from"./index-BVqBUaUZ.js";import{q as pe,B as C,f as _,h as T,j as O,k as I,t as P,u as R,e as S,L as ge,E as fe,I as A,p as j}from"./layout-BKsO2JfQ.js";import{S as L,a as D,b as M,c as B,d as k,C as be}from"./select-YdSdKwW-.js";import{C as je}from"./clock-Dw9XYt7M.js";import{Z as Ne}from"./zap-CA6PKIag.js";import{A as ye,S as F}from"./star-Bu8SsvsT.js";import{P as $}from"./plus-BN5qIo2G.js";import{T as ve}from"./trending-up-C7rsHDv3.js";import{P as G}from"./play-BnK7k8QD.js";import{L as Ce}from"./loader-circle-oc_4DvbM.js";import{C as we}from"./index-DpsEiTZH.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],X=J("chart-column",Se);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]],Ee=J("link-2",ke),W={prepare:"PRIME",encode:"ENCODE",interrogate:"INTERROGATE",retrieve:"RETRIEVE",refine:"REFINE",overlearn:"OVERLEARN"},Re={prepare:"border-yellow-500 bg-yellow-500/10",encode:"border-purple-500 bg-purple-500/10",interrogate:"border-green-500 bg-green-500/10",retrieve:"border-red-500 bg-red-500/10",refine:"border-blue-500 bg-blue-500/10",overlearn:"border-gray-500 bg-gray-500/10"},Ae={prepare:"bg-yellow-500/20 text-yellow-400",encode:"bg-purple-500/20 text-purple-400",interrogate:"bg-green-500/20 text-green-400",retrieve:"bg-red-500/20 text-red-400",refine:"bg-blue-500/20 text-blue-400",overlearn:"bg-gray-500/20 text-gray-400"},_e={low:"text-green-400",medium:"text-yellow-400",high:"text-red-400"};function U({block:a,compact:d,onClick:m,draggable:i,onDragStart:x}){const h=Re[a.category]||"border-secondary bg-secondary/10",s=Ae[a.category]||"bg-secondary/20 text-muted-foreground",r=_e[a.energy_cost]||"text-muted-foreground";return d?e.jsx("div",{className:`border-2 ${h} p-2 rounded-none cursor-pointer hover:opacity-80 transition-opacity`,onClick:m,draggable:i,onDragStart:x,children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"font-terminal text-base truncate",children:a.name}),e.jsx("span",{className:`text-xs font-arcade px-1 py-0.5 rounded-none ${s}`,children:W[a.category]||a.category.toUpperCase()})]})}):e.jsxs("div",{className:`border-2 ${h} p-3 rounded-none cursor-pointer hover:opacity-80 transition-opacity`,onClick:m,draggable:i,onDragStart:x,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-arcade text-sm",children:a.name}),e.jsx("span",{className:`text-xs font-arcade px-1.5 py-0.5 rounded-none ${s}`,children:W[a.category]||a.category.toUpperCase()})]}),a.description&&e.jsx("p",{className:"font-terminal text-lg text-muted-foreground mb-2 line-clamp-2",children:a.description}),a.evidence&&e.jsx("p",{className:"font-terminal text-base text-primary/50 italic mb-2 line-clamp-1",children:a.evidence}),e.jsxs("div",{className:"flex items-center gap-3 text-base text-muted-foreground font-terminal",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(je,{className:"w-4 h-4"}),a.default_duration_min,"m"]}),e.jsxs("span",{className:`flex items-center gap-1 ${r}`,children:[e.jsx(Ne,{className:"w-4 h-4"}),a.energy_cost]}),a.best_stage&&e.jsx("span",{className:"text-primary/60",children:a.best_stage.replace("_"," ")})]}),a.tags&&a.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:a.tags.slice(0,4).map(u=>e.jsx("span",{className:"text-sm font-terminal bg-secondary/30 px-1 py-0.5 text-muted-foreground",children:u},u))})]})}function Te({chain:a,allBlocks:d,onSave:m,readOnly:i}){const[x,h]=c.useState(a.block_ids||[]),[s,r]=c.useState(!1),u=new Map(d.map(l=>[l.id,l])),f=x.map(l=>u.get(l)).filter(Boolean),g=l=>{const n=[...x];n.splice(l,1),h(n),m(n)},y=l=>{const n=[...x,l];h(n),m(n),r(!1)},b=l=>{if(l===0)return;const n=[...x];[n[l-1],n[l]]=[n[l],n[l-1]],h(n),m(n)};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-arcade text-xs text-primary",children:"CHAIN BLOCKS"}),e.jsxs("span",{className:"text-[10px] font-terminal text-muted-foreground",children:["(",f.length," blocks)"]})]}),f.length===0&&e.jsx("div",{className:"border-2 border-dashed border-secondary p-4 text-center",children:e.jsx("p",{className:"font-terminal text-xs text-muted-foreground",children:"No blocks in this chain yet"})}),e.jsx("div",{className:"space-y-2",children:f.map((l,n)=>e.jsxs("div",{className:"flex items-center gap-2",children:[!i&&e.jsx("button",{className:"text-muted-foreground hover:text-primary cursor-grab",onClick:()=>b(n),title:"Move up",children:e.jsx(pe,{className:"w-4 h-4"})}),e.jsx("div",{className:"flex-1",children:e.jsx(U,{block:l,compact:!0})}),n<f.length-1&&e.jsx(ye,{className:"w-3 h-3 text-primary/40 shrink-0"}),!i&&e.jsx("button",{className:"text-muted-foreground hover:text-red-400",onClick:()=>g(n),children:e.jsx(K,{className:"w-3 h-3"})})]},`${l.id}-${n}`))}),!i&&e.jsx("div",{children:s?e.jsxs("div",{className:"border-2 border-primary/30 bg-black/50 p-3 space-y-2 max-h-48 overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"font-arcade text-[10px] text-primary",children:"ADD BLOCK"}),e.jsx("button",{onClick:()=>r(!1),children:e.jsx(K,{className:"w-3 h-3 text-muted-foreground"})})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-1",children:d.map(l=>e.jsx(U,{block:l,compact:!0,onClick:()=>y(l.id)},l.id))})]}):e.jsxs(C,{variant:"outline",size:"sm",className:"w-full rounded-none border-2 border-dashed border-secondary font-arcade text-xs",onClick:()=>r(!0),children:[e.jsx($,{className:"w-3 h-3 mr-1"})," ADD BLOCK"]})})]})}const Oe={prepare:"bg-yellow-500",encode:"bg-purple-500",interrogate:"bg-green-500",retrieve:"bg-red-500",refine:"bg-blue-500",overlearn:"bg-gray-500"};function Ie({data:a}){const{block_stats:d,chain_stats:m,recent_ratings:i}=a,x=d.filter(s=>s.usage_count>0),h=m.filter(s=>s.usage_count>0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border-2 border-secondary bg-black/40 p-4 rounded-none",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(X,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-arcade text-xs text-primary",children:"BLOCK EFFECTIVENESS"})]}),x.length===0?e.jsx("p",{className:"font-terminal text-xs text-muted-foreground",children:"No ratings yet. Rate methods after study sessions to see analytics."}):e.jsx("div",{className:"space-y-2",children:x.map(s=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-terminal text-xs w-32 truncate",children:s.name}),e.jsx("div",{className:"flex-1 h-4 bg-secondary/20 rounded-none overflow-hidden",children:e.jsx("div",{className:`h-full ${Oe[s.category]||"bg-primary"}`,style:{width:`${(s.avg_effectiveness??0)/5*100}%`}})}),e.jsx("span",{className:"font-terminal text-[10px] text-muted-foreground w-8 text-right",children:s.avg_effectiveness??"—"}),e.jsxs("span",{className:"font-terminal text-[10px] text-muted-foreground w-6 text-right",children:["(",s.usage_count,")"]})]},s.id))})]}),e.jsxs("div",{className:"border-2 border-secondary bg-black/40 p-4 rounded-none",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ve,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-arcade text-xs text-primary",children:"CHAIN COMPARISON"})]}),h.length===0?e.jsx("p",{className:"font-terminal text-xs text-muted-foreground",children:"No chain ratings yet."}):e.jsx("div",{className:"space-y-2",children:h.map(s=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-terminal text-xs w-40 truncate",children:s.name}),e.jsx("div",{className:"flex-1 h-4 bg-secondary/20 rounded-none overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary",style:{width:`${(s.avg_effectiveness??0)/5*100}%`}})}),e.jsx("span",{className:"font-terminal text-[10px] text-muted-foreground w-8 text-right",children:s.avg_effectiveness??"—"})]},s.id))})]}),e.jsxs("div",{className:"border-2 border-secondary bg-black/40 p-4 rounded-none",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(F,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-arcade text-xs text-primary",children:"RECENT RATINGS"})]}),i.length===0?e.jsx("p",{className:"font-terminal text-xs text-muted-foreground",children:"No ratings recorded yet."}):e.jsx("div",{className:"space-y-2",children:i.slice(0,10).map(s=>e.jsxs("div",{className:"flex items-center justify-between border border-secondary/50 p-2 rounded-none",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-terminal text-xs",children:s.method_name||s.chain_name||"Unknown"}),s.notes&&e.jsx("p",{className:"font-terminal text-[10px] text-muted-foreground mt-0.5 truncate max-w-[200px]",children:s.notes})]}),e.jsxs("div",{className:"flex items-center gap-2 text-[10px] font-terminal",children:[e.jsxs("span",{children:["E:",s.effectiveness,"/5"]}),e.jsxs("span",{children:["G:",s.engagement,"/5"]})]})]},s.id))})]})]})}function Z({value:a,onChange:d,label:m}){return e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"font-arcade text-[10px] text-muted-foreground",children:m}),e.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(i=>e.jsx("button",{onClick:()=>d(i),className:"p-0.5 hover:scale-110 transition-transform",children:e.jsx(F,{className:`w-5 h-5 ${i<=a?"text-primary fill-primary":"text-secondary"}`})},i))})]})}function Le({open:a,onClose:d,onSubmit:m,targetName:i,targetType:x}){const[h,s]=c.useState(0),[r,u]=c.useState(0),[f,g]=c.useState(""),y=()=>{h===0||r===0||(m({effectiveness:h,engagement:r,notes:f}),s(0),u(0),g(""),d())};return e.jsx(_,{open:a,onOpenChange:b=>!b&&d(),children:e.jsxs(T,{className:"bg-black border-2 border-primary rounded-none max-w-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs(O,{className:"font-arcade text-xs text-primary",children:["RATE ",x.toUpperCase()]}),e.jsx(I,{className:"sr-only",children:"Rate the effectiveness and engagement of this method"}),e.jsx("button",{onClick:d,children:e.jsx(K,{className:"w-4 h-4 text-muted-foreground"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"font-terminal text-sm",children:i}),e.jsx(Z,{value:h,onChange:s,label:"EFFECTIVENESS (did it help you learn?)"}),e.jsx(Z,{value:r,onChange:u,label:"ENGAGEMENT (did it hold your focus?)"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-arcade text-[10px] text-muted-foreground",children:"NOTES (optional)"}),e.jsx(P,{value:f,onChange:b=>g(b.target.value),placeholder:"What worked? What didn't?",className:"h-16 bg-secondary/20 border-2 border-secondary font-terminal text-sm rounded-none resize-none mt-1"})]}),e.jsx(C,{className:"w-full font-arcade rounded-none text-xs",onClick:y,disabled:h===0||r===0,children:"SUBMIT RATING"})]})]})})}const De=["all","prepare","encode","interrogate","retrieve","refine","overlearn"],ee={prepare:"PRIME",encode:"ENCODE",interrogate:"INTERROGATE",retrieve:"RETRIEVE",refine:"REFINE",overlearn:"OVERLEARN"},Me=[{id:"library",label:"LIBRARY",icon:fe},{id:"chains",label:"CHAINS",icon:Ee},{id:"analytics",label:"ANALYTICS",icon:X}];function Je(){const[a,d]=c.useState("library"),[m,i]=c.useState("all"),[x,h]=c.useState(""),[s,r]=c.useState(!1),[u,f]=c.useState(!1),[g,y]=c.useState(null),[b,l]=c.useState(null),[n,w]=c.useState(null),[p,E]=c.useState(null),{toast:v}=he(),o=ue(),{data:Q=[],isLoading:H}=R({queryKey:["methods"],queryFn:()=>j.methods.getAll()}),{data:q=[],isLoading:te}=R({queryKey:["chains"],queryFn:()=>j.chains.getAll()}),{data:V,isLoading:se}=R({queryKey:["methods-analytics"],queryFn:()=>j.methods.analytics(),enabled:a==="analytics"}),{data:ae=[]}=R({queryKey:["courses-active"],queryFn:()=>j.courses.getActive(),enabled:!!n}),{data:Y=[]}=R({queryKey:["chain-run-history"],queryFn:()=>j.chainRun.getHistory(),enabled:a==="chains"}),re=S({mutationFn:j.methods.create,onSuccess:()=>{o.invalidateQueries({queryKey:["methods"]}),o.invalidateQueries({queryKey:["methods-analytics"]}),r(!1),v({title:"Method block created"})}}),ne=S({mutationFn:j.methods.delete,onSuccess:()=>{o.invalidateQueries({queryKey:["methods"]}),o.invalidateQueries({queryKey:["methods-analytics"]}),v({title:"Method block deleted"})}}),ie=S({mutationFn:j.chains.create,onSuccess:()=>{o.invalidateQueries({queryKey:["chains"]}),o.invalidateQueries({queryKey:["methods-analytics"]}),f(!1),v({title:"Chain created"})}}),le=S({mutationFn:({id:t,data:N})=>j.chains.update(t,N),onSuccess:()=>{o.invalidateQueries({queryKey:["chains"]}),v({title:"Chain updated"})}}),de=S({mutationFn:j.chains.delete,onSuccess:()=>{o.invalidateQueries({queryKey:["chains"]}),o.invalidateQueries({queryKey:["methods-analytics"]}),y(null),v({title:"Chain deleted"})}}),oe=S({mutationFn:({id:t,data:N})=>j.methods.rate(t,N),onSuccess:()=>{o.invalidateQueries({queryKey:["methods-analytics"]}),v({title:"Rating submitted"})}}),ce=S({mutationFn:({id:t,data:N})=>j.chains.rate(t,N),onSuccess:()=>{o.invalidateQueries({queryKey:["methods-analytics"]}),v({title:"Rating submitted"})}}),z=Q.filter(t=>!(m!=="all"&&t.category!==m||x&&!t.name.toLowerCase().includes(x.toLowerCase()))),me=async t=>{const N=await j.chains.getOne(t.id);y(N)},xe=t=>{b&&(b.type==="method"?oe.mutate({id:b.id,data:t}):ce.mutate({id:b.id,data:t}))};return e.jsx(ge,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"font-arcade text-xl text-primary",children:"METHOD_LIBRARY"}),e.jsx("p",{className:"font-terminal text-base text-muted-foreground",children:"Composable study methods — build, chain, rate, optimize"})]})}),e.jsx("div",{className:"flex gap-1 border-b-2 border-primary/30 pb-0",children:Me.map(t=>e.jsxs("button",{onClick:()=>d(t.id),className:`flex items-center gap-1.5 px-3 py-2 font-arcade text-sm border-b-2 -mb-[2px] transition-colors ${a===t.id?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-foreground"}`,children:[e.jsx(t.icon,{className:"w-3 h-3"}),t.label]},t.id))}),a==="library"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(A,{placeholder:"Search methods...",value:x,onChange:t=>h(t.target.value),className:"w-64 bg-black/40"}),e.jsx("div",{className:"flex gap-1",children:De.map(t=>e.jsx("button",{onClick:()=>i(t),className:`px-3 py-1.5 font-arcade text-xs border-2 rounded-none transition-colors ${m===t?"border-primary bg-primary/20 text-primary":"border-muted-foreground/30 text-muted-foreground hover:text-foreground hover:border-muted-foreground/50 hover:bg-black/30"}`,children:ee[t]||t.toUpperCase()},t))}),e.jsxs(C,{variant:"outline",size:"sm",className:"ml-auto rounded-none border-2 font-arcade text-sm h-10",onClick:()=>r(!0),children:[e.jsx($,{className:"w-3 h-3 mr-1"})," ADD BLOCK"]})]}),H?e.jsx("p",{className:"font-terminal text-base text-muted-foreground",children:"Loading methods..."}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:z.map(t=>e.jsxs("div",{className:"relative group",children:[e.jsx(U,{block:t}),e.jsxs("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity flex gap-1",children:[e.jsx("button",{className:"p-1 bg-black/80 border border-primary/40 hover:border-primary",onClick:()=>l({id:t.id,name:t.name,type:"method"}),title:"Rate",children:e.jsx(F,{className:"w-3 h-3 text-primary"})}),e.jsx("button",{className:"p-1 bg-black/80 border border-red-500/40 hover:border-red-500 text-red-400",onClick:()=>{confirm(`Delete "${t.name}"?`)&&ne.mutate(t.id)},title:"Delete",children:e.jsx("span",{className:"text-[10px]",children:"x"})})]})]},t.id))}),!H&&z.length===0&&e.jsxs("p",{className:"font-terminal text-base text-muted-foreground text-center py-8",children:["No methods found. ",m!=="all"?"Try a different category.":"Add your first method block."]})]}),a==="chains"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-arcade text-sm text-muted-foreground",children:[q.length," CHAINS (",q.filter(t=>t.is_template).length," templates)"]}),e.jsxs(C,{variant:"outline",size:"sm",className:"rounded-none border-2 font-arcade text-sm h-10",onClick:()=>f(!0),children:[e.jsx($,{className:"w-3 h-3 mr-1"})," NEW CHAIN"]})]}),te?e.jsx("p",{className:"font-terminal text-base text-muted-foreground",children:"Loading chains..."}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsx("div",{className:"space-y-2",children:q.map(t=>e.jsxs("div",{onClick:()=>me(t),className:`border-2 p-3 rounded-none cursor-pointer transition-colors ${g?.id===t.id?"border-primary bg-primary/10":"border-muted-foreground/30 hover:border-muted-foreground/50 hover:bg-black/30"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"font-arcade text-sm",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.is_template?e.jsx("span",{className:"text-xs font-arcade bg-primary/20 text-primary px-1.5 py-0.5",children:"TEMPLATE"}):null,e.jsx("button",{className:"p-0.5 hover:text-green-400",onClick:N=>{N.stopPropagation(),w({id:t.id,name:t.name})},title:"Run chain",children:e.jsx(G,{className:"w-3 h-3"})}),e.jsx("button",{className:"p-0.5 hover:text-primary",onClick:N=>{N.stopPropagation(),l({id:t.id,name:t.name,type:"chain"})},children:e.jsx(F,{className:"w-3 h-3"})})]})]}),t.description&&e.jsx("p",{className:"font-terminal text-base text-muted-foreground line-clamp-1",children:t.description}),e.jsx("div",{className:"flex gap-1 mt-1.5",children:(t.block_ids||[]).length>0&&e.jsxs("span",{className:"text-sm font-terminal text-muted-foreground",children:[(t.block_ids||[]).length," blocks"]})})]},t.id))}),e.jsx("div",{className:"border-2 border-primary/30 bg-black/40 p-4 rounded-none",children:g?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-arcade text-sm text-primary",children:g.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(C,{variant:"outline",size:"sm",className:"rounded-none border-2 border-green-600 text-green-400 font-arcade text-xs h-8",onClick:()=>w({id:g.id,name:g.name}),children:[e.jsx(G,{className:"w-3 h-3 mr-1"})," RUN"]}),!g.is_template&&e.jsx(C,{variant:"ghost",size:"sm",className:"text-red-400 rounded-none text-xs font-arcade h-8",onClick:()=>{confirm(`Delete chain "${g.name}"?`)&&de.mutate(g.id)},children:"DELETE"})]})]}),g.description&&e.jsx("p",{className:"font-terminal text-base text-muted-foreground",children:g.description}),e.jsx(Te,{chain:g,allBlocks:Q,readOnly:!!g.is_template,onSave:t=>{le.mutate({id:g.id,data:{block_ids:t}})}})]}):e.jsx("div",{className:"flex items-center justify-center h-40",children:e.jsx("p",{className:"font-terminal text-base text-muted-foreground",children:"Select a chain to view or edit"})})})]}),Y.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-arcade text-sm text-muted-foreground",children:"RUN HISTORY"}),e.jsx("div",{className:"border-2 border-primary/30 rounded-none overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-primary/30 bg-black/60",children:[e.jsx("th",{className:"text-left px-3 py-1.5 font-arcade text-xs text-muted-foreground",children:"CHAIN"}),e.jsx("th",{className:"text-left px-3 py-1.5 font-arcade text-xs text-muted-foreground",children:"TOPIC"}),e.jsx("th",{className:"text-left px-3 py-1.5 font-arcade text-xs text-muted-foreground",children:"STATUS"}),e.jsx("th",{className:"text-left px-3 py-1.5 font-arcade text-xs text-muted-foreground",children:"STEPS"}),e.jsx("th",{className:"text-left px-3 py-1.5 font-arcade text-xs text-muted-foreground",children:"DATE"})]})}),e.jsx("tbody",{children:Y.slice(0,10).map(t=>e.jsxs("tr",{className:"border-b border-primary/20 hover:bg-primary/5 cursor-pointer",onClick:async()=>{const N=await j.chainRun.getOne(t.id);E(N)},children:[e.jsx("td",{className:"px-3 py-1.5 font-terminal text-base",children:t.chain_name}),e.jsx("td",{className:"px-3 py-1.5 font-terminal text-base text-muted-foreground",children:t.topic}),e.jsx("td",{className:"px-3 py-1.5",children:e.jsx("span",{className:`text-xs font-arcade px-1.5 py-0.5 ${t.status==="completed"?"bg-green-900/40 text-green-400":t.status==="failed"?"bg-red-900/40 text-red-400":"bg-yellow-900/40 text-yellow-400"}`,children:t.status.toUpperCase()})}),e.jsxs("td",{className:"px-3 py-1.5 font-terminal text-base text-muted-foreground",children:[t.current_step,"/",t.total_steps]}),e.jsx("td",{className:"px-3 py-1.5 font-terminal text-base text-muted-foreground",children:new Date(t.started_at).toLocaleDateString()})]},t.id))})]})})]})]}),a==="analytics"&&e.jsx("div",{children:se?e.jsx("p",{className:"font-terminal text-base text-muted-foreground",children:"Loading analytics..."}):V?e.jsx(Ie,{data:V}):e.jsx("p",{className:"font-terminal text-base text-muted-foreground",children:"Failed to load analytics."})}),e.jsx(Be,{open:s,onClose:()=>r(!1),onSubmit:t=>re.mutate(t)}),e.jsx(Fe,{open:u,onClose:()=>f(!1),onSubmit:t=>ie.mutate(t)}),n&&e.jsx(qe,{open:!!n,chainId:n.id,chainName:n.name,courses:ae,onClose:()=>w(null),onComplete:t=>{E(t),w(null),o.invalidateQueries({queryKey:["chain-run-history"]}),v({title:`${t.chain_name} ${t.status}`})}}),p&&e.jsx(Ke,{open:!!p,result:p,onClose:()=>E(null)}),b&&e.jsx(Le,{open:!!b,onClose:()=>l(null),onSubmit:xe,targetName:b.name,targetType:b.type})]})})}function Be({open:a,onClose:d,onSubmit:m}){const[i,x]=c.useState(""),[h,s]=c.useState("prepare"),[r,u]=c.useState(""),[f,g]=c.useState(5),[y,b]=c.useState("medium"),[l,n]=c.useState(""),w=()=>{i.trim()&&(m({name:i.trim(),category:h,description:r.trim()||null,default_duration_min:f,energy_cost:y,best_stage:l||null,tags:[]}),x(""),u(""))};return e.jsx(_,{open:a,onOpenChange:p=>!p&&d(),children:e.jsxs(T,{className:"bg-black border-2 border-primary rounded-none max-w-md",children:[e.jsx(O,{className:"font-arcade text-sm text-primary",children:"NEW METHOD BLOCK"}),e.jsx(I,{className:"sr-only",children:"Create a new method block"}),e.jsxs("div",{className:"space-y-3 mt-2",children:[e.jsx(A,{placeholder:"Method name",value:i,onChange:p=>x(p.target.value),className:"rounded-none border-2 border-primary/40 bg-black/60 font-terminal text-base"}),e.jsxs(L,{value:h,onValueChange:s,children:[e.jsx(D,{className:"rounded-none border-2 border-primary/40 bg-black/60 font-terminal text-base",children:e.jsx(M,{})}),e.jsx(B,{className:"bg-black border-2 border-primary rounded-none",children:["prepare","encode","interrogate","retrieve","refine","overlearn"].map(p=>e.jsx(k,{value:p,className:"font-terminal text-sm",children:ee[p]||p.charAt(0).toUpperCase()+p.slice(1)},p))})]}),e.jsx(P,{placeholder:"Description (optional)",value:r,onChange:p=>u(p.target.value),className:"h-16 rounded-none border-2 border-primary/40 bg-black/60 font-terminal text-base resize-none"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"font-arcade text-xs text-muted-foreground",children:"DURATION"}),e.jsx(A,{type:"number",value:f,onChange:p=>g(Number(p.target.value)),className:"rounded-none border-2 border-primary/40 bg-black/60 font-terminal text-base"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-arcade text-xs text-muted-foreground",children:"ENERGY"}),e.jsxs(L,{value:y,onValueChange:b,children:[e.jsx(D,{className:"rounded-none border-2 border-primary/40 bg-black/60 font-terminal text-base",children:e.jsx(M,{})}),e.jsx(B,{className:"bg-black border-2 border-primary rounded-none",children:["low","medium","high"].map(p=>e.jsx(k,{value:p,className:"font-terminal text-sm",children:p},p))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-arcade text-xs text-muted-foreground",children:"BEST STAGE"}),e.jsxs(L,{value:l,onValueChange:n,children:[e.jsx(D,{className:"rounded-none border-2 border-primary/40 bg-black/60 font-terminal text-base",children:e.jsx(M,{placeholder:"Any"})}),e.jsxs(B,{className:"bg-black border-2 border-primary rounded-none",children:[e.jsx(k,{value:"first_exposure",className:"font-terminal text-sm",children:"First Exposure"}),e.jsx(k,{value:"review",className:"font-terminal text-sm",children:"Review"}),e.jsx(k,{value:"exam_prep",className:"font-terminal text-sm",children:"Exam Prep"}),e.jsx(k,{value:"consolidation",className:"font-terminal text-sm",children:"Consolidation"})]})]})]})]}),e.jsx(C,{className:"w-full font-arcade rounded-none text-xs",onClick:w,disabled:!i.trim(),children:"CREATE BLOCK"})]})]})})}function Fe({open:a,onClose:d,onSubmit:m}){const[i,x]=c.useState(""),[h,s]=c.useState(""),r=()=>{i.trim()&&(m({name:i.trim(),description:h.trim()||null,block_ids:[],context_tags:{},is_template:0}),x(""),s(""))};return e.jsx(_,{open:a,onOpenChange:u=>!u&&d(),children:e.jsxs(T,{className:"bg-black border-2 border-primary rounded-none max-w-md",children:[e.jsx(O,{className:"font-arcade text-sm text-primary",children:"NEW CHAIN"}),e.jsx(I,{className:"sr-only",children:"Create a new method chain"}),e.jsxs("div",{className:"space-y-3 mt-2",children:[e.jsx(A,{placeholder:"Chain name",value:i,onChange:u=>x(u.target.value),className:"rounded-none border-2 border-primary/40 bg-black/60 font-terminal text-base"}),e.jsx(P,{placeholder:"Description (optional)",value:h,onChange:u=>s(u.target.value),className:"h-16 rounded-none border-2 border-primary/40 bg-black/60 font-terminal text-base resize-none"}),e.jsx("p",{className:"font-terminal text-sm text-muted-foreground",children:"Add blocks to the chain after creating it."}),e.jsx(C,{className:"w-full font-arcade rounded-none text-xs",onClick:r,disabled:!i.trim(),children:"CREATE CHAIN"})]})]})})}function qe({open:a,chainId:d,chainName:m,courses:i,onClose:x,onComplete:h}){const[s,r]=c.useState(""),[u,f]=c.useState(""),[g,y]=c.useState(!0),[b,l]=c.useState(!0),[n,w]=c.useState(!1),[p,E]=c.useState(null),v=async()=>{if(s.trim()){w(!0),E(null);try{const o=await j.chainRun.start({chain_id:d,topic:s.trim(),course_id:u?Number(u):void 0,options:{write_obsidian:g,draft_cards:b}});h(o)}catch(o){E(o instanceof Error?o.message:"Chain run failed"),w(!1)}}};return e.jsx(_,{open:a,onOpenChange:o=>!o&&!n&&x(),children:e.jsxs(T,{className:"bg-black border-2 border-primary rounded-none max-w-md",children:[e.jsxs(O,{className:"font-arcade text-sm text-primary",children:["RUN: ",m]}),e.jsx(I,{className:"sr-only",children:"Configure and run a method chain"}),e.jsxs("div",{className:"space-y-3 mt-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"font-arcade text-xs text-muted-foreground",children:"TOPIC"}),e.jsx(A,{placeholder:"e.g., Glenohumeral Joint Ligaments",value:s,onChange:o=>r(o.target.value),disabled:n,className:"rounded-none border-2 border-primary/40 bg-black/60 font-terminal text-base"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-arcade text-xs text-muted-foreground",children:"COURSE (OPTIONAL)"}),e.jsxs(L,{value:u,onValueChange:f,disabled:n,children:[e.jsx(D,{className:"rounded-none border-2 border-primary/40 bg-black/60 font-terminal text-base",children:e.jsx(M,{placeholder:"None"})}),e.jsx(B,{className:"bg-black border-2 border-primary rounded-none",children:i.map(o=>e.jsx(k,{value:String(o.id),className:"font-terminal text-sm",children:o.name},o.id))})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 font-terminal text-base cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:g,onChange:o=>y(o.target.checked),disabled:n,className:"accent-primary"}),"Write to Obsidian"]}),e.jsxs("label",{className:"flex items-center gap-2 font-terminal text-base cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:b,onChange:o=>l(o.target.checked),disabled:n,className:"accent-primary"}),"Draft Anki cards"]})]}),p&&e.jsx("p",{className:"font-terminal text-base text-red-400",children:p}),e.jsx(C,{className:"w-full font-arcade rounded-none text-xs",onClick:v,disabled:!s.trim()||n,children:n?e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"w-3 h-3 mr-2 animate-spin"}),"RUNNING..."]}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"w-3 h-3 mr-1"})," START"]})}),n&&e.jsx("p",{className:"font-terminal text-sm text-muted-foreground text-center",children:"This may take 15-45 seconds depending on chain length."})]})]})})}function Ke({open:a,result:d,onClose:m}){const[i,x]=c.useState(new Set([1])),h=r=>{x(u=>{const f=new Set(u);return f.has(r)?f.delete(r):f.add(r),f})},s=d.artifacts?.metrics;return e.jsx(_,{open:a,onOpenChange:r=>!r&&m(),children:e.jsxs(T,{className:"bg-black border-2 border-primary rounded-none max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(O,{className:"font-arcade text-sm text-primary flex items-center gap-2",children:[d.chain_name," RESULTS",e.jsx("span",{className:`text-xs px-1.5 py-0.5 ${d.status==="completed"?"bg-green-900/40 text-green-400":"bg-red-900/40 text-red-400"}`,children:d.status.toUpperCase()})]}),e.jsx(I,{className:"sr-only",children:"Chain run results"}),s&&e.jsxs("div",{className:"flex gap-4 mt-2",children:[e.jsxs("div",{className:"border border-primary/30 px-3 py-1.5 bg-black/60",children:[e.jsx("span",{className:"font-arcade text-xs text-muted-foreground block",children:"DURATION"}),e.jsxs("span",{className:"font-terminal text-sm",children:[(s.total_duration_ms/1e3).toFixed(1),"s"]})]}),e.jsxs("div",{className:"border border-primary/30 px-3 py-1.5 bg-black/60",children:[e.jsx("span",{className:"font-arcade text-xs text-muted-foreground block",children:"STEPS"}),e.jsx("span",{className:"font-terminal text-sm",children:s.steps_completed})]}),e.jsxs("div",{className:"border border-primary/30 px-3 py-1.5 bg-black/60",children:[e.jsx("span",{className:"font-arcade text-xs text-muted-foreground block",children:"CARDS"}),e.jsx("span",{className:"font-terminal text-sm",children:s.cards_drafted})]}),d.artifacts?.obsidian_path&&e.jsxs("div",{className:"border border-primary/30 px-3 py-1.5 bg-black/60",children:[e.jsx("span",{className:"font-arcade text-xs text-muted-foreground block",children:"OBSIDIAN"}),e.jsx("span",{className:"font-terminal text-sm text-green-400",children:"saved"})]})]}),e.jsx("div",{className:"space-y-2 mt-3",children:d.steps.map(r=>e.jsxs("div",{className:"border border-primary/30 rounded-none",children:[e.jsxs("button",{className:"w-full flex items-center gap-2 px-3 py-2 hover:bg-primary/5 text-left",onClick:()=>h(r.step),children:[i.has(r.step)?e.jsx(be,{className:"w-3 h-3 text-muted-foreground flex-shrink-0"}):e.jsx(we,{className:"w-3 h-3 text-muted-foreground flex-shrink-0"}),e.jsxs("span",{className:"font-arcade text-xs text-primary",children:[r.step,"."]}),e.jsx("span",{className:"font-terminal text-base",children:r.method_name}),e.jsxs("span",{className:"ml-auto font-terminal text-sm text-muted-foreground",children:[r.category," | ",(r.duration_ms/1e3).toFixed(1),"s"]})]}),i.has(r.step)&&e.jsx("div",{className:"px-3 pb-3 border-t border-primary/20",children:e.jsx("pre",{className:"font-terminal text-base text-muted-foreground whitespace-pre-wrap mt-2 leading-relaxed",children:r.output})})]},r.step))}),d.error&&e.jsxs("div",{className:"mt-3 border border-red-500/40 bg-red-900/10 px-3 py-2",children:[e.jsx("span",{className:"font-arcade text-xs text-red-400",children:"ERROR: "}),e.jsx("span",{className:"font-terminal text-base text-red-300",children:d.error})]}),e.jsx(C,{variant:"outline",className:"w-full mt-3 font-arcade rounded-none text-xs",onClick:m,children:"CLOSE"})]})})}export{Je as default};
