import{c as $,r as f,j as e,b as R,u as ae}from"./index-C79Y5ZgH.js";import{v as Ce,u as C,a as B,A as _,B as w,L as Re,S as ke,k as Pe,g as S}from"./index-Dh__Bh7q.js";import{C as u,a as N,b as j,c as h}from"./card-DOxKU6PL.js";import{B as p,C as W}from"./badge-BtQm9kSk.js";import{S as re,a as te,b as ne,c as le,d as k}from"./select-CjlFxpc-.js";import{T as Te,a as Ae,b as Ie,d as q}from"./tabs-Ba9QNbKP.js";import{B as F,C as Oe}from"./circle-check-BYE5Fl3-.js";import{P as De}from"./play-BN_GBPnM.js";import{R as O,S as Me}from"./send-Bdb_HXIR.js";import{C as Le,M as qe,L as _e}from"./message-square-CC2FvlF-.js";import{C as ce}from"./clock-SxOHk0F3.js";import{T as G}from"./trending-up-CSzahAJh.js";import{S as J}from"./search-YTPEdM2J.js";import{C as I}from"./circle-alert-BGDqMhYp.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],X=$("circle-question-mark",Fe);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],ie=$("circle-x",Ve);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],Z=$("history",$e);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]],H=$("lightbulb",Ue);function He(a,t=[]){let o=[];function d(r,m){const n=f.createContext(m);n.displayName=r+"Context";const x=o.length;o=[...o,m];const y=g=>{const{scope:b,children:P,...E}=g,T=b?.[a]?.[x]||n,D=f.useMemo(()=>E,Object.values(E));return e.jsx(T.Provider,{value:D,children:P})};y.displayName=r+"Provider";function i(g,b){const P=b?.[a]?.[x]||n,E=f.useContext(P);if(E)return E;if(m!==void 0)return m;throw new Error(`\`${g}\` must be used within \`${r}\``)}return[y,i]}const l=()=>{const r=o.map(m=>f.createContext(m));return function(n){const x=n?.[a]||r;return f.useMemo(()=>({[`__scope${a}`]:{...n,[a]:x}}),[n,x])}};return l.scopeName=a,[d,Be(l,...t)]}function Be(...a){const t=a[0];if(a.length===1)return t;const o=()=>{const d=a.map(l=>({useScope:l(),scopeName:l.scopeName}));return function(r){const m=d.reduce((n,{useScope:x,scopeName:y})=>{const g=x(r)[`__scope${y}`];return{...n,...g}},{});return f.useMemo(()=>({[`__scope${t.scopeName}`]:m}),[m])}};return o.scopeName=t.scopeName,o}var Ke=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],oe=Ke.reduce((a,t)=>{const o=Ce(`Primitive.${t}`),d=f.forwardRef((l,r)=>{const{asChild:m,...n}=l,x=m?o:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(x,{...n,ref:r})});return d.displayName=`Primitive.${t}`,{...a,[t]:d}},{}),K="Progress",z=100,[ze]=He(K),[Qe,Ye]=ze(K),de=f.forwardRef((a,t)=>{const{__scopeProgress:o,value:d=null,max:l,getValueLabel:r=We,...m}=a;(l||l===0)&&!ee(l)&&console.error(Ge(`${l}`,"Progress"));const n=ee(l)?l:z;d!==null&&!se(d,n)&&console.error(Je(`${d}`,"Progress"));const x=se(d,n)?d:null,y=V(x)?r(x,n):void 0;return e.jsx(Qe,{scope:o,value:x,max:n,children:e.jsx(oe.div,{"aria-valuemax":n,"aria-valuemin":0,"aria-valuenow":V(x)?x:void 0,"aria-valuetext":y,role:"progressbar","data-state":ue(x,n),"data-value":x??void 0,"data-max":n,...m,ref:t})})});de.displayName=K;var xe="ProgressIndicator",me=f.forwardRef((a,t)=>{const{__scopeProgress:o,...d}=a,l=Ye(xe,o);return e.jsx(oe.div,{"data-state":ue(l.value,l.max),"data-value":l.value??void 0,"data-max":l.max,...d,ref:t})});me.displayName=xe;function We(a,t){return`${Math.round(a/t*100)}%`}function ue(a,t){return a==null?"indeterminate":a===t?"complete":"loading"}function V(a){return typeof a=="number"}function ee(a){return V(a)&&!isNaN(a)&&a>0}function se(a,t){return V(a)&&!isNaN(a)&&a<=t&&a>=0}function Ge(a,t){return`Invalid prop \`max\` of value \`${a}\` supplied to \`${t}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${z}\`.`}function Je(a,t){return`Invalid prop \`value\` of value \`${a}\` supplied to \`${t}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${z} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var he=de,Xe=me;const pe=f.forwardRef(({className:a,indicatorClassName:t,value:o,...d},l)=>e.jsx(he,{ref:l,className:R("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",a),...d,children:e.jsx(Xe,{className:R("h-full w-full flex-1 bg-primary transition-all",t),style:{transform:`translateX(-${100-(o||0)}%)`}})}));pe.displayName=he.displayName;function Ze(){const a=ae(),[t,o]=f.useState(!1),[d,l]=f.useState("brain"),{data:r,isLoading:m}=C({queryKey:["scholarStatus"],queryFn:async()=>{const i=await fetch("/api/scholar/status");if(!i.ok)throw new Error("Failed to fetch Scholar status");return i.json()},refetchInterval:t?2e3:!1}),n=B({mutationFn:async()=>{const i=await fetch("/api/scholar/run",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({triggered_by:"ui",mode:d})}),g=await i.json().catch(()=>({message:i.statusText}));if(!i.ok){const b=g&&(g.message||g.error)||`Failed to start Scholar run (${i.status})`;throw new Error(b)}return g},onSuccess:()=>{o(!0),a.invalidateQueries({queryKey:["scholarStatus"]})}});f.useEffect(()=>{r?.running?o(!0):t&&!r?.running&&(o(!1),a.invalidateQueries({queryKey:["scholarStatus"]}))},[r?.running,t,a]);const x=()=>m?e.jsx(O,{className:"w-4 h-4 animate-spin"}):r?.running?e.jsx(O,{className:"w-4 h-4 animate-spin text-primary"}):r?.status==="complete"?e.jsx(Le,{className:"w-4 h-4 text-green-400"}):r?.status==="error"?e.jsx(ie,{className:"w-4 h-4 text-red-400"}):e.jsx(ce,{className:"w-4 h-4 text-muted-foreground"}),y=()=>r?.running?e.jsx(p,{className:"bg-primary/20 text-primary border-primary/50",children:"Running"}):r?.status==="complete"?e.jsx(p,{className:"bg-green-500/20 text-green-400 border-green-500/50",children:"Complete"}):r?.status==="error"?e.jsx(p,{className:"bg-red-500/20 text-red-400 border-red-500/50",children:"Error"}):e.jsx(p,{variant:"outline",className:"text-muted-foreground",children:"Idle"});return e.jsxs(u,{className:"brain-card rounded-none",children:[e.jsx(N,{className:"border-b border-secondary/50 p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[x(),e.jsx(j,{className:"font-arcade text-sm text-primary",children:"SCHOLAR ORCHESTRATOR"})]}),y()]})}),e.jsxs(h,{className:"p-3 space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[n.isError&&e.jsxs("div",{className:"p-2 bg-red-900/20 border border-red-500/50 rounded-none",children:[e.jsx("div",{className:"font-terminal text-[10px] text-red-400",children:"Run Error:"}),e.jsx("div",{className:"font-terminal text-[10px] text-red-300",children:n.error?.message||"Unknown error"})]}),r?.running&&e.jsxs(e.Fragment,{children:[r.current_step&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-terminal text-[10px] text-muted-foreground",children:"Current Step:"}),e.jsx("div",{className:"font-terminal text-xs text-secondary",children:r.current_step})]}),r.progress!==void 0&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-terminal text-[10px] text-muted-foreground",children:"Progress:"}),e.jsxs("span",{className:"font-terminal text-[10px] text-primary",children:[Math.round(r.progress),"%"]})]}),e.jsx(pe,{value:r.progress,className:"h-2 bg-black border border-secondary/40"})]})]}),!r?.running&&r?.last_run&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-terminal text-[10px] text-muted-foreground",children:"Last Run:"}),e.jsx("div",{className:"font-terminal text-xs text-secondary",children:new Date(r.last_run).toLocaleString()})]}),r?.errors&&r.errors.length>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-terminal text-[10px] text-red-400",children:"Errors:"}),e.jsx("div",{className:"space-y-1 p-2 bg-red-900/20 border border-red-500/50 rounded-none",children:r.errors.map((i,g)=>e.jsxs("div",{className:"font-terminal text-[10px] text-red-400",children:["• ",i]},g))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-terminal text-[10px] text-muted-foreground",children:"Study mode"}),e.jsxs(re,{value:d,onValueChange:i=>l(i),disabled:r?.running||n.isPending,children:[e.jsx(te,{className:"rounded-none font-terminal text-xs border-secondary h-8",children:e.jsx(ne,{})}),e.jsxs(le,{className:"rounded-none bg-black border-primary",children:[e.jsx(k,{value:"brain",className:"font-terminal text-xs rounded-none",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(_,{className:"w-3 h-3"})," Brain Study"]})}),e.jsx(k,{value:"tutor",className:"font-terminal text-xs rounded-none",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-3 h-3"})," Tutor Study"]})})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(w,{onClick:()=>n.mutate(),disabled:r?.running||n.isPending,className:"flex-1 bg-primary hover:bg-primary/80 rounded-none font-terminal text-xs",children:[e.jsx(De,{className:"w-3 h-3 mr-1"}),n.isPending?"Starting...":"Run Scholar"]}),e.jsx(w,{onClick:()=>a.invalidateQueries({queryKey:["scholarStatus"]}),variant:"outline",className:"rounded-none font-terminal text-xs",disabled:m,children:e.jsx(O,{className:`w-3 h-3 ${m?"animate-spin":""}`})})]}),e.jsx("div",{className:"pt-2 border-t border-secondary/30",children:e.jsx("p",{className:"font-terminal text-[9px] text-muted-foreground",children:d==="brain"?"Brain Study: session logs + SOP. Tutor Study: SOP library only (no telemetry).":"Tutor Study: evaluates sop/library, researches learning science, proposes changes."})})]})]})}function hs(){const a=ae(),[t,o]=f.useState("summary"),[d,l]=f.useState([]),[r,m]=f.useState(""),[n,x]=f.useState(!1),y=f.useRef(null),{data:i=[]}=C({queryKey:["sessions"],queryFn:S.sessions.getAll}),{data:g=[]}=C({queryKey:["courses"],queryFn:S.courses.getAll}),{data:b=[]}=C({queryKey:["proposals"],queryFn:S.proposals.getAll}),{data:P=[]}=C({queryKey:["scholar-questions"],queryFn:S.scholar.getQuestions}),{data:E=[]}=C({queryKey:["scholar-findings"],queryFn:S.scholar.getFindings}),{data:T=[]}=C({queryKey:["scholar-tutor-audit"],queryFn:S.scholar.getTutorAudit}),{data:D}=C({queryKey:["scholar-clusters"],queryFn:S.scholar.getClusters}),U=B({mutationFn:S.scholar.runClustering,onSuccess:()=>{a.invalidateQueries({queryKey:["scholar-clusters"]})}}),fe=B({mutationFn:({id:s,data:c})=>S.proposals.update(s,c),onSuccess:()=>{a.invalidateQueries({queryKey:["proposals"]})}});f.useEffect(()=>{y.current?.scrollIntoView({behavior:"smooth"})},[d]),i.slice(0,20);const Ne=i.reduce((s,c)=>s+(c.minutes||0),0),je=i.length>0?Math.round(Ne/i.length):0,ge=i.filter(s=>{const c=new Date(s.date),v=new Date;return v.setDate(v.getDate()-7),c>=v}).length,A=g.filter(s=>(s.totalSessions||0)<3),M=i.filter(s=>s.confusions&&s.confusions.length>0).flatMap(s=>s.confusions||[]),L=i.filter(s=>s.issues&&s.issues.length>0).flatMap(s=>s.issues||[]),be=A.length>0||M.length>0||L.length>0,Q=async()=>{if(!r.trim())return;const s=r.trim();l(c=>[...c,{role:"user",content:s}]),m(""),x(!0);try{const c=await S.scholar.chat(s);l(v=>[...v,{role:"assistant",content:c.response}])}catch{l(v=>[...v,{role:"assistant",content:"Error processing your question. Please try again."}])}finally{x(!1)}},ye=P,ve=T,Se=E,Y=s=>{switch(s){case"APPROVED":return"bg-primary/20 text-primary border-primary";case"REJECTED":return"bg-secondary/40 text-muted-foreground border-secondary";case"IMPLEMENTED":return"bg-white/20 text-white border-white";default:return"bg-secondary/20 text-secondary-foreground border-secondary"}},we=s=>{switch(s){case"HIGH":return"text-primary border-primary";case"MED":return"text-white border-white";default:return"text-muted-foreground border-muted-foreground"}};return e.jsx(Re,{children:e.jsxs("div",{className:"min-h-[calc(100vh-140px)] flex flex-col gap-6",children:[e.jsxs("div",{className:"space-y-4 shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(_,{className:"w-6 h-6 text-primary"}),e.jsx("h1",{className:"font-arcade text-lg text-primary",children:"SCHOLAR"}),e.jsx(p,{variant:"outline",className:"rounded-none text-[10px] font-terminal border-primary/50",children:"READ ONLY ADVISORY"})]}),e.jsxs(w,{variant:"outline",size:"sm",className:"rounded-none font-arcade text-xs border-secondary",onClick:()=>a.invalidateQueries(),"data-testid":"button-refresh-data",children:[e.jsx(O,{className:"w-3 h-3 mr-2"})," REFRESH DATA"]})]}),e.jsx(Ze,{})]}),e.jsx("div",{className:"flex-1",children:e.jsxs(Te,{value:t,onValueChange:o,className:"flex flex-col",children:[e.jsx(Ae,{className:"bg-black/60 border border-secondary rounded-none p-1 shrink-0 w-full justify-start overflow-x-auto",children:[{id:"summary",label:"SUMMARY",icon:G},{id:"analysis",label:"ANALYSIS",icon:J},{id:"proposals",label:"PROPOSALS",icon:H},{id:"history",label:"HISTORY",icon:Z}].map(s=>e.jsxs(Ie,{value:s.id,className:"rounded-none font-arcade text-[10px] data-[state=active]:bg-primary data-[state=active]:text-black px-3","data-testid":`tab-${s.id}`,children:[e.jsx(s.icon,{className:"w-3 h-3 mr-1"}),s.label]},s.id))}),e.jsxs(q,{value:"summary",className:"flex-1 mt-6",children:[e.jsx(u,{className:"bg-black/40 border border-secondary/60 rounded-none mb-4",children:e.jsxs(h,{className:"p-3",children:[e.jsx("div",{className:"font-arcade text-[10px] text-secondary mb-2",children:"SCHOLAR RUN: HIGH-LEVEL → ANALYSIS → DECISIONS"}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-3 font-terminal text-[11px] text-muted-foreground",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-primary font-semibold",children:"1. Review study health"}),e.jsx("p",{children:"Scan totals and recent activity for obvious gaps."})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-primary font-semibold",children:"2. Dive into analysis"}),e.jsx("p",{children:"Use Tutor audit, questions, and evidence to understand why."})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-primary font-semibold",children:"3. Approve/track proposals"}),e.jsx("p",{children:"Decide which changes to adopt and track over time."})]})]})]})}),b.length>0&&e.jsx(u,{className:"bg-black/60 border border-primary/70 rounded-none mb-4",children:e.jsxs(h,{className:"p-3 flex flex-col md:flex-row md:items-center gap-3 justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4 text-primary"}),e.jsxs("p",{className:"font-terminal text-xs text-muted-foreground",children:["You have"," ",e.jsxs("span",{className:"text-primary",children:[b.filter(s=>s.status!=="REJECTED").length," active Scholar proposal",b.filter(s=>s.status!=="REJECTED").length===1?"":"s"]})," ","waiting for a decision."]})]}),e.jsx(w,{variant:"outline",size:"sm",className:"rounded-none font-arcade text-[10px] border-primary text-primary",onClick:()=>o("proposals"),"data-testid":"cta-review-proposals-from-summary",children:"GO TO PROPOSALS"})]})}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4 pr-2",children:[e.jsxs(u,{className:"bg-black/40 border-2 border-primary/50 rounded-none",children:[e.jsx(N,{className:"p-4 border-b border-primary/30",children:e.jsxs(j,{className:"font-arcade text-sm text-primary flex items-center gap-3",children:[e.jsx(G,{className:"w-4 h-4"})," STUDY HEALTH OVERVIEW"]})}),e.jsx(h,{className:"p-6 space-y-6",children:e.jsxs("div",{className:"grid grid-cols-3 gap-6 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-arcade text-2xl text-primary",children:i.length}),e.jsx("div",{className:"font-terminal text-xs text-muted-foreground",children:"TOTAL SESSIONS"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-arcade text-2xl text-white",children:ge}),e.jsx("div",{className:"font-terminal text-xs text-muted-foreground",children:"THIS WEEK"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-arcade text-2xl text-secondary",children:[je,"m"]}),e.jsx("div",{className:"font-terminal text-xs text-muted-foreground",children:"AVG/SESSION"})]})]})})]}),e.jsxs(u,{className:"bg-black/40 border-2 border-white/30 rounded-none",children:[e.jsx(N,{className:"p-3 border-b border-white/20",children:e.jsxs(j,{className:"font-arcade text-xs text-white flex items-center gap-2",children:[e.jsx(Oe,{className:"w-4 h-4"})," WHAT APPEARS TO BE WORKING"]})}),e.jsxs(h,{className:"p-6",children:[e.jsx("ul",{className:"space-y-3 font-terminal text-sm",children:g.filter(s=>(s.totalSessions||0)>=3).length>0?e.jsxs(e.Fragment,{children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(W,{className:"w-4 h-4 text-primary shrink-0 mt-0.5"}),e.jsxs("span",{children:[g.filter(s=>(s.totalSessions||0)>=3).length," courses have consistent study activity"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(W,{className:"w-4 h-4 text-primary shrink-0 mt-0.5"}),e.jsx("span",{children:"Round-robin rotation ensuring balanced coverage"})]})]}):e.jsx("li",{className:"text-muted-foreground",children:"Insufficient data for strong conclusions. Aim for at least ~10 logged sessions (via the Dashboard Study Wheel) before trusting these patterns."})}),e.jsx("div",{className:"mt-3 pt-3 border-t border-secondary/30",children:e.jsxs(p,{variant:"outline",className:"rounded-none text-[9px] border-secondary",children:["CONFIDENCE: ",i.length>10?"MEDIUM":"LOW"," (based on ",i.length," sessions)"]})})]})]}),e.jsxs(u,{className:"bg-black/40 border-2 border-destructive/50 rounded-none",children:[e.jsx(N,{className:"p-3 border-b border-destructive/30",children:e.jsxs(j,{className:"font-arcade text-xs text-destructive flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4"})," POTENTIAL CONCERNS"]})}),e.jsxs(h,{className:"p-6",children:[e.jsxs("ul",{className:"space-y-3 font-terminal text-sm",children:[A.length>0&&e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(I,{className:"w-4 h-4 text-destructive shrink-0 mt-0.5"}),e.jsxs("span",{children:[A.length," courses with low activity: ",A.map(s=>s.name).join(", ")]})]}),M.length>0&&e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(I,{className:"w-4 h-4 text-destructive shrink-0 mt-0.5"}),e.jsxs("span",{children:[M.length," unresolved confusions logged"]})]}),L.length>0&&e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(I,{className:"w-4 h-4 text-destructive shrink-0 mt-0.5"}),e.jsxs("span",{children:[L.length," session issues flagged"]})]}),A.length===0&&M.length===0&&L.length===0&&e.jsx("li",{className:"text-muted-foreground",children:"No significant concerns identified yet. Keep logging sessions; Scholar will surface issues here once patterns emerge."})]}),be&&e.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[e.jsx(w,{variant:"outline",size:"sm",className:"rounded-none font-arcade text-[10px] border-primary text-primary",onClick:()=>o("analysis"),"data-testid":"cta-open-analysis-from-summary",children:"OPEN DETAILED ANALYSIS"}),e.jsx(w,{variant:"ghost",size:"sm",className:"rounded-none font-arcade text-[10px]",onClick:()=>{window.location.href="/brain"},"data-testid":"cta-open-brain-from-summary",children:"REVIEW SESSIONS IN BRAIN"})]})]})]})]}),e.jsxs(u,{className:"bg-black/40 border-2 border-secondary rounded-none flex flex-col",children:[e.jsx(N,{className:"p-3 border-b border-secondary shrink-0 sticky top-0 bg-black/95 z-10",children:e.jsxs(j,{className:"font-arcade text-xs flex items-center gap-2",children:[e.jsx(qe,{className:"w-4 h-4"})," ASK SCHOLAR"]})}),e.jsxs(h,{className:"p-0 flex-1 flex flex-col",children:[e.jsx(ke,{className:"flex-1 p-3 min-h-[400px]",children:e.jsxs("div",{className:"space-y-3",children:[d.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(_,{className:"w-8 h-8 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"font-terminal text-xs text-muted-foreground",children:"Ask questions about your study data, patterns, or get recommendations."})]}),d.map((s,c)=>e.jsx("div",{className:R("p-2 rounded-sm font-terminal text-xs",s.role==="user"?"bg-primary/20 text-primary ml-8":"bg-secondary/20 text-white mr-8"),children:s.content},c)),n&&e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground font-terminal text-xs",children:[e.jsx(O,{className:"w-3 h-3 animate-spin"}),"Analyzing Brain data..."]}),e.jsx("div",{ref:y})]})}),e.jsx("div",{className:"p-2 border-t border-secondary shrink-0",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Pe,{value:r,onChange:s=>m(s.target.value),onKeyDown:s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),Q())},placeholder:"Ask about your study patterns...",className:"rounded-none bg-black border-secondary text-xs min-h-[60px] resize-none","data-testid":"input-scholar-chat"}),e.jsx(w,{size:"icon",className:"rounded-none bg-primary text-black h-[60px] w-10",onClick:Q,disabled:n,"data-testid":"button-send-chat",children:e.jsx(Me,{className:"w-4 h-4"})})]})})]})]})]})]}),e.jsx(q,{value:"analysis",className:"flex-1 overflow-auto mt-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"font-terminal text-[11px] text-muted-foreground",children:"Scholar analysis walks from how Tutor behaved, to where issues cluster, to concrete questions and evidence. If something looks important here, expect or create a matching proposal on the next tab."}),e.jsxs(u,{className:"bg-black/40 border-2 border-secondary rounded-none",children:[e.jsx(N,{className:"p-3 border-b border-secondary",children:e.jsxs(j,{className:"font-arcade text-xs flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4"})," TUTOR AUDIT"]})}),e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"grid lg:grid-cols-2 gap-4",children:[e.jsxs(u,{className:"bg-black/40 border-2 border-primary/50 rounded-none",children:[e.jsx(N,{className:"p-3 border-b border-primary/30",children:e.jsxs(j,{className:"font-arcade text-xs text-primary flex items-center gap-2",children:[e.jsx(_,{className:"w-4 h-4"})," TUTOR BEHAVIOR AUDIT"]})}),e.jsx(h,{className:"p-4",children:e.jsx("div",{className:"space-y-3",children:T.length===0?e.jsx("p",{className:"font-terminal text-xs text-muted-foreground",children:"No audit data available"}):T.map((s,c)=>e.jsxs("div",{className:"p-3 bg-primary/5 border border-primary/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-terminal text-sm",children:s.sessionDate}),e.jsx(p,{variant:"outline",className:"rounded-none text-[9px] border-primary",children:s.phase})]}),e.jsx("p",{className:"font-terminal text-xs mb-2",children:s.observation}),e.jsx("div",{className:"flex gap-2",children:e.jsx(p,{variant:"secondary",className:"rounded-none text-[8px]",children:s.impact})})]},c))})})]}),e.jsxs(u,{className:"bg-black/40 border-2 border-secondary rounded-none",children:[e.jsx(N,{className:"p-3 border-b border-secondary",children:e.jsxs(j,{className:"font-arcade text-xs flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4"})," RECURRENT ISSUES"]})}),e.jsx(h,{className:"p-4",children:e.jsx("div",{className:"space-y-3",children:ve.map((s,c)=>e.jsxs("div",{className:"p-3 bg-black/40 border border-secondary/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-terminal text-sm",children:s.issue??"Unknown issue"}),e.jsxs(p,{variant:"outline",className:"rounded-none text-[9px] border-primary text-primary",children:["x",s.frequency??0]})]}),e.jsx("div",{className:"flex gap-1 flex-wrap",children:(s.courses||[]).map((v,Ee)=>e.jsx(p,{variant:"secondary",className:"rounded-none text-[8px]",children:v},Ee))})]},c))})})]})]})})]}),e.jsxs(u,{className:"bg-black/40 border-2 border-secondary rounded-none",children:[e.jsx(N,{className:"p-3 border-b border-secondary",children:e.jsxs(j,{className:"font-arcade text-xs flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4"})," QUESTION PIPELINE"]})}),e.jsxs(h,{className:"p-4",children:[e.jsx("p",{className:"font-terminal text-[11px] text-muted-foreground mb-3",children:"Scholar turns messy issues into tractable questions. Use this section to see what is still unanswered and where more Brain data or external research is needed."}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-4",children:[e.jsxs(u,{className:"bg-black/40 border-2 border-secondary rounded-none",children:[e.jsx(N,{className:"p-3 border-b border-secondary",children:e.jsxs(j,{className:"font-arcade text-xs flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4"})," QUESTION RESOLUTION PIPELINE"]})}),e.jsxs(h,{className:"p-4",children:[e.jsxs("div",{className:"space-y-2 font-terminal text-xs text-muted-foreground mb-4",children:[e.jsx("p",{children:"1. Generate question from identified issue"}),e.jsx("p",{children:"2. Attempt answer using Brain data"}),e.jsx("p",{children:"3. If insufficient, research learning science"}),e.jsx("p",{children:"4. If still unresolved, escalate to user"})]}),e.jsx("div",{className:"space-y-3",children:[{stage:"Identified",count:5},{stage:"Brain Analysis",count:3},{stage:"Research",count:1},{stage:"User Escalation",count:2}].map((s,c)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-primary/60"}),e.jsx("span",{className:"font-terminal text-sm flex-1",children:s.stage}),e.jsx(p,{variant:"outline",className:"rounded-none",children:s.count})]},c))})]})]}),e.jsxs(u,{className:"bg-black/40 border-2 border-primary/50 rounded-none",children:[e.jsx(N,{className:"p-3 border-b border-primary/30",children:e.jsxs(j,{className:"font-arcade text-xs text-primary flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4"})," OPEN QUESTIONS"]})}),e.jsx(h,{className:"p-4",children:e.jsx("div",{className:"space-y-4",children:ye.map(s=>e.jsxs("div",{className:"p-3 bg-primary/5 border border-primary/30",children:[e.jsx("p",{className:"font-terminal text-sm mb-3",children:s.question}),e.jsxs("div",{className:"space-y-2 text-xs",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-muted-foreground shrink-0",children:"Context:"}),e.jsx("span",{children:s.context})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-muted-foreground shrink-0",children:"Data Gap:"}),e.jsx("span",{children:s.dataInsufficient})]})]})]},s.id))})})]})]})]})]}),e.jsxs(u,{className:"bg-black/40 border-2 border-secondary rounded-none",children:[e.jsx(N,{className:"p-3 border-b border-secondary",children:e.jsxs(j,{className:"font-arcade text-xs flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4"})," EVIDENCE REVIEW"]})}),e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"grid lg:grid-cols-2 gap-4",children:[e.jsxs(u,{className:"bg-black/40 border-2 border-secondary rounded-none",children:[e.jsx(N,{className:"p-3 border-b border-secondary",children:e.jsxs(j,{className:"font-arcade text-xs flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4"})," OBSERVED DATA"]})}),e.jsx(h,{className:"p-4",children:e.jsx("div",{className:"space-y-4",children:E.map((s,c)=>e.jsxs("div",{className:"p-3 bg-black/40 border border-secondary/50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(p,{variant:"outline",className:"rounded-none text-[9px] border-secondary",children:s.category}),e.jsx("span",{className:"font-terminal text-xs text-muted-foreground",children:s.sessionDate})]}),e.jsx("p",{className:"font-terminal text-sm",children:s.observation})]},c))})})]}),e.jsxs(u,{className:"bg-black/40 border-2 border-secondary rounded-none",children:[e.jsx(N,{className:"p-3 border-b border-secondary",children:e.jsxs(j,{className:"font-arcade text-xs flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4"})," RESEARCH INTERPRETATION"]})}),e.jsx(h,{className:"p-4",children:e.jsx("div",{className:"space-y-4",children:Se.map((s,c)=>e.jsxs("div",{className:"p-3 bg-black/40 border border-secondary/50",children:[e.jsx("div",{className:"font-arcade text-xs text-primary mb-2",children:s.topic??s.title}),e.jsx("p",{className:"font-terminal text-xs mb-2",children:s.summary??s.content}),e.jsx("div",{className:"flex justify-between text-[10px] text-muted-foreground",children:e.jsxs("span",{children:["Source: ",s.source]})})]},c))})})]})]})})]}),e.jsxs(u,{className:"bg-black/40 border-2 border-secondary rounded-none",children:[e.jsxs(N,{className:"p-3 border-b border-secondary flex flex-row items-center justify-between",children:[e.jsxs(j,{className:"font-arcade text-xs flex items-center gap-2",children:[e.jsx(_e,{className:"w-4 h-4"})," TOPIC CLUSTERS"]}),e.jsx(w,{variant:"outline",size:"sm",className:"rounded-none font-arcade text-xs",onClick:()=>U.mutate(),disabled:U.isPending,children:U.isPending?"Running...":"Run Clustering"})]}),e.jsxs(h,{className:"p-4",children:[e.jsx("p",{className:"font-terminal text-[11px] text-muted-foreground mb-3",children:"Clustering works best after you have a healthy volume of sessions and findings. Use it to spot recurring themes that might deserve their own proposals."}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:D?.clusters?.length===0?e.jsx("p",{className:"font-terminal text-xs text-muted-foreground col-span-2",children:"No clusters yet. Run clustering to analyze."}):D?.clusters?.map(s=>e.jsxs("div",{className:"p-3 bg-black/40 border border-secondary/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"font-arcade text-xs text-primary",children:["Cluster ",s.cluster_id]}),e.jsxs(p,{variant:"outline",className:"rounded-none text-[9px] border-secondary",children:[s.count," items"]})]}),e.jsx("div",{className:"space-y-2",children:s.items.map((c,v)=>e.jsxs("div",{className:"flex items-center gap-2 font-terminal text-xs",children:[e.jsx(p,{variant:"secondary",className:"rounded-none text-[8px] shrink-0",children:c.source==="digest"?"DIG":"PROP"}),e.jsx("span",{className:"truncate",children:c.title||"Untitled"})]},v))})]},s.cluster_id))})]})]}),b.length>0&&e.jsx("div",{className:"flex justify-end",children:e.jsx(w,{variant:"outline",size:"sm",className:"rounded-none font-arcade text-[10px] mt-2",onClick:()=>o("proposals"),"data-testid":"cta-next-proposals-from-analysis",children:"NEXT: REVIEW PROPOSALS"})})]})}),e.jsx(q,{value:"proposals",className:"flex-1 overflow-auto mt-4",children:e.jsxs(u,{className:"bg-black/40 border-2 border-secondary rounded-none",children:[e.jsxs(N,{className:"p-3 border-b border-secondary",children:[e.jsxs(j,{className:"font-arcade text-xs flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4"})," IMPROVEMENT PROPOSALS"]}),e.jsx("p",{className:"font-terminal text-[10px] text-muted-foreground mt-1",children:"No auto-implementation. All changes require user approval."}),e.jsxs("p",{className:"font-terminal text-[10px] text-muted-foreground mt-1",children:[e.jsx("span",{className:"font-semibold text-primary",children:"Status legend:"})," ","DRAFT = idea only, APPROVED = you intend to implement, IMPLEMENTED = change applied, REJECTED = explicitly declined."]})]}),e.jsx(h,{className:"p-4",children:e.jsx("div",{className:"space-y-4",children:b.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"font-arcade text-xs text-primary mb-2",children:"NO PROPOSALS YET"}),e.jsx("p",{className:"font-terminal text-xs text-muted-foreground",children:"Proposals are generated by the Scholar workflow after analyzing Brain session data. Run a Scholar analysis from the dashboard or via the Scholar CLI to create proposals."})]}):b.filter(s=>s.status!=="REJECTED").map(s=>e.jsxs("div",{className:"p-4 bg-black/40 border border-secondary/50",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-mono text-xs text-muted-foreground",children:s.proposalId}),e.jsx("h4",{className:"font-terminal text-sm mt-1",children:s.summary})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(p,{variant:"outline",className:R("rounded-none text-[9px]",we(s.priority||"MED")),children:s.priority||"MED"})})]}),s.targetSystem&&e.jsxs("div",{className:"mb-3",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground",children:"Target system: "}),e.jsx(p,{variant:"secondary",className:"rounded-none text-[9px]",children:s.targetSystem})]}),e.jsxs("div",{className:"flex items-center justify-between mt-3 pt-3 border-t border-secondary/30",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{variant:"outline",className:"rounded-none text-[9px] border-secondary",children:"Confidence: MED"}),e.jsx(p,{variant:"outline",className:"rounded-none text-[9px] border-secondary",children:"Risk: LOW"})]}),e.jsxs(re,{value:s.status||"DRAFT",onValueChange:c=>fe.mutate({id:s.id,data:{status:c}}),children:[e.jsx(te,{className:R("rounded-none w-28 h-7 text-[10px]",Y(s.status||"DRAFT")),"data-testid":`select-proposal-status-${s.id}`,children:e.jsx(ne,{})}),e.jsxs(le,{className:"rounded-none bg-black border-primary",children:[e.jsx(k,{value:"DRAFT",children:"PROPOSED"}),e.jsx(k,{value:"APPROVED",children:"APPROVED"}),e.jsx(k,{value:"REJECTED",children:"REJECTED"}),e.jsx(k,{value:"IMPLEMENTED",children:"IMPLEMENTED"})]})]})]})]},s.id))})})]})}),e.jsx(q,{value:"history",className:"flex-1 overflow-auto mt-4",children:e.jsxs(u,{className:"bg-black/40 border-2 border-secondary rounded-none",children:[e.jsx(N,{className:"p-3 border-b border-secondary",children:e.jsxs(j,{className:"font-arcade text-xs flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4"})," PROPOSAL HISTORY (READ ONLY)"]})}),e.jsxs(h,{className:"p-4",children:[e.jsx("p",{className:"font-terminal text-[10px] text-muted-foreground mb-2",children:"Read-only log of every Scholar proposal and its final status. Use this to see what has already been tried and decided before creating new changes."}),e.jsx("div",{className:"space-y-2",children:b.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"font-arcade text-xs text-primary mb-2",children:"NO HISTORY YET"}),e.jsx("p",{className:"font-terminal text-xs text-muted-foreground",children:"Proposal history will appear here once Scholar generates its first analysis."})]}):b.map(s=>e.jsxs("div",{className:"flex items-center p-3 bg-black/40 border border-secondary/50 font-terminal text-sm","data-testid":`history-proposal-${s.id}`,children:[e.jsx("div",{className:"w-20 font-mono text-xs text-muted-foreground",children:s.proposalId}),e.jsx("div",{className:"flex-1 truncate",children:s.summary}),e.jsxs("div",{className:"flex gap-2 items-center shrink-0",children:[e.jsx(p,{variant:"outline",className:R("rounded-none text-[9px]",Y(s.status||"DRAFT")),children:s.status||"DRAFT"}),e.jsxs("span",{className:"text-[10px] text-muted-foreground",children:[e.jsx(ce,{className:"w-3 h-3 inline mr-1"}),s.createdAt?new Date(s.createdAt).toLocaleDateString():"N/A"]})]})]},s.id))})]})]})})]})})]})})}export{hs as default};
