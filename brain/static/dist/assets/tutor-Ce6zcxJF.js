import{c as H,j as e,r as a,d as he,X as je}from"./index-BTr4xENe.js";import{u as Y,p as w,S as fe,B as G,n as ge,o as be,m as Se,L as Ce}from"./layout-a5ngy0UQ.js";import{B as O,C as W}from"./badge-C9YnbhT0.js";import{I as k,T as E,a as X,b as Q,P as V,c as ve,S as ke,d as ie,e as le,M as _e,B as Ee,f as te,g as se,h as we,t as j}from"./MaterialUploader-D33iLJjq.js";import{C as re}from"./checkbox-DKgYHA73.js";import{L as ne}from"./loader-circle-BOEkbIw8.js";import{F as J}from"./file-text-BHFYdvjO.js";import{D as $e,M as Te,r as Ae,F as Oe}from"./index-B0nMDwr8.js";import{L as De}from"./link-BVDcNKco.js";import{Z as Le}from"./zap-BKL32J1f.js";import{C as Me}from"./index-aVOWEh9L.js";import{S as Pe}from"./send-BKE_OzDk.js";import{M as ce}from"./message-square-DMbblvkH.js";import{C as de}from"./clock-DGEcTDBV.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]],Ie=H("cloud",Re);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],ye=H("credit-card",Fe);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=[["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M17 20v2",key:"1rnc9c"}],["path",{d:"M17 2v2",key:"11trls"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M2 17h2",key:"7oei6x"}],["path",{d:"M2 7h2",key:"asdhe0"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"M20 17h2",key:"1fpfkl"}],["path",{d:"M20 7h2",key:"1o8tra"}],["path",{d:"M7 20v2",key:"4gnj0m"}],["path",{d:"M7 2v2",key:"1i4yhu"}],["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"8",y:"8",width:"8",height:"8",rx:"1",key:"z9xiuo"}]],Ue=H("cpu",qe);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]],Ne=H("map",Ke);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],Qe=H("square",Ge),Xe={pdf:"PDF",docx:"DOC",pptx:"PPT",md:"MD",txt:"TXT"};function ze({courseId:c,selectedMaterials:n,setSelectedMaterials:N}){const{data:f=[],isLoading:m}=Y({queryKey:["tutor-materials",c],queryFn:()=>w.tutor.getMaterials(c?{course_id:c}:void 0)}),$=i=>{N(n.includes(i)?n.filter(M=>M!==i):[...n,i])},v=()=>{n.length===f.length?N([]):N(f.map(i=>i.id))};return m?e.jsx("div",{className:"flex items-center justify-center py-3",children:e.jsx(ne,{className:`${k} animate-spin text-muted-foreground`})}):f.length===0?e.jsx("div",{className:`${E} text-center py-2`,children:"No materials uploaded yet"}):e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:`flex items-center gap-1.5 px-1 py-0.5 ${X} text-muted-foreground hover:text-foreground cursor-pointer border-b border-muted-foreground/10 pb-1`,children:[e.jsx(re,{checked:f.length>0&&n.length===f.length,onCheckedChange:v,className:"w-3 h-3"}),e.jsx("span",{children:"Select all"}),e.jsxs(O,{variant:"outline",className:`ml-auto ${Q} h-4 px-1`,children:[n.length,"/",f.length]})]}),f.map(i=>e.jsxs("label",{className:`flex items-center gap-1.5 px-1 py-0.5 ${X} text-muted-foreground hover:text-foreground cursor-pointer`,children:[e.jsx(re,{checked:n.includes(i.id),onCheckedChange:()=>$(i.id),className:"w-3 h-3"}),e.jsx(J,{className:`${k} text-primary/60 shrink-0`}),e.jsx("span",{className:"truncate flex-1",children:i.title}),e.jsx(O,{variant:"outline",className:`${Q} h-4 px-1 shrink-0`,children:Xe[i.file_type]||i.file_type.toUpperCase()})]},i.id))]})}const Z=[{value:"arcee-ai/trinity-large-preview:free",label:"Trinity Large (free)"},{value:"qwen/qwen3-coder-next",label:"Qwen3 Coder Next"},{value:"google/gemini-2.5-flash-lite",label:"Gemini 2.5 Flash Lite"}],Be=[{value:"Core",label:"LEARN",desc:"Prime + encode"},{value:"Sprint",label:"REVIEW",desc:"Retrieve + refine"},{value:"Quick Sprint",label:"QUICK",desc:"Quick retrieval"},{value:"Light",label:"LIGHT",desc:"Low energy"},{value:"Drill",label:"FIX",desc:"Target weak spots"}],Ye=["Teaching Sprint","Diagnostic Sprint"],ue={Core:"First Exposure (Core)",Sprint:"Review Sprint","Quick Sprint":"Quick Drill",Light:"Low Energy",Drill:"Mastery Review","Teaching Sprint":"First Exposure (Core)","Diagnostic Sprint":"Review Sprint"},me="tutor.autopick_chain.v1",xe="tutor.last_openrouter_model.v1",pe="tutor.last_codex_model.v1";function ae(c){try{return localStorage.getItem(c)}catch{return null}}function ee(c,n){try{localStorage.setItem(c,n)}catch{}}function Ve(c,n){const N=ae(c);return N===null?n:N==="true"}function z({children:c,icon:n}){return e.jsxs("div",{className:`${se} flex items-center gap-1.5 pb-1 border-b border-primary/20 mb-2`,children:[n,c]})}function He({courseId:c,setCourseId:n,selectedMaterials:N,setSelectedMaterials:f,mode:m,setMode:$,chainId:v,setChainId:i,topic:M,setTopic:b,model:u,setModel:p,onStartSession:D,isStarting:I,hasActiveSession:T}){const{data:s,isError:d}=Y({queryKey:["tutor-content-sources"],queryFn:()=>w.tutor.getContentSources()}),{data:h=[],isError:r}=Y({queryKey:["tutor-template-chains"],queryFn:()=>w.tutor.getTemplateChains()}),{data:y=[]}=Y({queryKey:["courses-active"],queryFn:()=>w.courses.getActive()}),x=s?.openrouter_enabled??!1,S=u.includes("/")?"openrouter":"codex";a.useEffect(()=>{!x&&S==="openrouter"&&p("codex")},[x,S,p]),a.useEffect(()=>{u&&(u.includes("/")?ee(xe,u):ee(pe,u))},[u]);const[g,U]=a.useState(()=>Ve(me,!0)),[L,q]=a.useState(null);a.useEffect(()=>{ee(me,String(g))},[g]);const P=ue[m],_=a.useMemo(()=>{if(P)return h.find(t=>t.name===P)},[h,P]);a.useEffect(()=>{g&&v===void 0&&_&&L!==m&&(i(_.id),q(m))},[g,v,_?.id,L,m,i]);const B=t=>{if($(t),!g||v!==void 0)return;const R=ue[t];if(!R)return;const o=h.find(l=>l.name===R);o&&(i(o.id),q(t))},K=()=>{const t=ae(pe),R=t&&!t.includes("/")?t:"codex";p(R)},F=()=>{if(!x)return;const t=ae(xe),R=t&&t.includes("/")?t:Z[0].value;p(R)};return a.useEffect(()=>{S==="openrouter"&&(Z.some(t=>t.value===u)||p(Z[0].value))},[S,u,p]),e.jsxs("div",{className:"flex flex-col h-full overflow-hidden",children:[e.jsxs("div",{className:`shrink-0 ${V} pb-2 border-b-2 border-primary/30`,children:[e.jsx("div",{className:ve,children:"CONTENT FILTER"}),(d||r)&&e.jsxs("div",{className:`${E} text-red-400`,children:["Tutor API unavailable. Start the dashboard via ",e.jsx("span",{className:"font-arcade",children:"Start_Dashboard.bat"}),"."]}),e.jsxs("div",{className:`flex items-center gap-2 mt-1 ${E}`,children:[e.jsx($e,{className:k}),s?.total_materials??0," materials",e.jsx("span",{className:"text-muted-foreground/40",children:"|"}),s?.total_instructions??0," SOP"]})]}),e.jsx(fe,{className:"flex-1 min-h-0",children:e.jsxs("div",{className:`${V} ${ke}`,children:[e.jsxs("div",{children:[e.jsx(z,{children:"Mode"}),e.jsx("div",{className:"grid grid-cols-2 gap-1",children:Be.map(t=>e.jsxs("button",{onClick:()=>B(t.value),className:`text-left px-2 py-1 border-2 transition-colors ${m===t.value?"border-primary bg-primary/20 text-primary":"border-muted-foreground/30 text-foreground/80 hover:border-muted-foreground/50 hover:text-foreground hover:bg-black/30"}`,children:[e.jsx("div",{className:"font-arcade text-xs leading-tight truncate",children:t.label}),e.jsx("div",{className:`${E} leading-tight truncate`,children:t.desc})]},t.value))}),e.jsx("div",{className:`${E} mt-1`,children:"Auto-picks a chain template. Override below."}),Ye.includes(m)&&e.jsxs("div",{className:`${E} mt-1`,children:["Legacy mode active: ",m]})]}),e.jsxs("div",{children:[e.jsx(z,{icon:e.jsx(De,{className:k}),children:"Chain"}),e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1",children:[e.jsxs("div",{className:`${E} min-w-0`,children:[e.jsx("span",{className:"opacity-70",children:"Recommended:"})," ",_?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-foreground truncate",children:_.name}),e.jsx(O,{variant:"outline",className:`ml-1.5 ${Q} h-4 px-1`,children:_.blocks.length})]}):e.jsx("span",{className:"opacity-70",children:"—"})]}),_&&v!==_.id&&e.jsx(G,{size:"sm",variant:"outline",onClick:()=>i(_.id),className:"rounded-none h-7 px-2 font-arcade text-xs border-primary/50 hover:bg-primary/10",children:"APPLY"})]}),e.jsxs("label",{className:`flex items-center gap-2 ${X} text-muted-foreground mb-1 cursor-pointer`,children:[e.jsx(re,{checked:g,onCheckedChange:t=>U(t===!0),className:"w-3 h-3"}),e.jsx("span",{className:"select-none",children:"Auto-pick recommended chain"})]}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("button",{onClick:()=>{i(void 0),q(m)},className:`w-full text-left px-2 py-0.5 ${X} border-l-2 transition-colors ${v?"border-transparent text-foreground/80 hover:text-foreground hover:border-muted-foreground/40 hover:bg-black/30":"border-primary text-primary bg-primary/10"}`,children:"Freeform"}),h.map(t=>e.jsxs("button",{onClick:()=>i(t.id),className:`w-full text-left px-2 py-0.5 ${X} border-l-2 transition-colors ${v===t.id?"border-primary text-primary bg-primary/10":"border-transparent text-foreground/80 hover:text-foreground hover:border-muted-foreground/40 hover:bg-black/30"}`,children:[e.jsx("span",{className:"truncate",children:t.name}),e.jsx(O,{variant:"outline",className:`ml-1.5 ${Q} h-4 px-1`,children:t.blocks.length})]},t.id))]})]}),e.jsxs("div",{children:[e.jsx(z,{children:"Topic"}),e.jsx("input",{value:M,onChange:t=>b(t.target.value),placeholder:"e.g. Hip Flexors",className:ie})]}),e.jsxs("div",{children:[e.jsx(z,{children:"Model"}),e.jsxs("div",{className:"grid grid-cols-2 gap-1 mb-1",children:[e.jsxs("button",{onClick:K,className:`text-left px-2 py-1 border-2 transition-colors ${S==="codex"?"border-primary bg-primary/20 text-primary":"border-muted-foreground/30 text-foreground/80 hover:border-muted-foreground/50 hover:text-foreground hover:bg-black/30"}`,children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Ue,{className:k}),e.jsx("div",{className:"font-arcade text-xs leading-tight",children:"CODEX"})]}),e.jsx("div",{className:`${E} leading-tight`,children:"ChatGPT login"})]}),e.jsxs("button",{onClick:F,disabled:!x,className:`text-left px-2 py-1 border-2 transition-colors ${S==="openrouter"?"border-primary bg-primary/20 text-primary":"border-muted-foreground/30 text-foreground/80 hover:border-muted-foreground/50 hover:text-foreground hover:bg-black/30"} ${x?"":"opacity-50 cursor-not-allowed"}`,children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Ie,{className:k}),e.jsx("div",{className:"font-arcade text-xs leading-tight",children:"OPENROUTER"})]}),e.jsx("div",{className:`${E} leading-tight`,children:x?"API key enabled":"API key missing"})]})]}),S==="openrouter"?e.jsx("select",{value:u,onChange:t=>p(t.target.value),className:le,children:Z.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}):e.jsx("input",{value:u==="codex"?"":u,onChange:t=>p(t.target.value.trim()?t.target.value:"codex"),placeholder:"Codex model override (optional)",className:ie})]}),e.jsxs("div",{children:[e.jsx(z,{children:"Course"}),e.jsxs("select",{value:c??"",onChange:t=>n(t.target.value?Number(t.target.value):void 0),className:le,children:[e.jsx("option",{value:"",children:"All courses"}),y.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx(z,{icon:e.jsx(J,{className:k}),children:"Materials"}),e.jsx(ze,{courseId:c,selectedMaterials:N,setSelectedMaterials:f})]}),e.jsxs("div",{className:"border-t border-primary/10 pt-2",children:[e.jsx(z,{children:"Upload"}),e.jsx(_e,{courseId:c})]})]})}),e.jsx("div",{className:`shrink-0 ${V} pt-2 border-t-2 border-primary/30`,children:e.jsxs(G,{onClick:D,disabled:I||T,className:Ee,children:[I?e.jsx(ne,{className:`${te} animate-spin mr-1.5`}):e.jsx(Le,{className:`${te} mr-1.5`}),T?"SESSION ACTIVE":"START SESSION"]})})]})}function Ze({sessionId:c,onArtifactCreated:n,onSessionEnd:N,chainBlocks:f=[],currentBlockIndex:m=0,onAdvanceBlock:$}){const v=f.length>0,i=v&&m>=f.length,[M,b]=a.useState([]),[u,p]=a.useState(""),[D,I]=a.useState(!1),T=a.useRef(null),s=a.useRef(null);a.useEffect(()=>{T.current&&(T.current.scrollTop=T.current.scrollHeight)},[M]),a.useEffect(()=>{s.current?.focus()},[c]);const d=a.useCallback(async()=>{if(!u.trim()||!c||D)return;const r=u.trim();p("");const y=/^\/(note|save)\b/i.test(r),x=/^\/(card|flashcard)\b/i.test(r),S=/^\/(map|diagram)\b/i.test(r);b(g=>[...g,{role:"user",content:r}]),b(g=>[...g,{role:"assistant",content:"",isStreaming:!0}]),I(!0);try{const U=(await fetch(`/api/tutor/session/${c}/turn`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:r})})).body?.getReader(),L=new TextDecoder;if(!U)throw new Error("No response body");let q="",P="",_=[],B;for(;;){const{done:K,value:F}=await U.read();if(K)break;q+=L.decode(F,{stream:!0});const t=q.split(`
`);q=t.pop()??"";for(const R of t){if(!R.startsWith("data: "))continue;const o=R.slice(6);if(o==="[DONE]")break;try{const l=JSON.parse(o);if(l.type==="error"){b(A=>{const C=[...A];return C[C.length-1]={role:"assistant",content:`Error: ${l.content}`},C}),I(!1);return}l.type==="token"&&l.content&&(P+=l.content,b(A=>{const C=[...A],oe=C[C.length-1];return C[C.length-1]={...oe,content:oe.content+l.content,isStreaming:!0},C})),l.type==="done"&&(_=l.citations??[],B=l.model)}catch{}}}b(K=>{const F=[...K];return F[F.length-1]={role:"assistant",content:P,citations:_,model:B,isStreaming:!1},F}),(y||x||S)&&n({type:y?"note":x?"card":"map",content:P,title:r.replace(/^\/(note|card|flashcard|map|diagram|save)\s*/i,"").trim()})}catch(g){b(U=>{const L=[...U];return L[L.length-1]={role:"assistant",content:`Connection error: ${g instanceof Error?g.message:"Unknown"}`},L})}finally{I(!1)}},[u,c,D,n]),h=r=>{r.key==="Enter"&&!r.shiftKey&&(r.preventDefault(),d())};return c?e.jsxs("div",{className:"flex flex-col h-full",children:[v&&e.jsxs("div",{className:"shrink-0 px-3 py-2 border-b-2 border-primary/30 bg-black/40",children:[e.jsxs("div",{className:"flex items-center gap-1 overflow-x-auto",children:[f.map((r,y)=>{const x=y<m,S=y===m&&!i;return e.jsxs("div",{className:"flex items-center shrink-0",children:[y>0&&e.jsx(Me,{className:"w-4 h-4 text-muted-foreground/40 mx-0.5"}),e.jsxs("div",{className:`px-2 py-1 border-2 text-base font-terminal flex items-center gap-1 ${S?"border-primary bg-primary/20 text-primary":x?"border-primary/30 bg-primary/5 text-muted-foreground/70 line-through":"border-primary/20 text-muted-foreground/50"}`,children:[x&&e.jsx(ge,{className:"w-4 h-4"}),r.name]})]},r.id)}),!i&&$&&e.jsx("button",{onClick:$,className:"shrink-0 ml-2 px-3 py-1 border-2 border-primary/60 text-xs font-arcade text-primary hover:bg-primary/20 transition-colors",children:"NEXT"}),i&&e.jsx("span",{className:"shrink-0 ml-2 px-3 py-1 text-xs font-arcade text-green-400 border-2 border-green-400/50",children:"COMPLETE"})]}),!i&&f[m]&&e.jsxs("div",{className:"mt-1 text-base font-terminal text-muted-foreground",children:[e.jsx("span",{className:"text-primary",children:f[m].category.toUpperCase()})," ","· ~",f[m].duration,"min"]})]}),e.jsxs("div",{ref:T,className:"flex-1 overflow-y-auto p-3 space-y-3",children:[M.length===0&&e.jsxs("div",{className:"text-center py-8 space-y-2",children:[e.jsx("div",{className:"font-arcade text-sm text-primary",children:"SESSION STARTED"}),e.jsx("div",{className:"font-terminal text-lg text-muted-foreground",children:"Ask a question to begin learning. Use /note, /card, or /map for artifacts."})]}),M.map((r,y)=>e.jsx("div",{className:`flex ${r.role==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[85%] px-3 py-2 text-lg font-terminal ${r.role==="user"?"bg-primary/20 border-2 border-primary/50 text-foreground":"bg-black/40 border-2 border-primary/20 text-foreground"}`,children:[r.role==="assistant"?e.jsxs("div",{className:"prose prose-invert prose-lg max-w-none font-terminal [&_p]:my-2 [&_li]:my-1 [&_code]:text-base [&_pre]:text-base",children:[e.jsx(Te,{remarkPlugins:[Ae],children:r.content||(r.isStreaming?"...":"")}),r.isStreaming&&e.jsx("span",{className:"inline-block w-2 h-3 bg-primary animate-pulse ml-0.5"})]}):e.jsx("div",{children:r.content}),(r.citations?.length||r.model)&&!r.isStreaming?e.jsxs("div",{className:"flex flex-wrap items-center gap-1 mt-2 pt-2 border-t border-primary/20",children:[r.citations?.map(x=>e.jsxs(O,{variant:"outline",className:"text-sm rounded-none",children:["[",x.index,"] ",x.source]},x.index)),r.model&&e.jsx(O,{variant:"outline",className:"text-sm rounded-none text-muted-foreground/60 ml-auto",children:r.model})]}):null]})},y))]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 border-t border-primary/20",children:[e.jsx("span",{className:"text-base font-terminal text-muted-foreground/60",children:"Commands:"}),e.jsxs(O,{variant:"outline",className:"text-sm rounded-none cursor-pointer hover:bg-primary/10",onClick:()=>p("/note "),children:[e.jsx(J,{className:"w-4 h-4 mr-1"}),"/note"]}),e.jsxs(O,{variant:"outline",className:"text-sm rounded-none cursor-pointer hover:bg-primary/10",onClick:()=>p("/card "),children:[e.jsx(ye,{className:"w-4 h-4 mr-1"}),"/card"]}),e.jsxs(O,{variant:"outline",className:"text-sm rounded-none cursor-pointer hover:bg-primary/10",onClick:()=>p("/map "),children:[e.jsx(Ne,{className:"w-4 h-4 mr-1"}),"/map"]}),e.jsx("div",{className:"flex-1"}),e.jsxs(G,{variant:"ghost",size:"sm",onClick:N,className:"text-sm font-terminal text-destructive hover:text-destructive h-8 px-3",children:[e.jsx(Qe,{className:"w-4 h-4 mr-1"}),"END"]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-3 border-t-2 border-primary/20",children:[e.jsx("input",{ref:s,value:u,onChange:r=>p(r.target.value),onKeyDown:h,placeholder:"Ask a question...",disabled:D,className:"flex-1 bg-black/60 border-2 border-primary/40 rounded-none px-3 py-2 text-lg font-terminal text-foreground placeholder:text-muted-foreground/50 focus:border-primary focus:outline-none disabled:opacity-50"}),e.jsx(G,{onClick:d,disabled:!u.trim()||D,className:"rounded-none border-2 border-primary h-11 w-11 p-0",children:D?e.jsx(ne,{className:"w-5 h-5 animate-spin"}):e.jsx(Pe,{className:"w-5 h-5"})})]})]}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("div",{className:"font-arcade text-sm text-muted-foreground",children:"NO ACTIVE SESSION"}),e.jsx("div",{className:"font-terminal text-lg text-muted-foreground/70",children:"Configure content filter and start a session"})]})})}const Je={note:J,card:ye,map:Ne},We={note:"text-blue-400",card:"text-yellow-400",map:"text-green-400"};function et({sessionId:c,artifacts:n,turnCount:N,mode:f,topic:m,startedAt:$,recentSessions:v,onResumeSession:i}){const M=he(),[b,u]=a.useState(null),[p,D]=a.useState(null),I=async s=>{try{await w.tutor.deleteSession(s),j.success("Session deleted"),M.invalidateQueries({queryKey:["tutor-sessions"]}),u(null)}catch(d){j.error(`Delete failed: ${d instanceof Error?d.message:"Unknown"}`)}},T=async s=>{D(s.session_id);try{const d=await w.tutor.getSession(s.session_id);if(!d.turns||d.turns.length===0){j.error("No turns to save");return}const h=[`# Tutor: ${s.topic||s.mode}`,`**Date:** ${new Date(s.started_at).toLocaleDateString()}`,`**Mode:** ${s.mode} | **Turns:** ${s.turn_count}`,"","---",""];for(const x of d.turns)h.push(`## Q${x.turn_number}`),h.push(x.question),h.push(""),x.answer&&(h.push("**Answer:**"),h.push(x.answer),h.push(""));const y=`Study Sessions/${`Tutor - ${(s.topic||s.mode).replace(/[^a-zA-Z0-9 ]/g,"").trim()}`}.md`;await w.obsidian.append(y,h.join(`
`)),j.success(`Saved to Obsidian: ${y}`)}catch(d){j.error(`Save failed: ${d instanceof Error?d.message:"Unknown"}`)}finally{D(null)}};return e.jsxs("div",{className:"flex flex-col h-full overflow-hidden",children:[e.jsx("div",{className:`shrink-0 ${V} pb-2 border-b-2 border-secondary/30`,children:e.jsx("div",{className:ve,children:"ARTIFACTS"})}),e.jsx(fe,{className:"flex-1 min-h-0",children:e.jsxs("div",{className:`${V} space-y-3`,children:[c?e.jsxs("div",{className:"space-y-2 pb-3 border-b border-muted-foreground/20",children:[e.jsxs("div",{className:"flex items-center gap-1.5 flex-wrap",children:[e.jsx(O,{variant:"outline",className:`${Q} h-5 px-1.5`,children:f}),e.jsx(O,{variant:"outline",className:`${Q} h-5 px-1.5 text-primary`,children:"FIRST PASS"})]}),m&&e.jsx("div",{className:`${X} text-sm`,children:m}),e.jsxs("div",{className:`flex items-center gap-3 ${E}`,children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ce,{className:k}),N," turns"]}),$&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(de,{className:k}),new Date($).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})]}):e.jsx("div",{className:`${X} text-muted-foreground/50 py-3 text-center`,children:"No active session"}),n.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:se,children:"Artifacts"}),n.map((s,d)=>{const h=Je[s.type],r=We[s.type];return e.jsxs("div",{className:"border-2 border-muted-foreground/20 p-2.5 hover:border-primary/30 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(h,{className:`${te} ${r}`}),e.jsx("span",{className:`${X} text-sm truncate flex-1`,children:s.title||`${s.type} #${d+1}`})]}),s.content&&e.jsx("div",{className:`${E} mt-1 line-clamp-2`,children:s.content.slice(0,100)})]},d)})]}),c&&n.length===0&&e.jsxs("div",{className:"text-center space-y-1 py-4",children:[e.jsx(be,{className:`${we} text-muted-foreground/30 mx-auto`}),e.jsx("div",{className:`${E} text-muted-foreground/50`,children:"No artifacts yet"}),e.jsx("div",{className:`${E} text-muted-foreground/30`,children:"Use /note, /card, or /map"})]}),v.length>0&&e.jsxs("div",{className:"space-y-2 pt-2 border-t border-muted-foreground/20",children:[e.jsx("div",{className:se,children:"Recent Sessions"}),v.slice(0,8).map(s=>e.jsxs("div",{className:"border-2 border-muted-foreground/10 hover:border-muted-foreground/30 transition-colors",children:[e.jsxs("button",{onClick:()=>i(s.session_id),className:"w-full text-left px-3 py-2.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{variant:"outline",className:`${Q} h-5 px-1.5 shrink-0 ${s.status==="active"?"text-green-400 border-green-400/50":"text-muted-foreground"}`,children:s.status==="active"?"LIVE":"DONE"}),e.jsx("span",{className:"font-terminal text-sm truncate flex-1",children:s.topic||s.mode})]}),e.jsxs("div",{className:`flex items-center gap-2 mt-1.5 ${E}`,children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ce,{className:k}),s.turn_count]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(de,{className:k}),new Date(s.started_at).toLocaleDateString()]}),e.jsx(O,{variant:"outline",className:`${Q} h-4 px-1 ml-auto`,children:s.mode})]})]}),e.jsxs("div",{className:"flex items-center border-t border-primary/20 px-2 py-1",children:[e.jsxs(G,{variant:"ghost",size:"sm",className:"h-8 px-3 rounded-none text-muted-foreground hover:text-primary font-terminal text-sm",disabled:p===s.session_id,onClick:d=>{d.stopPropagation(),T(s)},children:[e.jsx(Oe,{className:`${k} mr-1`}),p===s.session_id?"SAVING...":"SAVE"]}),e.jsx("div",{className:"ml-auto",children:b===s.session_id?e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx("span",{className:"font-terminal text-sm text-red-400 mr-1",children:"Delete?"}),e.jsx(G,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 rounded-none text-red-400 hover:text-red-300 hover:bg-red-400/10",onClick:d=>{d.stopPropagation(),I(s.session_id)},children:e.jsx(ge,{className:k})}),e.jsx(G,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 rounded-none text-muted-foreground hover:text-foreground",onClick:d=>{d.stopPropagation(),u(null)},children:e.jsx(je,{className:k})})]}):e.jsx(G,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 rounded-none text-muted-foreground hover:text-red-400",onClick:d=>{d.stopPropagation(),u(s.session_id)},children:e.jsx(Se,{className:k})})})]})]},s.session_id))]})]})})]})}function ht(){const c=he(),[n,N]=a.useState(null),[f,m]=a.useState(!1),[$,v]=a.useState(),[i,M]=a.useState([]),[b,u]=a.useState("Core"),[p,D]=a.useState(),[I,T]=a.useState(0),[s,d]=a.useState([]),[h,r]=a.useState(""),[y,x]=a.useState("codex"),[S,g]=a.useState([]),[U,L]=a.useState(0),[q,P]=a.useState(null),{data:_=[]}=Y({queryKey:["tutor-sessions"],queryFn:()=>w.tutor.listSessions({limit:10})}),B=a.useCallback(async()=>{m(!0);try{const o=await w.tutor.createSession({course_id:$,phase:"first_pass",mode:b,topic:h||void 0,content_filter:{...i.length>0?{material_ids:i}:{},model:y},method_chain_id:p});if(N(o.session_id),P(o.started_at),g([]),L(0),T(o.current_block_index??0),p){const l=await w.tutor.getSession(o.session_id);l.chain_blocks&&d(l.chain_blocks.map(A=>({id:A.id,name:A.name,category:A.category,duration:A.default_duration_min})))}else d([]);j.success("Tutor session started"),c.invalidateQueries({queryKey:["tutor-sessions"]})}catch(o){j.error(`Failed to start session: ${o instanceof Error?o.message:"Unknown"}`)}finally{m(!1)}},[$,b,h,i,y,p,c]),K=a.useCallback(async()=>{if(n)try{await w.tutor.endSession(n),j.success("Session ended"),N(null),g([]),L(0),P(null),T(0),d([]),c.invalidateQueries({queryKey:["tutor-sessions"]})}catch(o){j.error(`Failed to end session: ${o instanceof Error?o.message:"Unknown"}`)}},[n,c]),F=a.useCallback(async o=>{if(n)try{const l=await w.tutor.createArtifact(n,{type:o.type,content:o.content,title:o.title}),A={type:o.type,title:o.title||`${o.type} #${S.length+1}`,content:o.content.slice(0,200),createdAt:new Date().toISOString(),cardId:l.card_id};g(C=>[...C,A]),j.success(`${o.type.charAt(0).toUpperCase()+o.type.slice(1)} created`)}catch(l){j.error(`Failed to create artifact: ${l instanceof Error?l.message:"Unknown"}`)}},[n,S.length]),t=a.useCallback(async()=>{if(n)try{const o=await w.tutor.advanceBlock(n);T(o.block_index),o.complete?j.success("Chain complete!"):j.success(`Advanced to: ${o.block_name}`)}catch(o){j.error(`Failed to advance block: ${o instanceof Error?o.message:"Unknown"}`)}},[n]),R=a.useCallback(async o=>{try{const l=await w.tutor.getSession(o);if(N(l.session_id),L(l.turn_count),P(l.started_at),u(l.mode),r(l.topic||""),v(l.course_id??void 0),l.artifacts_json)try{const A=JSON.parse(l.artifacts_json);Array.isArray(A)&&g(A.map(C=>({type:C.type,title:C.title,content:"",createdAt:C.created_at})))}catch{g([])}j.success("Session resumed")}catch(l){j.error(`Failed to resume session: ${l instanceof Error?l.message:"Unknown"}`)}},[]);return e.jsx(Ce,{children:e.jsxs("div",{className:"h-[calc(100vh-140px)] flex gap-2",children:[e.jsx(W,{className:"w-72 shrink-0 bg-black/40 border-2 border-primary rounded-none overflow-y-auto",children:e.jsx(He,{courseId:$,setCourseId:v,selectedMaterials:i,setSelectedMaterials:M,mode:b,setMode:u,chainId:p,setChainId:D,topic:h,setTopic:r,model:y,setModel:x,onStartSession:B,isStarting:f,hasActiveSession:!!n})}),e.jsx(W,{className:"flex-1 bg-black/60 border-2 border-primary rounded-none flex flex-col min-w-0",children:e.jsx(Ze,{sessionId:n,onArtifactCreated:F,onSessionEnd:K,chainBlocks:s,currentBlockIndex:I,onAdvanceBlock:t})}),e.jsx(W,{className:"w-72 shrink-0 bg-black/40 border-2 border-primary/40 rounded-none overflow-y-auto",children:e.jsx(et,{sessionId:n,artifacts:S,turnCount:U,mode:b,topic:h,startedAt:q,onCreateArtifact:F,recentSessions:_,onResumeSession:R})})]})})}export{ht as default};
