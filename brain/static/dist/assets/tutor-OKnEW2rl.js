import{c as N,v as R,r as c,j as e,b as w}from"./index-vxaivTfW.js";import{u as f,L as P,S as b,B as q,i as B,h as M,b as y}from"./layout-BYzKcK-t.js";import{C as g,a as U,b as _}from"./card-8vEaI0SE.js";import{a as u,M as D,r as $,F as A}from"./index-C3mvmHno.js";import{L as j}from"./loader-circle-BTYvCqet.js";import{F as v}from"./file-text-D42du7m2.js";import{L as G}from"./link-BWv-8ID_.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["path",{d:"m16 18 6-6-6-6",key:"eg8j8"}],["path",{d:"m8 6-6 6 6 6",key:"ppft3o"}]],V=N("code",K);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],H=N("copy",z);function J({item:a,isSelected:r,onSelect:i}){const t=a.type==="dir";return e.jsxs("button",{onClick:()=>!t&&i(a.path),disabled:t,className:w("w-full text-left px-3 py-1.5 text-sm font-terminal flex items-center gap-2 transition-colors",t?"text-muted-foreground cursor-default":"hover:bg-primary/20 cursor-pointer",r&&"bg-primary/30 text-primary border-l-2 border-primary"),children:[t?e.jsx(u,{className:"w-4 h-4 text-yellow-500/70"}):e.jsx(v,{className:"w-4 h-4 text-primary/70"}),e.jsx("span",{className:"truncate",children:a.title})]})}function Q({section:a,selectedPath:r,onSelect:i}){const[t,n]=c.useState(!0),l=a.items.some(d=>d.path===r);return c.useEffect(()=>{l&&n(!0)},[l]),e.jsxs("div",{className:"mb-2",children:[e.jsxs("button",{onClick:()=>n(!t),className:"w-full text-left px-2 py-1 text-xs font-arcade uppercase text-muted-foreground hover:text-primary flex items-center gap-1 transition-colors",children:[t?e.jsx(B,{className:"w-3 h-3"}):e.jsx(M,{className:"w-3 h-3"}),a.title]}),t&&e.jsx("div",{className:"ml-2 border-l border-secondary/50",children:a.items.map(d=>e.jsx(J,{item:d,isSelected:d.path===r,onSelect:i},d.id))})]})}function W({group:a,selectedPath:r,onSelect:i,defaultOpen:t=!1}){const[n,l]=c.useState(t),d=a.sections.some(x=>x.items.some(m=>m.path===r));return c.useEffect(()=>{d&&l(!0)},[d]),e.jsxs("div",{className:"mb-4",children:[e.jsxs("button",{onClick:()=>l(!n),className:"w-full text-left p-2 text-sm font-arcade uppercase bg-secondary/20 hover:bg-secondary/30 flex items-center gap-2 transition-colors border-l-2 border-primary/50",children:[n?e.jsx(A,{className:"w-4 h-4 text-primary"}):e.jsx(u,{className:"w-4 h-4 text-primary/70"}),a.title]}),n&&e.jsx("div",{className:"mt-1 ml-2",children:a.sections.map(x=>e.jsx(Q,{section:x,selectedPath:r,onSelect:i},x.id))})]})}function h({onClick:a,icon:r,label:i,copied:t}){return e.jsxs(q,{size:"sm",variant:"ghost",onClick:a,className:w("rounded-none border border-secondary hover:bg-primary hover:text-black text-[10px] font-arcade h-auto py-2 px-3 transition-all",t&&"bg-green-500/20 border-green-500 text-green-500"),children:[e.jsx(r,{className:"w-3 h-3 mr-1"}),t?"COPIED!":i]})}function oe(){const a=R(),[r,i]=c.useState(null),[t,n]=c.useState(null);c.useEffect(()=>{const o=new URLSearchParams(a).get("path");o&&i(o)},[a]);const{data:l,isLoading:d,error:x}=f({queryKey:["sop-index"],queryFn:()=>y.sop.getIndex()}),{data:m,isLoading:C,error:k}=f({queryKey:["sop-file",r],queryFn:()=>r?y.sop.getFile(r):null,enabled:!!r}),S=c.useCallback(s=>{i(s);const o=`/tutor?path=${encodeURIComponent(s)}`;window.history.pushState({},"",o)},[]);c.useEffect(()=>{if(m?.content&&window.location.hash){const s=decodeURIComponent(window.location.hash.slice(1));setTimeout(()=>{const o=document.getElementById(s);o&&o.scrollIntoView({behavior:"smooth"})},100)}},[m?.content]);const E=c.useCallback(()=>{m?.content&&(navigator.clipboard.writeText(m.content),n("content"),setTimeout(()=>n(null),2e3))},[m?.content]),L=c.useCallback(()=>{if(r){const s=`${window.location.origin}/tutor?path=${encodeURIComponent(r)}`;navigator.clipboard.writeText(s),n("link"),setTimeout(()=>n(null),2e3)}},[r]),T=c.useCallback(()=>{if(r){const s=JSON.stringify({path:r,anchor:"",label:r.split("/").pop()?.replace(".md","")||r},null,2);navigator.clipboard.writeText(s),n("sopref"),setTimeout(()=>n(null),2e3)}},[r]),I=l?.default_group||"runtime",O=c.useMemo(()=>{if(!l||!r)return null;for(const s of l.groups)for(const o of s.sections){const p=o.items.find(F=>F.path===r);if(p)return p.title}return r.split("/").pop()},[l,r]);return e.jsx(P,{children:e.jsxs("div",{className:"h-[calc(100vh-140px)] flex flex-col md:flex-row gap-4",children:[e.jsx("aside",{className:"w-full md:w-80 shrink-0",children:e.jsxs(g,{className:"h-full bg-black/40 border-2 border-primary rounded-none flex flex-col",children:[e.jsx(U,{className:"border-b border-secondary p-3",children:e.jsxs(_,{className:"font-arcade text-sm flex items-center gap-2",children:[e.jsx(u,{className:"w-4 h-4"})," SOP EXPLORER"]})}),e.jsx(b,{className:"flex-1",children:e.jsx("div",{className:"p-2",children:d?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(j,{className:"w-6 h-6 animate-spin text-primary"})}):x?e.jsx("div",{className:"text-red-500 text-sm p-4 font-terminal",children:"Failed to load SOP index"}):l?l.groups.map(s=>e.jsx(W,{group:s,selectedPath:r,onSelect:S,defaultOpen:s.id===I},s.id)):null})})]})}),e.jsxs(g,{className:"flex-1 bg-black/60 border-2 border-primary rounded-none flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"border-b border-secondary p-3 flex items-center justify-between gap-2 bg-black/40",children:[e.jsx("div",{className:"font-arcade text-xs text-primary truncate",children:r?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(v,{className:"w-4 h-4"}),O||r]}):e.jsx("span",{className:"text-muted-foreground",children:"SELECT A FILE TO VIEW"})}),r&&e.jsxs("div",{className:"flex gap-2 shrink-0",children:[e.jsx(h,{onClick:E,icon:H,label:"CONTENT",copied:t==="content"}),e.jsx(h,{onClick:L,icon:G,label:"LINK",copied:t==="link"}),e.jsx(h,{onClick:T,icon:V,label:"SOPREF",copied:t==="sopref"})]})]}),e.jsx(b,{className:"flex-1",children:e.jsx("div",{className:"p-6",children:r?C?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(j,{className:"w-8 h-8 animate-spin text-primary"})}):k?e.jsxs("div",{className:"text-red-500 font-terminal",children:["Failed to load file: ",r]}):m?.content?e.jsx("article",{className:`prose prose-invert prose-primary max-w-none font-terminal text-sm leading-relaxed\r
                  prose-headings:font-arcade prose-headings:text-primary prose-headings:border-b prose-headings:border-secondary/50 prose-headings:pb-2\r
                  prose-h1:text-xl prose-h2:text-lg prose-h3:text-base\r
                  prose-a:text-cyan-400 prose-a:no-underline hover:prose-a:underline\r
                  prose-code:bg-secondary/30 prose-code:px-1 prose-code:py-0.5 prose-code:rounded prose-code:text-primary\r
                  prose-pre:bg-black/50 prose-pre:border prose-pre:border-secondary\r
                  prose-ul:list-disc prose-ol:list-decimal\r
                  prose-li:marker:text-primary\r
                  prose-blockquote:border-l-primary prose-blockquote:text-muted-foreground\r
                  prose-table:border-collapse prose-th:border prose-th:border-secondary prose-th:bg-secondary/20 prose-th:p-2\r
                  prose-td:border prose-td:border-secondary prose-td:p-2\r
                `,children:e.jsx(D,{remarkPlugins:[$],components:{h1:({children:s,...o})=>{const p=String(s).toLowerCase().replace(/\s+/g,"-").replace(/[^\w-]/g,"");return e.jsx("h1",{id:p,...o,children:s})},h2:({children:s,...o})=>{const p=String(s).toLowerCase().replace(/\s+/g,"-").replace(/[^\w-]/g,"");return e.jsx("h2",{id:p,...o,children:s})},h3:({children:s,...o})=>{const p=String(s).toLowerCase().replace(/\s+/g,"-").replace(/[^\w-]/g,"");return e.jsx("h3",{id:p,...o,children:s})},h4:({children:s,...o})=>{const p=String(s).toLowerCase().replace(/\s+/g,"-").replace(/[^\w-]/g,"");return e.jsx("h4",{id:p,...o,children:s})}},children:m.content})}):e.jsx("div",{className:"text-muted-foreground font-terminal",children:"No content available"}):e.jsxs("div",{className:"text-center py-12 font-terminal text-muted-foreground",children:[e.jsx(u,{className:"w-12 h-12 mx-auto mb-4 text-primary/50"}),e.jsx("p",{children:"SELECT A FILE FROM THE TREE"}),e.jsx("p",{className:"text-xs mt-2",children:"Browse your Study Operating Procedures"})]})})}),r&&e.jsx("div",{className:"border-t border-secondary p-2 bg-black/40",children:e.jsx("div",{className:"text-[10px] font-mono text-muted-foreground truncate",children:r})})]})]})})}export{oe as default};
