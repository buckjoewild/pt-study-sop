import{c as H,j as e,b as ke,r as n,d as ge,X as Se}from"./index-DF-Ci4pY.js";import{u as Z,p as _,S as ne,B as X,n as ye,o as Ce,m as we,L as _e}from"./layout-DTksDvAT.js";import{B as T,C as se}from"./badge-CHdU4YP4.js";import{I as v,T as g,a as Y,b as V,P as J,c as be,d as ce,S as de,M as $e,e as ie,f as Ee,g as Te,t as S}from"./MaterialUploader-D0Riy0Hb.js";import{C as re}from"./checkbox-C2pP7FBD.js";import{L as le}from"./loader-circle-b8bJQH5G.js";import{F as te}from"./file-text-GC7nl1lM.js";import{D as Ae,M as Le,r as Oe,F as De}from"./index-CCOpRHMl.js";import{L as Me}from"./link-CCFveJj-.js";import{Z as Pe}from"./zap-Bviqmd1G.js";import{C as Re}from"./index-ph0M9LG5.js";import{S as Fe}from"./send-BNkO-TRT.js";import{M as me}from"./message-square-tBF_zfhx.js";import{C as xe}from"./clock-C_AltzvL.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]],qe=H("cloud",Ie);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],ve=H("credit-card",Ue);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=[["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M17 20v2",key:"1rnc9c"}],["path",{d:"M17 2v2",key:"11trls"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M2 17h2",key:"7oei6x"}],["path",{d:"M2 7h2",key:"asdhe0"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"M20 17h2",key:"1fpfkl"}],["path",{d:"M20 7h2",key:"1o8tra"}],["path",{d:"M7 20v2",key:"4gnj0m"}],["path",{d:"M7 2v2",key:"1i4yhu"}],["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"8",y:"8",width:"8",height:"8",rx:"1",key:"z9xiuo"}]],Qe=H("cpu",Ke);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],ze=H("globe",Ge);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]],je=H("map",Xe);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],Ve=H("square",Be);function W({className:l,...a}){return e.jsx("div",{className:ke("animate-pulse rounded-md bg-primary/10",l),...a})}const Ye={pdf:"PDF",docx:"DOC",pptx:"PPT",md:"MD",txt:"TXT"};function He({courseId:l,selectedMaterials:a,setSelectedMaterials:k}){const{data:h=[],isLoading:d}=Z({queryKey:["tutor-materials",l],queryFn:()=>_.tutor.getMaterials(l?{course_id:l}:void 0)}),$=c=>{k(a.includes(c)?a.filter(D=>D!==c):[...a,c])},y=()=>{a.length===h.length?k([]):k(h.map(c=>c.id))};return d?e.jsx("div",{className:"flex items-center justify-center py-3",children:e.jsx(le,{className:`${v} animate-spin text-muted-foreground`})}):h.length===0?e.jsx("div",{className:`${g} text-center py-2`,children:"No materials uploaded yet"}):e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:`flex items-center gap-1.5 px-1 py-0.5 ${Y} text-muted-foreground hover:text-foreground cursor-pointer border-b border-muted-foreground/10 pb-1`,children:[e.jsx(re,{checked:h.length>0&&a.length===h.length,onCheckedChange:y,className:"w-3 h-3"}),e.jsx("span",{children:"Select all"}),e.jsxs(T,{variant:"outline",className:`ml-auto ${V} h-4 px-1`,children:[a.length,"/",h.length]})]}),h.map(c=>e.jsxs("label",{className:`flex items-center gap-1.5 px-1 py-0.5 ${Y} text-muted-foreground hover:text-foreground cursor-pointer`,children:[e.jsx(re,{checked:a.includes(c.id),onCheckedChange:()=>$(c.id),className:"w-3 h-3"}),e.jsx(te,{className:`${v} text-primary/60 shrink-0`}),e.jsx("span",{className:"truncate flex-1",children:c.title}),e.jsx(T,{variant:"outline",className:`${V} h-4 px-1 shrink-0`,children:Ye[c.file_type]||c.file_type.toUpperCase()})]},c.id))]})}const ee=[{value:"arcee-ai/trinity-large-preview:free",label:"Trinity Large (free)"},{value:"qwen/qwen3-coder-next",label:"Qwen3 Coder Next"},{value:"google/gemini-2.5-flash-lite",label:"Gemini 2.5 Flash Lite"}],We=["Teaching Sprint","Diagnostic Sprint"],ue={Core:"First Exposure (Core)",Sprint:"Review Sprint","Quick Sprint":"Quick Drill",Light:"Low Energy",Drill:"Mastery Review","Teaching Sprint":"First Exposure (Core)","Diagnostic Sprint":"Review Sprint"},pe="tutor.autopick_chain.v1",he="tutor.last_openrouter_model.v1",fe="tutor.last_codex_model.v1";function oe(l){try{return localStorage.getItem(l)}catch{return null}}function ae(l,a){try{localStorage.setItem(l,a)}catch{}}function Ze(l,a){const k=oe(l);return k===null?a:k==="true"}function B({children:l,icon:a}){return e.jsxs("div",{className:`${ie} flex items-center gap-1.5 pb-1 border-b border-primary/20 mb-2`,children:[a,l]})}function Je({courseId:l,setCourseId:a,selectedMaterials:k,setSelectedMaterials:h,mode:d,setMode:$,chainId:y,setChainId:c,topic:D,setTopic:j,model:x,setModel:u,webSearch:A,setWebSearch:U,onStartSession:L,isStarting:t,hasActiveSession:o}){const{data:f,isLoading:i,isError:N}=Z({queryKey:["tutor-content-sources"],queryFn:()=>_.tutor.getContentSources()}),{data:m=[],isLoading:F,isError:M}=Z({queryKey:["tutor-template-chains"],queryFn:()=>_.tutor.getTemplateChains()}),{data:I=[],isLoading:E}=Z({queryKey:["courses-active"],queryFn:()=>_.courses.getActive()}),O=f?.openrouter_enabled??!1,p=x.includes("/")?"openrouter":"codex";n.useEffect(()=>{!O&&p==="openrouter"&&u("codex")},[O,p,u]),n.useEffect(()=>{x&&(x.includes("/")?ae(he,x):ae(fe,x))},[x]);const[P,Q]=n.useState(()=>Ze(pe,!0)),[K,R]=n.useState(null);n.useEffect(()=>{ae(pe,String(P))},[P]);const G=ue[d],C=n.useMemo(()=>{if(G)return m.find(r=>r.name===G)},[m,G]);n.useEffect(()=>{P&&y===void 0&&C&&K!==d&&(c(C.id),R(d))},[P,y,C?.id,K,d,c]);const q=r=>{if($(r),!P||y!==void 0)return;const b=ue[r];if(!b)return;const z=m.find(Ne=>Ne.name===b);z&&(c(z.id),R(r))},w=()=>{const r=oe(fe),b=r&&!r.includes("/")?r:"codex";u(b)},s=()=>{if(!O)return;const r=oe(he),b=r&&r.includes("/")?r:ee[0].value;u(b)};return n.useEffect(()=>{p==="openrouter"&&(ee.some(r=>r.value===x)||u(ee[0].value))},[p,x,u]),e.jsxs("div",{className:"flex flex-col h-full overflow-hidden",children:[e.jsxs("div",{className:`shrink-0 ${J} pb-2 border-b-2 border-primary/30`,children:[e.jsx("div",{className:be,children:"CONTENT FILTER"}),(N||M)&&e.jsxs("div",{className:`${g} text-red-400`,children:["Tutor API unavailable. Start the dashboard via ",e.jsx("span",{className:"font-arcade",children:"Start_Dashboard.bat"}),"."]}),e.jsxs("div",{className:`flex items-center gap-2 mt-1 ${g}`,children:[e.jsx(Ae,{className:v}),f?.total_materials??0," materials",e.jsx("span",{className:"text-muted-foreground/40",children:"|"}),f?.total_instructions??0," SOP"]})]}),e.jsx(ne,{className:"flex-1 min-h-0",children:e.jsxs("div",{className:`${J} space-y-2`,children:[e.jsxs("div",{children:[e.jsx(B,{children:"Mode"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[e.jsxs("button",{onClick:()=>q("Core"),className:`text-left px-2 py-2 border-2 transition-colors ${d==="Core"?"border-primary bg-primary/20 text-primary":"border-primary/30 text-foreground/80 hover:border-primary/50 hover:text-foreground hover:bg-black/30"}`,children:[e.jsx("div",{className:"font-arcade text-xs leading-tight truncate",children:"LEARN"}),e.jsx("div",{className:`${g} text-xs leading-tight truncate`,children:"Prime + encode"})]}),e.jsxs("button",{onClick:()=>q("Quick Sprint"),className:`text-left px-2 py-2 border-2 transition-colors ${d==="Quick Sprint"?"border-primary bg-primary/20 text-primary":"border-primary/30 text-foreground/80 hover:border-primary/50 hover:text-foreground hover:bg-black/30"}`,children:[e.jsx("div",{className:"font-arcade text-xs leading-tight truncate",children:"QUICK"}),e.jsx("div",{className:`${g} text-xs leading-tight truncate`,children:"Quick retrieval"})]})]}),e.jsx("button",{onClick:()=>q("Drill"),className:`w-full text-left px-2 py-2 border-2 transition-colors ${d==="Drill"?"border-primary bg-primary/20 text-primary":"border-primary/30 text-foreground/80 hover:border-primary/50 hover:text-foreground hover:bg-black/30"}`,children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-arcade text-xs leading-tight",children:"FIX"}),e.jsx("div",{className:`${g} text-xs leading-tight`,children:"Target weak spots"})]})})}),e.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[e.jsxs("button",{onClick:()=>q("Sprint"),className:`text-left px-2 py-2 border-2 transition-colors ${d==="Sprint"?"border-primary bg-primary/20 text-primary":"border-primary/30 text-foreground/80 hover:border-primary/50 hover:text-foreground hover:bg-black/30"}`,children:[e.jsx("div",{className:"font-arcade text-xs leading-tight truncate",children:"REVIEW"}),e.jsx("div",{className:`${g} text-xs leading-tight truncate`,children:"Retrieve + refine"})]}),e.jsxs("button",{onClick:()=>q("Light"),className:`text-left px-2 py-2 border-2 transition-colors ${d==="Light"?"border-primary bg-primary/20 text-primary":"border-primary/30 text-foreground/80 hover:border-primary/50 hover:text-foreground hover:bg-black/30"}`,children:[e.jsx("div",{className:"font-arcade text-xs leading-tight truncate",children:"LIGHT"}),e.jsx("div",{className:`${g} text-xs leading-tight truncate`,children:"Low energy"})]})]})]}),e.jsx("div",{className:`${g} text-xs mt-2`,children:"Auto-picks a chain template. Override below."}),We.includes(d)&&e.jsxs("div",{className:`${g} text-xs mt-1`,children:["Legacy mode active: ",d]})]}),e.jsxs("div",{children:[e.jsx(B,{icon:e.jsx(Me,{className:v}),children:"Chain"}),e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[e.jsxs("div",{className:`${g} text-xs min-w-0 truncate`,children:[e.jsx("span",{className:"opacity-70",children:"Rec:"})," ",C?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-foreground font-medium",children:C.name}),e.jsxs(T,{variant:"outline",className:`ml-1 ${V} h-4 px-1.5 text-xs`,children:[C.blocks.length," blocks"]})]}):F?e.jsx(W,{className:"inline-block w-20 h-4 bg-primary/10"}):e.jsx("span",{className:"opacity-70",children:"—"})]}),C&&y!==C.id&&e.jsx(X,{size:"sm",onClick:()=>c(C.id),className:"rounded-none h-6 px-2 font-arcade text-[10px] bg-primary text-primary-foreground hover:bg-primary/90 border border-primary",children:"APPLY"})]}),e.jsxs("label",{className:`flex items-center gap-2 ${Y} text-muted-foreground mb-2 cursor-pointer`,children:[e.jsx(re,{checked:P,onCheckedChange:r=>Q(r===!0),className:"w-3 h-3"}),e.jsx("span",{className:"select-none text-xs",children:"Auto-pick recommended chain"})]}),e.jsx(ne,{className:"h-40 border-2 border-primary/30 bg-black/20",children:e.jsxs("div",{className:"p-1 space-y-1",children:[e.jsx("button",{onClick:()=>{c(void 0),R(d)},className:`w-full text-left px-3 py-2 border-2 transition-all ${y?"border-primary/20 text-foreground/80 hover:border-primary/40 hover:text-foreground hover:bg-black/30":"border-primary bg-primary/20 text-primary"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-arcade text-xs",children:"FREEFORM"}),e.jsx("div",{className:`${g} text-xs`,children:"No template"})]}),!y&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary"})]})}),F?e.jsxs("div",{className:"space-y-2 p-2",children:[e.jsx(W,{className:"w-full h-10 bg-primary/10"}),e.jsx(W,{className:"w-full h-10 bg-primary/10"}),e.jsx(W,{className:"w-full h-10 bg-primary/10"})]}):m.map(r=>e.jsx("button",{onClick:()=>c(r.id),className:`w-full text-left px-3 py-2 border-2 transition-all ${y===r.id?"border-primary bg-primary/20 text-primary":"border-primary/20 text-foreground/80 hover:border-primary/40 hover:text-foreground hover:bg-black/30"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"font-arcade text-xs truncate",children:r.name.toUpperCase()}),e.jsxs("div",{className:`${g} text-xs`,children:[r.blocks.length," blocks"]})]}),y===r.id&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary ml-2"})]})},r.id))]})})]}),e.jsxs("div",{children:[e.jsx(B,{children:"Topic"}),e.jsx("input",{value:D,onChange:r=>j(r.target.value),placeholder:"e.g. Hip Flexors",className:`${ce} border-2 border-primary/30`})]}),e.jsxs("div",{children:[e.jsx(B,{children:"Model"}),e.jsxs("div",{className:"space-y-1 mb-2",children:[e.jsx("button",{onClick:w,className:`w-full text-left px-3 py-2 border-2 transition-colors ${p==="codex"?"border-primary bg-primary/20 text-primary":"border-primary/30 text-foreground/80 hover:border-primary/50 hover:text-foreground hover:bg-black/30"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qe,{className:v}),e.jsxs("div",{children:[e.jsx("div",{className:"font-arcade text-xs leading-tight",children:"CODEX"}),e.jsx("div",{className:`${g} text-xs leading-tight`,children:"ChatGPT login"})]})]}),p==="codex"&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary"})]})}),e.jsx("button",{onClick:s,disabled:!O,className:`w-full text-left px-3 py-2 border-2 transition-colors ${p==="openrouter"?"border-primary bg-primary/20 text-primary":"border-primary/30 text-foreground/80 hover:border-primary/50 hover:text-foreground hover:bg-black/30"} ${O?"":"opacity-50 cursor-not-allowed"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qe,{className:v}),e.jsxs("div",{children:[e.jsx("div",{className:"font-arcade text-xs leading-tight",children:"OPENROUTER"}),e.jsx("div",{className:`${g} text-xs leading-tight`,children:O?"API key enabled":"API key missing"})]})]}),p==="openrouter"&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary"})]})})]}),p==="openrouter"?e.jsx("select",{value:x,onChange:r=>u(r.target.value),className:`${de} border-2 border-primary/30`,children:ee.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))}):e.jsx("input",{value:x==="codex"?"":x,onChange:r=>u(r.target.value.trim()?r.target.value:"codex"),placeholder:"Codex model override (optional)",className:`${ce} border-2 border-primary/30`})]}),e.jsxs("label",{className:`flex items-center gap-2 cursor-pointer ${p!=="codex"?"opacity-50":""}`,children:[e.jsx(re,{checked:A,onCheckedChange:r=>p==="codex"&&U(!!r),disabled:p!=="codex"}),e.jsx(ze,{className:v}),e.jsx("span",{className:`${Y} text-xs`,children:"Web search"}),p!=="codex"&&e.jsx("span",{className:"text-[10px] text-muted-foreground",children:"(Codex only)"})]}),e.jsxs("div",{children:[e.jsx(B,{children:"Course"}),E?e.jsx(W,{className:"w-full h-10 bg-primary/10"}):e.jsxs("select",{value:l??"",onChange:r=>a(r.target.value?Number(r.target.value):void 0),className:`${de} border-2 border-primary/30`,children:[e.jsx("option",{value:"",children:"All courses"}),I.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]}),e.jsxs("div",{children:[e.jsx(B,{icon:e.jsx(te,{className:v}),children:"Materials"}),e.jsx(He,{courseId:l,selectedMaterials:k,setSelectedMaterials:h})]}),e.jsxs("div",{className:"border-t border-primary/10 pt-2",children:[e.jsx(B,{children:"Upload"}),e.jsx($e,{courseId:l})]})]})}),e.jsx("div",{className:`shrink-0 ${J} pt-2 border-t-2 border-primary/30`,children:e.jsxs(X,{onClick:L,disabled:t||o,className:`w-full rounded-none border-2 font-arcade text-xs h-9 ${o?"border-green-500/50 bg-green-500/10 text-green-400 cursor-default":t?"border-primary/50 bg-primary/10 text-primary cursor-wait":"border-primary bg-primary/10 hover:bg-primary/20"}`,children:[t?e.jsx(le,{className:`${v} animate-spin mr-1`}):o?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-green-400 animate-pulse"}),"SESSION ACTIVE"]}):e.jsx(Pe,{className:`${v} mr-1`}),!t&&!o&&"START SESSION"]})})]})}function er({sessionId:l,onArtifactCreated:a,onSessionEnd:k,chainBlocks:h=[],currentBlockIndex:d=0,onAdvanceBlock:$}){const y=h.length>0,c=y&&d>=h.length,[D,j]=n.useState([]),[x,u]=n.useState(""),[A,U]=n.useState(!1),L=n.useRef(null),t=n.useRef(null);n.useEffect(()=>{L.current&&(L.current.scrollTop=L.current.scrollHeight)},[D]),n.useEffect(()=>{t.current?.focus()},[l]);const o=n.useCallback(async()=>{if(!x.trim()||!l||A)return;const i=x.trim();u("");const N=/^\/(note|save)\b/i.test(i),m=/^\/(card|flashcard)\b/i.test(i),F=/^\/(map|diagram)\b/i.test(i);j(M=>[...M,{role:"user",content:i}]),j(M=>[...M,{role:"assistant",content:"",isStreaming:!0}]),U(!0);try{const I=(await fetch(`/api/tutor/session/${l}/turn`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:i})})).body?.getReader(),E=new TextDecoder;if(!I)throw new Error("No response body");let O="",p="",P=[],Q;for(;;){const{done:K,value:R}=await I.read();if(K)break;O+=E.decode(R,{stream:!0});const G=O.split(`
`);O=G.pop()??"";for(const C of G){if(!C.startsWith("data: "))continue;const q=C.slice(6);if(q==="[DONE]")break;try{const w=JSON.parse(q);if(w.type==="error"){j(s=>{const r=[...s];return r[r.length-1]={role:"assistant",content:`Error: ${w.content}`},r}),U(!1);return}w.type==="web_search_searching"&&j(s=>{const r=[...s];return r[r.length-1]={...r[r.length-1],content:`Searching the web...

`,isStreaming:!0},r}),w.type==="web_search_completed"&&(p="",j(s=>{const r=[...s];return r[r.length-1]={...r[r.length-1],content:"",isStreaming:!0},r})),w.type==="token"&&w.content&&(p+=w.content,j(s=>{const r=[...s],b=r[r.length-1];return r[r.length-1]={...b,content:b.content+w.content,isStreaming:!0},r})),w.type==="done"&&(P=w.citations??[],Q=w.model)}catch{}}}j(K=>{const R=[...K];return R[R.length-1]={role:"assistant",content:p,citations:P,model:Q,isStreaming:!1},R}),(N||m||F)&&a({type:N?"note":m?"card":"map",content:p,title:i.replace(/^\/(note|card|flashcard|map|diagram|save)\s*/i,"").trim()})}catch(M){j(I=>{const E=[...I];return E[E.length-1]={role:"assistant",content:`Connection error: ${M instanceof Error?M.message:"Unknown"}`},E})}finally{U(!1)}},[x,l,A,a]),f=i=>{i.key==="Enter"&&!i.shiftKey&&(i.preventDefault(),o())};return l?e.jsxs("div",{className:"flex flex-col h-full",children:[y&&e.jsxs("div",{className:"shrink-0 px-3 py-2 border-b-2 border-primary/30 bg-black/40",children:[e.jsxs("div",{className:"flex items-center gap-1 overflow-x-auto",children:[h.map((i,N)=>{const m=N<d,F=N===d&&!c;return e.jsxs("div",{className:"flex items-center shrink-0",children:[N>0&&e.jsx(Re,{className:"w-4 h-4 text-muted-foreground/40 mx-0.5"}),e.jsxs("div",{className:`px-2 py-1 border-2 text-base font-terminal flex items-center gap-1 ${F?"border-primary bg-primary/20 text-primary":m?"border-primary/30 bg-primary/5 text-muted-foreground/70 line-through":"border-primary/20 text-muted-foreground/50"}`,children:[m&&e.jsx(ye,{className:"w-4 h-4"}),i.name]})]},i.id)}),!c&&$&&e.jsx("button",{onClick:$,className:"shrink-0 ml-2 px-3 py-1 border-2 border-primary/60 text-xs font-arcade text-primary hover:bg-primary/20 transition-colors",children:"NEXT"}),c&&e.jsx("span",{className:"shrink-0 ml-2 px-3 py-1 text-xs font-arcade text-green-400 border-2 border-green-400/50",children:"COMPLETE"})]}),!c&&h[d]&&e.jsxs("div",{className:"mt-1 text-base font-terminal text-muted-foreground",children:[e.jsx("span",{className:"text-primary",children:h[d].category.toUpperCase()})," ","· ~",h[d].duration,"min"]})]}),e.jsxs("div",{ref:L,className:"flex-1 overflow-y-auto p-3 space-y-3",children:[D.length===0&&e.jsxs("div",{className:"text-center py-8 space-y-2",children:[e.jsx("div",{className:"font-arcade text-sm text-primary",children:"SESSION STARTED"}),e.jsx("div",{className:"font-terminal text-lg text-muted-foreground",children:"Ask a question to begin learning. Use /note, /card, or /map for artifacts."})]}),D.map((i,N)=>e.jsx("div",{className:`flex ${i.role==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[85%] px-3 py-2 text-lg font-terminal ${i.role==="user"?"bg-primary/20 border-2 border-primary/50 text-foreground":"bg-black/40 border-2 border-primary/20 text-foreground"}`,children:[i.role==="assistant"?e.jsxs("div",{className:"prose prose-invert prose-lg max-w-none font-terminal [&_p]:my-2 [&_li]:my-1 [&_code]:text-base [&_pre]:text-base",children:[e.jsx(Le,{remarkPlugins:[Oe],children:i.content||(i.isStreaming?"...":"")}),i.isStreaming&&e.jsx("span",{className:"inline-block w-2 h-3 bg-primary animate-pulse ml-0.5"})]}):e.jsx("div",{children:i.content}),(i.citations?.length||i.model)&&!i.isStreaming?e.jsxs("div",{className:"flex flex-wrap items-center gap-1 mt-2 pt-2 border-t border-primary/20",children:[i.citations?.map(m=>m.url?e.jsx("a",{href:m.url,target:"_blank",rel:"noopener noreferrer",children:e.jsxs(T,{variant:"outline",className:"text-sm rounded-none cursor-pointer hover:bg-primary/10",children:["[",m.index,"] ",m.source]})},m.index):e.jsxs(T,{variant:"outline",className:"text-sm rounded-none",children:["[",m.index,"] ",m.source]},m.index)),i.model&&e.jsx(T,{variant:"outline",className:"text-sm rounded-none text-muted-foreground/60 ml-auto",children:i.model})]}):null]})},N))]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 border-t border-primary/20",children:[e.jsx("span",{className:"text-base font-terminal text-muted-foreground/60",children:"Commands:"}),e.jsxs(T,{variant:"outline",className:"text-sm rounded-none cursor-pointer hover:bg-primary/10",onClick:()=>u("/note "),children:[e.jsx(te,{className:"w-4 h-4 mr-1"}),"/note"]}),e.jsxs(T,{variant:"outline",className:"text-sm rounded-none cursor-pointer hover:bg-primary/10",onClick:()=>u("/card "),children:[e.jsx(ve,{className:"w-4 h-4 mr-1"}),"/card"]}),e.jsxs(T,{variant:"outline",className:"text-sm rounded-none cursor-pointer hover:bg-primary/10",onClick:()=>u("/map "),children:[e.jsx(je,{className:"w-4 h-4 mr-1"}),"/map"]}),e.jsx("div",{className:"flex-1"}),e.jsxs(X,{variant:"ghost",size:"sm",onClick:k,className:"text-sm font-terminal text-destructive hover:text-destructive h-8 px-3",children:[e.jsx(Ve,{className:"w-4 h-4 mr-1"}),"END"]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-3 border-t-2 border-primary/20",children:[e.jsx("input",{ref:t,value:x,onChange:i=>u(i.target.value),onKeyDown:f,placeholder:"Ask a question...",disabled:A,className:"flex-1 bg-black/60 border-2 border-primary/40 rounded-none px-3 py-2 text-lg font-terminal text-foreground placeholder:text-muted-foreground/50 focus:border-primary focus:outline-none disabled:opacity-50"}),e.jsx(X,{onClick:o,disabled:!x.trim()||A,className:"rounded-none border-2 border-primary h-11 w-11 p-0",children:A?e.jsx(le,{className:"w-5 h-5 animate-spin"}):e.jsx(Fe,{className:"w-5 h-5"})})]})]}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("div",{className:"font-arcade text-sm text-muted-foreground",children:"NO ACTIVE SESSION"}),e.jsx("div",{className:"font-terminal text-lg text-muted-foreground/70",children:"Configure content filter and start a session"})]})})}const rr={note:te,card:ve,map:je},tr={note:"text-blue-400",card:"text-yellow-400",map:"text-green-400"};function sr({sessionId:l,artifacts:a,turnCount:k,mode:h,topic:d,startedAt:$,recentSessions:y,onResumeSession:c}){const D=ge(),[j,x]=n.useState(null),[u,A]=n.useState(null),U=async t=>{try{await _.tutor.deleteSession(t),S.success("Session deleted"),D.invalidateQueries({queryKey:["tutor-sessions"]}),x(null)}catch(o){S.error(`Delete failed: ${o instanceof Error?o.message:"Unknown"}`)}},L=async t=>{A(t.session_id);try{const o=await _.tutor.getSession(t.session_id);if(!o.turns||o.turns.length===0){S.error("No turns to save");return}const f=[`# Tutor: ${t.topic||t.mode}`,`**Date:** ${new Date(t.started_at).toLocaleDateString()}`,`**Mode:** ${t.mode} | **Turns:** ${t.turn_count}`,"","---",""];for(const m of o.turns)f.push(`## Q${m.turn_number}`),f.push(m.question),f.push(""),m.answer&&(f.push("**Answer:**"),f.push(m.answer),f.push(""));const N=`Study Sessions/${`Tutor - ${(t.topic||t.mode).replace(/[^a-zA-Z0-9 ]/g,"").trim()}`}.md`;await _.obsidian.append(N,f.join(`
`)),S.success(`Saved to Obsidian: ${N}`)}catch(o){S.error(`Save failed: ${o instanceof Error?o.message:"Unknown"}`)}finally{A(null)}};return e.jsxs("div",{className:"flex flex-col h-full overflow-hidden",children:[e.jsx("div",{className:`shrink-0 ${J} pb-2 border-b-2 border-secondary/30`,children:e.jsx("div",{className:be,children:"ARTIFACTS"})}),e.jsx(ne,{className:"flex-1 min-h-0",children:e.jsxs("div",{className:`${J} space-y-3`,children:[l?e.jsxs("div",{className:"space-y-2 pb-3 border-b border-muted-foreground/20",children:[e.jsxs("div",{className:"flex items-center gap-1.5 flex-wrap",children:[e.jsx(T,{variant:"outline",className:`${V} h-5 px-1.5`,children:h}),e.jsx(T,{variant:"outline",className:`${V} h-5 px-1.5 text-primary`,children:"FIRST PASS"})]}),d&&e.jsx("div",{className:`${Y} text-sm`,children:d}),e.jsxs("div",{className:`flex items-center gap-3 ${g}`,children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(me,{className:v}),k," turns"]}),$&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(xe,{className:v}),new Date($).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})]}):e.jsx("div",{className:`${Y} text-muted-foreground/50 py-3 text-center`,children:"No active session"}),a.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:ie,children:"Artifacts"}),a.map((t,o)=>{const f=rr[t.type],i=tr[t.type];return e.jsxs("div",{className:"border-2 border-muted-foreground/20 p-2.5 hover:border-primary/30 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(f,{className:`${Ee} ${i}`}),e.jsx("span",{className:`${Y} text-sm truncate flex-1`,children:t.title||`${t.type} #${o+1}`})]}),t.content&&e.jsx("div",{className:`${g} mt-1 line-clamp-2`,children:t.content.slice(0,100)})]},o)})]}),l&&a.length===0&&e.jsxs("div",{className:"text-center space-y-1 py-4",children:[e.jsx(Ce,{className:`${Te} text-muted-foreground/30 mx-auto`}),e.jsx("div",{className:`${g} text-muted-foreground/50`,children:"No artifacts yet"}),e.jsx("div",{className:`${g} text-muted-foreground/30`,children:"Use /note, /card, or /map"})]}),y.length>0&&e.jsxs("div",{className:"space-y-2 pt-2 border-t border-muted-foreground/20",children:[e.jsx("div",{className:ie,children:"Recent Sessions"}),y.slice(0,8).map(t=>e.jsxs("div",{className:"border-2 border-muted-foreground/10 hover:border-muted-foreground/30 transition-colors",children:[e.jsxs("button",{onClick:()=>c(t.session_id),className:"w-full text-left px-3 py-2.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{variant:"outline",className:`${V} h-5 px-1.5 shrink-0 ${t.status==="active"?"text-green-400 border-green-400/50":"text-muted-foreground"}`,children:t.status==="active"?"LIVE":"DONE"}),e.jsx("span",{className:"font-terminal text-sm truncate flex-1",children:t.topic||t.mode})]}),e.jsxs("div",{className:`flex items-center gap-2 mt-1.5 ${g}`,children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(me,{className:v}),t.turn_count]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(xe,{className:v}),new Date(t.started_at).toLocaleDateString()]}),e.jsx(T,{variant:"outline",className:`${V} h-4 px-1 ml-auto`,children:t.mode})]})]}),e.jsxs("div",{className:"flex items-center border-t border-primary/20 px-2 py-1",children:[e.jsxs(X,{variant:"ghost",size:"sm",className:"h-8 px-3 rounded-none text-muted-foreground hover:text-primary font-terminal text-sm",disabled:u===t.session_id,onClick:o=>{o.stopPropagation(),L(t)},children:[e.jsx(De,{className:`${v} mr-1`}),u===t.session_id?"SAVING...":"SAVE"]}),e.jsx("div",{className:"ml-auto",children:j===t.session_id?e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx("span",{className:"font-terminal text-sm text-red-400 mr-1",children:"Delete?"}),e.jsx(X,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 rounded-none text-red-400 hover:text-red-300 hover:bg-red-400/10",onClick:o=>{o.stopPropagation(),U(t.session_id)},children:e.jsx(ye,{className:v})}),e.jsx(X,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 rounded-none text-muted-foreground hover:text-foreground",onClick:o=>{o.stopPropagation(),x(null)},children:e.jsx(Se,{className:v})})]}):e.jsx(X,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 rounded-none text-muted-foreground hover:text-red-400",onClick:o=>{o.stopPropagation(),x(t.session_id)},children:e.jsx(we,{className:v})})})]})]},t.session_id))]})]})})]})}function yr(){const l=ge(),[a,k]=n.useState(null),[h,d]=n.useState(!1),[$,y]=n.useState(),[c,D]=n.useState([]),[j,x]=n.useState("Core"),[u,A]=n.useState(),[U,L]=n.useState(0),[t,o]=n.useState([]),[f,i]=n.useState(""),[N,m]=n.useState("codex"),[F,M]=n.useState(!1),[I,E]=n.useState([]),[O,p]=n.useState(0),[P,Q]=n.useState(null),{data:K=[]}=Z({queryKey:["tutor-sessions"],queryFn:()=>_.tutor.listSessions({limit:10})}),R=n.useCallback(async()=>{d(!0);try{const s=await _.tutor.createSession({course_id:$,phase:"first_pass",mode:j,topic:f||void 0,content_filter:{...c.length>0?{material_ids:c}:{},model:N,...F?{web_search:!0}:{}},method_chain_id:u});if(k(s.session_id),Q(s.started_at),E([]),p(0),L(s.current_block_index??0),u){const r=await _.tutor.getSession(s.session_id);r.chain_blocks&&o(r.chain_blocks.map(b=>({id:b.id,name:b.name,category:b.category,duration:b.default_duration_min})))}else o([]);S.success("Tutor session started"),l.invalidateQueries({queryKey:["tutor-sessions"]})}catch(s){S.error(`Failed to start session: ${s instanceof Error?s.message:"Unknown"}`)}finally{d(!1)}},[$,j,f,c,N,F,u,l]),G=n.useCallback(async()=>{if(a)try{await _.tutor.endSession(a),S.success("Session ended"),k(null),E([]),p(0),Q(null),L(0),o([]),l.invalidateQueries({queryKey:["tutor-sessions"]})}catch(s){S.error(`Failed to end session: ${s instanceof Error?s.message:"Unknown"}`)}},[a,l]),C=n.useCallback(async s=>{if(a)try{const r=await _.tutor.createArtifact(a,{type:s.type,content:s.content,title:s.title}),b={type:s.type,title:s.title||`${s.type} #${I.length+1}`,content:s.content.slice(0,200),createdAt:new Date().toISOString(),cardId:r.card_id};E(z=>[...z,b]),S.success(`${s.type.charAt(0).toUpperCase()+s.type.slice(1)} created`)}catch(r){S.error(`Failed to create artifact: ${r instanceof Error?r.message:"Unknown"}`)}},[a,I.length]),q=n.useCallback(async()=>{if(a)try{const s=await _.tutor.advanceBlock(a);L(s.block_index),s.complete?S.success("Chain complete!"):S.success(`Advanced to: ${s.block_name}`)}catch(s){S.error(`Failed to advance block: ${s instanceof Error?s.message:"Unknown"}`)}},[a]),w=n.useCallback(async s=>{try{const r=await _.tutor.getSession(s);if(k(r.session_id),p(r.turn_count),Q(r.started_at),x(r.mode),i(r.topic||""),y(r.course_id??void 0),r.artifacts_json)try{const b=JSON.parse(r.artifacts_json);Array.isArray(b)&&E(b.map(z=>({type:z.type,title:z.title,content:"",createdAt:z.created_at})))}catch{E([])}S.success("Session resumed")}catch(r){S.error(`Failed to resume session: ${r instanceof Error?r.message:"Unknown"}`)}},[]);return e.jsx(_e,{children:e.jsxs("div",{className:"h-[calc(100vh-140px)] flex gap-2",children:[e.jsx(se,{className:"w-72 shrink-0 bg-black/40 border-2 border-primary rounded-none overflow-hidden",children:e.jsx(Je,{courseId:$,setCourseId:y,selectedMaterials:c,setSelectedMaterials:D,mode:j,setMode:x,chainId:u,setChainId:A,topic:f,setTopic:i,model:N,setModel:m,webSearch:F,setWebSearch:M,onStartSession:R,isStarting:h,hasActiveSession:!!a})}),e.jsx(se,{className:"flex-1 bg-black/60 border-2 border-primary rounded-none flex flex-col min-w-0",children:e.jsx(er,{sessionId:a,onArtifactCreated:C,onSessionEnd:G,chainBlocks:t,currentBlockIndex:U,onAdvanceBlock:q})}),e.jsx(se,{className:"w-72 shrink-0 bg-black/40 border-2 border-primary/40 rounded-none overflow-y-auto",children:e.jsx(sr,{sessionId:a,artifacts:I,turnCount:O,mode:j,topic:f,startedAt:P,onCreateArtifact:C,recentSessions:K,onResumeSession:w})})]})})}export{yr as default};
