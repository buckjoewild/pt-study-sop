<!DOCTYPE html>
<!-- PT Study Brain Dashboard v2.0 - Updated: 2026-01-09 - Professional UI -->
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="color-scheme" content="dark" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>PT Study Brain v2.0.2</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/static/css/dashboard.css?v=3.0">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <script src="/static/js/dashboard.js?v=2.8" defer></script>
</head>

<body>
  <!-- Navigation -->
  <nav class="navbar">
    <a href="#overview" class="logo" style="display: flex; align-items: center;">
      <img src="/static/images/logo-brain.png" alt="PT Study Brain" style="height: 44px; width: auto;">
    </a>

    <!-- Tabs in Navbar -->
    <div class="nav-links">
      <button class="tab-button active" onclick="openTab(event, 'overview')" data-tab="overview" type="button">Overview</button>
      <button class="tab-button" onclick="openTab(event, 'sessions')" data-tab="sessions" type="button">Brain</button>
      <button class="tab-button" onclick="openTab(event, 'syllabus')" data-tab="syllabus" type="button">Syllabus</button>
      <button class="tab-button" onclick="openTab(event, 'scholar')" data-tab="scholar" type="button">Scholar</button>
      <button class="tab-button" onclick="openTab(event, 'tutor')" data-tab="tutor" type="button">Tutor</button>
      <button class="tab-button" onclick="openTab(event, 'brain')" data-tab="brain" type="button">Database</button>
    </div>

    <div class="profile-section">
      <button class="profile-btn">
        <div class="avatar">TT</div>
        <span style="font-size: 14px; font-weight: 500;">Profile</span>
          <span style="font-size: 12px; color: var(--text-muted);">v</span>
      </button>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="main">
    
    <!-- Overview Tab -->
    <section id="tab-overview" class="tab-panel active">
      <style>
        #overview-wrapper {
          /* Force Dark Theme & Font locally */
          --bg-deep: #0A0E17;
          --card-bg: rgba(30, 35, 45, 0.6);
          --border-color: rgba(255, 255, 255, 0.1);
          --text-main: #f1f5f9;
          --text-muted: #94a3b8;
          --accent-primary: #0EA5E9;
          --accent-teal: #14B8A6;
          
          /* Medical blue/teal gradient for Glassmorphism */
          background: radial-gradient(circle at 15% 50%, rgba(14, 165, 233, 0.12), transparent 25%),
                      radial-gradient(circle at 85% 30%, rgba(20, 184, 166, 0.10), transparent 25%),
                      var(--bg-deep);
          
          color: var(--text-main);
          font-family: system-ui, -apple-system, sans-serif;
          padding: 32px;
          border-radius: 12px;
          box-sizing: border-box;
        }

        #overview-wrapper * { box-sizing: border-box; }

        /* Grid System */
        .dashboard-grid {
          display: grid;
          grid-template-columns: repeat(4, 1fr); /* Force 4 columns */
          gap: 24px;
          margin-top: 24px;
        }

        /* Cards */
        .d-card {
          background: var(--card-bg);
          border: 1px solid var(--border-color);
          border-radius: 16px;
          padding: 20px;
          backdrop-filter: blur(12px); /* The Glass Blur */
          -webkit-backdrop-filter: blur(12px);
          box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
        }

        /* Mini Stats */
        .d-card.mini {
          grid-column: span 1;
          display: flex;
          align-items: center;
          gap: 16px;
          transition: transform 0.2s;
        }
        .d-card.mini:hover {
          transform: translateY(-4px);
          border-color: var(--accent-primary);
          box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3), 0 0 20px rgba(14, 165, 233, 0.2);
        }

        /* Spanning Cards */
        .d-card.hero { grid-column: span 4; min-height: 250px; }
        .d-card.upload { grid-column: span 4; cursor: pointer; border-style: dashed; }

        /* Icons */
        .d-icon {
          width: 48px; height: 48px;
          background: rgba(255,255,255,0.05);
          border-radius: 12px;
          display: flex; align-items: center; justify-content: center;
          flex-shrink: 0;
        }
        .d-icon svg { width: 24px; height: 24px; stroke: var(--text-main); }

        /* Chart Container (Prevent Explosion) */
        .chart-box { height: 120px; width: 120px; position: relative; }

        /* Responsive */
        @media (max-width: 1024px) {
          .dashboard-grid { grid-template-columns: 1fr 1fr; }
          .d-card.hero, .d-card.upload { grid-column: span 2; }
        }
        @media (max-width: 600px) {
          .dashboard-grid { display: flex; flex-direction: column; }
        }
      </style>

      <div id="overview-wrapper">
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <h2 style="margin:0;">Dashboard Overview</h2>
          <span style="font-size:0.85rem; color:#94a3b8;">Welcome back</span>
        </div>

        <div class="dashboard-grid">
          
          <div class="d-card mini">
            <div class="d-icon" style="color:#0EA5E9;">
              <svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            </div>
            <div>
              <div style="font-size:1.5rem; font-weight:700;" id="total-sessions">0</div>
              <div style="font-size:0.85rem; color:#94a3b8;">Total Sessions</div>
            </div>
          </div>

          <div class="d-card mini">
            <div class="d-icon" style="color:#14B8A6;">
              <svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
            </div>
            <div>
              <div style="font-size:1.5rem; font-weight:700;" id="total-time">0h</div>
              <div style="font-size:0.85rem; color:#94a3b8;">Study Time</div>
            </div>
          </div>

          <div class="d-card mini">
            <div class="d-icon" style="color:#10b981;">
              <svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
            </div>
            <div>
              <div style="font-size:1.5rem; font-weight:700;" id="avg-score">-%</div>
              <div style="font-size:0.85rem; color:#94a3b8;">Avg. Score</div>
            </div>
          </div>

          <div class="d-card mini">
            <div class="d-icon" style="color:#f59e0b;">
              <svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>
            </div>
            <div>
              <div style="font-size:1.5rem; font-weight:700;" id="anki-cards">0</div>
              <div style="font-size:0.85rem; color:#94a3b8;">Cards Due</div>
            </div>
          </div>

          <!-- Scholar Insights Panel -->
          <div class="d-card" id="scholar-insights-card" style="grid-column: span 4; display: none;">
            <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:10px; margin-bottom:16px;">
              <h3 style="margin:0; font-size:1.1rem;">üìö Scholar Insights</h3>
              <button class="btn" style="font-size: 0.75rem; padding: 4px 10px;" onclick="openTab(null, 'scholar')">View All ‚Üí</button>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
              <!-- Alerts Section -->
              <div id="scholar-alerts-section">
                <h4 style="font-size:0.75rem; text-transform:uppercase; color:#94a3b8; margin-bottom:10px;">Alerts</h4>
                <div id="scholar-alerts-list" style="font-size:0.9rem;">
                  <div style="color:#64748b;">No alerts</div>
                </div>
              </div>
              
              <!-- Proposals Section -->
              <div>
                <h4 style="font-size:0.75rem; text-transform:uppercase; color:#94a3b8; margin-bottom:10px;">Pending Proposals</h4>
                <div id="scholar-proposals-count" style="font-size:0.9rem; cursor: pointer;" onclick="openTab(null, 'scholar')">
                  <span style="color:#64748b;">0 proposals</span>
                </div>
              </div>
              
              <!-- Questions Section -->
              <div>
                <h4 style="font-size:0.75rem; text-transform:uppercase; color:#94a3b8; margin-bottom:10px;">Pending Questions</h4>
                <div id="scholar-questions-count" style="font-size:0.9rem; cursor: pointer;" onclick="openTab(null, 'scholar')">
                  <span style="color:#64748b;">0 questions</span>
                </div>
              </div>
              
              <!-- Recent Findings Section -->
              <div style="grid-column: span 1;">
                <h4 style="font-size:0.75rem; text-transform:uppercase; color:#94a3b8; margin-bottom:10px;">Recent Findings</h4>
                <ul id="scholar-findings-list" style="padding-left:0; margin:0; list-style:none; font-size:0.85rem; color:#94a3b8;">
                  <li style="color:#64748b;">No recent findings</li>
                </ul>
              </div>
            </div>
          </div>

          <div class="d-card hero" id="patterns">
            <div style="border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:10px; margin-bottom:20px;">
              <h3 style="margin:0; font-size:1.1rem;">Patterns & Insights</h3>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; align-items:start;">
              <div style="display:flex; flex-direction:column; align-items:center; gap:12px;">
                 <div class="chart-box"><canvas id="modeChart"></canvas></div>
                 <div id="mode-legend" style="display:flex; flex-wrap:wrap; gap:12px; font-size:0.75rem; color:#94a3b8;"></div>
              </div>
              
              <div>
                <h4 style="font-size:0.75rem; text-transform:uppercase; color:#94a3b8; margin-bottom:8px;">Focus Areas</h4>
                <div style="font-size:0.9rem;">
                  <div style="margin-bottom:5px;"><span style="color:#ef4444;">‚Ä¢</span> Weak: <span id="weak-topics">-</span></div>
                  <div><span style="color:#10b981;">‚Ä¢</span> Strong: <span id="strong-topics">-</span></div>
                </div>
              </div>
              
              <div>
                <h4 style="font-size:0.75rem; text-transform:uppercase; color:#94a3b8; margin-bottom:8px;">Retrospective</h4>
                 <ul id="what-worked" style="padding-left:15px; margin:0; list-style:none; font-size:0.9rem; color:#94a3b8;">
                     <li>waiting for data...</li>
                 </ul>
              </div>
            </div>
          </div>

          <!-- Study Trends Section -->
          <div class="d-card" style="grid-column: span 4;">
            <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:10px; margin-bottom:20px;">
              <h3 style="margin:0; font-size:1.1rem;">Study Trends</h3>
              <select id="trends-period" style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; padding: 6px 12px; color: #f1f5f9; font-size: 0.85rem; cursor: pointer;">
                <option value="7">Last 7 days</option>
                <option value="14">Last 14 days</option>
                <option value="30" selected>Last 30 days</option>
              </select>
            </div>
            <div id="trends-container" style="position: relative; width: 100%; height: 200px;">
              <canvas id="trends-chart" style="width: 100%; height: 100%;"></canvas>
              <div id="trends-empty" style="display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #94a3b8; text-align: center;">
                <div style="font-size: 2rem; margin-bottom: 8px;">üìä</div>
                <div>No trend data yet</div>
                <div style="font-size: 0.85rem;">Complete some study sessions to see your progress</div>
              </div>
            </div>
            <div id="trends-legend" style="display: flex; justify-content: center; gap: 24px; margin-top: 16px; font-size: 0.85rem; color: #94a3b8;">
              <div style="display: flex; align-items: center; gap: 6px;">
                <span style="width: 12px; height: 3px; background: #a855f7; border-radius: 2px;"></span>
                Understanding
              </div>
              <div style="display: flex; align-items: center; gap: 6px;">
                <span style="width: 12px; height: 3px; background: #3b82f6; border-radius: 2px;"></span>
                Retention
              </div>
            </div>
          </div>

          <div class="d-card upload" id="dropzone">
            <div style="display:flex; align-items:center; justify-content:space-between;">
              <div style="display:flex; align-items:center; gap:15px;">
                 <div class="d-icon">üìÇ</div>
                 <div>
                   <div style="font-weight:bold;">Upload Session Log</div>
                   <div style="font-size:0.75rem; color:#94a3b8;">Drag & drop .md files here</div>
                 </div>
              </div>
              <div id="upload-status" style="font-size:0.75rem;"></div>
              <input type="file" id="file-input" style="display:none;" />
            </div>
          </div>

        </div>
      </div>
    </section>
    
    <!-- Sessions Tab (renamed to Brain) -->
    <section id="tab-sessions" class="tab-panel">
      <h2 class="page-title" style="font-size: 20px; margin-bottom: 20px;">Brain</h2>
      
      <!-- Fast Entry from Tutor (Collapsible) -->
      <div class="card collapsible-section" id="fast-entry-section" data-section="fast-entry" style="margin-bottom: 24px;">
        <div class="collapsible-header" onclick="toggleCollapsible(this)">
          <div>
            <h2 class="card-title" style="margin: 0;">‚ö° Fast Entry (Paste from Tutor)</h2>
            <p class="card-subtitle" style="font-size: 13px; color: var(--text-secondary); margin-top: 4px;">Paste your tutor session output directly and ingest it.</p>
          </div>
          <span class="chevron">‚ñº</span>
        </div>
        <div class="collapsible-content">
          
          <!-- Prompt Dropdown -->
          <div class="form-group" style="margin-bottom: 16px;">
            <label class="form-label">Get the Format Prompt</label>
            <div style="display: flex; gap: 8px; align-items: center;">
              <select id="fast-entry-prompt-select" class="form-select" style="flex: 1;">
                <option value="">Select a prompt to copy...</option>
                <option value="session-log">Session Log Format</option>
                <option value="quick-recap">Quick Recap Format</option>
              </select>
              <button type="button" class="btn btn-secondary" onclick="copyFastEntryPrompt()">Copy Prompt</button>
            </div>
          </div>
          
          <!-- Prompt Display -->
          <div id="fast-entry-prompt-display" style="display: none; margin-bottom: 16px; padding: 12px; background: var(--bg); border: 1px solid var(--border); border-radius: 8px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
              <span style="font-size: 12px; font-weight: 600; color: var(--text-primary);">Prompt to paste in ChatGPT/Tutor:</span>
              <button type="button" class="btn" style="padding: 4px 8px; font-size: 11px;" onclick="copyFastEntryPrompt()">Copy</button>
            </div>
            <pre id="fast-entry-prompt-text" style="font-size: 12px; white-space: pre-wrap; color: var(--text-secondary); margin: 0; max-height: 150px; overflow-y: auto;"></pre>
          </div>
          
          <!-- Paste Area -->
          <div class="form-group">
            <label for="fast-entry-paste" class="form-label">Paste Tutor Output Here</label>
            <textarea id="fast-entry-paste" class="form-textarea" rows="10" placeholder="Paste the formatted session output from your tutor here...

Example format:
---
Date: 2026-01-10
Topic: Cardiovascular Physiology
Mode: Core
Duration: 45 minutes
Understanding: 4
Retention: 3
What Worked: Active recall with diagrams
Gaps: Need to review valve mechanics
---"></textarea>
          </div>
          
          <div class="form-actions">
            <button type="button" class="btn btn-primary" onclick="submitFastEntry()">Ingest Session</button>
            <button type="button" class="btn btn-secondary" onclick="document.getElementById('fast-entry-paste').value = ''">Clear</button>
          </div>
          <div id="fast-entry-status" style="margin-top: 8px;"></div>
        </div>
      </div>
      
      <!-- Latest Study Sessions -->
      <div class="card" id="sessions">
        <div class="card-header">
          <h2 class="card-title">Latest Study Sessions</h2>
        </div>
        <table class="sessions-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Mode</th>
              <th>Topic</th>
              <th>Duration</th>
              <th>Score (U/R/S)</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="sessions-tbody">
          </tbody>
        </table>
      </div>
      
      <!-- Quick Session Entry (Collapsible) -->
      <div class="card collapsible-section" id="quick-session-section" data-section="quick-session" style="margin-top: 24px;">
        <div class="collapsible-header" onclick="toggleCollapsible(this)">
          <div>
            <h2 class="card-title" style="margin: 0;">Quick Session Entry</h2>
            <p class="card-subtitle" style="font-size: 13px; color: var(--text-secondary); margin-top: 4px;">Document what worked, what didn't, or quick session notes directly.</p>
          </div>
          <span class="chevron">‚ñº</span>
        </div>
        <div class="collapsible-content">
        <form id="quick-session-form" class="form-section">
          <div class="form-grid">
            <div class="form-group">
              <label for="topic" class="form-label">Topic *</label>
              <input type="text" id="topic" class="form-input" required placeholder="e.g., Cardiovascular Physiology">
            </div>
            <div class="form-group">
              <label for="study_mode" class="form-label">Study Mode</label>
              <select id="study_mode" class="form-select">
                <option value="Core">Core</option>
                <option value="Sprint">Sprint</option>
                <option value="Drill">Drill</option>
              </select>
            </div>
            <div class="form-group">
              <label for="time_spent_minutes" class="form-label">Time (minutes) *</label>
              <input type="number" id="time_spent_minutes" class="form-input" required min="1" placeholder="30">
            </div>
            <div class="form-group">
              <label for="understanding_level" class="form-label">Understanding * (1-5)</label>
              <input type="number" id="understanding_level" class="form-input" required min="1" max="5" placeholder="3">
            </div>
            <div class="form-group">
              <label for="retention_confidence" class="form-label">Retention (1-5)</label>
              <input type="number" id="retention_confidence" class="form-input" min="1" max="5" placeholder="3">
            </div>
            <div class="form-group">
              <label for="system_performance" class="form-label">System Performance (1-5)</label>
              <input type="number" id="system_performance" class="form-input" min="1" max="5" placeholder="3">
            </div>
          </div>

          <div class="form-group">
            <label for="what_worked" class="form-label">What Worked / What You Liked</label>
            <textarea id="what_worked" class="form-textarea" rows="3" placeholder="e.g., 'The gated platter really helped me focus', 'Love how it broke down the complex topic'"></textarea>
          </div>

          <div class="form-group">
            <label for="what_needs_fixing" class="form-label">What Needs Fixing / What It Didn't Do</label>
            <textarea id="what_needs_fixing" class="form-textarea" rows="3" placeholder="e.g., 'It didn't explain the concept clearly', 'Need more examples on this topic'"></textarea>
          </div>

          <div class="form-group">
            <label for="notes_insights" class="form-label">Additional Notes & Insights</label>
            <textarea id="notes_insights" class="form-textarea" rows="2" placeholder="Any other observations..."></textarea>
          </div>

          <div class="form-actions">
            <button type="submit" class="btn btn-primary">Save Session</button>
            <button type="button" class="btn btn-secondary" onclick="resetQuickForm()">Clear Form</button>
          </div>
        </form>
        <div id="quick-session-status"></div>
        </div>
      </div>

      <!-- Session Resume (Collapsible) (Collapsible) -->
      <div class="card resume-section collapsible-section" id="resume" data-section="session-resume">
        <div class="collapsible-header" onclick="toggleCollapsible(this)">
          <div>
            <h2 class="card-title" style="margin: 0;">Session Resume</h2>
            <p class="card-subtitle" style="font-size: 13px; color: var(--text-secondary); margin-top: 4px;">Generate a concise summary for your next GPT session.</p>
          </div>
          <span class="chevron">‚ñº</span>
        </div>
        <div class="collapsible-content">
        <div class="resume-actions">
          <button type="button" class="btn btn-primary" id="btn-resume">Generate Resume</button>
          <a class="btn btn-secondary" href="/api/resume/download" target="_blank" rel="noopener">Download</a>
        </div>
        <pre class="resume-preview" id="resume-box">Click "Generate Resume" to fetch the latest summary.</pre>
        </div>
      </div>
    </section>
    
    <!-- Syllabus Tab -->
    <section id="tab-syllabus" class="tab-panel">
      <h2 class="page-title" style="font-size: 20px; margin-bottom: 20px;">Syllabus & Calendar</h2>
      
      <!-- Calendar View (Always Visible - Primary Feature) -->
      <div class="card resume-section" id="calendar-section" style="margin-bottom: 24px;">
        <div class="card-header" style="display: flex; align-items: center; justify-content: space-between; gap: 12px; flex-wrap: wrap;">
          <div>
            <h2 class="card-title" style="margin: 0;">üìÖ Study Calendar</h2>
            <p style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">View and manage your course events, study sessions, and planned repetitions.</p>
          </div>
          <div style="display: flex; gap: 8px;">
            <button id="btn-view-calendar" class="btn btn-primary" type="button">Calendar</button>
            <button id="btn-view-list" class="btn" type="button">List</button>
          </div>
        </div>
        
        <div id="syllabus-calendar-container">
          <!-- Filters -->
          <div style="margin-bottom: 16px; display: flex; gap: 12px; flex-wrap: wrap; align-items: center;">
            <div class="form-group" style="margin: 0; min-width: 150px;">
              <label class="form-label" style="font-size: 12px;">Course</label>
              <select id="calendar-filter-course" class="form-select" style="font-size: 13px;">
                <option value="">All Courses</option>
              </select>
            </div>
            <div class="form-group" style="margin: 0; min-width: 120px;">
              <label class="form-label" style="font-size: 12px;">Event Type</label>
              <select id="calendar-filter-type" class="form-select" style="font-size: 13px;">
                <option value="">All Types</option>
                <option value="lecture">Lectures</option>
                <option value="quiz">Quizzes</option>
                <option value="exam">Exams</option>
                <option value="assignment">Assignments</option>
              </select>
            </div>
            <div class="form-group" style="margin: 0; min-width: 100px;">
              <label class="form-label" style="font-size: 12px;">View</label>
              <select id="calendar-view-range" class="form-select" style="font-size: 13px;">
                <option value="month">Month View</option>
                <option value="week">Week View</option>
                <option value="day">Day View</option>
              </select>
            </div>
            <button id="btn-refresh-calendar" class="btn" style="margin-top: 20px;">Refresh</button>
          </div>

          <!-- Calendar Navigation -->
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
            <button id="btn-calendar-prev" class="btn" style="padding: 6px 12px;">‚Üê Prev</button>
            <h3 id="calendar-month-year" style="margin: 0; font-size: 18px; font-weight: 600;">Loading...</h3>
            <button id="btn-calendar-next" class="btn" style="padding: 6px 12px;">Next ‚Üí</button>
          </div>

          <!-- Calendar Grid -->
          <div id="calendar-grid" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; margin-bottom: 20px;">
            <!-- Calendar will be rendered here by JavaScript -->
          </div>

          <!-- Legend -->
          <div style="display: flex; gap: 16px; flex-wrap: wrap; padding-top: 16px; border-top: 1px solid var(--border); font-size: 12px;">
            <div style="display: flex; align-items: center; gap: 6px;">
              <div style="width: 16px; height: 16px; border-radius: 4px; background: rgba(31, 111, 235, 0.3); border: 1px solid var(--accent);"></div>
              <span>Course Event</span>
            </div>
            <div style="display: flex; align-items: center; gap: 6px;">
              <div style="width: 16px; height: 16px; border-radius: 4px; background: rgba(63, 185, 80, 0.3); border: 1px solid var(--success);"></div>
              <span>Study Session</span>
            </div>
            <div style="display: flex; align-items: center; gap: 6px;">
              <div style="width: 16px; height: 16px; border-radius: 4px; background: rgba(188, 142, 249, 0.3); border: 1px solid var(--purple);"></div>
              <span>Planned Repetition</span>
            </div>
            <div style="display: flex; align-items: center; gap: 6px;">
              <div style="width: 16px; height: 16px; border-radius: 4px; background: rgba(248, 81, 73, 0.3); border: 1px solid var(--error);"></div>
              <span>Exam/Quiz</span>
            </div>
          </div>

          <!-- Quick Add Planned Session -->
          <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border);">
            <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 12px;">Plan Spaced Repetition Session</h4>
            <div style="display: flex; gap: 12px; flex-wrap: wrap;">
              <div class="form-group" style="margin: 0; min-width: 140px;">
                <label class="form-label" style="font-size: 12px;">Date</label>
                <input type="date" id="plan-session-date" class="form-input" style="font-size: 13px;">
              </div>
              <div class="form-group" style="margin: 0; min-width: 100px;">
                <label class="form-label" style="font-size: 12px;">Minutes</label>
                <input type="number" id="plan-session-minutes" class="form-input" value="60" min="15" step="15" style="font-size: 13px;">
              </div>
              <div class="form-group" style="margin: 0; flex: 1; min-width: 200px;">
                <label class="form-label" style="font-size: 12px;">Course</label>
                <select id="plan-session-course" class="form-select" style="font-size: 13px;">
                  <option value="">Optional</option>
                </select>
              </div>
              <button id="btn-add-planned-session" class="btn btn-primary" style="margin-top: 20px;">Add Planned Session</button>
            </div>
            <div id="plan-session-status" style="margin-top: 8px; font-size: 12px;"></div>
          </div>

          <!-- Google Calendar Sync Section -->
          <div style="margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--border);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
              <h4 style="margin: 0; font-size: 15px;">Google Calendar Sync</h4>
              <span id="gcal-status-badge" class="badge" style="padding: 4px 10px; border-radius: 12px; font-size: 12px;">Checking...</span>
            </div>

            <!-- Not Connected State -->
            <div id="gcal-auth-section" style="display: block;">
              <p style="color: var(--text-secondary); font-size: 13px; margin-bottom: 12px;">
                Connect your Google Calendar to import events automatically.
              </p>
              <button id="btn-gcal-connect" class="btn btn-primary" style="width: 100%;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 8px; vertical-align: middle;">
                  <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                  <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                  <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                  <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                </svg>
                Connect Google Calendar
              </button>
            </div>

            <!-- Connected State -->
            <div id="gcal-sync-section" style="display: none;">
              <p style="color: var(--text-secondary); font-size: 13px; margin-bottom: 8px;">
                Connected as: <strong id="gcal-user-email" style="color: var(--text-primary);">‚Äî</strong>
              </p>
              <div style="display: flex; gap: 8px; margin-bottom: 8px;">
                <button id="btn-gcal-sync" class="btn btn-primary" style="flex: 1;">
                  üìÖ Sync Calendar
                </button>
                <button id="btn-gtasks-sync" class="btn btn-primary" style="flex: 1;">
                  ‚úÖ Sync Tasks
                </button>
              </div>
              <div style="display: flex; gap: 8px;">
                <button id="btn-gcal-disconnect" class="btn" style="flex: 1; padding: 8px 12px;" title="Disconnect">
                  Disconnect
                </button>
              </div>
              <p id="gcal-sync-status" style="margin-top: 8px; font-size: 12px; color: var(--text-muted);"></p>
            </div>
          </div>
        </div>

        <!-- Syllabus List View -->
        <div id="syllabus-list-container" style="display: none;">
          <!-- Week Selector at Top -->
          <div style="margin-bottom: 20px; padding: 16px; background: var(--surface-2); border-radius: 12px; border: 1px solid var(--border);">
            <div style="display: flex; gap: 16px; flex-wrap: wrap; align-items: center; justify-content: space-between;">
              <div style="display: flex; gap: 12px; align-items: center;">
                <div class="form-group" style="margin: 0; min-width: 140px;">
                  <label class="form-label" style="font-size: 12px;">Start Week</label>
                  <select id="list-start-week" class="form-select" style="font-size: 13px;">
                    <!-- Will be populated by JS, Week 1 = Jan 5, 2025 -->
                  </select>
                </div>
                <div class="form-group" style="margin: 0; min-width: 100px;">
                  <label class="form-label" style="font-size: 12px;">Show Weeks</label>
                  <select id="list-week-count" class="form-select" style="font-size: 13px;">
                    <option value="1">1 week</option>
                    <option value="2">2 weeks</option>
                    <option value="3" selected>3 weeks</option>
                    <option value="4">4 weeks</option>
                    <option value="8">8 weeks</option>
                    <option value="all">All</option>
                  </select>
                </div>
              </div>
              <div style="display: flex; gap: 8px; align-items: center;">
                <button id="btn-list-prev-week" class="btn" style="padding: 6px 12px;">‚Üê Earlier</button>
                <span id="list-week-range-label" style="font-size: 13px; color: var(--text-secondary); min-width: 150px; text-align: center;">Week 1 - 3</span>
                <button id="btn-list-next-week" class="btn" style="padding: 6px 12px;">Later ‚Üí</button>
              </div>
            </div>
          </div>
          
          <!-- Filters Row -->
          <div style="margin-bottom: 16px; display: flex; gap: 12px; flex-wrap: wrap; align-items: center;">
            <div class="form-group" style="margin: 0; min-width: 150px;">
              <label class="form-label" style="font-size: 12px;">Course</label>
              <select id="syllabus-list-course" class="form-select" style="font-size: 13px;">
                <option value="">All Courses</option>
              </select>
            </div>
            <div class="form-group" style="margin: 0; min-width: 120px;">
              <label class="form-label" style="font-size: 12px;">Event Type</label>
              <select id="syllabus-list-type" class="form-select" style="font-size: 13px;">
                <option value="">All Types</option>
                <option value="lecture">Lectures</option>
                <option value="reading">Readings</option>
                <option value="quiz">Quizzes</option>
                <option value="exam">Exams</option>
                <option value="assignment">Assignments</option>
                <option value="other">Other</option>
              </select>
            </div>
            <div class="form-group" style="margin: 0; min-width: 200px; flex: 1;">
              <label class="form-label" style="font-size: 12px;">Search title/details</label>
              <input id="syllabus-list-search" class="form-input" type="text" placeholder="Search events..." style="font-size: 13px;">
            </div>
            <button id="btn-refresh-syllabus-list" class="btn" style="margin-top: 20px;">Refresh</button>
          </div>

          <div style="overflow-x: auto;">
            <table class="sessions-table" style="min-width: 900px;">
              <thead>
                <tr>
                  <th style="width: 50px; text-align: center;">Done</th>
                  <th style="width: 100px;">Date</th>
                  <th style="width: 120px;">Course</th>
                  <th style="width: 100px;">Type</th>
                  <th>Title</th>
                  <th style="width: 60px; text-align: center;">Weight</th>
                  <th style="max-width: 200px;">Details</th>
                  <th style="width: 60px;">Actions</th>
                </tr>
              </thead>
              <tbody id="syllabus-list-body">
              </tbody>
            </table>
          </div>
          <div id="syllabus-list-empty" style="display: none; color: var(--text-muted); font-size: 13px; padding: 12px 0;">No events match the filters.</div>
        </div>
      </div>

      <!-- Study Tasks (Readings & Topics) -->
      <div class="card resume-section" id="study-tasks-section" style="margin-bottom: 24px;">
        <div class="card-header" style="display: flex; align-items: center; justify-content: space-between; gap: 12px; flex-wrap: wrap;">
          <div>
            <h2 class="card-title" style="margin: 0;">üìö Study Tasks</h2>
            <p style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">Readings, topics, and ongoing assignments. Check off as you complete.</p>
          </div>
          <div style="display: flex; gap: 8px; align-items: center;">
            <select id="study-tasks-filter" class="form-select" style="font-size: 13px; min-width: 120px;">
              <option value="active">Active</option>
              <option value="all">All</option>
              <option value="completed">Completed</option>
            </select>
            <button id="btn-refresh-study-tasks" class="btn" type="button">Refresh</button>
          </div>
        </div>
        
        <!-- Task Stats -->
        <div id="study-tasks-stats" style="display: flex; gap: 16px; flex-wrap: wrap; padding: 12px 0; border-bottom: 1px solid var(--border); margin-bottom: 16px;">
          <div style="display: flex; align-items: center; gap: 6px;">
            <span style="font-size: 20px; font-weight: 700; color: var(--warning);" id="tasks-pending-count">0</span>
            <span style="font-size: 12px; color: var(--text-muted);">Pending</span>
          </div>
          <div style="display: flex; align-items: center; gap: 6px;">
            <span style="font-size: 20px; font-weight: 700; color: var(--accent);" id="tasks-in-progress-count">0</span>
            <span style="font-size: 12px; color: var(--text-muted);">In Progress</span>
          </div>
          <div style="display: flex; align-items: center; gap: 6px;">
            <span style="font-size: 20px; font-weight: 700; color: var(--success);" id="tasks-completed-count">0</span>
            <span style="font-size: 12px; color: var(--text-muted);">Completed</span>
          </div>
          <div style="display: flex; align-items: center; gap: 6px; margin-left: auto;">
            <span style="font-size: 12px; color: var(--text-muted);">Progress:</span>
            <div style="width: 120px; height: 8px; background: var(--bg-secondary); border-radius: 4px; overflow: hidden;">
              <div id="tasks-progress-bar" style="height: 100%; width: 0%; background: linear-gradient(90deg, var(--success), var(--accent)); transition: width 0.3s;"></div>
            </div>
            <span id="tasks-progress-pct" style="font-size: 12px; font-weight: 600;">0%</span>
          </div>
        </div>
        
        <!-- Task List -->
        <div id="study-tasks-list" style="max-height: 400px; overflow-y: auto;">
          <div style="color: var(--text-muted); font-size: 13px; padding: 20px; text-align: center;">Loading study tasks...</div>
        </div>
      </div>
      
      <!-- Syllabus Intake (Collapsible) -->
      <div class="collapsible-section" id="syllabus-intake-section" data-section="syllabus-intake">
        <div class="collapsible-header" onclick="toggleCollapsible(this)">
          <h3>Syllabus Intake (MVP)</h3>
          <span class="chevron">‚ñº</span>
        </div>
        <div class="collapsible-content">
      <div class="card resume-section" id="syllabus" style="border: none; margin-bottom: 0;">
      <form id="syllabus-form" class="form-section">
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label" for="course_name">Course Name *</label>
            <input id="course_name" class="form-input" type="text" placeholder="PT Anatomy I" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="course_code">Course Code</label>
            <input id="course_code" class="form-input" type="text" placeholder="PTA101">
          </div>
          <div class="form-group">
            <label class="form-label" for="course_term">Term</label>
            <input id="course_term" class="form-input" type="text" placeholder="Spring 2026">
          </div>
          <div class="form-group">
            <label class="form-label" for="course_instructor">Instructor</label>
            <input id="course_instructor" class="form-input" type="text" placeholder="Dr. Smith">
          </div>
          <div class="form-group">
            <label class="form-label" for="course_mode">Default Study Mode</label>
            <select id="course_mode" class="form-select">
              <option value="Core">Core</option>
              <option value="Sprint">Sprint</option>
              <option value="Drill">Drill</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label" for="course_time_budget">Minutes per week</label>
            <input id="course_time_budget" class="form-input" type="number" min="0" placeholder="900">
          </div>
        </div>

        <div class="form-group">
          <label class="form-label" for="event_title">Event Title *</label>
          <input id="event_title" class="form-input" type="text" placeholder="Exam 1 ‚Äì Pelvis &amp; Hip" required>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label" for="event_type">Event Type</label>
            <select id="event_type" class="form-select">
              <option value="lecture">Lecture</option>
              <option value="reading">Reading</option>
              <option value="quiz">Quiz</option>
              <option value="exam">Exam</option>
              <option value="assignment">Assignment</option>
              <option value="other">Other</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label" for="event_date">Date</label>
            <input id="event_date" class="form-input" type="date">
          </div>
          <div class="form-group">
            <label class="form-label" for="event_due_date">Due Date</label>
            <input id="event_due_date" class="form-input" type="date">
          </div>
          <div class="form-group">
            <label class="form-label" for="event_weight">Weight (0‚Äì1)</label>
            <input id="event_weight" class="form-input" type="number" step="0.01" min="0" max="1" placeholder="0.30">
          </div>
        </div>
        <div class="form-group">
          <label class="form-label" for="event_raw_text">Details (chapters, slides, notes)</label>
          <textarea id="event_raw_text" class="form-textarea" rows="2" placeholder="Covers weeks 1‚Äì3, Chapters 1‚Äì5; Slides 01‚Äì03."></textarea>
        </div>
        <div class="form-actions">
          <button type="submit" class="btn btn-primary">Save Course + Event</button>
        </div>
      </form>
      <div id="syllabus-status"></div>
    </div>
        </div>
      </div>
    <!-- Syllabus Part 2 (ChatGPT & Calendar) -->

    <!-- ChatGPT JSON Import (Collapsible) -->
    <div class="collapsible-section" id="json-import-section" data-section="json-import">
      <div class="collapsible-header" onclick="toggleCollapsible(this)">
        <h3>Syllabus via ChatGPT (JSON Import)</h3>
        <span class="chevron">‚ñº</span>
      </div>
      <div class="collapsible-content">
    <div class="card resume-section" id="syllabus-chatgpt" style="border: none; margin-bottom: 0;">
      <div class="form-section">
        <div class="form-group">
          <label class="form-label" for="syllabus_prompt_template">1) Copy this prompt into ChatGPT</label>
          <button type="button" class="btn" id="btn-syllabus-prompt-copy" style="margin-top: 6px; margin-bottom: 6px;">Copy Prompt</button>
          <textarea id="syllabus_prompt_template" class="form-textarea" rows="12" readonly>
You are helping me convert a course syllabus into a JSON format for my PT Study Brain app.

### Goal

Given the raw syllabus text I provide, output a SINGLE JSON object in this exact shape:

{
  "name": "COURSE NAME",
  "code": "COURSE CODE OR SHORT LABEL",
  "term": "TERM (e.g., Spring 2026)",
  "instructor": "INSTRUCTOR NAME (if known)",
  "default_study_mode": "Core",
  "time_budget_per_week_minutes": 900,
  "events": [
    {
      "type": "lecture | reading | quiz | exam | assignment | other",
      "title": "Short, clear title",
      "date": "YYYY-MM-DD or null",
      "due_date": "YYYY-MM-DD or null",
      "weight": 0.0,
      "raw_text": "Short description: chapters, slides, topics, etc."
    }
  ]
}

### Rules

1. Only output JSON. No commentary, no markdown, no backticks.
2. Use these rules for events:
   - Create ONE event per meaningful item in the syllabus (lecture, reading block, quiz, exam, assignment).
   - type: lecture, reading, quiz, exam, assignment, or other.
   - title: short but specific (include week or topic where helpful).
   - date: calendar date if present, otherwise null.
   - due_date: for quizzes/exams/assignments, usually same as date; otherwise null.
   - weight: 0.0 if not clearly stated; or 0.3 if the syllabus says ‚Äú30%‚Äù.
   - raw_text: the most useful details (chapters, pages, slides, topics), under ~200 characters.
3. If the syllabus spans multiple courses, process ONLY ONE course per run.
4. If term, instructor, or course code are not obvious, use null for those fields.
5. Dates must be in "YYYY-MM-DD" format if you can infer them; otherwise null.

Now say: ‚ÄúPaste your syllabus text here (one course at a time).‚Äù Then wait for me, and after I paste the syllabus, respond ONLY with the JSON object.</textarea>
        </div>
        <div class="form-group">
          <label class="form-label" for="syllabus_json_input">2) Paste ChatGPT JSON here and import</label>
          <textarea id="syllabus_json_input" class="form-textarea" rows="8" placeholder='{"name": "PT Anatomy I", "code": "PTA101", ...}'></textarea>
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-primary" id="btn-syllabus-json-import">Import JSON</button>
        </div>
        <div id="syllabus-json-status"></div>
      </div>
      </div>
    </div>

    <!-- Course Color Manager (Collapsible) -->
    <div class="collapsible-section" data-section="course-colors">
      <div class="collapsible-header" onclick="toggleCollapsible(this)">
        <h3>üé® Course Colors</h3>
        <span class="chevron">‚ñº</span>
      </div>
      <div class="collapsible-content">
    <div class="card resume-section" id="course-colors-section" style="border: none; margin-bottom: 0;">
      <div class="card-header" style="display: flex; align-items: center; justify-content: space-between;">
        <div>
          <h2 class="card-title" style="margin: 0;">üé® Course Colors</h2>
          <p style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">Click a color swatch to pick a custom color, or use the quick-select palette.</p>
        </div>
        <button class="btn" type="button" onclick="document.getElementById('course-color-manager').style.display = document.getElementById('course-color-manager').style.display === 'none' ? 'block' : 'none';">
          Toggle
        </button>
      </div>
      <div id="course-color-manager" style="padding: 8px 0; display: none;">
        <div style="color: var(--text-muted); font-size: 13px;">Loading courses...</div>
      </div>
    </div>
      </div>
    </div>

    </section>
    
    <!-- Scholar Tab -->
    <section id="tab-scholar" class="tab-panel">
      <h2 class="page-title" style="font-size: 20px; margin-bottom: 20px;">Scholar Research</h2>
      
      <!-- Scholar Section -->
      <div class="card resume-section" id="scholar">
        <div class="card-header">
          <h2 class="card-title">Scholar Research Dashboard</h2>
          <p style="font-size: 13px; color: var(--text-secondary); margin-top: 8px;">
            Research progress, questions, and next steps
          </p>
        </div>

        <!-- API Key Configuration (Collapsible) -->
        <div class="collapsible-section" data-section="scholar-api-config">
          <div class="collapsible-header" onclick="toggleCollapsible(this)">
            <h3>Scholar API Key</h3>
            <span class="chevron">‚ñº</span>
          </div>
          <div class="collapsible-content">
        <div style="margin-bottom: 24px; padding: 16px; background: var(--bg); border: 1px solid var(--border); border-radius: 8px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
            <h4 style="font-size: 15px; font-weight: 600; color: var(--text-primary); margin: 0;">Configuration</h4>
            <button id="btn-toggle-api-key" class="btn" style="padding: 6px 10px; font-size: 12px;">Configure</button>
          </div>
          <div id="api-key-status" style="font-size: 12px; color: var(--text-muted);">Loading API key status...</div>
          <div id="api-key-config" style="display: none; margin-top: 12px;">
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label" for="api-provider-select">Provider</label>
                <select id="api-provider-select" class="form-select">
                  <option value="openrouter">OpenRouter</option>
                  <option value="openai">OpenAI</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label" for="api-key-input">API Key</label>
                <input id="api-key-input" class="form-input" type="password" placeholder="Paste your API key">
              </div>
            </div>
            <div class="form-actions" style="margin-top: 8px;">
              <button type="button" class="btn btn-primary" id="btn-save-api-key">Save Key</button>
              <button type="button" class="btn" id="btn-test-api-key">Test</button>
            </div>
            <div id="api-key-test-result" style="margin-top: 8px; font-size: 12px; color: var(--text-muted);"></div>
          </div>
        </div>
          </div>
        </div>

        <!-- Run Scholar (Collapsible) -->
        <div class="collapsible-section" data-section="scholar-run">
          <div class="collapsible-header" onclick="toggleCollapsible(this)">
            <h3>Run Scholar</h3>
            <span class="chevron">‚ñº</span>
          </div>
          <div class="collapsible-content">
        <!-- Scholar Status -->
        <div style="margin-bottom: 24px;">
        <div style="display: flex; gap: 16px; margin-bottom: 16px; flex-wrap: wrap;">
          <div style="padding: 12px 16px; background: var(--bg); border: 1px solid var(--border); border-radius: 8px; flex: 1; min-width: 150px;">
            <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 4px;">Status</div>
            <div id="scholar-status" style="font-size: 16px; font-weight: 600; color: var(--text-primary);">-</div>
          </div>
          <div style="padding: 12px 16px; background: var(--bg); border: 1px solid var(--border); border-radius: 8px; flex: 1; min-width: 150px;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <div>
                <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 4px;">Safe Mode</div>
                <div id="scholar-safe-mode" style="font-size: 16px; font-weight: 600; color: var(--text-primary);">-</div>
              </div>
              <button id="btn-toggle-safe-mode" class="btn" style="padding: 4px 8px; font-size: 12px;">Toggle</button>
            </div>
          </div>
          <div style="padding: 12px 16px; background: var(--bg); border: 1px solid var(--border); border-radius: 8px; flex: 1; min-width: 150px;">
            <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 4px;">Last Updated</div>
            <div id="scholar-last-updated" style="font-size: 16px; font-weight: 600; color: var(--text-primary);">-</div>
          </div>
        </div>
      </div>
      
      <!-- Run Scholar Section -->
      <div style="margin-bottom: 24px; padding: 16px; background: rgba(31, 111, 235, 0.1); border: 1px solid var(--accent); border-radius: 8px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
          <h4 style="font-size: 16px; font-weight: 600; color: var(--text-primary); margin: 0;">Run Scholar</h4>
          <button id="btn-run-scholar" class="btn btn-primary" style="margin: 0;">Start Run</button>
        </div>
        <div id="scholar-run-status" style="font-size: 13px; color: var(--text-secondary); margin-top: 8px;">
          Click "Start Run" to execute Scholar orchestrator
        </div>
        <div id="scholar-run-progress" class="scholar-progress" style="display:none; margin-top: 10px;">
          <div class="scholar-progress-bar" id="scholar-run-progress-bar"></div>
        </div>
        <div id="scholar-run-meta" style="display:none; margin-top: 8px; font-size: 12px; color: var(--text-muted);"></div>
        <div id="scholar-run-actions" style="display:none; margin-top: 10px; gap: 8px; flex-wrap: wrap;">
          <button id="btn-scholar-refresh" class="btn" type="button">Refresh Status</button>
          <button id="btn-scholar-open-final" class="btn" type="button">Open Latest Final</button>
          <button id="btn-scholar-cancel" class="btn" type="button">Cancel Run</button>
        </div>
        <div style="margin-top: 8px; font-size: 12px; color: var(--text-muted);">Tip: drag the bottom edge to resize.</div>
        <div id="scholar-run-log" class="scholar-run-log" style="display: none;">
        </div>
      </div>
          </div>
        </div>
      
      <!-- Proposals (Collapsible) -->
      <div class="collapsible-section" data-section="scholar-proposals">
        <div class="collapsible-header" onclick="toggleCollapsible(this)">
          <h3>üìù Proposals & Questions</h3>
          <span class="chevron">‚ñº</span>
        </div>
        <div class="collapsible-content">
      <!-- Questions Section -->
      <div style="margin-bottom: 24px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
          <h4 style="font-size: 16px; font-weight: 600; color: var(--text-primary); margin: 0;">
            üìù Proposals Awaiting Review
            <span id="scholar-proposals-section-count" style="font-size: 12px; color: var(--text-muted); margin-left: 8px;">(0)</span>
          </h4>
        </div>
        <div id="scholar-proposals-list" style="padding: 16px; background: var(--bg); border: 1px solid var(--border); border-radius: 8px; min-height: 60px;">
          <div style="color: var(--text-muted); font-size: 13px;">Loading proposals...</div>
        </div>
      </div>
      
      <!-- Questions Section -->
      <div style="margin-bottom: 24px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
          <h4 style="font-size: 16px; font-weight: 600; color: var(--text-primary); margin: 0;">
            Questions Needing Answers
            <span id="scholar-questions-section-count" style="font-size: 12px; color: var(--text-muted); margin-left: 8px;">(0)</span>
          </h4>
          <button id="btn-save-answers" class="btn btn-primary" style="display: none;">Save Answers</button>
        </div>
        <div id="scholar-questions" style="padding: 16px; background: var(--bg); border: 1px solid var(--border); border-radius: 8px; min-height: 60px;">
          <div style="color: var(--text-muted); font-size: 13px;">Loading questions...</div>
        </div>
      </div>
      
      <!-- Answered Questions Section (Collapsible) -->
      <div style="margin-bottom: 24px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; cursor: pointer;" onclick="toggleAnsweredQuestions()">
          <h4 style="font-size: 16px; font-weight: 600; color: var(--text-primary); margin: 0;">
            ‚úÖ Answered Questions
            <span id="scholar-answered-section-count" style="font-size: 12px; color: var(--text-muted); margin-left: 8px;">(0)</span>
          </h4>
          <span id="answered-questions-chevron" style="font-size: 12px; color: var(--text-muted);">‚ñ∂</span>
        </div>
        <div id="scholar-answered-questions" style="display: none; padding: 16px; background: var(--bg); border: 1px solid var(--border); border-radius: 8px; min-height: 40px;">
          <div style="color: var(--text-muted); font-size: 13px;">No answered questions yet.</div>
        </div>
      </div>
        </div>
      </div>
      
      <!-- System Health (Collapsible) -->
      <div class="collapsible-section" data-section="scholar-health">
        <div class="collapsible-header" onclick="toggleCollapsible(this)">
          <h3>üî¨ System Health & Research</h3>
          <span class="chevron">‚ñº</span>
        </div>
        <div class="collapsible-content">
      <!-- System Health (formerly Coverage) -->
      <div style="margin-bottom: 24px;">
        <h4 style="font-size: 16px; font-weight: 600; margin-bottom: 8px; color: var(--text-primary);">
          üî¨ System Health
          <span id="scholar-coverage-summary" style="font-size: 12px; color: var(--text-muted); margin-left: 8px;"></span>
        </h4>
        <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 12px;">
          Continuous auditing, polishing, and improvement of the study system
        </div>
        
        <!-- Progress Bar -->
        <div style="margin-bottom: 16px;">
          <div style="display: flex; height: 20px; border-radius: 10px; overflow: hidden; background: rgba(139, 148, 158, 0.2);">
            <div id="scholar-coverage-bar-complete" style="background: var(--success); transition: width 0.3s ease;"></div>
            <div id="scholar-coverage-bar-progress" style="background: var(--warning); transition: width 0.3s ease;"></div>
          </div>
        </div>
        
        <!-- Stats Cards - Compact -->
        <div style="display: flex; gap: 8px; margin-bottom: 16px;">
          <div style="flex: 1; padding: 10px; background: rgba(63, 185, 80, 0.15); border-radius: 8px; text-align: center;">
            <div style="font-size: 10px; color: var(--success); text-transform: uppercase;">Documented</div>
            <div id="scholar-coverage-complete" style="font-size: 24px; font-weight: 700; color: var(--success);">0</div>
          </div>
          <div style="flex: 1; padding: 10px; background: rgba(218, 165, 32, 0.15); border-radius: 8px; text-align: center;">
            <div style="font-size: 10px; color: var(--warning); text-transform: uppercase;">In Progress</div>
            <div id="scholar-coverage-progress" style="font-size: 24px; font-weight: 700; color: var(--warning);">0</div>
          </div>
          <div style="flex: 1; padding: 10px; background: rgba(139, 148, 158, 0.15); border-radius: 8px; text-align: center;">
            <div style="font-size: 10px; color: var(--text-muted); text-transform: uppercase;">Pending</div>
            <div id="scholar-coverage-not-started" style="font-size: 24px; font-weight: 700; color: var(--text-muted);">0</div>
          </div>
          <div style="flex: 1; padding: 10px; background: rgba(136, 46, 224, 0.15); border-radius: 8px; text-align: center;">
            <div style="font-size: 10px; color: #a855f7; text-transform: uppercase;">Stale (30d+)</div>
            <div id="scholar-coverage-stale" style="font-size: 24px; font-weight: 700; color: #a855f7;">-</div>
          </div>
        </div>
        
        <!-- Module List -->
        <div id="scholar-coverage-list" style="max-height: 250px; overflow-y: auto; padding: 12px; background: var(--bg); border: 1px solid var(--border); border-radius: 8px;">
          <div style="color: var(--text-muted); font-size: 13px;">Loading module status...</div>
        </div>
      </div>
      
      <!-- Research & Gaps -->
      <div style="margin-bottom: 24px;">
        <h4 style="font-size: 16px; font-weight: 600; margin-bottom: 8px; color: var(--text-primary);">
          üìö Research & Gap Analysis
        </h4>
        <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 12px;">
          Pedagogy research, meta-analysis findings, and system gaps to address
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
          <!-- Active Research -->
          <div style="padding: 12px; background: var(--bg); border: 1px solid var(--border); border-radius: 8px;">
            <div style="font-size: 12px; font-weight: 600; color: var(--text-primary); margin-bottom: 8px;">üîç Active Research Topics</div>
            <div id="scholar-research-topics" style="font-size: 13px; color: var(--text-secondary); min-height: 60px;">
              Loading...
            </div>
          </div>
          
          <!-- Identified Gaps -->
          <div style="padding: 12px; background: var(--bg); border: 1px solid var(--border); border-radius: 8px;">
            <div style="font-size: 12px; font-weight: 600; color: var(--text-primary); margin-bottom: 8px;">‚ö†Ô∏è Identified Gaps</div>
            <div id="scholar-gaps" style="font-size: 13px; color: var(--text-secondary); min-height: 60px;">
              Loading...
            </div>
          </div>
        </div>
        
        <!-- Improvement Candidates -->
        <div style="margin-top: 12px; padding: 12px; background: var(--bg); border: 1px solid var(--border); border-radius: 8px;">
          <div style="font-size: 12px; font-weight: 600; color: var(--text-primary); margin-bottom: 8px;">üí° Improvement Candidates</div>
          <div id="scholar-improvements" style="font-size: 13px; color: var(--text-secondary); min-height: 40px;">
            Loading...
          </div>
        </div>
      </div>
      
      <!-- Next Steps -->
      <div style="margin-bottom: 24px;">
        <h4 style="font-size: 16px; font-weight: 600; margin-bottom: 12px; color: var(--text-primary);">üìã What To Do Next</h4>
        <div id="scholar-next-steps" style="padding: 16px; background: var(--bg); border: 1px solid var(--border); border-radius: 8px; min-height: 60px;">
          <div style="color: var(--text-muted); font-size: 13px;">Loading next steps...</div>
        </div>
      </div>
      
      <!-- Latest Run Summary -->
      <div style="margin-bottom: 24px;">
        <h4 style="font-size: 16px; font-weight: 600; margin-bottom: 12px; color: var(--text-primary);">üìÑ Latest Run Summary</h4>
        <div id="scholar-latest-run" style="padding: 16px; background: var(--bg); border: 1px solid var(--border); border-radius: 8px; font-family: monospace; font-size: 13px; white-space: pre-wrap; max-height: 200px; overflow-y: auto;">
          <div style="color: var(--text-muted);">Loading latest run...</div>
        </div>
      </div>
        </div>
      </div>
      
      <!-- AI Strategic Digest (Collapsible) -->
      <div class="collapsible-section" data-section="scholar-digest">
        <div class="collapsible-header" onclick="toggleCollapsible(this)">
          <h3>üß† AI Strategic Digest</h3>
          <span class="chevron">‚ñº</span>
        </div>
        <div class="collapsible-content">
      <!-- AI Weekly Digest Section -->
      <div style="margin-bottom: 24px; padding: 16px; background: linear-gradient(135deg, rgba(136, 46, 224, 0.1), rgba(63, 185, 80, 0.1)); border: 1px solid #a855f7; border-radius: 8px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
          <div>
            <h4 style="font-size: 16px; font-weight: 600; color: var(--text-primary); margin: 0;">
              üß† AI Strategic Digest
              <span style="font-size: 10px; padding: 2px 6px; background: #a855f7; color: white; border-radius: 4px; margin-left: 8px;">AI-Powered</span>
            </h4>
          </div>
          <button id="btn-generate-digest" class="btn btn-primary" style="margin: 0; background: #a855f7;">Generate Analysis</button>
          <button class="btn" style="margin: 0;" onclick="saveStrategicDigest()">Save Digest</button>
        </div>
        <div id="scholar-digest-status" style="font-size: 13px; color: var(--text-secondary); margin-bottom: 8px;">
          AI analyzes proposals, gaps, improvements, and research to recommend strategic next steps
        </div>
        <div id="scholar-digest-content" style="display: none; padding: 16px; background: var(--bg); border: 1px solid var(--border); border-radius: 8px; max-height: 500px; overflow-y: auto;">
          <div id="scholar-digest-text" style="font-size: 13px; line-height: 1.7;"></div>
        </div>
      </div>
        </div>
      </div>

      <!-- Saved Digests (Collapsible) -->
      <div class="collapsible-section" data-section="scholar-saved-digests">
        <div class="collapsible-header" onclick="toggleCollapsible(this)">
          <h3>üìÅ Saved Digests</h3>
          <span class="chevron">‚ñº</span>
        </div>
        <div class="collapsible-content">
          <div style="margin-bottom: 24px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
              <h4 style="font-size: 16px; font-weight: 600; color: var(--text-primary); margin: 0;">
                üìÅ Saved Digests
                <span id="saved-digests-count" style="font-size: 12px; color: var(--text-muted); margin-left: 8px;">(0)</span>
              </h4>
              <button class="btn btn-secondary" onclick="loadSavedDigests()" style="font-size: 12px;">Refresh</button>
            </div>
            <div id="saved-digests-list" style="padding: 16px; background: var(--bg); border: 1px solid var(--border); border-radius: 8px; min-height: 60px; max-height: 400px; overflow-y: auto;">
              <div style="color: var(--text-muted); font-size: 13px;">Loading saved digests...</div>
            </div>
          </div>
          
          <!-- Digest Viewer Modal -->
          <div id="digest-viewer-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; justify-content: center; align-items: center;">
            <div style="background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 12px; width: 90%; max-width: 800px; max-height: 90vh; display: flex; flex-direction: column;">
              <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px 20px; border-bottom: 1px solid var(--border);">
                <h3 id="digest-viewer-title" style="margin: 0; font-size: 16px; color: var(--text-primary);">Digest Title</h3>
                <button onclick="closeDigestViewer()" style="background: none; border: none; font-size: 20px; cursor: pointer; color: var(--text-muted);">&times;</button>
              </div>
              <div id="digest-viewer-content" style="padding: 20px; overflow-y: auto; flex: 1; font-size: 13px; line-height: 1.7; white-space: pre-wrap; font-family: monospace;"></div>
              <div style="padding: 12px 20px; border-top: 1px solid var(--border); display: flex; justify-content: flex-end; gap: 8px;">
                <button class="btn btn-secondary" onclick="closeDigestViewer()">Close</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    </section>
    
    <!-- Tutor Tab -->
    <section id="tab-tutor" class="tab-panel">
      <h2 class="page-title" style="font-size: 20px; margin-bottom: 20px;">Tutor</h2>

      <!-- Tutor Chat (First - at top) -->
      <div class="collapsible-section expanded" data-section="tutor-chat">
        <div class="collapsible-header" onclick="toggleCollapsible(this)">
          <h3>üí¨ Ask Tutor</h3>
          <span class="chevron">‚ñº</span>
        </div>
        <div class="collapsible-content" style="display: block;">
      <!-- Tutor Chat -->
      <div class="card" id="tutor-chat" style="margin-bottom: 24px; border: none;">
        <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
          <h2 class="card-title">Chat with Tutor</h2>
          <div style="display: flex; gap: 12px; align-items: center;">
            <div style="display: flex; align-items: center; gap: 8px;">
              <label for="tutor-mode-select" style="font-size: 13px; font-weight: 600; color: var(--text-primary);">Mode:</label>
              <select id="tutor-mode-select" class="form-select" style="min-width: 120px; font-size: 13px;">
                <option value="Core" selected>Core</option>
                <option value="Sprint">Sprint</option>
                <option value="Drill">Drill</option>
              </select>
            </div>
            <button type="button" class="btn btn-secondary" id="btn-tutor-new-session" style="font-size: 13px;">
              üîÑ New Session
            </button>
          </div>
        </div>
        
        <!-- Chat Messages Container -->
        <div id="tutor-chat-messages" style="
          height: 400px;
          overflow-y: auto;
          padding: 16px;
          background: var(--surface-0);
          border: 1px solid var(--border);
          border-radius: 12px;
          margin-bottom: 16px;
          display: flex;
          flex-direction: column;
          gap: 12px;
        ">
          <div class="chat-message tutor" style="align-self: flex-start; max-width: 85%;">
            <div class="chat-sender" style="font-size: 11px; font-weight: 600; color: var(--primary); margin-bottom: 4px;">Tutor</div>
            <div class="chat-bubble" style="
              background: var(--surface-2);
              color: var(--text-primary);
              padding: 12px 16px;
              border-radius: 16px 16px 16px 4px;
              font-size: 14px;
              line-height: 1.5;
            ">Ready to help! Sync your Study folder and ask me anything.</div>
          </div>
        </div>
        
        <!-- Chat Input -->
        <div class="form-section" style="margin: 0;">
          <div style="display: flex; gap: 12px; align-items: flex-end;">
            <div style="flex: 1;">
              <textarea id="tutor-question" class="form-textarea" rows="2" placeholder="Type your question... (Enter to send, Shift+Enter for new line)" style="resize: none;"></textarea>
            </div>
            <button type="button" class="btn btn-primary" id="btn-tutor-send" style="height: 50px; padding: 0 24px;">
              Send
            </button>
          </div>
        </div>
      </div>
        </div>
      </div>

      <!-- RAG Sources (Collapsible - below Ask Tutor) -->
      <div class="collapsible-section" data-section="tutor-rag">
        <div class="collapsible-header" onclick="toggleCollapsible(this)">
          <h3>üìö RAG Sources</h3>
          <span class="chevron">‚ñº</span>
        </div>
        <div class="collapsible-content">
      <!-- Study RAG (folder-synced) + Runtime RAG (toggle catalog) -->
      <div class="card" id="tutor-knowledge" style="margin-bottom: 24px; border: none;">
        <div class="card-header">
          <h2 class="card-title">RAG Sources</h2>
          <p class="card-subtitle" style="font-size: 13px; color: var(--text-secondary); margin-top: 8px;">
            Study RAG and Runtime RAG are separate. Add Study materials by dropping files into a folder, then Sync. Uploads are only used for YouTube/URL links.
          </p>
        </div>

        <!-- Study RAG -->
        <div class="form-section">
          <h4 style="font-size: 14px; font-weight: 700; margin-bottom: 10px;">Study RAG (your materials)</h4>
          
          <!-- Folder Path Configuration -->
          <div style="margin-bottom: 16px; padding: 12px; background: var(--bg); border: 1px solid var(--border); border-radius: 8px;">
            <label style="font-size: 12px; font-weight: 600; color: var(--text-primary); display: block; margin-bottom: 8px;">Study Materials Folder</label>
            <div style="display: flex; gap: 8px; margin-bottom: 8px;">
              <input type="text" id="study-rag-path-input" class="form-input" placeholder="C:\Users\YourName\Documents\StudyMaterials" style="flex: 1; font-family: monospace; font-size: 12px;" />
              <label for="study-rag-folder-picker" class="btn btn-secondary" style="cursor: pointer; margin: 0; display: flex; align-items: center; gap: 4px;">
                üìÅ Browse
              </label>
              <input type="file" id="study-rag-folder-picker" webkitdirectory directory multiple style="display: none;" />
            </div>
            <div style="display: flex; gap: 8px; align-items: center;">
              <button type="button" class="btn btn-primary" id="btn-save-study-path" style="font-size: 12px;">Save Path</button>
              <span id="study-rag-path-status" style="font-size: 12px; color: var(--text-muted);"></span>
            </div>
            <div style="font-size: 11px; color: var(--text-muted); margin-top: 8px;">
              Enter the full path to your study materials folder, or click Browse to select it. This is where your PDFs, notes, and study files live.
            </div>
          </div>

          <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 10px;">
            Current folder: <span id="study-rag-path-display" style="font-family: monospace; color: var(--text-primary);">Loading...</span>
          </div>
          <div class="form-actions" style="margin-bottom: 10px;">
            <button type="button" class="btn btn-primary" id="btn-tutor-study-sync">Sync Study Folder</button>
            <button type="button" class="btn btn-secondary" id="btn-tutor-study-refresh">Refresh Folders</button>
          </div>
          <div id="tutor-study-status"></div>
          <div id="tutor-study-folders" style="max-height: 220px; overflow-y: auto; padding: 12px; background: var(--bg); border: 1px solid var(--border); border-radius: 8px;">
            <div style="color: var(--text-muted); font-size: 13px;">Loading Study folders...</div>
          </div>
        </div>

        <!-- Runtime RAG -->
        <div class="form-section" style="padding-top: 0;">
          <h4 style="font-size: 14px; font-weight: 700; margin-bottom: 10px;">Runtime RAG (systems/engines)</h4>
          <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 10px;">
            These are compact descriptions of systems/engines that shape Tutor behavior. Toggle them on/off.
          </div>
          <div class="form-actions" style="margin-bottom: 10px;">
            <button type="button" class="btn btn-secondary" id="btn-tutor-runtime-refresh">Refresh Runtime Items</button>
          </div>
          <div id="tutor-runtime-items" style="max-height: 220px; overflow-y: auto; padding: 12px; background: var(--bg); border: 1px solid var(--border); border-radius: 8px;">
            <div style="color: var(--text-muted); font-size: 13px;">Loading Runtime items...</div>
          </div>
        </div>

        <!-- YouTube / URL links (only upload-style input) -->
        <div class="form-section" style="padding-top: 0;">
          <h4 style="font-size: 14px; font-weight: 700; margin-bottom: 10px;">YouTube / URL Links</h4>
          <div class="form-grid">
            <div class="form-group">
              <label for="tutor-link-url" class="form-label">Add a YouTube / URL</label>
              <input type="text" id="tutor-link-url" class="form-input" placeholder="https://www.youtube.com/watch?v=..." />
              <div style="font-size: 12px; color: var(--text-muted); margin-top: 6px;">Stored as a Study RAG record (content may be empty until transcript/notes are added).</div>
            </div>
            <div class="form-group">
              <label for="tutor-link-doc-type" class="form-label">Link Type</label>
              <select id="tutor-link-doc-type" class="form-select">
                <option value="youtube">youtube</option>
                <option value="other">other</option>
              </select>
            </div>
          </div>
          <div class="form-actions">
            <button type="button" class="btn btn-secondary" id="btn-tutor-add-link">Add Link</button>
          </div>
          <div id="tutor-upload-status"></div>
        </div>
      </div>
        </div>
      </div>

      <!-- Hidden legacy answer box for compatibility -->
      <div id="tutor-answer-box" style="display: none;"></div>
      <div id="tutor-citations" style="display: none;"></div>
    </section>

    <!-- Brain Tab -->
    <section id="tab-brain" class="tab-panel">
      <h2 class="page-title" style="font-size: 20px; margin-bottom: 20px;">Brain Database</h2>
      
      <div class="collapsible-section" id="brain-stats-section" data-section="brain-stats">
        <div class="collapsible-header" onclick="toggleCollapsible(this)">
          <h3>Database Statistics</h3>
          <span class="chevron">‚ñº</span>
        </div>
        <div class="collapsible-content">
          <div id="brain-stats-grid" class="stats-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 16px; margin-bottom: 16px;">
            <div class="stat-card" style="padding: 16px; background: var(--bg); border: 1px solid var(--border); border-radius: 8px; text-align: center;">
              <div class="stat-value" id="brain-session-count" style="font-size: 24px; font-weight: 700; color: var(--accent);">--</div>
              <div class="stat-label" style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">Sessions</div>
            </div>
            <div class="stat-card" style="padding: 16px; background: var(--bg); border: 1px solid var(--border); border-radius: 8px; text-align: center;">
              <div class="stat-value" id="brain-event-count" style="font-size: 24px; font-weight: 700; color: var(--success);">--</div>
              <div class="stat-label" style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">Syllabus Events</div>
            </div>
            <div class="stat-card" style="padding: 16px; background: var(--bg); border: 1px solid var(--border); border-radius: 8px; text-align: center;">
              <div class="stat-value" id="brain-rag-count" style="font-size: 24px; font-weight: 700; color: var(--purple);">--</div>
              <div class="stat-label" style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">RAG Documents</div>
            </div>
            <div class="stat-card" style="padding: 16px; background: var(--bg); border: 1px solid var(--border); border-radius: 8px; text-align: center;">
              <div class="stat-value" id="brain-pending-cards" style="font-size: 24px; font-weight: 700; color: var(--warning);">--</div>
              <div class="stat-label" style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">Pending Cards</div>
            </div>
            <div class="stat-card" style="padding: 16px; background: var(--bg); border: 1px solid var(--border); border-radius: 8px; text-align: center;">
              <div class="stat-value" id="brain-db-size" style="font-size: 24px; font-weight: 700; color: var(--text-primary);">--</div>
              <div class="stat-label" style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">DB Size (MB)</div>
            </div>
          </div>
          <button class="btn" onclick="loadBrainStatus()" style="margin-top: 12px;">Refresh</button>
        </div>
      </div>
      
      <div class="collapsible-section" id="brain-mastery-section" data-section="brain-mastery" style="margin-top: 24px;">
        <div class="collapsible-header" onclick="toggleCollapsible(this)">
          <h3>Topic Mastery Overview</h3>
          <span class="chevron">‚ñº</span>
        </div>
        <div class="collapsible-content">
          <div id="brain-mastery-list" style="padding: 16px; background: var(--bg); border: 1px solid var(--border); border-radius: 8px; min-height: 60px;">Loading...</div>
        </div>
      </div>
      
      <!-- Ingestion Status Section -->
      <div class="collapsible-section" id="brain-sync-section" data-section="brain-sync" style="margin-top: 24px;">
        <div class="collapsible-header" onclick="toggleCollapsible(this)">
          <h3>Ingestion Status</h3>
          <span class="chevron">‚ñº</span>
        </div>
        <div class="collapsible-content">
          <div style="padding: 16px; background: var(--bg); border: 1px solid var(--border); border-radius: 8px;">
            <div id="sync-status">
              <p style="margin: 0 0 8px 0;"><strong>Files Tracked:</strong> <span id="sync-files-count" style="color: var(--accent);">-</span></p>
              <p style="margin: 0 0 8px 0;"><strong>Valid Sessions:</strong> <span id="sync-sessions-count" style="color: var(--success);">-</span></p>
              <p style="margin: 0;"><strong>Last Sync:</strong> <span id="sync-last-time" style="color: var(--text-muted);">-</span></p>
            </div>
            <div style="display: flex; gap: 8px; margin-top: 16px;">
              <button class="btn btn-primary" onclick="runSync(false)">Sync Now</button>
              <button class="btn btn-secondary" onclick="runSync(true)">Force Re-sync All</button>
            </div>
            <div id="sync-message" style="margin-top: 12px; font-size: 13px;"></div>
          </div>
        </div>
      </div>
      
      <!-- Anki Cards Section -->
      <div class="collapsible-section" id="anki-cards-section" data-section="anki-cards" style="margin-top: 24px;">
        <div class="collapsible-header" onclick="toggleCollapsible(this)">
          <h3 style="display: flex; align-items: center; gap: 12px;">
            üÉè Anki Cards
            <span id="anki-pending-count" style="background: var(--warning); color: #000; font-size: 12px; font-weight: 600; padding: 2px 8px; border-radius: 12px; min-width: 24px; text-align: center;">0</span>
          </h3>
          <span class="chevron">‚ñº</span>
        </div>
        <div class="collapsible-content">
          
          <!-- Connection Status & Actions -->
          <div style="padding: 16px; background: var(--bg); border: 1px solid var(--border); border-radius: 8px; margin-bottom: 16px;">
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px;">
              <div style="display: flex; align-items: center; gap: 12px;">
                <span style="font-weight: 600;">Anki Status:</span>
                <span id="anki-status" style="display: inline-flex; align-items: center; gap: 6px; padding: 4px 12px; border-radius: 20px; font-size: 13px; background: rgba(255,255,255,0.05); border: 1px solid var(--border);">
                  <span style="width: 8px; height: 8px; border-radius: 50%; background: var(--text-muted);"></span>
                  Checking...
                </span>
              </div>
              <div style="display: flex; gap: 8px;">
                <button id="anki-sync-btn" class="btn btn-primary" onclick="syncAnkiCards()" style="display: flex; align-items: center; gap: 6px;">
                  <span>üîÑ</span> Sync to Anki
                </button>
                <button class="btn" onclick="refreshAnkiDrafts()">Refresh</button>
              </div>
            </div>
          </div>
          
          <!-- Card Drafts Table -->
          <div style="padding: 16px; background: var(--bg); border: 1px solid var(--border); border-radius: 8px; margin-bottom: 16px;">
            <h4 style="margin: 0 0 16px 0; font-size: 14px; font-weight: 600;">Card Drafts</h4>
            <div style="overflow-x: auto;">
              <table class="sessions-table" id="anki-drafts-table" style="min-width: 700px;">
                <thead>
                  <tr>
                    <th style="width: 25%;">Front</th>
                    <th style="width: 25%;">Back</th>
                    <th style="width: 80px;">Status</th>
                    <th style="width: 120px;">Course</th>
                    <th style="width: 120px; text-align: center;">Actions</th>
                  </tr>
                </thead>
                <tbody id="anki-drafts-body">
                  <tr>
                    <td colspan="5" style="text-align: center; color: var(--text-muted); padding: 20px;">No card drafts yet.</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          
          <!-- Create New Card Form -->
          <div style="padding: 16px; background: var(--bg); border: 1px solid var(--border); border-radius: 8px;">
            <h4 style="margin: 0 0 16px 0; font-size: 14px; font-weight: 600;">Create New Card Draft</h4>
            <form id="anki-create-form" onsubmit="createAnkiCard(event)">
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                <div class="form-group" style="margin: 0;">
                  <label class="form-label" for="anki-card-front">Front *</label>
                  <textarea id="anki-card-front" class="form-textarea" rows="3" placeholder="Question or prompt..." required style="resize: vertical;"></textarea>
                </div>
                <div class="form-group" style="margin: 0;">
                  <label class="form-label" for="anki-card-back">Back *</label>
                  <textarea id="anki-card-back" class="form-textarea" rows="3" placeholder="Answer or explanation..." required style="resize: vertical;"></textarea>
                </div>
              </div>
              <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                <div class="form-group" style="margin: 0;">
                  <label class="form-label" for="anki-card-type">Card Type</label>
                  <select id="anki-card-type" class="form-select">
                    <option value="Basic">Basic</option>
                    <option value="Basic (and reversed)">Basic (and reversed)</option>
                    <option value="Cloze">Cloze</option>
                  </select>
                </div>
                <div class="form-group" style="margin: 0;">
                  <label class="form-label" for="anki-card-deck">Deck Name</label>
                  <input type="text" id="anki-card-deck" class="form-input" placeholder="PT Study::Default">
                </div>
                <div class="form-group" style="margin: 0;">
                  <label class="form-label" for="anki-card-course">Course (optional)</label>
                  <select id="anki-card-course" class="form-select">
                    <option value="">-- No Course --</option>
                  </select>
                </div>
              </div>
              <div class="form-actions" style="display: flex; gap: 8px;">
                <button type="submit" class="btn btn-primary">Add Card Draft</button>
                <button type="reset" class="btn btn-secondary">Clear</button>
              </div>
              <div id="anki-create-status" style="margin-top: 8px; font-size: 13px;"></div>
            </form>
          </div>
          
        </div>
      </div>
    </section>
  </main>

  <!-- Proposal Viewer Modal -->
  <div id="proposal-modal-overlay" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 1000; align-items: center; justify-content: center;">
    <div id="proposal-modal" style="background: var(--card-bg); border: 1px solid var(--border); border-radius: 12px; max-width: 800px; width: 90%; max-height: 85vh; display: flex; flex-direction: column; box-shadow: 0 20px 60px rgba(0,0,0,0.4);">
      <!-- Modal Header -->
      <div style="padding: 16px 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center;">
        <div>
          <h3 id="proposal-modal-title" style="margin: 0; font-size: 18px; color: var(--text-primary);">Proposal</h3>
          <div id="proposal-modal-meta" style="font-size: 12px; color: var(--text-muted); margin-top: 4px;"></div>
        </div>
        <button onclick="closeProposalModal()" style="background: none; border: none; font-size: 24px; color: var(--text-muted); cursor: pointer; padding: 0 8px;">&times;</button>
      </div>
      <!-- Modal Content -->
      <div id="proposal-modal-content" style="flex: 1; overflow-y: auto; padding: 20px; font-family: monospace; font-size: 13px; white-space: pre-wrap; line-height: 1.6; color: var(--text-secondary); background: var(--bg);">
        Loading...
      </div>
      <!-- Modal Actions -->
      <div style="padding: 16px 20px; border-top: 1px solid var(--border); display: flex; gap: 12px; justify-content: flex-end;">
        <button id="proposal-reject-btn" class="btn" style="background: var(--danger); color: white;" onclick="handleProposalAction('reject')">‚ùå Reject</button>
        <button id="proposal-approve-btn" class="btn btn-primary" style="background: var(--success);" onclick="handleProposalAction('approve')">‚úì Approve</button>
        <button class="btn btn-secondary" onclick="closeProposalModal()">Close</button>
      </div>
    </div>
  </div>

  <!-- Event Edit Modal -->
  <div id="event-edit-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content" style="background: var(--card-bg); border: 1px solid var(--border); border-radius: 12px; padding: 24px; max-width: 500px; width: 90%; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h3 style="margin: 0; font-size: 18px;">Edit Event</h3>
        <button type="button" onclick="closeEventEditModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: var(--text-muted);">&times;</button>
      </div>
      <form id="event-edit-form">
        <input type="hidden" id="edit-event-id">
        <div class="form-group" style="margin-bottom: 16px;">
          <label class="form-label" for="edit-event-title">Title</label>
          <input type="text" id="edit-event-title" class="form-input" required>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
          <div class="form-group" style="margin: 0;">
            <label class="form-label" for="edit-event-type">Type</label>
            <select id="edit-event-type" class="form-select">
              <option value="lecture">Lecture</option>
              <option value="reading">Reading</option>
              <option value="quiz">Quiz</option>
              <option value="exam">Exam</option>
              <option value="assignment">Assignment</option>
              <option value="other">Other</option>
            </select>
          </div>
          <div class="form-group" style="margin: 0;">
            <label class="form-label" for="edit-event-status">Status</label>
            <select id="edit-event-status" class="form-select">
              <option value="pending">Pending</option>
              <option value="completed">Completed</option>
              <option value="cancelled">Cancelled</option>
            </select>
          </div>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
          <div class="form-group" style="margin: 0;">
            <label class="form-label" for="edit-event-date">Date</label>
            <input type="date" id="edit-event-date" class="form-input">
          </div>
          <div class="form-group" style="margin: 0;">
            <label class="form-label" for="edit-event-due-date">Due Date</label>
            <input type="date" id="edit-event-due-date" class="form-input">
          </div>
        </div>
        <div class="form-group" style="margin-bottom: 16px;">
          <label class="form-label" for="edit-event-weight">Weight (0-1)</label>
          <input type="number" id="edit-event-weight" class="form-input" step="0.01" min="0" max="1">
        </div>
        <div class="form-group" style="margin-bottom: 20px;">
          <label class="form-label" for="edit-event-details">Details</label>
          <textarea id="edit-event-details" class="form-textarea" rows="3"></textarea>
        </div>
        <div style="display: flex; gap: 12px; justify-content: flex-end; align-items: center;">
          <button type="button" class="btn" style="color: var(--error); margin-right: auto;" onclick="deleteEvent()">Delete</button>
          <button type="button" class="btn" onclick="closeEventEditModal()">Cancel</button>
          <button type="submit" class="btn btn-primary">Save Changes</button>
        </div>
      </form>
      <div id="event-edit-status" style="margin-top: 12px; font-size: 13px;"></div>
    </div>
  </div>

  <style>
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      backdrop-filter: blur(4px);
    }
    .session-detail-row {
      background: rgba(255, 255, 255, 0.03);
    }
    .session-detail-row td {
      padding: 16px 12px;
    }
    .session-detail-row.hidden {
      display: none;
    }
  </style>

  <!-- Edit Session Modal -->
  <div id="edit-session-modal" class="modal-overlay" style="display: none;">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Edit Session</h3>
        <button type="button" class="modal-close" onclick="closeEditModal()">
          <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      <form id="edit-session-form" onsubmit="saveSession(event)">
        <div class="modal-body">
          <input type="hidden" id="edit-session-id" />
          
          <!-- Row 1: Date, Start Time, End Time -->
          <div class="modal-form-grid">
            <div class="form-group">
              <label for="edit-date" class="form-label">Date</label>
              <input type="date" id="edit-date" class="form-input" required />
            </div>
            <div class="form-group">
              <label for="edit-start-time" class="form-label">Start Time</label>
              <input type="time" id="edit-start-time" class="form-input" />
            </div>
            <div class="form-group">
              <label for="edit-end-time" class="form-label">End Time</label>
              <input type="time" id="edit-end-time" class="form-input" />
            </div>
          </div>

          <!-- Row 2: Course, Topic, Study Mode -->
          <div class="modal-form-grid">
            <div class="form-group">
              <label for="edit-course" class="form-label">Course</label>
              <input type="text" id="edit-course" class="form-input" placeholder="e.g., Anatomy I" />
            </div>
            <div class="form-group">
              <label for="edit-topic" class="form-label">Topic</label>
              <input type="text" id="edit-topic" class="form-input" placeholder="e.g., Gluteal Region" required />
            </div>
            <div class="form-group">
              <label for="edit-study-mode" class="form-label">Study Mode</label>
              <select id="edit-study-mode" class="form-select">
                <option value="Core">Core</option>
                <option value="Sprint">Sprint</option>
                <option value="Drill">Drill</option>
              </select>
            </div>
          </div>

          <!-- Row 3: Duration & Scores -->
          <div class="modal-form-grid">
            <div class="form-group">
              <label for="edit-duration" class="form-label">Duration (minutes)</label>
              <input type="number" id="edit-duration" class="form-input" min="1" placeholder="60" />
            </div>
            <div class="form-group">
              <label for="edit-understanding" class="form-label">Understanding (1-5)</label>
              <input type="number" id="edit-understanding" class="form-input" min="1" max="5" />
            </div>
            <div class="form-group">
              <label for="edit-retention" class="form-label">Retention (1-5)</label>
              <input type="number" id="edit-retention" class="form-input" min="1" max="5" />
            </div>
          </div>

          <!-- Row 4: System Performance & Emotional Check-in -->
          <div class="modal-form-grid-2">
            <div class="form-group">
              <label for="edit-system-performance" class="form-label">System Performance (1-5)</label>
              <input type="number" id="edit-system-performance" class="form-input" min="1" max="5" />
            </div>
            <div class="form-group">
              <label for="edit-emotional" class="form-label">Emotional Check-in</label>
              <input type="text" id="edit-emotional" class="form-input" placeholder="e.g., focused, tired" />
            </div>
          </div>

          <!-- Goal -->
          <div class="form-group">
            <label for="edit-goal" class="form-label">Goal</label>
            <textarea id="edit-goal" class="form-textarea" rows="2" placeholder="Session goal..."></textarea>
          </div>

          <!-- Session Summary -->
          <div class="form-group">
            <label for="edit-summary" class="form-label">Session Summary</label>
            <textarea id="edit-summary" class="form-textarea" rows="3" placeholder="What was covered..."></textarea>
          </div>

          <!-- Wins -->
          <div class="form-group">
            <label for="edit-wins" class="form-label">Wins (What Worked)</label>
            <textarea id="edit-wins" class="form-textarea" rows="2" placeholder="What went well..."></textarea>
          </div>

          <!-- Friction Points -->
          <div class="form-group">
            <label for="edit-friction" class="form-label">Friction Points (What Needs Fixing)</label>
            <textarea id="edit-friction" class="form-textarea" rows="2" placeholder="Challenges encountered..."></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" onclick="closeEditModal()">Cancel</button>
          <button type="submit" class="btn btn-primary">Save Changes</button>
        </div>
      </form>
    </div>
  </div>
  
</body>
</html>
