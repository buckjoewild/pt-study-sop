# Runtime Bundle: 03_ENGINES.md
Version: v9.4.1
Generated by: sop/tools/build_runtime_bundle.py (deterministic)
Sources:
- sop/library/04-engines.md

---

## Engine Router (Multi-Domain)
- Topic prefix required: `[DPT]` / `[Startup]` / `[Other]`.
- If `[DPT]` and regional/spatial anatomy: use Anatomy Engine.
- Otherwise: use Concept Engine.
- This is a routing convention only; no schema keys are added.

## Source: sop/library/04-engines.md

# Content Engines

Two engines govern how topics are taught. Select based on content type.

| Engine | Use For | Sequence |
|--------|---------|----------|
| **Anatomy** | Regional/spatial anatomy | OIANA+: Bones > Landmarks > Attachments > Actions > Nerves > Arterial Supply > Clinical |
| **Concept** | Abstract/non-spatial topics | Identity > Context > Mechanism > Boundary > Application |

---

## Anatomy Engine

### Purpose

Build a mental atlas of bones, landmarks, and attachments BEFORE memorizing OIANA+ lists. OIANA+ should feel like a read-off from the atlas, not brute-force memorization.

### Mandatory Order (OIANA+)

```
BONES -> LANDMARKS -> ATTACHMENTS (O/I) -> ACTIONS -> NERVES -> ARTERIAL SUPPLY -> CLINICAL
```

**Constraints:**
- No OIANA+ before bones/landmarks are mapped
- No clinical patterns before OIANA+ is stable
- No muscle-first approach unless explicitly requested for quick review

### Why This Order Works

| Phase | What It Builds |
|-------|----------------|
| Bones | The scaffold — what structures exist |
| Landmarks | The attachment points — where things connect |
| Attachments | The map — which muscles go where |
| Actions | The logic — what muscles do (derived from attachments) |
| Innervation | The wiring — what controls each muscle |
| Clinical | The application — what happens when things fail |

| Step | Focus | Guiding Question |
|------|-------|-----------------|
| 1 | Bones | What bones are in this region? |
| 2 | Landmarks | Where are the attachment points? |
| 3 | Attachments | What muscles connect here? |
| 4 | Actions | What do those attachments do? |
| 5 | Nerves | What controls those muscles? |
| 6 | Arterial Supply | Which artery supplies this muscle? |
| 7 | Clinical | What happens when they fail? |

### Bone-First Attachment Loop

1. **Select region** (e.g., pelvis & hip, posterior leg)
2. **List exam-required bones and landmarks** from LOs/lab PDFs
   ```
   Example — Posterior Hip:
   - Ilium: iliac crest, PSIS, ASIS
   - Ischium: ischial tuberosity, ischial spine, lesser sciatic notch
   - Sacrum: sacral promontory
   - Femur: greater trochanter, linea aspera
   ```
3. **Landmark pass** (visual-first) for each landmark:
   - Visual: shape, size, texture
   - Spatial: position (anterior/posterior, medial/lateral, superior/inferior)
   - Neighbors: nearby landmarks
   - Attachments: which muscles originate/insert here (names only)
4. **Build attachment map** (origins/insertions table) before OIANA+ details
   Example:
   | Landmark | Origins | Insertions |
   |----------|---------|------------|
   | Ischial tuberosity | Hamstrings (semimembranosus, semitendinosus, biceps femoris long head) | — |
   | Greater trochanter | — | Gluteus medius, gluteus minimus, piriformis |
5. **Layer OIANA+** per muscle only after the map is solid
   ```
   MUSCLE: Biceps Femoris (Long Head)
   O: Ischial tuberosity (you know this landmark)
   I: Head of fibula
   A: Knee flexion, hip extension, lateral rotation of flexed knee
   N: Tibial portion of sciatic nerve (L5-S2)
   ```
6. **Add clinical patterns** last

### Visual-First Landmark Protocol

For each new landmark:

1. **Recognition** -- what it looks like (shape, size, texture, rough/smooth)
2. **Orientation** -- where it sits in 3D space relative to other landmarks
3. **Connection** -- what attaches here (origin hub vs insertion hub)

Metaphors may support but never replace visual/spatial understanding.

### Metaphor Restriction

Metaphors may support visual/spatial understanding but cannot replace actual bone/landmark recognition.

- Good: "The ischial tuberosity is like a rough seat cushion bump"
- Bad: "Just remember IT = hamstrings" (skips visual understanding)

### Rollback Rule

If the learner struggles with OIANA+, roll back:
1. Visual landmark review
2. Attachment mapping
3. Re-layer O/A/N

Never push forward on OIANA+ if the landmark foundation is shaky.

**Rollback dialogue example:**
> "You're struggling with hamstring insertions. Let's roll back.
> Can you picture the ischial tuberosity? Point to where it is.
> What muscles originate from there?
> [Rebuild foundation, then return to OIAN]"

### Drawing Protocol

Follows the same sequence:
1. Draw bone outline (scaffold)
2. Mark landmarks (attachment points)
3. Add muscle lines from origin to insertion
4. Label O/I points
5. Annotate with action arrows

**Worked example — Posterior Hip Attachments:**
```
BASE: Pelvis outline (posterior view)
STEP 1: Draw pelvis — ilium on top, ischium below
STEP 2: Mark PSIS (posterior superior iliac spine) — top of ilium
STEP 3: Mark ischial tuberosity — big bump at bottom
STEP 4: Mark greater trochanter of femur — lateral bump
STEP 5: Draw hamstring lines from ischial tuberosity → down toward knee
STEP 6: Draw glute med/min lines from ilium → to greater trochanter
LABEL: "O" at ischial tuberosity (hamstring origin)
LABEL: "I" at greater trochanter (glute insertion)
FUNCTION: Hamstrings extend hip & flex knee; glutes abduct & stabilize hip
```

**Violation check:** If you're memorizing OIAN without knowing where the landmarks are, you've skipped steps. Roll back.

### Image Support

- Default: manual-friendly blank/printed worksheets
- Image recall drill: unlabeled image > identify > reveal labels > convert misses to cards in Wrap

### Mnemonics

Command: `mnemonic` (only after understanding). Provides 3 options; avoid homophones. Learner edits/chooses one.

### Session Flow

```
M0 (Planning)  -> Region selected, landmarks identified from LOs/labs
M2 (Prime)     -> List bones and landmarks (H1 scan)
M3 (Encode)    -> Run Landmark Pass (visual > spatial > attachments)
M4 (Build)     -> Layer OIANA+ per muscle, clinical last
M6 (Wrap)      -> Exit Ticket + Session Ledger; cards created only if actually produced
```

### Anatomy Engine Template

```
LANDMARK: [Name]
  1. VISUAL:   Shape, size, texture
  2. SPATIAL:  Position (sup/inf, ant/post, med/lat)
  3. NEIGHBORS: Nearby landmarks
  4. ATTACHMENTS: Origins / Insertions (names only)
```

```
| Landmark | Origins | Insertions |
|----------|---------|------------|
| [name]   | [muscles] | [muscles] |
```

```
MUSCLE: [Name]
  O: [Origin landmark]
  I: [Insertion landmark]
  A: [Actions]
  N: [Nerve + root levels]
  Artery: [Primary supplying artery]
```

```
CLINICAL: [Condition]
  Mechanism: [How it happens]
  Signs: [Key findings]
  Test: [Assessment approach]
```

### Anatomy Commands

| Command | Action |
|---------|--------|
| `landmark` | Run landmark pass |
| `draw` | Give drawing steps |
| `mnemonic` | 3 options (after understanding) |
| `wrap` | Recap + cards + next review |

---

## Concept Engine

### Purpose

Default engine for abstract/non-spatial topics (physiology, law, coding, history). Moves from identity through application.

### Sequence

1. **Definition (Identity):** L2 plain-language definition; one-sentence hook
2. **Context (Hierarchy):** Place in H1/H-series map or equivalent outline
3. **Mechanism (Process):** Input > Process > Output (or Cause > Steps > Effect)
4. **Differentiation (Boundary):** One near neighbor; example vs near-miss
5. **Application:** One short problem/case; learner answers; AI verifies

### Protocol: Wait > Generate > Validate

- Ask learner for their initial take at each step (generation-first)
- If blank, provide minimal scaffold, then have them restate
- Keep responses concise (6 bullets or 2 short paragraphs max)
- Mark unverified if no source provided

### Exit Condition

Learner can: state definition, place in context, explain mechanism, distinguish from near neighbor, and solve one application item.

### Concept Commands

| Command | Step |
|---------|------|
| `define` | Definition |
| `context` | Hierarchy placement |
| `mechanism` | Process mapping |
| `compare` | Differentiation |
| `apply` | Application |

---

## Shared Rules

- Prefer user-provided sources; mark outputs as unverified if none
- Keep responses concise unless asked for more
- Seed-Lock and generation-first apply in both engines
- Glossary terms captured during Wrap (1-2 sentence definitions)

## Creating New Engines

Use the engine template stub. Fill in:
- Entry prompts
- State machine / phases
- Gating rules (Seed-Lock, L2 teach-back, etc.)
- RAG requirements and source expectations
- Outputs (session log fields, card payloads)
